<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Injectionâ…¢]]></title>
    <url>%2F2019%2F03%2F24%2F%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B%2Finjection%E2%85%A2%2F</url>
    <content type="text"><![CDATA[å·¥å…·ç®€ä»‹Injectionâ…¢æ˜¯ä½œè€…John Holdsworthå¼€æºçš„ä¸€æ¬¾iOSçƒ­é‡è½½å·¥å…·ï¼Œå½“APPåœ¨æ¨¡æ‹Ÿå™¨ä¸Šç¼–è¯‘è¿è¡ŒåŽï¼Œä½¿ç”¨å®ƒå¯ä»¥å³æ—¶çš„æ‰§è¡Œé¡¹ç›®ä¸­ä»£ç çš„æ”¹åŠ¨ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ï¼Œä»Žè€Œæžå¤§çš„æé«˜ä»£ç çš„è°ƒè¯•æ•ˆçŽ‡ã€‚ Injectionâ…¢å¤§æ¦‚çš„å·¥ä½œåŽŸç†æ˜¯ï¼š åœ¨APPå¯åŠ¨æ—¶ï¼Œä»¥åŠ è½½NSBundleçš„å½¢å¼åœ¨APPä¸­è¿è¡Œä¸€ä¸ªClientç«¯ï¼› Injectionâ…¢ä½œä¸ºServerç«¯ç›‘è§†æŒ‡å®šç›®å½•ä¸‹æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œå½“æ–‡ä»¶å‘ç”Ÿæ”¹åŠ¨æ—¶å°†æ”¹åŠ¨çš„æ–‡ä»¶é‡æ–°ç¼–è¯‘ä¸ºä¸€ä¸ªåŠ¨æ€åº“ï¼› åŠ¨æ€åº“ç¼–è¯‘å®ŒæˆåŽï¼Œé€šè¿‡socketé€šä¿¡é€šçŸ¥Clientç«¯ï¼Œè®©APPåŽ»åŠ è½½è¿™ä¸ªåŠ¨æ€åº“ï¼ˆdlopenï¼‰ï¼› åŠ¨æ€åº“åŠ è½½å®ŒæˆåŽï¼Œå†é€šè¿‡Runtimeçš„class_replaceMethodå°†åŽŸæ¥ç±»ä¸­çš„æ–¹æ³•éƒ½æ›¿æ¢ä¸ºåŠ¨æ€åº“ä¸­æ–°ç±»çš„æ–¹æ³•ï¼› æœ€åŽå†è°ƒç”¨æ–‡ä»¶ä¸­çš„ç±»åŠå…¶å¯¹è±¡çš„injectedæ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å…¶ä¸­è°ƒç”¨ä¿®æ”¹åŽçš„ä»£ç ï¼› æœ€ç»ˆå®Œæˆäº†å¯¹å½“å‰æ–‡ä»¶ä¸­ä»£ç æ”¹åŠ¨çš„åŠ¨æ€è°ƒè¯•ï¼› å·¥å…·æ•™ç¨‹1.å®‰è£…Injectionâ…¢å¯ä»¥åœ¨Macçš„åº”ç”¨å•†åº—ä¸­ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æºç å®‰è£…ï¼šcloneæˆ–è€…ä¸‹è½½æºç ï¼Œæž„å»ºæºç ä¸­çš„Injectionâ…¢.xcodeprojå·¥ç¨‹å³å¯ã€‚å¦‚æžœé€šè¿‡æºç å®‰è£…ï¼Œå¸è½½æ—¶åˆ é™¤æž„å»ºæºç æ—¶ç”Ÿæˆçš„xcodeæ’ä»¶å³å¯ï¼Œç»ˆç«¯å‘½ä»¤ï¼š 1rm -rf ~/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins/InjectionPlugin.xcplugin 2.ä½¿ç”¨é¦–å…ˆåœ¨Injectionâ…¢ä¸­é€šè¿‡Open Projectæˆ–Add Directoryæ·»åŠ éœ€è¦ç›‘è§†çš„æ–‡ä»¶ç›®å½•ï¼Œå¹¶å‹¾é€‰File Watcherã€‚ ç„¶åŽåœ¨application:DidFinishLaunching:ä¸­åŠ è½½Injectionçš„åŠ¨æ€åº“ï¼š 12345678#if DEBUG // iOS [[NSBundle bundleWithPath:@"/Applications/InjectionIII.app/Contents/Resources/iOSInjection.bundle"] load]; // tvOS// [[NSBundle bundleWithPath:@"/Applications/InjectionIII.app/Contents/Resources/tvOSInjection.bundle"] load]; // macOS// [[NSBundle bundleWithPath:@"/Applications/InjectionIII.app/Contents/Resources/macOSInjection.bundle"] load];#endif å†åœ¨éœ€è¦è¢«ç›‘è§†æ”¹åŠ¨çš„ä»£ç æ–‡ä»¶ä¸­æ·»åŠ ç±»é‡è½½åŽçš„ä»£ç æ‰§è¡Œå…¥å£ï¼š 123456789+ (void)injected&#123; // ä»£ç æ”¹åŠ¨æˆ–è°ƒç”¨æ”¹åŠ¨çš„ä»£ç &#125;- (void)injected&#123; // ä»£ç æ”¹åŠ¨æˆ–è°ƒç”¨æ”¹åŠ¨çš„ä»£ç &#125; æœ€åŽè¿è¡Œå·¥ç¨‹ï¼Œå½“æŽ§åˆ¶å°è¾“å‡ºâ€œðŸ’‰ Injection connected ðŸ‘â€ï¼Œå³è¡¨ç¤ºInjectionâ…¢æ­£å¸¸è¿è¡Œã€‚ APPè¿è¡Œä¸­ï¼Œå¯¹ä»£ç æ–‡ä»¶åšå‡ºä¿®æ”¹å¹¶é€šè¿‡Command+sä¿å­˜åŽï¼Œè¢«ä¿®æ”¹æ–‡ä»¶ä¸­çš„æ‰€æœ‰ç±»çš„+injectedåŠå…¶å¯¹è±¡çš„-injectedæ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ï¼Œåœ¨æ–¹æ³•ä¸­ç›´æŽ¥æ·»åŠ è°ƒè¯•ä»£ç æˆ–è°ƒç”¨å‘ç”Ÿæ”¹åŠ¨çš„ä»£ç ï¼Œå³å¯å¯¹è¿è¡Œä¸­çš„APPè¿›è¡ŒåŠ¨æ€è°ƒè¯•ã€‚ 3.æ³¨æ„åœ¨ä½¿ç”¨Injectionâ…¢æ—¶éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š Injectionâ…¢åªèƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸­ä½¿ç”¨ï¼Œç›®å‰è¿˜ä¸èƒ½è¿›è¡ŒçœŸæœºè°ƒè¯•ï¼› Injectionâ…¢åŠ¨æ€è°ƒè¯•æ—¶ï¼Œæ–°å¢žçš„ç±»/æ–¹æ³•/å±žæ€§/å˜é‡ä¼šç”Ÿæ•ˆï¼Œåˆ é™¤çš„ç±»/æ–¹æ³•/å±žæ€§/å˜é‡ä»ç„¶å¯ä»¥åŠ¨æ€è®¿é—®ï¼› Injectionâ…¢åªç›‘è§†å½“å‰æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œå¦‚æžœè¦åŠ¨æ€æ–°å¢žç±»ï¼Œéœ€è¦åœ¨å½“å‰æ–‡ä»¶ä¸­æ–°å¢žï¼› é—®é¢˜è®°å½•Could not find fileè®°å½•æ—¥æœŸï¼š2020-04-03 é”™è¯¯æç¤ºï¼šå¦‚ä¸‹ï¼ˆç›®æ ‡ã€æ–‡ä»¶åç­‰å·²çœç•¥ï¼‰ 12345ðŸ’‰ *** Compiling /xxx.m ***ðŸ’‰ *** Re-compilation failed (... .../com.johnholdsworth.InjectionIII/Data/command.sh)fatal error: malformed or corrupted AST file: &apos;could not find file &apos;... .../Pods/BaiduMapKit/BaiduMapKit/BaiduMapAPI_Search.framework/Headers/BMKPOISearchResult.h&apos; referenced by AST file &apos;... .../PrefixHeader.pch.gch&apos;&apos;note: after modifying system headers, please delete the module cache at &apos;/... ...&apos;1 error generated. é”™è¯¯åŽŸå› ï¼šPrefixHeaderä¸­å¼•ç”¨äº†BaiduMapKitï¼Œè€ŒBaiduMapKitä¸­å¯¹æ–‡ä»¶çš„å¼•ç”¨ï¼ˆåŒ…æ‹¬BMKPOISearchResult.hï¼‰ï¼Œæœ‰ä¸¤å¤„æ–‡ä»¶åçš„å¤§å°å†™ä¸æ­£ç¡®ï¼Œå¯¼è‡´Injectionâ…¢å¯¹å˜åŠ¨çš„æ–‡ä»¶é‡æ–°ç¼–è¯‘æ—¶å¤±è´¥ã€‚ é”™è¯¯åˆ†æžï¼šXCodeä¸­importæ–‡ä»¶åå¤§å°å†™ä¸æ­£ç¡®æ—¶ä¼šæŠ¥â€œNon-portable pathâ€çš„è­¦å‘Šï¼Œåœ¨Injectionâ…¢è¿™å„¿å³å¯¼è‡´äº†é‡ç¼–è¯‘çš„å¤±è´¥ï¼ŒåŒæ—¶ä¿¡æ¯ä¸­ä¹Ÿè¯´æ˜ŽInjectionâ…¢é‡ç¼–è¯‘æ—¶ä½¿ç”¨äº†PrefixHeader.pchç­‰system headersçš„ç¼–è¯‘ç¼“å­˜ã€‚]]></content>
      <categories>
        <category>å·¥å…·æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>injectionâ…¢</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…­ã€ç½‘ç»œå±‚çš„æž¶æž„è®¾è®¡]]></title>
    <url>%2F2019%2F01%2F20%2FAPP%E6%9E%B6%E6%9E%84%2F%E5%85%AD%E3%80%81%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%2F</url>
    <content type="text"><![CDATA[Reference:App Architecture æ·»åŠ ç½‘ç»œçš„æŒ‘æˆ˜ä¸ºç¨‹åºæ·»åŠ ç½‘ç»œæ”¯æŒæ—¶ï¼Œä¼šé¢ä¸´ä¸€äº›é¢å¤–çš„æŒ‘æˆ˜ï¼Œè¿™ä¸æ˜¯æŸä¸ªæž¶æž„æ‰€ç‰¹æœ‰çš„é—®é¢˜ï¼Œä¹Ÿå’Œæœ¬èŠ‚ä¸­å¯¹äºŽç½‘ç»œå±‚å¦‚ä½•æž¶æž„çš„è®¨è®ºæ— å…³ï¼Œä½†æ˜¯å¯¹äºŽä¸€æ¬¾éœ€è¦ä»Žç½‘ç»œä¸­èŽ·å–æ•°æ®çš„APPï¼Œæˆ–å¤šæˆ–å°‘éƒ½éœ€è¦æ¸…æ¥šå¯¹äºŽè¿™äº›é—®é¢˜çš„æ€è€ƒï¼š é¢å¤–çš„å¤±è´¥æ¥æºï¼šä»»ä½•ä»Žç½‘ç»œèŽ·å–æ•°æ®çš„å°è¯•ï¼Œéƒ½å¯èƒ½ç”±äºŽä¸€ç³»åˆ—çš„ç†ç”±ä»¥å¤±è´¥è€Œå‘Šç»ˆã€‚æˆ‘ä»¬å¿…é¡»è€ƒè™‘å¦‚ä½•ä¼˜é›…åœ°å¤„ç†è¿™äº›é”™è¯¯ï¼Œè€Œä¸”ç»å¸¸è¿˜è¦ä¸ºå±•ç¤ºè¿™äº›é”™è¯¯åˆ›å»ºé¢å¤–çš„UIã€‚ èŽ·å–æœ€æ–°æ•°æ®å‰¯æœ¬ï¼šæŒç»­ä»Žç½‘ç»œç›‘å¬æ•°æ®è¦æ¯”è§‚å¯Ÿæœ¬åœ°æ•°æ®å›°éš¾å¾—å¤šï¼Œè¿™å¾€å¾€å¯¼è‡´æˆ‘ä»¬éœ€è¦å‘¨æœŸæ€§åœ°æ‰‹åŠ¨èŽ·å–æ•°æ®ã€‚ å¤šç«¯é—´çš„æ•°æ®å†²çªï¼šç½‘ç»œå¼•å…¥äº†å¤šç«¯æ›´æ–°åŒä¸€ä¸ªæ•°æ®çš„å¯èƒ½æ€§ï¼Œè¿™å¯èƒ½å¯¼è‡´æ½œåœ¨çš„å†²çªã€‚ç½‘ç»œä¸Šçš„æ•°æ®å¯èƒ½ä¼šæœ‰ç‹¬ç«‹äºŽappçš„æ›´æ”¹ã€å¼•ç”¨çš„èµ„æºå¯èƒ½ä¼šåœ¨ä¸é€šçŸ¥å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ç›´æŽ¥å¤±æ•ˆã€ä¸¤ä¸ªå®¢æˆ·ç«¯æœ‰å¯èƒ½æ›´æ–°äº†åŒæ ·çš„å¯¹è±¡ã€‚ å¯¹äºŽä¸¤ä¸ªå®¢æˆ·ç«¯æ›´æ–°äº†åŒæ ·çš„å¯¹è±¡ï¼Œè¿™å¿…é¡»è®©æœåŠ¡å™¨ä»Žä¸¤è€…é—´é€‰æ‹©å‡ºå“ªä¸€ä¸ªåº”è¯¥èƒœå‡ºï¼Œå¹¶ä¸”å‘Šè¯‰æ¯ä¸€ä¸ªå®¢æˆ·ç«¯å†²çªçš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒiCloudå…³äºŽè§£å†³æ–‡æ¡£å†²çªçš„æ–¹å¼å’Œç›¸å…³æ€è€ƒã€‚ æ·»åŠ ç½‘ç»œå±‚çš„æ–¹å¼ä¸ºAPPæ·»åŠ ç½‘ç»œå±‚æœ‰ä¸¤ç§å¸¸è§çš„æ–¹å¼ï¼š Controllerå±‚æŒæœ‰ç½‘ç»œï¼šå°†modelå±‚ç§»é™¤ï¼Œå¹¶è®©controlleræ¥å¤„ç†ç½‘ç»œè¯·æ±‚ã€‚æ•°æ®ç›´æŽ¥ä»Žç½‘ç»œèŽ·å–ï¼Œä»Žç½‘ç»œèŽ·å¾—çš„æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œè€Œæ˜¯ç”±controllerè´Ÿè´£å°†å®ƒä»¬ä»¥å¤„ç†view stateç›¸åŒçš„æ–¹å¼ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚è¿™ç§æ–¹å¼éžå¸¸çš„ç®€å•ç›´æŽ¥ï¼Œä¸»è¦é—®é¢˜åœ¨äºŽä¸åŒçš„controllerä¹‹é—´è¿›è¡Œæ•°æ®å…±äº«å˜å¾—éžå¸¸éº»çƒ¦ã€‚ Modelå±‚æŒæœ‰ç½‘ç»œï¼šä¿ç•™modelå±‚ï¼Œå¹¶åœ¨modelçš„ä¸‹æ–¹åŠ å…¥äº†ä¸€ä¸ªç½‘ç»œå±‚ã€‚modelè´Ÿè´£è§¦å‘å’Œç®¡ç†ç½‘ç»œè¯·æ±‚ï¼Œå¹¶æŒ‰ç…§éœ€è¦ç”¨è¯·æ±‚çš„ç»“æžœæ¥æ›´æ–°modelï¼Œmodelçš„å˜æ›´ä¾ç„¶é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼ä¼ é€’ç»™controllerã€‚åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œå°è£…çš„ç½‘ç»œæœåŠ¡å¯ä»¥æä¾›æŽ¥å£ç›´æŽ¥ç”±modelå±‚è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è§‚å¯Ÿmodelçš„å˜æ›´ç„¶åŽè¿›è¡Œæ•°æ®åŒæ­¥çš„ç½‘ç»œæ´»åŠ¨ï¼ŒåŽè€…modelå±‚å’Œç½‘ç»œå±‚ä¹‹é—´çš„è€¦åˆæ›´ä½Žï¼›å› ä¸ºä¿ç•™äº†modelå±‚ï¼Œåˆ©äºŽä¸åŒcontrolleré—´æ•°æ®å…±äº«çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„åšç¦»çº¿ç¼“å­˜ã€‚ Controllerå±‚æŒæœ‰ç½‘ç»œ1.èŽ·å–åˆå§‹æ•°æ®controllerå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¸”åœ¨æ•°æ®è¿”å›žæ—¶å¯¹viewè¿›è¡Œé…ç½®ï¼Œcontrolleråªç»´æŠ¤å‰ä¸€æ¬¡è¯·æ±‚æ‰€èŽ·å–çš„æ•°æ®çš„å†…å­˜ç¼“å­˜ã€‚å› ä¸ºç½‘ç»œèŽ·å–æ•°æ®æ˜¯ä¸€ç§å»¶æ—¶æ“ä½œï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ æ•°æ®èŽ·å–è¿‡ç¨‹å¤„äºŽä¸åŒçš„çŠ¶æ€ã€å·²ç»çŠ¶æ€å˜æ›´çš„é¢å¤–é€»è¾‘ã€‚ 2.æ›´æ”¹æ•°æ®æ•°æ®çš„æ›´æ”¹çŽ°åœ¨ä¹Ÿæ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œæ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡ï¼Œview actionä¼ é€’åˆ°controllerä¸­ï¼Œcontrollerå‘èµ·æ•°æ®å˜æ›´çš„ç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¸”åœ¨æ•°æ®è¿”å›žæ—¶æ›´æ–°viewã€‚ 3.æ€è€ƒ&amp;è®¨è®ºControllerå±‚æŒæœ‰ç½‘ç»œå°†å¤§é‡çš„æ–°çš„èŒè´£æ”¾åˆ°äº†controllerä¸­ï¼ŒåŒ…æ‹¬å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¤„ç†ç»“æžœï¼Œä»¥åŠå¤„ç†ç½‘ç»œå¤±è´¥ç­‰ï¼Œè¿™å¯ä»¥é€šè¿‡å°†è¿™äº›ä»£ç å°è£…ä¸ºç½‘ç»œæœåŠ¡æ¥å‡å°‘controllerä¸­çš„ä»£ç ã€‚ä¸è¿‡åœ¨è¿™ç§æ–¹å¼è¿˜å­˜åœ¨å…¶ä»–å¼Šç«¯ï¼šcontrollerè´Ÿè´£è¿›è¡Œç½‘ç»œè¯·æ±‚å¹¶æŒæœ‰æ•°æ®ï¼Œå®žé™…ä¸Šæ•°æ®çš„é€»è¾‘å·²ç»ç­‰åŒäºŽview stateï¼Œå¦‚æžœappä¸­æ²¡æœ‰å…¶ä»–éƒ¨åˆ†ä¾èµ–è¿™äº›æ•°æ®ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥è‰¯å¥½å·¥ä½œï¼Œä½†å¦‚æžœæ•°æ®éœ€è¦åœ¨ä¸åŒcontrollerä¸­è¿›è¡Œä½¿ç”¨ï¼Œç¼ºå°‘modelå±‚è®©æ•°æ®å…±äº«å˜å¾—æ›´åŠ éº»çƒ¦ï¼Œè€Œä¸”å³ä½¿å½“å‰ä¸éœ€è¦å…±äº«ï¼Œä¹Ÿéœ€è¦è€ƒè™‘åˆ°æœªæ¥å¯èƒ½ä¼šæœ‰å˜æ›´ï¼Œæ‰€ä»¥ä»Žä¸€å¼€å§‹å°±é€‰æ‹©å¯¹æœªæ¥å‹å¥½çš„æ–¹å¼å¯èƒ½ä¼šæ›´åŠ æ˜Žæ™ºã€‚ Modelå±‚æŒæœ‰ç½‘ç»œ1.åŠ è½½åˆå§‹æ•°æ®åˆ›å»ºmodelå¯¹è±¡ï¼Œè°ƒç”¨modelçš„æ•°æ®åŠ è½½æ–¹æ³•ï¼Œåœ¨modelçš„æ–¹æ³•ä¸­ï¼ŒåŽ»è§¦å‘ç›¸åº”çš„ç½‘ç»œè¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚çš„ç»“æžœï¼Œmodelæ›´æ–°è‡ªå·±ï¼Œè€Œcontrolleråˆ™è§‚å¯Ÿmodelçš„å˜æ›´å¹¶æ›´æ–°ç›¸åº”çš„viewå³å¯ã€‚ 2.æ›´æ”¹æ•°æ®controllerä¸Žmodelè¿›è¡Œäº¤äº’ï¼Œå°±å¥½åƒmodelåªæ˜¯æœ¬åœ°æ•°æ®ä¸€æ ·ï¼Œç½‘ç»œåˆ™å‘ç”Ÿåœ¨modelå±‚çš„èƒŒåŽã€‚ä½†å¯¹äºŽmodelå¦‚ä½•è§¦å‘ç½‘ç»œè¯·æ±‚ï¼Œåˆ™æœ‰ä¸¤ç§ä¸åŒçš„å¯é€‰æ–¹å¼ï¼š modelç›´æŽ¥å‘èµ·ç½‘ç»œè¯·æ±‚ï¼šåœ¨modelæ•°æ®å˜æ›´çš„ç›¸åº”æŽ¥å£ä¸­ï¼Œç›´æŽ¥å‘èµ·ç½‘ç»œè¯·æ±‚ï¼ŒåŒæ­¥æ•°æ®çš„å˜æ›´ã€‚ ç½‘ç»œæœåŠ¡è§‚å¯Ÿmodelçš„å˜æ›´ï¼šå°è£…çš„ç½‘ç»œæœåŠ¡è§‚å¯Ÿmodelï¼Œmodelåœ¨æ•°æ®å˜æ›´æ—¶è§¦å‘æŸç§é€šçŸ¥ï¼Œç½‘ç»œæœåŠ¡åœ¨æŽ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼Œå†å‘èµ·ç›¸åº”çš„ç½‘ç»œè¯·æ±‚ã€‚ ç¬¬äºŒç§æ–¹å¼è®©modelå±‚å’Œç½‘ç»œå±‚è¿›ä¸€æ­¥çš„è§£è€¦ï¼ŒåŒæ—¶å› ä¸ºå°è£…äº†ç›¸åº”çš„ç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ›´æ”¹é˜Ÿåˆ—æ¥å¯¹è¿™ä¸€ç±»ç½‘ç»œè¯·æ±‚åšç»Ÿä¸€ç®¡ç†ï¼Œå¹¶å¯¹å¾…å¤„ç†æ›´æ”¹é˜Ÿåˆ—è¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿™æ ·å³ä½¿APPç¦»çº¿æ—¶(æ–­ç½‘ã€é€€å‡ºã€å´©æºƒ)æœ¬åœ°æ›´æ”¹ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ 3.è®¨è®º&amp;æ€è€ƒmodelæŒæœ‰ç½‘ç»œä¸ºä»£ç å¢žåŠ äº†ä¸€äº›å¤æ‚åº¦ï¼Œä½†ä¹Ÿå…·æœ‰æ›´å¤šçš„èƒ½åŠ›ï¼šä¿ç•™äº†modelï¼Œè®©controllerä¹‹é—´çš„æ•°æ®å…±äº«æ›´åŠ æ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿå¾ˆå®¹æ˜“åšæ•°æ®çš„ç¦»çº¿ç¼“å­˜ï¼›é€šè¿‡æ·»åŠ ç½‘ç»œæœåŠ¡éƒ¨ä»¶æ¥ç®¡ç†æ•°æ®åŒæ­¥çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥åœ¨APPä¸­ç«‹å³æ›´æ–°æ•°æ®ï¼Œè€Œä¸ç”¨ç­‰æœåŠ¡å™¨çš„å“åº”ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦å¢žåŠ é¢å¤–çš„ä»£ç ï¼Œæ¥è¿½è¸ªæœªæäº¤çš„å˜æ›´ï¼Œå¹¶å¯¹å˜æ›´æäº¤æ˜¯å¯èƒ½å‘ç”Ÿçš„å†²çªè¿›è¡Œå¤„ç†ã€‚æŒæœ‰ç½‘ç»œæ˜¯å¯¹APPæœªæ¥å˜æ›´å’Œæ‰©å±•æ›´åŠ å‹å¥½çš„æ–¹å¼ï¼Œæ˜¯æ›´åŠ æŽ¨èçš„ç½‘ç»œå±‚æž¶æž„æ¨¡å¼ã€‚]]></content>
      <categories>
        <category>APPæž¶æž„</category>
      </categories>
      <tags>
        <tag>APPç½‘ç»œå±‚</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº”ã€MVC-VSè®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F12%2FAPP%E6%9E%B6%E6%9E%84%2F%E4%BA%94%E3%80%81MVC-VS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Reference:App Architecture MVC+VCæ˜¯MVCçš„ä¸€ç§å˜ä½“ï¼Œæ‰€ä¸åŒçš„æ˜¯å®ƒå°†view stateè§†ä¸ºmodelå±‚çš„ä¸€éƒ¨åˆ†ï¼Œç”¨view state modelè¿›è¡Œå­˜å‚¨ï¼ŒViewControllerè§‚å¯Ÿview state modelï¼Œå¹¶ä¸”ç›¸åº”åœ°æ›´æ–° view å±‚çº§ã€‚ MVC+VSä¸­çš„åé¦ˆå›žè·¯ï¼š MVC+VSå¯¹MVCçš„æ”¹è¿›åœ¨äºŽï¼šæä¾›äº†ä¸€ç§ä¸€è‡´çš„å¤„ç†view stateå˜æ›´çš„æ–¹æ³•ï¼Œè®©view stateå¯ä»¥è¢«æŒä¹…åŒ–ï¼ŒåŒæ—¶å¯¹view stateçš„æ•°æ®ç®¡ç†ä¹Ÿå˜æˆäº†å•å‘æ•°æ®æµã€‚ MVC+VCä¸­view stateçš„æ•°æ®æµï¼š é™¤äº†å¯¹view stateçš„å¤„ç†å˜æˆäº†å•å‘æ•°æ®æµï¼ŒMVC+VSä¸­å¯¹view stateä½¿ç”¨modelæŠ½è±¡è¿˜å¸¦æ¥äº†ä¸‰ç‚¹å¥½å¤„ï¼š Modelé€šè¿‡æŽ¥å£å’Œç¨‹åºå…¶ä½™éƒ¨åˆ†äº¤æµï¼Œåœ¨æœ‰éœ€è¦æ—¶ï¼Œå¯¹æŽ¥å£ä¸­çš„å®žçŽ°è¿›è¡Œæ›¿æ¢ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°æŽ¥å£å’Œå¯¹æŽ¥å£çš„ä½¿ç”¨ Modelä¸ºactionæä¾›äº†å•ä¸€çš„äº‹å®žæ¥æºï¼Œè®©é‡æž„å’Œæµ‹è¯•å¯ä»¥åªå…³æ³¨å•ä¸€çš„æŸä¸ªç‚¹ å¯¹Modelçš„è§‚å¯Ÿå’Œå“åº”å¯ä»¥è¢«ä¸åŒçš„actioné‡ç”¨ï¼Œæ‰€ä»¥ç»“æž„çš„æ‰©å±•æ€§ä¼šæ›´å¥½ å…³äºŽview state modelæœ‰ä¸¤ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š è™½ç„¶view state modelä¸Žæ–‡æ¡£(æ•°æ®)modelæ˜¯åŒä¸€å±‚æŠ½è±¡ï¼Œå¹¶éµå¾ªç›¸åŒçš„ä½¿ç”¨è§„åˆ™ï¼Œä½†è¿˜æ˜¯åº”è¯¥ä¿æŒåˆ†ç¦»ï¼Œè¿™æ˜¯å› ä¸ºæ–‡æ¡£(æ•°æ®)ä¸Žview stateç”Ÿå‘½å‘¨æœŸå¹¶ä¸ç›¸åŒ view state modelä¸­ä»…ä»…æ˜¯å­˜å‚¨äº†ä»£è¡¨view stateçš„ç®€å•å€¼ï¼Œå¹¶ä¸åŒ…å«å¯¹æ•°æ®çš„å˜å½¢(è¿™éƒ¨åˆ†é€»è¾‘ä¾ç„¶å†™åœ¨ViewControllerä¸­)ï¼Œè¿™æ˜¯å…¶å’ŒMVVMä¸­çš„view-modelæœ€æœ¬è´¨çš„åŒºåˆ« ä¸€ã€MVC+VSçš„å®žçŽ°1.æž„å»ºä¸ŽMVCå’ŒMVVMä¸­å…ˆæž„å»ºViewControllerä¸åŒï¼ŒMVC+VSä¸­éœ€è¦é¦–å…ˆæž„å»ºview stateï¼Œç„¶åŽåœ¨view stateæ‰€è§¦å‘çš„è§‚å¯Ÿå›žè°ƒä¸­ï¼ŒåŽ»æž„å»ºViewControllerï¼Œå†ç”±ViewControlleræž„å»ºå…¶ä»–éƒ¨ä»¶ã€‚ä½†ç”±äºŽview stateçš„è§‚å¯Ÿè€…å°±æ˜¯ViewControllerï¼Œå› æ­¤åœ¨view stateçš„æž„å»ºä¹‹å‰éœ€è¦è‡³å°‘ä¸€ä¸ªViewControllerï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªViewControllerå³Root ViewControlleræ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒåœ¨view stateä¹‹å‰æž„å»ºã€‚ 2.å°†Viewè¿žæŽ¥åˆ°æ•°æ®MVC+VSä»Žview state modelå’Œæ–‡æ¡£(æ•°æ®)modelä¸­æ‹‰å–æ•°æ®ï¼Œå¹¶è®¢é˜…è¿™äº›æ•°æ®ï¼Œç„¶åŽå°†è¿™äº›æ•°æ®å…³è”åˆ°viewä¸ŠåŽ»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯MVC+VSçš„æ ‡å‡†æ¨¡å¼æ˜¯ï¼Œæ–‡æ¡£(æ•°æ®)modelå¯¹è±¡çš„æ ‡è¯†åº”è¯¥å­˜å‚¨åœ¨view state modelä¸­ï¼Œè¿™å°±æ„å‘³ç€å¯¹æ–‡æ¡£(æ•°æ®)modelçš„è§‚å¯Ÿæ˜¯ä¾èµ–äºŽview stateçš„ï¼Œå¯¹æ–‡æ¡£(æ•°æ®)modelçš„è§‚å¯Ÿå¿…é¡»åœ¨å¯¹view state modelçš„è§‚å¯Ÿä¹‹åŽã€‚ ç»å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­ï¼ŒViewControllerçš„æ–‡æ¡£(æ•°æ®)modelçš„æ ‡è¯†ç¬¦åœ¨ViewControllerçš„ç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¸ä¼šæ›´æ”¹ï¼Œä½†å¦‚æžœæœ‰éœ€è¦æ”¹å˜çš„æƒ…å†µï¼Œå¿…é¡»åœ¨view state modelçš„è§‚å¯Ÿå›žè°ƒé‡Œé¢ï¼Œé‡æ–°åŠ è½½æ–‡æ¡£(æ•°æ®)modelï¼Œå¹¶é‡æ–°åˆ›å»ºåˆ›å»ºå¯¹æ–‡æ¡£(æ•°æ®)modelçš„è§‚å¯Ÿã€‚ 3.æ›´æ”¹Modelæ›´æ”¹modelçš„å›žè·¯MVC+VSå’ŒMVCä¸­æ˜¯ä¸€æ ·çš„ï¼šviewå°†actionä¼ é€’ç»™ViewControllerï¼ŒViewControllerç›´æŽ¥æ›´æ”¹modelï¼ŒåŒæ—¶ViewControllerä¸­è§‚å¯Ÿäº†modelï¼Œå½“modelå˜æ›´æ—¶åšç›¸åº”çš„viewæ›´æ–°ã€‚ 4.æ›´æ”¹View StateMVC+VSä¸ºview stateçš„å¤„ç†æ·»åŠ äº†ä¸€æ¡å’Œæ–‡æ¡£æ•°æ®å¤„ç†ç›¸ä¼¼çš„è·¯å¾„ï¼šviewå°†actionä¼ é€’åˆ°ViewControllerï¼ŒViewControlleræ›´æ”¹view state modelï¼ŒåŒæ—¶ViewControllerä¸­è§‚å¯Ÿäº†view state modelï¼Œå½“view state modelå˜æ›´æ—¶åšç›¸åº”çš„viewæ›´æ–°ã€‚ ####çŠ¶æ€æ¢å¤MVC+VSçš„æž¶æž„åœ¨view state modelä¸­ç»´æŠ¤äº†å®Œæ•´çš„view stateï¼Œå°†view state modelåºåˆ—åŒ–ä¿å­˜ï¼Œå†æ ¹æ®å…¶æž„å»ºViewControllerå’ŒViewControllerçš„å±‚çº§ï¼Œå³å¯å®ŒæˆçŠ¶æ€æ¢å¤ï¼ŒçŠ¶æ€æ¢å¤æ—¶çš„ä»£ç è·¯å¾„å’Œåˆå§‹æž„å»ºçš„ä»£ç è·¯å¾„æ˜¯ä¸€è‡´çš„ã€‚ 5.æµ‹è¯•MVC+VSå’ŒMVCä¸­éƒ½ä½¿ç”¨é›†æˆæµ‹è¯•ï¼Œä½†å®žçŽ°ä¸Šæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œç¬¬ä¸€ä¸ªä¸åŒåœ¨äºŽMVC+VSä¸­ä¸å†éœ€è¦å…ˆæž„å»ºViewControlleræ ‘ï¼Œè€Œæ˜¯æž„å»ºRoot ViewControllerå’Œview state modelå³å¯ï¼ŒåŒ…æ‹¬ViewControlleræ ‘åœ¨å†…çš„å…¶ä½™éƒ¨åˆ†éƒ½å°†ä½œä¸ºview stateçš„å“åº”è¢«è‡ªè¡Œåˆ›å»ºå‡ºæ¥ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡æä¾›view state modelä½œä¸ºæ ¹ViewControllerçš„è¾“å…¥ï¼Œä»¥ç‰¹å®šçš„çŠ¶æ€æž„å»ºå‡ºappçš„ä¸€ä¸ªæ–°çš„å®žä¾‹(çŠ¶æ€æ¢å¤)ã€‚ MVC+VSä¹¦å†™æµ‹è¯•æ—¶çš„å¦å¤–ä¸€ä¸ªä¸åŒåœ¨äºŽç ”ç©¶å¯¹actionçš„å“åº”æ—¶ï¼ŒMVCä¸­ç ”ç©¶å¯¹actionçš„å“åº”ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…åŠ¨ç”»æˆ–å…¶ä»–å¼‚æ­¥æ›´æ”¹çš„å®Œæˆï¼ŒMVC+VSä¸­â€œå¯¹äºŽview actionçš„å“åº”æ‰€é€ æˆçš„view stateæ›´æ”¹â€ ä¸Ž â€œview stateæ›´æ”¹å¼•èµ·viewå±‚çº§ä¸­çš„æ›´æ–°â€è¿™ä¸¤æ®µè·¯å¾„çš„æµ‹è¯•æ˜¯å¯ä»¥åˆ†ç¦»å¼€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç›´æŽ¥éªŒè¯view stateæ¥ç¡®ä¿æŸä¸ªactionç¡®å®žå¯¹æ•°æ®è¿›è¡Œäº†åˆé€‚çš„å˜æ›´ï¼Œè€Œä¸éœ€è¦ç­‰å¾…actionæ‰§è¡ŒåŠ¨ç”»å¹¶ä¸”æœ€ç»ˆæ›´æ–°viewï¼Œè¿™éƒ¨åˆ†è·¯å¾„çš„æµ‹è¯•ä»£ç ä¼šå˜å¾—å¥½å†™å¾ˆå¤šã€‚è‡³äºŽview stateçš„å˜æ›´å¼•èµ·viewæ›´æ–°çš„è¿™æ®µè·¯å¾„ï¼Œåˆ™å¯ä»¥ä¸ºå®ƒç¼–å†™å•ç‹¬çš„æµ‹è¯•ã€‚ äºŒã€MVC+VSçš„ä¼˜ç¼ºç‚¹MVC+VSæœ€å¤§çš„å¥½å¤„åœ¨äºŽä¸ºview stateå˜æ›´çš„é€šè®¯åˆ›å»ºäº†ä¸€è‡´çš„æœºåˆ¶ï¼Œå¯¹view stateä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ä¹Ÿä¿è¯äº†UIçš„åŒæ­¥ï¼›åŒæ—¶åŽŸæœ¬å‘ç”Ÿåœ¨ViewControllerä¹‹é—´çš„é€šè®¯ï¼ŒçŽ°åœ¨ä¹Ÿå¯ä»¥é€šè¿‡view stateæ¥å®Œæˆï¼›æœ€åŽï¼Œå› ä¸ºview state modelä¸Šç»´æŠ¤äº†å®Œæ•´çš„view stateï¼Œæ‰€ä»¥ä¹Ÿèƒ½å¾ˆæ–¹ä¾¿çš„å®ŒæˆçŠ¶æ€æ—¥å¿—ã€çŠ¶æ€æ¢å¤ã€æ—¶é—´æ—…è¡Œè°ƒè¯•ç­‰åŠŸèƒ½ã€‚ MVC+VSåœ¨å®žè·µä¸­ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„é—®é¢˜åœ¨äºŽå¹¶ä¸æ˜¯æ€»èƒ½åœ¨UIKitæ›´æ–°viewå±‚çº§ä¹‹å‰æ•èŽ·åˆ°view stateçš„å˜åŒ–ï¼Œæ¯”å¦‚NavigationControllerè¿”å›žæŒ‰é’®å’Œè¿”å›žæ‰‹åŠ¿æ‰€å¼•èµ·çš„å±‚çº§å˜åŠ¨ï¼Œè¿™éœ€è¦æˆ‘ä»¬è®¾ç½®NavigationControllerçš„delegateï¼Œåœ¨é¡µé¢å±‚çº§å˜åŠ¨å®Œæˆï¼Œè€Œè¿™ç§å˜åŠ¨åˆä¸æ˜¯ç”±view stateçš„å˜æ›´æ‰€å¼•èµ·æ—¶(ç”±è¿”å›žæŒ‰é’®å’Œè¿”å›žæ‰‹åŠ¿æ‰€å¼•èµ·)ï¼ŒåŽ»å¯¹view stateè¿›è¡Œæ›´æ–°å’Œå¤„ç†ï¼Œå…¶ä»–ç±»ä¼¼çš„æƒ…å†µä¹Ÿéœ€è¦æˆ‘ä»¬åŽ»æ·»åŠ ä»£ç æ”¯æŒã€‚ ä¸‰ã€MVC+VSæž¶æž„çš„ä¼˜ç§€ç»éªŒ1.æ•°æ®çš„ä¾èµ–æ³¨å…¥åœ¨å¯¹è±¡åˆå§‹åŒ–çš„æ—¶å€™å°†æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’è¿›åŽ»å°±å«ä¾èµ–æ³¨å…¥ï¼Œåœ¨MVC+VSä¸­ä¸ºViewControllerè®¾ç½®åˆå§‹çš„view state modelæ—¶ä¾¿æ˜¯é€‰ç”¨çš„è¿™ç§æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥é¿å…ç›´æŽ¥è®¿é—®å•ä¾‹ï¼Œæ›´æ–¹ä¾¿ä¹¦å†™æµ‹è¯•ï¼ŒåŒæ—¶è¿™ä¹Ÿæ¯”åˆå§‹åŒ–æ—¶å…ˆè®¾ç½®ä¸ºnilå†ç­‰ä¹‹åŽæä¾›éžnilçš„æ–¹å¼æ›´åŠ ç®€å•ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ç”¨äºŽå…¶ä»–åŸºäºŽViewControllerçš„æ¨¡å¼ä¸­ã€‚ 2.å…¨å±€View Stateé€šè®¯ä½†view stateä¼šè¢«å¤šä¸ªViewControlleræˆ–viewå…±äº«æ—¶ï¼Œä½¿ç”¨å•ä¾‹æ¥ä¿å­˜view stateä»¥æä¾›å…¨å±€çš„view stateé€šè®¯ï¼Œå¾€å¾€æ¯”åœ¨è¿™äº›ViewControlleræˆ–viewçš„å…±åŒç¥–å…ˆä¸­ä¿å­˜view stateæ›´åŠ çš„ç®€å•ç›´æŽ¥ï¼Œå®ƒè¿˜ä¸éœ€è¦åŽ»è€ƒè™‘ViewControlleræˆ–viewå±‚çº§é—´çš„é€šè®¯ç®¡é“ã€‚ 3.ç®€åŒ–æœ¬åœ°View Stateå¯ä»¥æŠŠä¸€ä¸ªç®€åŒ–ç‰ˆçš„MVC+VSåº”ç”¨åˆ°MVCçš„å•ä¸ªViewControllerä¸­ï¼šå°†éƒ¨åˆ†view stateæŠ½è±¡å‡ºæ¥ï¼Œç”¨ä¸€ä¸ªå¯¹è±¡å­˜å‚¨(å­—å…¸æˆ–è‡ªå®šä¹‰ç±»)ï¼Œå°†è¿™ä¸ªå¯¹è±¡è®¾ç½®ä¸ºViewControllerçš„å±žæ€§ï¼Œå¹¶å¯¹è¿™ä¸ªå±žæ€§è¿›è¡Œè§‚å¯Ÿï¼Œåœ¨è¯¥å±žæ€§å˜æ›´çš„æ—¶å€™å¯¹viewåšè¿™éƒ¨åˆ†view stateçš„æ›´æ–°ï¼Œè¿™ç§æ–¹å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½ç¼“è§£å¤æ‚çš„ViewControllerä¸­view stateçš„äº¤äº’é—®é¢˜ã€‚]]></content>
      <categories>
        <category>APPæž¶æž„</category>
      </categories>
      <tags>
        <tag>MVCS</tag>
        <tag>MVC+VS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å››ã€MVVMè®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F06%2FAPP%E6%9E%B6%E6%9E%84%2F%E5%9B%9B%E3%80%81MVVM%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Reference:App Architecture Model-View-ViewModel(MVVM)æ˜¯ä¸€ç§åŸºäºŽMVCè¿›è¡Œæ”¹è¿›çš„æ¨¡å¼ï¼Œå®ƒå°†æ‰€æœ‰modelç›¸å…³çš„ä»»åŠ¡ï¼ˆè§‚å¯Ÿmodelå˜æ›´ï¼Œå°†modelæ•°æ®å˜å½¢ï¼Œä»¥åŠæ›´æ–°modelï¼‰ä»Žcontrollerå±‚æŠ½ç¦»å‡ºæ¥ï¼Œæ”¾åˆ°æ–°çš„å«åšview-modelçš„ä¸€å±‚å¯¹è±¡ä¸­ã€‚å¼•å…¥view-modelå±‚çš„ä¸»è¦ç›®çš„æœ‰ä¸¤ç‚¹ï¼š é¼“åŠ±å°†modelå’Œviewä¹‹é—´çš„å…³ç³»æž„å»ºä¸ºä¸€ç³»åˆ—çš„å˜å½¢ç®¡é“ã€‚ å°†viewåº”è¯¥å±•ç¤ºçš„çŠ¶æ€é€šè¿‡ä¸€å¥—ç‹¬ç«‹äºŽappæ¡†æž¶çš„æŽ¥å£è¿›è¡Œå‘ˆçŽ°ã€‚ åœ¨MVVMä¸­ä¸ºäº†ä¿æŒviewä¸Žview-modelçš„åŒæ­¥ï¼ŒMVVMå¼ºåˆ¶ä½¿ç”¨æŸç§å½¢å¼çš„ç»‘å®šï¼Œè¿™é€šå¸¸é€šè¿‡å“åº”å¼ç¼–ç¨‹æ¥å®Œæˆã€‚MVVMåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†MVCæœ€å¤§çš„ä¸¤ä¸ªé—®é¢˜ï¼Œé¦–å…ˆé€šè¿‡å°†modelè§‚å¯Ÿçš„ä»£ç ä»¥åŠå…¶ä»–æ˜¾ç¤ºå’Œäº¤äº’é€»è¾‘ç§»åŠ¨åˆ°å›´ç»•ç€æ•°æ®æµæž„å»ºçš„éš”ç¦»çš„view-modelä¸­ï¼Œè§£å†³äº†MVCä¸­ViewControlleré‡Œä¸è§„åˆ™çš„çŠ¶æ€äº¤äº’æ‰€å¸¦æ¥çš„æœ‰å…³é—®é¢˜ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç¼“è§£äº†ViewControllerè‚¥å¤§çš„é—®é¢˜ï¼›ç„¶åŽview-modelè¿˜ä¸ºåœºæ™¯çš„view stateæä¾›äº†ä¸€å¥—å¹²å‡€çš„æŽ¥å£ï¼Œè®©å®ƒå¯ä»¥ç‹¬ç«‹äºŽappæ¡†æž¶è¿›è¡Œæµ‹è¯•ï¼Œè§£å†³äº†MVCéš¾ä»¥æµ‹è¯•çš„é—®é¢˜ã€‚ MVVM+Cä¸­APPçš„åé¦ˆå›žè·¯ï¼š åœ¨MVVM+Cä¸­ï¼Œåè°ƒå™¨åœ¨APPå¯åŠ¨å®Œæˆçš„æœ€åŽé˜¶æ®µåˆ›å»ºï¼Œå¯¹äºŽMVVMè€Œè¨€ï¼Œåè°ƒå™¨å¹¶éžæ˜¯å¼ºåˆ¶éœ€è¦çš„éƒ¨ä»¶ï¼Œä½†å¼•å…¥åè°ƒå™¨æ¥è´Ÿè´£ç»´æŠ¤ViewControllerçš„å±‚çº§ï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ†æ‹…ViewControllerçš„å·¥ä½œï¼Œè®©å…¶å˜å¾—æ›´åŠ çš„ç®€å•ï¼Œè¿™ç¬¦åˆMVVMçš„æž¶æž„æ€è·¯ï¼Œåè°ƒå™¨åˆ†æ‹…çš„èŒè´£ä¸»è¦ä¸ºï¼šç®¡ç†å…¶ä»–controllerçš„å±•ç¤ºï¼ŒåŒæ—¶åè°ƒmodelæ•°æ®å’Œcontrollerä¹‹é—´çš„é€šè®¯ã€‚åè°ƒå™¨çš„å·¥ä½œæ–¹å¼æœ‰ä¸¤ç§ï¼š ä½œä¸ºViewControllerçš„delegateï¼ŒViewControlleræŠŠå¯¼èˆªè¡Œä¸ºç›´æŽ¥è½¬å‘ç»™åè°ƒå™¨ã€‚ æŠŠå¯¼èˆªè¡Œä¸ºå…ˆè½¬å‘ç»™view-modelï¼Œç„¶åŽè®©åè°ƒå™¨åŽ»è§‚å¯Ÿview-modelï¼Œä»¥èŽ·å–å¯¼èˆªäº‹ä»¶ã€‚ ç¬¬ä¸€ç§æ›´åŠ ç®€å•ç›´æŽ¥ï¼Œä½†å¦‚æžœå¯¼èˆªäº‹ä»¶æ˜¯ä¾èµ–äºŽå½“å‰viewçš„çŠ¶æ€æˆ–è€…modelæ•°æ®çš„è¯ï¼Œç¬¬äºŒç§åšæ³•å°†æ›´åŠ åˆç†ï¼ŒåŒæ—¶ç¬¬äºŒç§åšæ³•ä¹Ÿæ›´åˆ©äºŽä»£ç æµ‹è¯•ã€‚ ä¸€ã€MVVMçš„å®žçŽ°1.æž„å»ºMVVMæž„å»ºçš„æ–¹å¼å’ŒMVCå¾ˆç›¸ä¼¼ï¼šViewControllerå……åˆ†äº†è§£ç¨‹åºçš„ç»“æž„ï¼Œå¹¶ä¸”å¯¹å…¶å®ƒæ‰€æœ‰éƒ¨ä»¶è¿›è¡Œæž„å»ºå’Œè¿žæŽ¥ã€‚æ­¤å¤–ï¼Œç›¸æ¯”èµ·MVCä¸»è¦æœ‰ä¸‰ç‚¹ä¸åŒï¼š å¿…é¡»åˆ›å»ºview-modelã€‚ å¿…é¡»å»ºç«‹èµ·view-modelå’Œviewä¹‹é—´çš„ç»‘å®šã€‚ Modelç”±view-modelæ‹¥æœ‰ï¼Œè€Œä¸æ˜¯ç”±controlleræ‰€æ‹¥æœ‰ã€‚ view-modelçš„åˆ›å»ºæœ‰åœ¨ViewControlleråˆ›å»ºæ—¶åˆ›å»ºé»˜è®¤å€¼ã€ä½œä¸ºå‚æ•°ä¼ é€’ç»™ViewControllerçš„ä¾èµ–æ³¨å…¥ã€å’Œåœ¨ViewControlleråŠ è½½åŽå»¶è¿Ÿåˆ›å»ºä¸‰ç§æ–¹å¼ã€‚ 2.å°†Viewè¿žæŽ¥åˆ°æ•°æ®åœ¨MVVM+Cä¸­ï¼Œå°†Viewè¿žæŽ¥åˆ°æ•°æ®çš„æ•°æ®ç®¡é“ï¼š åè°ƒå™¨ä¸ºæ¯ä¸ªViewControllerçš„view-modelè®¾ç½®åˆå§‹çš„modelå¯¹è±¡ã€‚ view-modelå°†è®¾å®šå€¼å’Œå…¶ä»–modelæ•°æ®åŠè§‚å¯Ÿé‡è¿›è¡Œåˆå¹¶ã€‚ view-modelå°†æ•°æ®å˜å½¢ä¸ºviewæ‰€éœ€è¦çš„å½¢å¼ã€‚ ViewControllerä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¡†æž¶æ¥å°†å‡†å¤‡å¥½çš„å€¼ç»‘å®šåˆ°å„ä¸ªviewä¸ŠåŽ»ã€‚ 3.æ›´æ”¹ModelMVVM-Cä¸­ï¼ŒView Actionçš„äº‹ä»¶å›žè·¯å’Œåœ¨MVCä¸­å„å±‚ä¹‹é—´çš„è·¯å¾„ç›¸ä¼¼ï¼Œä¸åŒåœ¨äºŽï¼Œåœ¨ViewControllerå’Œmodelä¹‹é—´æ’å…¥äº†ä¸€å±‚é¢å¤–çš„ç”¨äºŽåè°ƒçš„view-modelï¼š viewé€šè¿‡target/actionæœºåˆ¶ã€delegateã€æˆ–è€…å“åº”å¼ç¼–ç¨‹æ¡†æž¶æ‰©å±•ï¼Œå°†View Actionä¼ é€’ç»™ViewControllerï¼› ViewControlleræŽ¥æ”¶åˆ°View Actionæ—¶è°ƒç”¨view-modelçš„ç›¸åº”æŽ¥å£ï¼› view-modelçš„æŽ¥å£ä¸­ç›´æŽ¥æ›´æ”¹modelï¼› view-modelè§‚å¯Ÿmodelçš„å˜æ›´ï¼Œå¹¶åœ¨å˜å½¢åŽé€šè¿‡å¯è§‚å¯Ÿå€¼æš´éœ²ç»™ViewControllerï¼› ViewControllerä¸­å·²ç»å°†å¯è§‚å¯Ÿå€¼å’Œviewè¿›è¡Œäº†ç»‘å®šï¼Œå°†ä¼šåœ¨è¿™äº›å€¼å˜åŒ–æ˜¯æ›´æ–°viewã€‚ 4.æ›´æ”¹View StateåŒMVCä¸€æ ·ï¼Œéƒ¨åˆ†view stateä¾ç„¶éšå¼å­˜å‚¨åœ¨viewä¸­ï¼Œä½†åŽŸæœ¬é‚£äº›ç”±ViewControlleré€šè¿‡å±žæ€§æ‰€ä¿å­˜çš„view stateï¼Œåœ¨MVVM-Cä¸­ç”±view-modelæ˜¾å¼åœ°è¿›è¡Œè¡¨ç¤ºã€‚view-modelåªè´Ÿè´£é‚£äº›ä¼šè¢«viewè¡Œä¸ºå½±å“çš„view stateï¼Œå¯¹äºŽæ—¢ä¸ä¾èµ–äºŽä»»ä½•çš„view-modelå±žæ€§ï¼Œä¹Ÿä¸æ˜¯view-modelæ‰€ä¾èµ–çš„view stateï¼Œå¹¶ä¸éœ€è¦é€šè¿‡view-modelç®¡ç†ã€‚ æ›´æ”¹view stateçš„äº‹ä»¶å›žè·¯å’Œæ›´æ”¹modelçš„äº‹ä»¶å›žæ¥è¿‘ä¼¼ï¼Œåªæ˜¯å°‘äº†view-modelæ›´æ”¹modelï¼Œå¹¶è§‚å¯Ÿmodelçš„å˜æ›´ä¸”å˜å½¢ä¸ºå¯è§‚å¯Ÿå€¼çš„æ­¥éª¤ï¼š viewé€šè¿‡target/actionæœºåˆ¶ã€delegateã€æˆ–è€…å“åº”å¼ç¼–ç¨‹æ¡†æž¶æ‰©å±•ï¼Œå°†View Actionä¼ é€’ç»™ViewControllerï¼› ViewControlleræŽ¥æ”¶åˆ°View Actionæ—¶è°ƒç”¨view-modelçš„ç›¸åº”æŽ¥å£ï¼› view-modelçš„æŽ¥å£ä¸­ç›´æŽ¥æ›´æ”¹è‡ªå·±å­˜å‚¨çš„view stateå¯è§‚å¯Ÿå€¼ï¼› ViewControllerä¸­å·²ç»å°†å¯è§‚å¯Ÿå€¼å’Œviewè¿›è¡Œäº†ç»‘å®šï¼Œå°†ä¼šåœ¨è¿™äº›å€¼å˜åŒ–æ˜¯æ›´æ–°viewã€‚ å¯¹äºŽå½±å“ViewControllerå±‚çº§çš„view stateå˜æ›´ï¼ŒMVVM+Cä¸­æ ¹æ®åè°ƒå™¨çš„å·¥ä½œæ–¹å¼ä¸åŒï¼Œå¯ä»¥ç”±ViewControlleré€šè¿‡delegateç›´æŽ¥å°†äº‹ä»¶ä¼ é€’ç»™åè°ƒå™¨å¤„ç†ï¼Œä¹Ÿå¯ä»¥å°†äº‹ä»¶å¤„ç†ä¸ºview-modelçš„å¯è§‚å¯Ÿå€¼ï¼Œåè°ƒå™¨è®¢é˜…è¿™äº›è¯¾è§‚å¯Ÿè€…ï¼Œå½“æ¶ˆæ¯è§¦å‘æ—¶ï¼Œåšç›¸åº”çš„è§†å›¾å±‚çº§ç®¡ç†ã€‚ 5.æµ‹è¯•MVVMé€šè¿‡å¼•å…¥view-modelå±‚ï¼Œæä¾›äº†æ¸…æ™°ä¸”ç‹¬ç«‹äºŽappæ¡†æž¶çš„æŽ¥å£ï¼Œæ‰€ä»¥å¯¹äºŽview-modelåŠä»¥ä¸‹å±‚æ¬¡çš„ä»£ç ï¼Œä½¿ç”¨æŽ¥å£æµ‹è¯•å°†éžå¸¸æ–¹ä¾¿ï¼Œè€Œå¯¹ViewControlleråŠViewä¸­çš„ä»£ç é€»è¾‘çš„æµ‹è¯•åˆ™ä¾èµ–äºŽXcodeçš„UIæµ‹è¯•æˆ–äººå·¥æµ‹è¯•ã€‚MVCä½¿ç”¨çš„é›†æˆæµ‹è¯•ï¼Œæ›´åå‘äºŽåŠŸèƒ½è€Œä¸æ˜¯ä»£ç ï¼Œè™½ç„¶ä»£ç è¦†ç›–çŽ‡æ¯”æŽ¥å£æµ‹è¯•æ›´é«˜ï¼Œä½†å´éš¾ä»¥ç¼–å†™å’Œç»´æŠ¤ï¼›ç›¸æ¯”è€Œè¨€ï¼ŒMVVMçš„æŽ¥å£æµ‹è¯•ç”±äºŽåªéœ€è¦å…³æ³¨è‡ªå·±ç¼–å†™çš„view-modelå’ŒæŽ¥å£ï¼Œè€Œä¸”å¾ˆå°‘éœ€è¦å¼‚æ­¥æµ‹è¯•ï¼Œå…¶ç¼–å†™å’Œç»´æŠ¤éƒ½æœ‰æ–¹ä¾¿å¾—å¤šã€‚ æŽ¥å£æµ‹è¯•çš„ç»å…¸æ¨¡å¼æ˜¯ï¼šæž„å»ºè¾“å…¥ï¼Œå†æž„å»ºç”¨æ¥ä¼ é€’è¾“å…¥çš„æŽ¥å£ï¼Œç„¶åŽä»ŽæŽ¥å£ä¸­è¯»å–ç»“æžœã€‚MVVMä¸­åœ¨é…ç½®æµ‹è¯•çŽ¯å¢ƒå’Œæ•°æ®åŽï¼Œéœ€è¦åšçš„æµ‹è¯•å·¥ä½œä¸»è¦åŒ…æ‹¬å±•ç¤ºæµ‹è¯•å’Œè¡Œä¸ºæµ‹è¯•ï¼š å±•ç¤ºæµ‹è¯•ï¼šå¯¹view-modelä¸Šæ‰€æš´éœ²çš„æ¯ä¸€ä¸ªå¯è§‚å¯Ÿé‡ï¼Œå¯¹åˆå§‹å€¼è¿›è¡Œæµ‹è¯•ç„¶åŽæ‰§è¡Œæ“ä½œï¼Œå¹¶æµ‹è¯•åŽç»­çš„æ¡ä»¶ã€‚ è¡Œä¸ºæµ‹è¯•ï¼šæµ‹è¯•åˆå§‹æ¡ä»¶ï¼Œæ‰§è¡Œæ“ä½œï¼Œç„¶åŽæµ‹è¯•æŽ¥ä¸‹æ¥çš„æ¡ä»¶ã€‚ äºŒã€MVVMçš„ä¼˜ç¼ºç‚¹MVVMçš„ä¼˜ç‚¹ä¸»è¦æ˜¯ä½Žè€¦åˆå’Œæ–¹ä¾¿æµ‹è¯•ï¼Œæ­¤å¤–çš„åˆ©äºŽåˆ†å·¥åˆä½œå’Œæ–¹ä¾¿ä»£ç è¿ç§»å’Œå¤ç”¨ï¼Œéƒ½æ˜¯ä½Žè€¦åˆçš„å»¶ä¼¸ã€‚MVVMä¹Ÿæœ‰ä¸€äº›è‡ªèº«çš„ç¼ºç‚¹ï¼Œå®ƒä»¬ä¸»è¦ä½“çŽ°åœ¨ï¼š æ›´å¤šçš„ä»£ç ï¼šå› ä¸ºå¼•å…¥view-modelå±‚ï¼Œæœ€ç›´è§‚çš„æ„Ÿå—å°±æ˜¯ç±»å˜å¾—æ›´å¤šï¼Œåœ¨å¤„ç†ç®€å•çš„åœºæ™¯æ—¶ä»£ç é‡å¢žå¤šï¼Œä½†åœ¨å¤„ç†ç›¸å¯¹å¤æ‚çš„çŠ¶æ€äº¤äº’æ—¶ï¼ŒMVVMæ›´åŠ æ¸…æ™°çš„é€»è¾‘ï¼Œåè€Œä¼šè®©ç¼–ç å·¥ä½œå˜å¾—æ›´åŠ ç®€å•ã€‚ æ›´éš¾ä»¥è°ƒè¯•çš„BUGï¼šMVVMä¸€èˆ¬é€‰ç”¨å“åº”å¼ç¼–ç¨‹æ¥åšæ•°æ®ç»‘å®šï¼Œè¿™ä¼šä½¿å¾—ä¸€å¤„çš„BUGè¢«å¿«é€Ÿçš„ä¼ é€’åˆ°åˆ«çš„åœ°æ–¹ï¼Œå½“ä½ åœ¨æŸå¤„å‘çŽ°é—®é¢˜æ—¶ï¼Œå®šä½å®ƒæ˜¯å› ä¸ºæ•°æ®å˜å½¢ç®¡é“ä¸Šçš„å“ªä¸€æ­¥å‡ºäº†BUGï¼Œå°†ä¼šæ›´åŠ çš„ä¸å®¹æ˜“ã€‚ ä¸åˆ©äºŽé‡ç”¨çš„viewï¼šæœ‰çš„MVVMä¸­å¯¹äºŽviewé‡‡ç”¨åŒå‘ç»‘å®šï¼Œä¸ä»…å°†modelçš„æ•°æ®ç»‘å®šåˆ°viewä¸Šï¼Œè¿˜å°†viewçš„actionå’Œmodelè¿›è¡Œç»‘å®šï¼Œè¿™å°†é™ä½Žviewçš„å¯é‡ç”¨æ€§ï¼Œåº”é¿å…å¯¹viewä½¿ç”¨åŒå‘ç»‘å®šï¼Œè€Œæ˜¯åº”è¯¥å°†viewçš„actioné€šè¿‡é€šç”¨çš„æ–¹å¼ä¼ é€’ç»™ViewControllerï¼Œå†ç”±ViewControllerè°ƒç”¨view-modelçš„æŽ¥å£åšç›¸åº”å¤„ç†ã€‚ åŸºäºŽå“åº”å¼ç¼–ç¨‹ï¼šMVVMä¸­é€šå¸¸éƒ½ä¼šä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¥åšæ•°æ®ç»‘å®šï¼Œè¿™æ¯”å…¶å®ƒæ–¹æ¡ˆæ›´åŠ æ–¹ä¾¿ç®€æ´ï¼Œå“åº”å¼ç¼–ç¨‹çš„å­¦ä¹ æ›²çº¿ç¨åŠ é™¡å³­ï¼Œä½†ç†è§£å“åº”å¼ç¼–ç¨‹å¯¹ç¼–ç å·¥ä½œè€…ç»å¯¹å¤§æœ‰è£¨ç›Šã€‚ ä¸‰ã€MVVMä¸Žå“åº”å¼ç¼–ç¨‹å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç”¨æ¥æè¿°æ•°æ®æºå’Œæ•°æ®æ¶ˆè´¹ç«¯ä¹‹é—´æ•°æ®æµåŠ¨çš„æ¨¡å¼ï¼Œå“åº”å¼ç¼–ç¨‹å°†è¿™ç§æµåŠ¨æè¿°ä¸ºä¸€ä¸ªå˜å½¢ç®¡é“ã€‚MVVMå¹¶éžå¿…é¡»ä½¿ç”¨å“åº”å¼ç¼–ç¨‹ï¼Œä½†è§‚å¯Ÿmodelæ•°æ®å¹¶å°†å…¶å˜å½¢ä¸ºview-modelä¸Šçš„ä¸€ç³»åˆ—å¯è§‚å¯Ÿå€¼ï¼Œå†åœ¨ViewControllerä¸­å°†è¿™äº›å¯è§‚å¯Ÿå€¼ç»‘å®šåˆ°viewä¸Šï¼Œå¯¹äºŽè¿™æ¡è·¯å¾„ï¼Œåœ¨MVVMä¸­é€šå¸¸æ˜¯æŽ¨èä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸºäºŽKVOç­‰æŠ€æœ¯çš„å…¶ä»–æ–¹æ¡ˆï¼Œä½†é‚£éœ€è¦åšæ›´å¤šçš„é¢å¤–å·¥ä½œï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰å“åº”å¼ç¼–ç¨‹è¿™ç§å¯¹å£çš„æ–¹æ¡ˆæ–¹ä¾¿ã€‚ å››ã€MVVMæž¶æž„çš„ä¼˜ç§€ç»éªŒ1.å¼•å…¥é¢å¤–çš„å±‚MVVMåœ¨MVCåŸºç¡€ä¸Šå¼•å…¥view-modelè¿™é¢å¤–çš„ä¸€å±‚æŠ½è±¡æ¥æž„å»ºæ•°æ®ç®¡é“ï¼Œå°†æŠ½è±¡çš„æ•°æ®(modelä¸­çš„)å˜å½¢ä¸ºç‰¹å®šçš„æ•°æ®(viewé‡Œçš„)ï¼Œè¿™ç§æ¨¡å¼ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­çš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š App-modelï¼šæž„å»ºä¸€ä¸ªApp-modelï¼Œå°†ç”¨æˆ·å‡­è¯ã€ç³»ç»ŸæœåŠ¡ä¿¡æ¯(å¦‚ç½‘ç»œæ˜¯å¦å¯ç”¨)ç­‰æ•°æ®åˆå¹¶ã€å˜å½¢ï¼Œç„¶åŽä½œä¸ºå¯è§‚å¯Ÿå€¼æä¾›ç»™å…¶ä»–view-modelä½¿ç”¨ï¼Œè¿™ç§modelä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºsetting-modelã€‚ Session-modelï¼šç”¨äºŽè¿½è¸ªå½“å‰ç™»å½•ä¼šè¯çš„ç»†èŠ‚ï¼Œå¯èƒ½éœ€è¦åœ¨view-modelå’Œä¸» modelä¹‹é—´ï¼Œæˆ–è€…view-modelå’Œå…¶ä»–æŽ¥å£ä¹‹é—´ï¼Œè¿›è¡Œç½‘ç»œè¯·æ±‚çš„å¤„ç†ã€‚ æ•°æ®æµ-modelï¼šmodelç‰ˆæœ¬çš„åè°ƒå™¨ï¼Œç”¨æ¥å°†å¯¼èˆªçŠ¶æ€ä½œä¸ºæ•°æ®è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶å°†å¯¼èˆªçŠ¶æ€å’Œmodelæ•°æ®åˆå¹¶ï¼Œç›´æŽ¥ä¸ºview-modelæä¾›å¯è§‚å¯Ÿçš„modelæ•°æ®ã€‚ Use caseï¼šUse caseæŒ‡çš„æ˜¯é‚£äº›ç”¨æ¥å¯¹ä¸»modelè¿›è¡Œåˆ‡ç‰‡å‡†å¤‡ï¼Œå¹¶ä¸”ç”¨æ¥ç®€åŒ–æ‰€è¦æ‰§è¡Œæ“ä½œçš„ä»»æ„ç±»åž‹çš„æŽ¥å£æˆ–è€…modelã€‚Use caseå’Œview-modelå¾ˆåƒï¼Œä½†æ˜¯å®ƒå¹¶ä¸è¢«ç»‘å®šåœ¨ä¸€ä¸ªå•ç‹¬çš„ViewControllerä¸Šï¼Œè€Œæ˜¯å¯ä»¥åœ¨view-modelä¹‹é—´è¿›è¡Œä¼ é€’æˆ–è€…å…±äº«ï¼Œä»Žè€Œåœ¨å¤šä¸ªview-modelä¸­æä¾›å¯é‡ç”¨çš„åŠŸèƒ½ã€‚å½“ä¸€ä¸ªappæœ‰å¤šä¸ªviewæ˜¾ç¤ºåŒæ ·çš„åº•å±‚æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…±é€šçš„Use caseå¯¹è±¡æ¥å¯¹ä»ŽmodelèŽ·å–æ•°æ®å’Œå°†æ•°æ®å†™å›žmodelçš„æ“ä½œè¿›è¡Œç®€åŒ–ã€‚ 2.å¼•å…¥åè°ƒå™¨åè°ƒå™¨æ˜¯ç‹¬ç«‹äºŽMVVMçš„æ¨¡å¼ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºŽå…¶ä»–APPæž¶æž„ä¸­ï¼Œé€šè¿‡å¼•å…¥åè°ƒå™¨å¯ä»¥å‡è½»ViewControllerçš„èŒè´£ï¼Œè®©ViewControlleræ— éœ€çŸ¥é“å…¶ä»–ViewControllerçš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿè®©é¡µé¢å±‚çº§ç®¡ç†çš„é€»è¾‘é›†ä¸­åœ¨äº†ä¸€èµ·ï¼Œæ–¹ä¾¿ä»£ç çš„ç»´æŠ¤ã€‚ 3.åˆ†ç¦»æ•°æ®å˜å½¢MVVMä¸­é€šè¿‡view-modelå°†æ•°æ®å˜å½¢çš„é€»è¾‘ä»ŽViewControllerä¸­æŠ½ç¦»äº†å‡ºæ¥ï¼Œè¿™ç§åˆ†ç¦»è®©ViewControllerå˜å¾—æ›´åŠ æ•´æ´ï¼Œè®©æ•°æ®å˜å½¢çš„ä»£ç æ›´åŠ æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿæ›´æ˜“äºŽæµ‹è¯•ã€‚å¦‚æžœæœ‰éœ€è¦ï¼Œå³ä½¿ä¸æ˜¯åœ¨MVVMä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ è¾…åŠ©å¯¹è±¡æ¥åŒæ ·çš„å¯¹æ•°æ®å˜å½¢é€»è¾‘è¿›è¡Œåˆ†ç¦»ï¼Œç‰¹åˆ«æ˜¯æ•°æ®å˜å½¢ç‰µæ¶‰åˆ°æ¯”è¾ƒå¤šçš„æ•°æ®å’Œé€»è¾‘çš„æ—¶å€™ã€‚]]></content>
      <categories>
        <category>APPæž¶æž„</category>
      </categories>
      <tags>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸‰ã€MVCè®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2018%2F12%2F22%2FAPP%E6%9E%B6%E6%9E%84%2F%E4%B8%89%E3%80%81MVC%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Reference:App Architecture MVCåŸºäºŽç»å…¸çš„é¢å‘å¯¹è±¡åŽŸåˆ™:å¯¹è±¡åœ¨å†…éƒ¨å¯¹å®ƒä»¬çš„è¡Œä¸ºå’ŒçŠ¶æ€è¿›è¡Œç®¡ç†ï¼Œå¹¶é€šè¿‡ç±»å’Œåè®®çš„æŽ¥å£è¿›è¡Œé€šè®¯ã€‚MVCä¸­viewå¯¹è±¡é€šå¸¸æ˜¯è‡ªåŒ…å«ä¸”å¯é‡ç”¨çš„ï¼›modelå¯¹è±¡ç‹¬ç«‹äºŽè¡¨çŽ°å½¢å¼ä¹‹å¤–ï¼Œä¸”é¿å…ä¾èµ–ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼›controllerå±‚è´Ÿè´£å°†modelå±‚å’Œviewå±‚æ’®åˆåˆ°ä¸€èµ·å·¥ä½œï¼Œcontrollerå¯¹å¦å¤–ä¸¤å±‚è¿›è¡Œæž„å»ºå’Œé…ç½®ï¼Œå¹¶å¯¹modelå¯¹è±¡å’Œviewå¯¹è±¡ä¹‹é—´çš„åŒå‘é€šè®¯è¿›è¡Œåè°ƒã€‚ MVCä¸­APPçš„åé¦ˆå›žè·¯ï¼š iOSä¸­æ ‡å‡†çš„MVCæ˜¯ä¸‰ç§ä¸åŒçš„å­æ¨¡å¼çš„é›†åˆ: ç»„åˆæ¨¡å¼ï¼šviewè¢«ç»„è£…æˆä¸ºå±‚çº§ï¼Œè¯¥å±‚çº§æŒ‰ç»„åŒºåˆ†ï¼Œç”±controllerå¯¹è±¡è¿›è¡Œç®¡ç† ç­–ç•¥æ¨¡å¼ï¼šcontrollerå¯¹è±¡è´Ÿè´£åè°ƒviewå’Œmodelï¼Œå¹¶ä¸”å¯¹å¯é‡ç”¨çš„ã€ç‹¬ç«‹äºŽappçš„viewåœ¨appä¸­çš„è¡Œä¸ºè¿›è¡Œç®¡ç† è§‚å¯Ÿè€…æ¨¡å¼ï¼šä¾èµ–äºŽmodelæ•°æ®çš„å¯¹è±¡å¿…é¡»è®¢é˜…å’ŒæŽ¥æ”¶æ›´æ–° åœ¨æ‰€æœ‰æ¨¡å¼ä¸­ï¼ŒMVCé€šå¸¸éƒ½æ˜¯ä»£ç é‡æœ€å°‘ï¼Œè®¾è®¡å¼€é”€æœ€å°çš„æ¨¡å¼ã€‚MVCæ¨¡å¼æœ‰ä¸¤ä¸ªä¸»è¦çš„ç¼ºé™·ï¼Œå…¶ä¸€æ˜¯view controlleræ‹¥æœ‰å¤ªå¤šçš„èŒè´£ï¼Œæ‰€å¯¼è‡´çš„â€œmassive view controllerâ€ï¼›åŒæ—¶MVCä¹Ÿéš¾ä»¥æµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯å•å…ƒæµ‹è¯•å’ŒæŽ¥å£æµ‹è¯•éžå¸¸å›°éš¾ï¼Œè€Œæ¯”è¾ƒå¯è¡Œçš„é›†æˆæµ‹è¯•çš„ç¼–å†™ä¹Ÿå¹¶éžæ˜“äº‹ã€‚ ä¸€ã€MVCçš„å®žçŽ°1.æž„å»ºCocoa MVCç¨‹åºçš„åˆ›å»ºè¿‡ç¨‹ä¼šå®Œæˆå¯¹ä¸‰ä¸ªå¯¹è±¡çš„åˆ›å»ºï¼šUIApplicationå¯¹è±¡ï¼ŒApplication delegateï¼Œä»¥åŠä¸»çª—å£çš„æ ¹ViewControllerã€‚è¿™ä¸‰ä¸ªå¯¹è±¡çš„é»˜è®¤é…ç½®æ–‡ä»¶åˆ†åˆ«ä¸ºï¼šInfo.plistï¼ŒAppDelegateå’ŒMain.storyboardã€‚åŒæ—¶å®ƒä»¬åˆæä¾›äº†å¯¹åŽç»­å¯åŠ¨æµç¨‹è¿›è¡Œé…ç½®çš„åœ°æ–¹ï¼Œè¿™ä¸‰ä¸ªå¯¹è±¡éƒ½å±žäºŽControllerå±‚çº§ï¼Œæ‰€ä»¥è¯´Controllerå±‚è´Ÿè´£äº†æ‰€æœ‰çš„æž„å»ºå·¥ä½œã€‚ MVC appä¸­çš„Viewä¸ç›´æŽ¥å¼•ç”¨modelå¯¹è±¡ï¼ŒViewå°†ä¿æŒç‹¬ç«‹å¯é‡ç”¨ï¼Œmodelå¯¹è±¡å°†è¢«å­˜å‚¨åœ¨ViewControllerä¸­ï¼ŒViewControllerå°†å˜æˆäº†ä¸ªä¸å¯é‡ç”¨çš„ç±»ï¼Œmodelå¯¹è±¡èµ‹äºˆäº†ViewControllerå¯¹åº”çš„èº«ä»½ã€‚ 2.å°†Viewè¿žæŽ¥åˆ°æ•°æ®åœ¨MVCä¸­Controlleræ ¹æ®åˆå§‹çš„modelå¯¹Viewè¿›è¡Œé…ç½®ï¼Œå¹¶è§‚å¯Ÿmodelï¼Œåœ¨modelçš„å˜æ›´é€šçŸ¥åˆ°åˆ°è¾¾æ—¶åšç›¸åº”çš„Viewå˜æ›´ã€‚ åœ¨ViewControllerä¸Šè®¾ç½®ä¸€ä¸ªåˆå§‹modelå€¼æ—¶ï¼Œæœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼: é€šè¿‡åˆ¤å®šcontrolleråœ¨controllerå±‚çº§ä¸Šçš„ä½ç½®ä»¥åŠcontrollerçš„ç±»åž‹ï¼Œç›´æŽ¥è®¿é—®ä¸€ä¸ªå…¨å±€çš„modelå¯¹è±¡ å¼€å§‹æ—¶å°†modelå¯¹è±¡çš„å¼•ç”¨è®¾ç½®ä¸ºnilå¹¶è®©æ‰€æœ‰ä¸œè¥¿ä¿æŒä¸ºç©ºç™½çŠ¶æ€ï¼Œç›´åˆ°å¦ä¸€ä¸ªcontrolleræä¾›äº†ä¸€ä¸ªéžnilå€¼ åœ¨controlleråˆå§‹åŒ–æ—¶å°†modelå¯¹è±¡å½“ä½œå‚æ•°ä¼ é€’è¿›æ¥(ä¹Ÿå°±æ˜¯ä¾èµ–æ³¨å…¥) åœ¨æž„å»ºé˜¶æ®µç»“æŸåŽï¼Œå¯¹äºŽviewå±‚çº§çš„å˜æ›´åº”è¯¥éµå¾ªMVCä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„éƒ¨åˆ†ï¼Œåªå‘ç”Ÿåœ¨è§‚å¯Ÿçš„å›žè°ƒä¸­ã€‚ è§‚å¯Ÿè€…æ¨¡å¼æ˜¯åœ¨MVCä¸­ç»´æŒmodelå’Œviewåˆ†ç¦»çš„å…³é”®ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹åœ¨äºŽï¼Œä¸è®ºå˜æ›´ç©¶ç«Ÿæ˜¯æºè‡ªå“ªé‡Œ(æ¯”å¦‚ï¼Œviewäº‹ä»¶ã€åŽå°ä»»åŠ¡æˆ–è€…ç½‘ç»œ)ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç¡®ä¿¡UIæ˜¯å’Œmodelæ•°æ®åŒæ­¥çš„ã€‚è€Œä¸”ï¼Œåœ¨é‡åˆ°å˜æ›´è¯·æ±‚æ—¶ï¼Œmodelå°†æœ‰æœºä¼šæ‹’ç»æˆ–è€…ä¿®æ”¹è¿™ä¸ªè¯·æ±‚ï¼Œå³ä½¿modelè¢«ä»¥å…¶ä»–æ–¹å¼(æ¯”å¦‚ä¸€ä¸ªç½‘ç»œäº‹ä»¶)æ”¹å˜ï¼Œæˆ–è€…æ˜¯modelæ‹’ç»è¿™æ¬¡å˜æ›´æ—¶ï¼ŒUIä¹Ÿä¼šæ­£ç¡®æ›´æ–°ã€‚è¿™æ˜¯ä¸€ç§ç¡®ä¿viewå±‚å§‹ç»ˆä¸Žmodelå±‚åŒæ­¥çš„ååˆ†å¥å£®çš„æ–¹å¼ã€‚ 3.æ›´æ”¹ModelView Actionçš„äº‹ä»¶å›žè·¯ï¼š viewé€šè¿‡target/actionæœºåˆ¶å’Œdelegateç­‰æ–¹å¼å°†View Actionä¼ é€’ç»™ViewControllerï¼› ViewControlleræŽ¥æ”¶åˆ°å˜æ›´modelçš„View Actionæ—¶ç›´æŽ¥æ›´æ”¹modelï¼› ViewControlleré€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼å“åº”modelå˜æ›´å¹¶æ›´æ–°viewã€‚ 4.æ›´æ”¹ViewStateMVCçš„modelå±‚èµ·æºäºŽå…¸åž‹çš„åŸºäºŽæ–‡æ¡£çš„appï¼šä»»ä½•åœ¨ä¿å­˜æ“ä½œä¸­å†™å…¥æ–‡æ¡£çš„çŠ¶æ€éƒ½è¢«å½“ä½œæ˜¯modelçš„ä¸€éƒ¨åˆ†æ¥è€ƒè™‘ã€‚å…¶ä»–çš„ä»»æ„çŠ¶æ€ï¼ˆåŒ…æ‹¬åƒæ˜¯å¯¼èˆªçŠ¶æ€ï¼Œä¸´æ—¶çš„æœç´¢å’ŒæŽ’åºå€¼ï¼Œå¼‚æ­¥ä»»åŠ¡çš„åé¦ˆä»¥åŠæœªæäº¤çš„æ›´æ”¹ï¼‰ä¼ ç»Ÿæ„ä¹‰ä¸Šæ˜¯è¢«æŽ’é™¤åœ¨MVCçš„modelå®šä¹‰ä¹‹å¤–çš„ï¼Œæˆ‘ä»¬æŠŠè¿™äº›çŠ¶æ€ç»Ÿç§°ä¸ºview stateã€‚åœ¨MVCä¸­ï¼Œè¿™äº›è¢«æˆ‘ä»¬ç»Ÿç§°ä¸ºview stateçš„â€œå…¶ä»–â€çŠ¶æ€æ²¡æœ‰è¢«åŒ…å«åœ¨æ¨¡å¼çš„æè¿°ä¸­ã€‚ ä¾ç…§ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡çš„åŽŸåˆ™ï¼Œä»»æ„çš„å¯¹è±¡éƒ½å¯ä»¥æ‹¥æœ‰å†…éƒ¨çŠ¶æ€ï¼Œè¿™äº›å¯¹è±¡ä¹Ÿä¸éœ€è¦å°†å†…éƒ¨çŠ¶æ€çš„å˜åŒ–ä¼ è¾¾ç»™ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ã€‚åŸºäºŽè¿™ç§å†…éƒ¨å¤„ç†ï¼Œview stateä¸éœ€è¦éµå®ˆä»»ä½•ä¸€æ¡ç¨‹åºä¸­çš„æ¸…æ™°è·¯å¾„ã€‚ä»»æ„viewæˆ–è€…controlleréƒ½å¯ä»¥åŒ…å«çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ç”±View Actionè¿›è¡Œæ›´æ–°ã€‚view stateçš„å¤„ç†å°½å¯èƒ½åœ°åœ¨æœ¬åœ°è¿›è¡Œ:ä¸€ä¸ªviewæˆ–è€…ViewControllerå¯ä»¥ç‹¬è‡ªå“åº”ç”¨æˆ·äº‹ä»¶ï¼Œå¯¹è‡ªèº«çš„view stateè¿›è¡Œæ›´æ–°ã€‚ å¦‚æžœæƒ³è¦åœ¨viewå±‚çº§çš„ä¸åŒéƒ¨åˆ†å…±äº«view stateï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š æ‰¾åˆ°å®ƒä»¬å…±åŒçš„ç¥–å…ˆï¼Œå¹¶åœ¨é‚£å„¿ç®¡ç†çŠ¶æ€ ä½¿ç”¨å•ä¾‹æ¥ç®¡ç†çŠ¶æ€ å®žé™…æ“ä½œä¸­ï¼Œå°†view stateæ”¾åˆ°å±‚çº§çš„é¡¶å±‚controllerå¯¹è±¡ä¸­çš„åšæ³•ï¼ˆå³ç¬¬ä¸€ç§æ–¹å¼ï¼‰å¹¶ä¸å¸¸â»…ï¼Œå› ä¸ºè¿™ä¼šè¦æ±‚å±‚çº§çš„æ¯ä¸€å±‚ä¹‹é—´å­˜åœ¨é€šè®¯çš„ç®¡é“ã€‚ 5.æµ‹è¯•è‡ªåŠ¨æµ‹è¯•å¯ä»¥ç”±å¥½å‡ ç§ä¸åŒå½¢å¼è¿›è¡Œã€‚ä»Žæœ€å°çš„ç²’åº¦åˆ°æœ€å¤§çš„ç²’åº¦ï¼Œå®ƒä»¬åŒ…æ‹¬: å•å…ƒæµ‹è¯•ï¼šå°†ç‹¬ç«‹çš„å‡½æ•°ç‹¬ç«‹å‡ºæ¥ï¼Œå¹¶æµ‹è¯•å®ƒä»¬çš„è¡Œä¸º æŽ¥å£æµ‹è¯•ï¼šä½¿ç”¨æŽ¥å£è¾“å…¥å¹¶æµ‹è¯•æŽ¥å£è¾“å‡ºå¾—åˆ°çš„ç»“æžœï¼Œè¾“å…¥å’Œè¾“å‡ºé€šå¸¸éƒ½æ˜¯å‡½æ•° é›†æˆæµ‹è¯•ï¼šåœ¨æ•´ä½“ä¸Šæµ‹è¯•ç¨‹åºæˆ–è€…ç¨‹åºçš„ä¸»è¦éƒ¨åˆ† å•å…ƒæµ‹è¯•åªèŠ±äº†åå¤šå¹´çš„æ—¶é—´å°±æˆä¸ºäº†appä¸­æœ€å¸¸â»…çš„æµ‹è¯•æ–¹å¼ã€‚ä¸è¿‡å³ä½¿æ˜¯çŽ°åœ¨ï¼Œè®¸å¤šappé™¤äº†äººå·¥æµ‹è¯•ä»¥å¤–å¹¶æ²¡æœ‰è¿›è¡Œå¸¸è§„çš„è‡ªåŠ¨æµ‹è¯•ã€‚å¦‚æžœæƒ³è¦åœ¨ä»£ç å±‚çº§å¯¹MVCçš„controllerå’Œmodelå±‚è¿›è¡Œè‡ªåŠ¨æµ‹è¯•ï¼Œå¯è¡Œçš„é€‰é¡¹æ˜¯å†™é›†æˆæµ‹è¯•ï¼Œä½†æƒ³è¦æ­£ç¡®ä¹¦å†™é›†æˆæµ‹è¯•ï¼Œéœ€è¦å¤§é‡å…³äºŽCocoaæ¡†æž¶æ˜¯å¦‚ä½•æ“ä½œçš„çŸ¥è¯†ï¼Œè¿™å¹¶éžæ˜“äº‹ã€‚åœ¨MVCä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä»Žwindowå¼€å§‹æž„å»ºViewControlleræ ‘å’Œviewæ ‘ï¼Œåœ¨æ ‘æž„å»ºå‡ºæ¥åŽä¾¿å¯ä»¥é€‰æ‹©ä»¥æ–°åˆ›å»ºå‡ºæ¥çš„æ ‘ä½œä¸ºå•ä¸ªé›†æˆæµ‹è¯•å•å…ƒè¿›è¡Œæµ‹è¯•ï¼šä¹¦å†™ä»£ç è§¦å‘äº‹ä»¶ï¼Œç„¶åŽä¸Žæˆ‘ä»¬çš„é¢„æœŸè¿›è¡ŒéªŒè¯ã€‚ äºŒã€MVCçš„é—®é¢˜è§‚å¯Ÿè€…æ¨¡å¼å¤±æ•ˆç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œmodelå’Œviewçš„åŒæ­¥å¯èƒ½å¤±æ•ˆã€‚å½“å›´ç»•modelçš„è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰è¢«å®Œç¾Žæ‰§è¡Œæ—¶ï¼Œè¿™ä¸ªé—®é¢˜å°±ä¼šå‘ç”Ÿã€‚å¸¸â»…çš„é”™è¯¯æ˜¯ï¼Œåœ¨æž„å»ºviewæ—¶è¯»å–äº†modelçš„å€¼ï¼Œè€Œæ²¡æœ‰å¯¹åŽç»­çš„é€šçŸ¥è¿›è¡Œè®¢é˜…ã€‚å¦ä¸€ä¸ªå¸¸â»…é”™è¯¯æ˜¯åœ¨å˜æ›´modelçš„åŒæ—¶åŽ»æ›´æ”¹viewå±‚çº§ã€‚è§£å†³æ–¹æ³•åªæœ‰ä¸¥æ ¼åœ°éµå®ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼šå½“è¯»å–modelå€¼æ—¶ï¼Œä¹Ÿéœ€è¦å¯¹å®ƒè¿›è¡Œè®¢é˜…ã€‚ è‚¥å¤§çš„ViewControllerViewControlleréœ€è¦è´Ÿè´£å¤„ç†viewå±‚(è®¾ç½®viewå±žæ€§ï¼Œå±•ç¤ºviewç­‰)ï¼Œä½†æ˜¯å®ƒåŒæ—¶ä¹Ÿè´Ÿè´£controllerå±‚çš„ä»»åŠ¡(è§‚å¯Ÿmodelä»¥åŠæ›´æ–°view)ï¼Œæœ€åŽï¼Œå®ƒè¿˜è¦è´Ÿè´£modelå±‚(èŽ·å–æ•°æ®ï¼Œå¯¹å…¶å˜å½¢æˆ–è€…å¤„ç†)ã€‚ç»“åˆå®ƒåœ¨æž¶æž„ä¸­çš„ä¸­å¿ƒâ»†è‰²ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¾ˆå®¹æ˜“åœ¨ä¸ç»æ„é—´æŠŠæ‰€æœ‰çš„èŒè´£éƒ½èµ‹äºˆViewControllerï¼Œä»Žè€Œè¿…é€Ÿè®©ç¨‹åºå˜å¾—éš¾ä»¥ç®¡ç†ã€‚ å…³äºŽè‚¥å¤§çš„ViewControlleræœ€ä¸»è¦çš„äº‰è®ºä¸æ˜¯å…³äºŽä»£ç çš„è¡Œæ•°ï¼Œè€Œåœ¨äºŽæ‰€ä¿å­˜çš„çŠ¶æ€çš„æ•°é‡ã€‚å½“æ•´ä¸ªæ–‡ä»¶å°±åƒViewControllerè¿™æ ·æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å¯å˜çŠ¶æ€éƒ½å°†è¢«æ–‡ä»¶ä¸­çš„å„ä¸ªéƒ¨åˆ†å…±äº«ï¼Œæ¯ä¸ªå‡½æ•°éœ€è¦ç²¾è¯šåˆä½œï¼Œæ¥å…±åŒè¯»å–å’Œç»´æŠ¤è¿™äº›çŠ¶æ€ï¼Œé¿å…å½¼æ­¤çŸ›ç›¾ï¼Œè¿™æ— ç–‘æ˜¯ä¼šè®©ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éƒ½è¶Šæ¥è¶Šå·®ã€‚ ä¸‰ã€MVCçš„æ”¹è¿›è§‚å¯Ÿè€…æ¨¡å¼æœ€å¥½æ˜¯æœ‰ä¸€ç§æ–¹å¼ï¼Œèƒ½è®©å¯¹Viewçš„åˆå§‹è®¾å®šå’Œåœ¨viewDidLoadä¸­å¯¹modelå»ºç«‹è§‚å¯Ÿè€…ä¹‹é—´æ²¡æœ‰æ—¶é—´ç©ºéš™ã€‚ä½¿ç”¨é”®å€¼è§‚å¯Ÿ(KVO)æ¥æ›¿ä»£é€šçŸ¥æ˜¯å¯é€‰é¡¹ä¹‹ä¸€ï¼Œä½†æ˜¯ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™é€šå¸¸éœ€è¦åŒæ—¶è§‚å¯Ÿå¤šä¸ªä¸åŒçš„é”®è·¯å¾„ï¼Œè¿™è®©KVOå’Œé€šçŸ¥çš„æ–¹å¼ç›¸æ¯”ï¼Œå®žé™…ä¸Šå¹¶æ²¡æœ‰æ›´åŠ ç¨³å®šã€‚åœ¨Swiftä¸­KVOç”±äºŽéœ€è¦æ¯ä¸ªè¢«è§‚å¯Ÿçš„å±žæ€§éƒ½å£°æ˜Žä¸ºdynamicï¼Œè¿™ä¹Ÿè®©å®ƒåœ¨Swiftä¸­è¿œè¿œæ²¡æœ‰åœ¨Objective-Cä¸­é‚£æ ·æµè¡Œã€‚ å¯¹è§‚å¯Ÿè€…æ¨¡å¼æœ€ç®€å•çš„æ”¹è¿›æ–¹å¼æ˜¯ï¼Œå°†Notiô°ŠcationCenterè¿›è¡Œå°è£…å¹¶ä¸ºå®ƒå®žçŽ°KVOæ‰€åŒ…å«çš„åˆå§‹åŒ–çš„æ¦‚å¿µã€‚è¿™ä¸ªæ¦‚å¿µä¼šåœ¨è§‚å¯Ÿè¢«å»ºç«‹çš„åŒæ—¶å‘é€ä¸€ä¸ªåˆå§‹å€¼ï¼Œè¿™å…è®¸æˆ‘ä»¬å°†è®¾å®šåˆå§‹å€¼å’Œè§‚å¯ŸåŽç»­å€¼çš„æ“ä½œåˆå¹¶åˆ°ä¸€ä¸ªå•ä¸€ç®¡é“ä¸­åŽ»ã€‚å¦å¤–ä¸€ç§å¯è¡Œçš„æ€è€ƒæ˜¯ï¼Œå°†è§‚å¯Ÿè€…æ¨¡å¼æ›¿æ¢ä¸ºåœ¨MVVMä¸­æ¯”è¾ƒå¸¸ç”¨çš„å“åº”å¼ç¼–ç¨‹ï¼Œè¿™æ ·å¯ä»¥å€ŸåŠ©ä¸€äº›å“åº”å¼ç¼–ç¨‹æ¡†æž¶ï¼Œå°†å¯¹åˆå§‹å€¼çš„è®¾å®šä¸ŽåŽç»­è§‚å¯Ÿéƒ½åˆå¹¶åœ¨ä¸€æ¬¡è®¢é˜…æ“ä½œä¸­ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†modelä¸Žviewçš„åŒæ­¥ï¼Œä¾‹å¦‚åœ¨ReactiveCocoaä¸­ï¼Œå¯¹KVOçš„å°è£…ä¹Ÿè®©è¿™ç±»ä»£ç çš„ä¹¦å†™éžå¸¸åœ°æ–¹ä¾¿ã€‚ è‚¥å¤§ViewControllerçš„é—®é¢˜ViewControllerä¸»è¦çš„å·¥ä½œä¸ºï¼šè§‚å¯Ÿmodelï¼Œå±•ç¤ºviewï¼Œä¸ºå®ƒä»¬æä¾›æ•°æ®ï¼Œä»¥åŠæŽ¥æ”¶View Actionã€‚é€ æˆè‚¥å¤§ViewControllerçš„åŽŸå› å°±æ˜¯ViewControlleré€šå¸¸è¿˜è´Ÿè´£äº†ä¸»è¦å·¥ä½œä¹‹å¤–çš„æ— å…³å·¥ä½œï¼Œè¿™äº›é¢å¤–çš„å·¥ä½œæœ‰çš„åº”è¯¥è¢«åˆ†æ•£åˆ°è¾ƒå°å±‚çº§çš„Controllerä¸­ï¼Œè¿™äº›Controllerå„è‡ªç®¡ç†ä¸€ä¸ªè¾ƒå°éƒ¨åˆ†çš„viewï¼›æœ‰çš„åˆ™å¯ä»¥é€šè¿‡æŽ¥å£å’ŒæŠ½è±¡å°†å…¶å°è£…èµ·æ¥ï¼Œä½œä¸ºå·¥å…·ç±»ä½¿ç”¨ï¼›è¿˜æœ‰çš„åŠŸèƒ½åˆ™æ˜¯åº”è¯¥ç§»åŠ¨åˆ°modelå±‚ä¸­ï¼Œæ¯”å¦‚æŽ’åºã€æ•°æ®èŽ·å–å’Œå¤„ç†ç­‰æ–¹æ³•ï¼Œå®ƒä»¬ä¸Žappçš„æ•°æ®å’Œä¸“ç”¨é€»è¾‘ç›¸å…³ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨modelä¸­ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ æ‰€ä»¥è§£å†³è‚¥å¤§ViewControllerçš„ä¸»è¦æ€è·¯æœ‰ï¼š ä½¿ç”¨è¾ƒå°å±‚çº§çš„Controlleré€šè¿‡å°†ä¸»è¦çš„viewçš„é€»è¾‘åˆ†æ•£åˆ°å®ƒä»¬è‡ªå·±çš„æ›´å°çš„controllerä¸­ï¼Œç®€åŒ–åœºæ™¯çš„viewä¾èµ–ï¼Œåœ¨çˆ¶ViewControllerä¸­å‰©ä¸‹çš„å·¥ä½œå°±åªæœ‰é›†æˆå’Œå¸ƒå±€äº† å°†éƒ¨åˆ†ä»»åŠ¡å°è£…æˆå·¥å…·ç±»å¯ä»¥åˆ›å»ºå·¥å…·ç±»æ¥æ‰§è¡Œåƒæ˜¯èŽ·å–ç”¨æˆ·ä½ç½®ä¿¡æ¯è¿™ç§å¼‚æ­¥ä»»åŠ¡ï¼Œè¿™æ ·ï¼Œåœ¨controllerä¸­éœ€è¦çš„ä»£ç å°±åªæ˜¯åˆ›å»ºä»»åŠ¡å’Œå›žè°ƒé—­åŒ… å°†æ•°æ®ç›¸å…³çš„é€»è¾‘æ”¾åœ¨modelä¸­ä¾‹å¦‚æŽ’åºã€æ•°æ®èŽ·å–å’Œå¤„ç†ç­‰æ–¹æ³•ï¼ŒåŒ…æ‹¬æ•°æ®ç½‘ç»œå±‚çš„èŽ·å–ä¸Žå¤„ç†ï¼Œäº¤ç”±modelç®¡ç†å°†æ›´åŠ çš„åˆç† å±žäºŽå„ä¸ªéƒ¨ä»¶çš„é€»è¾‘åº”å½“å°½å¯èƒ½åœ°é›†æˆåˆ°å„è‡ªçš„éƒ¨ä»¶ä¸­åŽ»ï¼Œå°†éƒ¨åˆ†ViewControllerä¸­çš„ä»£ç æŠ½ç¦»å‡ºæ¥ï¼Œåœ¨æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰é™ä½Žæ•´ä¸ªç¨‹åºçš„å¤æ‚åº¦ï¼Œä½†æ˜¯è¿™ä¹ˆåšç¡®å®žé™ä½Žäº†ViewControlleræœ¬èº«çš„å¤æ‚åº¦ã€‚ é™ä½ŽViewControllerçš„å¤æ‚åº¦çš„å…¶ä»–æ‰‹æ®µè¿˜åŒ…æ‹¬ï¼š ä½¿ç”¨ä»£ç è€Œä¸æ˜¯segueå¦‚æžœä¸ä½¿ç”¨segueï¼Œè€Œæ˜¯é€‰æ‹©ç”¨ä»£ç æ¥å®šä¹‰viewå±‚çº§ï¼Œèƒ½åœ¨æž„å»ºé˜¶æ®µæœ‰æ›´å¤šçš„æŽ§åˆ¶åŠ›ï¼Œå…¶ä¸­æœ€å¤§çš„ä¼˜ç‚¹åœ¨äºŽï¼Œå¯ä»¥æ›´å¥½åœ°æŽŒæŽ§ä¾èµ–ï¼Œè¿™æ ·å¯ä»¥è®©é¡µé¢è·³è½¬æ—¶å¯¹ViewControllerçš„é…ç½®æ›´åŠ çš„æ–¹ä¾¿å¯æŽ§ã€‚ åœ¨æ‰©å±•ä¸­è¿›è¡Œä»£ç é‡ç”¨åœ¨ä¸åŒçš„ViewControlleré—´å…±äº«ä»£ç ï¼Œæœ€å¸¸â»…çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«å…±é€šåŠŸèƒ½çš„çˆ¶ç±»ï¼Œå¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨æ‰©å±•(ç±»åˆ«)ã€‚ç›¸è¾ƒäºŽç»§æ‰¿ï¼Œè¿™ç§é‡ç”¨ä»£ç çš„æ–¹å¼ï¼Œåœ¨é™ä½ŽViewControllerå¤æ‚åº¦çš„åŒæ—¶ï¼Œå¹¶æ²¡æœ‰æé«˜ç»§æ‰¿é“¾çš„å¤æ‚åº¦ã€‚ åˆ©ç”¨ChildViewControllerè¿›è¡Œä»£ç é‡ç”¨ChildViewControlleræ˜¯åœ¨ViewControllerä¹‹é—´å…±äº«ä»£ç çš„å¦ä¸€ç§é€‰é¡¹ï¼Œå®ƒç¬¦åˆä½¿ç”¨è¾ƒå°å±‚çº§Controllerçš„æ€è·¯ï¼Œæ˜¯é™ä½ŽViewControllerå¤æ‚åº¦åŒæ—¶æé«˜ä»£ç é‡ç”¨çš„æœ‰æ•ˆæ–¹å¼ã€‚ æå–åè°ƒcontrollerè®¸å¤šå¤§çš„ViewControlleréƒ½æœ‰å¾ˆå¤šâ»†è‰²å’ŒèŒè´£ï¼Œé™¤äº†ä¸€äº›å…·ä½“çš„ä»»åŠ¡å¯ä»¥æŠ½ç¦»æˆå·¥å…·ç±»ä¹‹å¤–ï¼Œå…¶ä»–çš„ä¸€äº›èŒè´£äº‹åŠ¡ä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡æå–å‡ºæ¥ï¼Œå¯¹è¿™äº›æå–å‡ºæ¥çš„äº‹åŠ¡å¯¹è±¡åšæ³›åž‹æŠ½è±¡åŽï¼Œè¿˜èƒ½åœ¨å…¶ä»–æœ‰ç›¸ä¼¼äº‹åŠ¡çš„ViewControllerä¸­é‡ç”¨ è‹¹æžœå°†controllerçš„ä¸»è¦èŒè´£åˆ†ä¸ºåè°ƒcontroller(coordinating controller)å’Œè°ƒè§£controller(mediating controller)ã€‚ä¸€ä¸ªåè°ƒcontrolleræ˜¯appç‰¹å®šçš„ï¼Œè€Œä¸”ä¸€èˆ¬æ¥è¯´æ˜¯æ— æ³•é‡ç”¨çš„(å³ViewControllerçš„ä¸»è¦å·¥ä½œéƒ¨åˆ†)ã€‚è°ƒè§£controlleråˆ™æ˜¯ä¸€ä¸ªå¯é‡ç”¨çš„controllerå¯¹è±¡ï¼Œé€šè¿‡é…ç½®ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚é€šå¸¸ï¼Œç”¨æ¥éµå®ˆæŸä¸ªåè®®çš„ä»£ç (æ¯”å¦‚ViewControllerä¸­éµå®ˆUITableViewDataSourceçš„éƒ¨åˆ†)ï¼Œæ¯”è¾ƒé€‚åˆè¢«æå–ä¸ºè°ƒè§£controllerï¼Œå†å°†æå–å‡ºæ¥çš„å¯¹è±¡è¿›è¡Œæ³›åž‹æŠ½è±¡ï¼Œè®©éƒ¨åˆ†å·®å¼‚åŒ–é€»è¾‘é€šè¿‡blockç­‰æ–¹å¼ä»Žå¤–é¢ä¼ é€’è¿›æ¥ï¼Œè¿™ä¸ªæå–å‡ºæ¥çš„å¯¹è±¡ï¼Œä¾¿èƒ½ç”¨äºŽæœ‰ç›¸ä¼¼è°ƒè§£controlleré€»è¾‘çš„ViewControllerä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ†ç¦»controllerçš„é€»è¾‘èƒ½é™ä½ŽViewControllerçš„å¤æ‚åº¦ï¼Œä½†æ˜¯å½“ä¸¤ä¸ªéƒ¨ä»¶ç´§å¯†è€¦åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”éœ€è¦å¯¹å¾ˆå¤šçŠ¶æ€è¿›è¡Œé€šè®¯å’Œå…±äº«çš„æ—¶å€™ï¼Œåˆ†ç¦»åŽæ‰€å¸¦æ¥çš„å¼€é”€å¯èƒ½ä¼šéžå¸¸å¤§ï¼Œåè€Œä½¿å¾—äº‹æƒ…å˜å¾—æ›´åŠ å¤æ‚ï¼Œè¿™æ—¶ä¸åˆ†ç¦»åè€Œæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ ç®€åŒ–Viewé…ç½®ä»£ç å¦‚æžœViewControlleréœ€è¦æž„å»ºå’Œæ›´æ–°éžå¸¸å¤šçš„viewï¼Œé‚£ä¹ˆå°†è¿™éƒ¨åˆ†viewé…ç½®çš„ä»£ç æå–å‡ºæ¥ï¼Œå¯¹äºŽé™ä½ŽViewControllerçš„å¤æ‚åº¦ä¹Ÿéžå¸¸æœ‰æ•ˆï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽé‚£äº›ä¸éœ€è¦åŒå‘é€šè®¯çš„é…ç½®]]></content>
      <categories>
        <category>APPæž¶æž„</category>
      </categories>
      <tags>
        <tag>MVC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äºŒã€APPæž¶æž„çš„è®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2018%2F12%2F16%2FAPP%E6%9E%B6%E6%9E%84%2F%E4%BA%8C%E3%80%81APP%E6%9E%B6%E6%9E%84%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Reference:App Architecture iOSå¼€å‘å®˜æ–¹é’¦å®šçš„è®¾è®¡æ¨¡å¼æ˜¯MVCï¼Œè€ŒMVCåŠå…¶ä¸¤ç§å˜å½¢ï¼šMVVM+Cå’ŒMVC+VSï¼Œæ˜¯å­¦ä¹ iOS APPæž¶æž„æœ€éœ€è¦æŽŒæ¡çš„ä¸‰ç§è®¾è®¡æ¨¡å¼ï¼Œè¿™ä¸‰ç§è®¾è®¡æ¨¡å¼éƒ½æ˜¯åŸºäºŽåœºæ™¯è¿›è¡Œçš„æž¶æž„ï¼Œå®ƒä»¬å…¶å®žéƒ½æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼å’Œç»„åˆæ¨¡å¼ä¸‰ç§è®¾è®¡å­æ¨¡å¼çš„é›†åˆã€‚ MVCSï¼šåœ¨æœ‰çš„åœ°æ–¹ä¼šæåˆ°ä¸€ç§ç§°ä¸ºMVCSçš„æž¶æž„ï¼Œå®ƒåœ¨Modelå±‚ä¸ŽControllerå±‚ä¹‹é—´åŠ å…¥äº†ä¸€ä¸ªServiceå±‚ï¼Œåœ¨iOSä¸­ä¸€èˆ¬åˆç‰¹æŒ‡è´Ÿè´£Modelæ•°æ®åŒæ­¥ã€ç¼“å­˜ã€æŒä¹…åŒ–ç­‰æœåŠ¡çš„Storeå±‚ï¼Œå®ƒæ‰€åˆ†ç¦»çš„é€»è¾‘åœ¨MVCä¸­å¯ä»¥å±žäºŽModelå±‚ï¼Œä¹Ÿå¯ä»¥å±žäºŽControllerå±‚ã€‚ä½†åœ¨App Architectureä¸€ä¹¦ä¸­å¹¶æ²¡æœ‰å°†MVCSåˆ—ä¸ºä¸€ç§å•ç‹¬çš„æž¶æž„ï¼ŒåŒæ—¶MVCSä¸­çš„Så±‚é™¤äº†å¯èƒ½å‡è½»äº†Controllerçš„èŒè´£ä¹Ÿæœªè§å…¶å®ƒè£¨ç›Šï¼Œè€Œå‡è½»Controllerçš„èŒè´£é€šè¿‡å°è£…æœåŠ¡ç±»ä¹Ÿèƒ½åŠžåˆ°ï¼Œäº‹å®žä¸ŠApp Architectureä¸€ä¹¦ä¸­åœ¨é˜è¿°MVCæž¶æž„çš„Demoä¸­å°±ç”¨ä¸€ä¸ªå…¨å±€çš„æœåŠ¡Storeè´Ÿè´£äº†æ‰€è°“MVCSæž¶æž„ä¸­Så±‚çš„å·¥ä½œï¼Œå¯è§MVCSä¸­ä¸ºæ¯ä¸ªåœºæ™¯éƒ½åˆ†ç¦»ä¸€ä¸ªSå±‚çš„åšæ³•ä¹Ÿç¡®å®žæ²¡é‚£ä¹ˆå¿…è¦ï¼Œå…¶æœ¬è´¨ä¸Šå’ŒMVCæž¶æž„ä¹Ÿæ²¡å¤šå°‘åŒºåˆ«ã€‚ MVCMVCæºäºŽSmalltalkä¸­æ‰€å‘å±•å‡ºçš„åˆ†ç¦»å±•ç¤ºéƒ¨åˆ†çš„ç†å¿µï¼Œä¹Ÿå°±æ˜¯viewå±‚å’Œmodelå±‚åº”è¯¥è¢«å®Œå…¨éš”ç¦»å¼€ï¼Œè¿™å¸¦æ¥äº†ä¸€ä¸ªå¼ºçƒˆçš„éœ€æ±‚ï¼Œé‚£å°±æ˜¯è¦å¼•å…¥ä¸€ä¸ªæ”¯æŒå¯¹è±¡æ¥è¾…åŠ©ä¸¤è€…ä¹‹é—´çš„é€šè®¯ï¼Œè¿™ä¸ªæ”¯æŒå¯¹è±¡åœ¨MVCä¸­å°±æ˜¯Controllerã€‚MVCä¸­Controllerå¯¹è±¡è´Ÿè´£å¤„ç†modelæˆ–è€…viewå±‚èŒƒç•´ä¹‹å¤–çš„æ‰€æœ‰ä»»åŠ¡ã€‚Controllerå±‚æŽ¥æ”¶æ‰€æœ‰çš„view actionï¼Œå¤„ç†æ‰€æœ‰çš„äº¤äº’é€»è¾‘ï¼›å‘é€æ‰€æœ‰çš„model actionï¼ŒæŽ¥æ”¶æ‰€æœ‰çš„modelé€šçŸ¥ï¼Œå¯¹æ‰€æœ‰ç”¨æ¥å±•ç¤ºçš„æ•°æ®è¿›è¡Œå‡†å¤‡ï¼Œæœ€åŽå†å°†å®ƒä»¬åº”ç”¨åˆ°Viewçš„å˜æ›´ä¸ŠåŽ»ã€‚æž„å»ºå’Œå¯¼èˆªä»»åŠ¡ä¹Ÿç”±Controllerè´Ÿè´£ã€‚ 1.æž„å»ºModelå’ŒViewï¼šMVCä¸­Viewå’ŒModelçš„æž„å»ºéƒ½ç”±Controllerè´Ÿè´£ï¼ŒAppå¯¹è±¡è´Ÿè´£åˆ›å»ºæœ€é¡¶å±‚çš„view controllerï¼Œè¿™ä¸ªview controllerå°†åŠ è½½viewï¼Œå¹¶ä¸”è¦ä¹ˆæ˜¾å¼åœ°åˆ›å»ºå’ŒæŒæœ‰modelå±‚ï¼Œè¦ä¹ˆé€šè¿‡ä¸€ä¸ªå»¶è¿Ÿåˆ›å»ºçš„modelå•ä¾‹æ¥èŽ·å–modelã€‚ 2.å˜æ›´ViewMVCä¸­ï¼ŒControlleréœ€è¦è§‚å¯Ÿmodelï¼Œåœ¨æ”¶åˆ°modelå˜æ›´çš„é€šçŸ¥æ—¶åŽ»å˜æ›´Viewã€‚å½“ä¸€ä¸ªæ›´æ”¹modelçš„View actionå‘ç”Ÿæ—¶ï¼Œä¸ºäº†ä¿è¯å•å‘æ•°æ®æµåŽŸåˆ™ï¼ŒControlleråº”é¿å…åŽ»ç›´æŽ¥æ“ä½œViewå±‚çº§ï¼Œæ ‡å‡†çš„åšæ³•æ˜¯ï¼šView actionè½¬å˜ä¸ºmodelå˜æ›´ï¼Œç„¶åŽmodelå‘é€é€šçŸ¥ï¼ŒControllerè®¢é˜…modelé€šçŸ¥ï¼Œå¹¶ä¸”åœ¨å½“é€šçŸ¥åˆ°è¾¾æ—¶å†æ›´æ”¹Viewå±‚çº§ã€‚ 3.æ›´æ”¹ModelMVCä¸­ï¼ŒControllerä¸»è¦é€šè¿‡target/actionæœºåˆ¶å’Œdelegateæ¥æŽ¥æ”¶viewäº‹ä»¶ã€‚ControllerçŸ¥é“è‡ªå·±æ‰€è¿žæŽ¥çš„viewï¼Œè€Œviewåœ¨ç¼–è¯‘æœŸé—´å¹¶ä¸çŸ¥é“ControlleræŽ¥å£çš„ä¿¡æ¯ã€‚å½“ä¸€ä¸ªViewäº‹ä»¶åˆ°è¾¾æ—¶ï¼ŒControlleræœ‰èƒ½åŠ›æ”¹å˜è‡ªèº«çš„å†…éƒ¨çŠ¶æ€ï¼Œæ›´æ”¹modelï¼Œæˆ–è€…ç›´æŽ¥æ”¹å˜Viewå±‚çº§ã€‚ 4.View StateMVCä¸­View Stateå¯ä»¥æŒ‰éœ€è¦è¢«å‚¨å­˜åœ¨Viewæˆ–è€…Controllerçš„å±žæ€§ä¸­ï¼ŒMVCä¸­é‚£äº›åªå½±å“Viewæˆ–ControllerçŠ¶æ€çš„actioné€šå¸¸ä¹Ÿä¸éœ€è¦é€šè¿‡modelè¿›è¡Œä¼ é€’ï¼Œè€Œé¡µé¢å±‚çº§æˆ–å¯¼èˆªçŠ¶æ€ä¹Ÿç”±Controllerè¿›è¡Œç»´æŠ¤ã€‚ 5.æµ‹è¯•MVCä¸­View Controllerä¸Žappçš„å…¶ä»–éƒ¨ä»¶ç´§å¯†ç›¸è¿žï¼Œè¿™å¯¼è‡´å±‚çº§é—´ç¼ºä¹æ¸…æ™°çš„è¾¹ç•Œï¼Œå•å…ƒæµ‹è¯•å’ŒæŽ¥å£æµ‹è¯•éƒ½ååˆ†å›°éš¾ï¼Œé›†æˆæµ‹è¯•æ˜¯MVCæœ€å¯è¡Œçš„æµ‹è¯•æ‰‹æ®µã€‚ MVVM+CMVVM+Cå°±æ˜¯MVVMåŠ Coordinator(åè°ƒå™¨)ã€‚MVVMåœ¨æ¯ä¸ªåœºæ™¯ä¸­ä½¿ç”¨View-modelæ¥æè¿°åœºæ™¯ä¸­çš„è¡¨çŽ°é€»è¾‘å’Œäº¤äº’é€»è¾‘ï¼Œä½¿ç”¨Coordinatoræ¥ç®¡ç†View controllerå±‚çº§ã€‚View-modelåœ¨ç¼–è¯‘æœŸé—´ä¸åŒ…å«å¯¹viewæˆ–è€…controllerçš„å¼•ç”¨ï¼Œå®ƒæš´éœ²å‡ºä¸€ç³»åˆ—å±žæ€§æ¥æè¿°æ¯ä¸ªviewåœ¨æ˜¾ç¤ºæ—¶åº”æœ‰çš„å€¼ã€‚å°†è¿™äº›å€¼è®¾ç½®åˆ°Viewä¸Šçš„å·¥ä½œï¼Œé€šå¸¸ç”±é¢„å…ˆå»ºç«‹çš„ç»‘å®šæ¥å®Œæˆ(å“åº”å¼ç¼–ç¨‹)ï¼Œç»‘å®šä¼šä¿è¯å½“è¿™äº›æ˜¾ç¤ºå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒæŠŠå®ƒè®¾å®šåˆ°å¯¹åº”çš„Viewä¸ŠåŽ»ã€‚Coordinator(åè°ƒå™¨)æ˜¯åœ¨åœºæ™¯é—´åˆ‡æ¢æ—¶è´Ÿè´£æä¾›é€»è¾‘çš„å¯¹è±¡ã€‚åè°ƒå™¨æŒæœ‰å¯¹modelå±‚çš„å¼•ç”¨ï¼Œå¹¶ä¸”äº†è§£View controlleræ ‘çš„ç»“æž„ã€‚MVVM-Cä¸­çš„View controlleré€šè¿‡delegateçš„æœºåˆ¶å°†Viewcontrollerçš„ä¿¡æ¯å‘Šè¯‰åè°ƒå™¨ï¼Œåè°ƒå™¨æ®æ­¤æ˜¾ç¤ºæ–°çš„Viewcontrollerå¹¶è®¾ç½®å®ƒä»¬çš„ modelæ•°æ®ã€‚MVVM+Cä¸­view controllerä¸å†æ‹¥æœ‰å†…éƒ¨çš„View stateï¼Œè¿™äº›çŠ¶æ€ä¹Ÿè¢«ç§»åŠ¨åˆ°äº†View-modelä¸­ï¼Œview controller ä»…ä»…åªæ˜¯Viewå±‚çº§çš„ä¸€éƒ¨åˆ†ã€‚ 1.æž„å»ºModelï¼šåœ¨MVVMä¸­modelçš„åˆ›å»ºå’ŒMVCä¸­ç›¸åŒï¼Œé€šå¸¸ç”±ä¸€ä¸ªé¡¶å±‚controllerè´Ÿè´£ã€‚ä¸è¿‡modelå¯¹è±¡å±žäºŽview-modelï¼Œè€Œä¸å†å±žäºŽview controllerã€‚Viewï¼šviewå±‚çº§çš„åˆ›å»ºä¹Ÿå’ŒMVCä¸­ä¸€æ ·ï¼Œé€šè¿‡storyboardæˆ–è€…ä»£ç æ¥å®Œæˆã€‚å’ŒMVCä¸åŒçš„æ˜¯ï¼Œview controllerä¸å†ç›´æŽ¥ä¸ºæ¯ä¸ªviewèŽ·å–å’Œå‡†å¤‡æ•°æ®ï¼Œè€Œæ˜¯ç”±view-modelè´Ÿè´£ã€‚View-Modelï¼šView controlleråœ¨åˆ›å»ºçš„æ—¶å€™ä¼šä¸€å¹¶åˆ›å»ºview-modelï¼Œå¹¶ä¸”å°†æ¯ä¸ªviewç»‘å®šåˆ°view-modelæ‰€æš´éœ²å‡ºçš„ç›¸åº”å±žæ€§ä¸ŠåŽ»ã€‚ 2.å˜æ›´Viewåœ¨MVVMä¸­ï¼Œå’ŒMVCä¸åŒï¼Œview controllerä¸ç›‘å¬modelã€‚View-modelå°†è´Ÿè´£è§‚å¯Ÿmodelï¼Œå¹¶å°†modelçš„é€šçŸ¥è½¬å˜ä¸ºViewcontrollerå¯ä»¥ç†è§£çš„å½¢å¼ã€‚View controllerè®¢é˜…view-modelçš„å˜æ›´(å“åº”å¼ç¼–ç¨‹)ï¼Œå½“ä¸€ä¸ªview-modeläº‹ä»¶æ¥åˆ°æ—¶ï¼Œå†ç”±ViewcontrolleråŽ»æ›´æ”¹Viewå±‚çº§ã€‚ 3.æ›´æ”¹Modelåœ¨MVVMä¸­ï¼Œview controlleræŽ¥æ”¶Viewäº‹ä»¶çš„æ–¹å¼å’ŒMVCä¸­ä¸€æ ·(target/Actionå’Œdelegate)ã€‚ä¸è¿‡ï¼Œå½“ä¸€ä¸ªViewäº‹ä»¶åˆ°è¾¾æ—¶ï¼Œview controllerä¸ä¼šåŽ»æ”¹å˜è‡ªèº«çš„å†…éƒ¨çŠ¶æ€ã€view stateã€æˆ–è€…æ˜¯modelï¼Œè€Œæ˜¯è°ƒç”¨view-modelä¸Šçš„æ–¹æ³•ï¼Œå†ç”±view-modelæ”¹å˜å†…éƒ¨çŠ¶æ€æˆ–è€…modelã€‚ 4.View Stateåœ¨MVVMä¸­ï¼ŒView stateè¦ä¹ˆå­˜åœ¨äºŽViewè‡ªèº«ä¹‹ä¸­ï¼Œè¦ä¹ˆå­˜åœ¨äºŽview-modelé‡Œã€‚å’ŒMVCä¸åŒï¼Œview controllerä¸­ä¸å­˜åœ¨ä»»ä½•View stateã€‚View-modelä¸­çš„View stateçš„å˜æ›´ï¼Œä¼šè¢«controllerè§‚å¯Ÿåˆ°ï¼Œä¸è¿‡controlleræ— æ³•åŒºåˆ†modelçš„é€šçŸ¥å’ŒView stateå˜æ›´çš„é€šçŸ¥ã€‚åœ¨MVVM+Cä¸­ï¼ŒViewcontrollerå±‚çº§å°†ç”±åè°ƒå™¨è¿›è¡Œç®¡ç†ã€‚ 5.æµ‹è¯•åœ¨MVVMä¸­ï¼Œå› ä¸ºview-modelçš„å¼•å…¥ï¼ŒViewå±‚ä¸Žcontrollerå±‚æ˜¯è§£è€¦åˆçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æŽ¥å£æµ‹è¯•æ¥æµ‹è¯•view-modelï¼Œè€Œä¸éœ€è¦åƒMVCé‡Œé‚£æ ·ä½¿ç”¨é›†æˆæµ‹è¯•ï¼ŒæŽ¥å£æµ‹è¯•è¦æ¯”é›†æˆæµ‹è¯•ç®€å•å¾—å¤šã€‚ MVC+VSMVC+VSæ˜¯ä¸ºæ ‡å‡†çš„MVCå¸¦æ¥å•å‘æ•°æ®æµæ–¹å¼çš„ä¸€ç§å°è¯•ï¼Œé€šè¿‡MVC+VSèƒ½åŠ æ·±ç¼–ç¨‹äººå‘˜å¯¹view stateå’Œå•å‘æ•°æ®æµçš„ç†è§£ã€‚åœ¨MVC+VSä¸­ï¼Œæˆ‘ä»¬æ˜Žç¡®åœ°åœ¨ä¸€ä¸ªæ–°çš„modelå¯¹è±¡ä¸­ï¼Œå¯¹æ‰€æœ‰çš„view stateè¿›è¡Œå®šä¹‰å’Œè¡¨è¾¾ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡å«åšview state modelã€‚æˆ‘ä»¬ä¸ä»Ž view ä¸­åŽ»è¯»å–view stateï¼Œè€Œæ˜¯ä»Žview state modelä¸­åŽ»èŽ·å–å®ƒä»¬ã€‚MVC+VSä¹Ÿå…·æœ‰ç‹¬åˆ°çš„ä¼˜ç‚¹ï¼Œä¾‹å¦‚ï¼šä»»æ„çš„çŠ¶æ€æ¢å¤ï¼Œå®Œæ•´çš„ç”¨æˆ·ç•Œé¢æ—¥å¿—ï¼Œä»¥åŠæžä¸ºå¼ºå¤§çš„è°ƒè¯•èƒ½åŠ›(é€šè¿‡è®¾ç½®ä¸åŒçš„view state)ã€‚ 1.æž„å»ºåœ¨MVC+VSä¸­å’ŒMVCä¸€æ ·ï¼Œmodelå’Œviewçš„æž„å»ºå·¥ä½œä¾ç„¶ç”±view controllerè´Ÿè´£ï¼Œä½†MVC+VSä¸­view controllerè¿˜éœ€è¦ä½¿ç”¨å’Œè®¢é˜…view stateã€‚ 2.å˜æ›´Viewåœ¨MVC+VSä¸­ControlleråŒæ—¶å¯¹æ–‡æ¡£modelå’Œview state modelè¿›è¡Œè§‚å¯Ÿï¼Œå¹¶ä¸”åªåœ¨å˜æ›´å‘ç”Ÿçš„æ—¶å€™æ›´æ–°viewå±‚çº§(å•å‘æ•°æ®æµåŽŸåˆ™)ã€‚ 3.æ›´æ”¹Modelå½“view actionå‘ç”Ÿæ—¶ï¼Œview controlleråŽ»å˜æ›´æ–‡æ¡£model(è¿™å’ŒMVCç›¸åŒ)æˆ–è€…å˜æ›´model stateã€‚MVC+VSä¸­ä¸ä¼šåŽ»ç›´æŽ¥æ”¹å˜viewå±‚çº§ï¼Œæ‰€æœ‰çš„viewå˜æ›´éƒ½è¦é€šè¿‡æ–‡æ¡£modelå’Œview state modelçš„é€šçŸ¥æ¥è¿›è¡Œã€‚ 4.View StateView Stateè¢«æ˜Žç¡®åœ°ä»Žview controllerä¸­æå–å‡ºæ¥,ç”±view state modelç»´æŠ¤ï¼Œå¤„ç†çš„æ–¹æ³•å’Œmodelä¸€æ ·ï¼šcontrollerè§‚å¯Ÿview state modelï¼Œå¹¶ä¸”å¯¹åº”åœ°æ›´æ”¹viewå±‚çº§ã€‚ 5.æµ‹è¯•åœ¨MVC+VSä¸­ï¼Œä½¿ç”¨å’ŒMVCé‡Œç±»ä¼¼çš„é›†æˆæµ‹è¯•ï¼Œä½†æ˜¯æµ‹è¯•æœ¬èº«ä¼šéžå¸¸ä¸åŒï¼šæ‰€æœ‰çš„æµ‹è¯•éƒ½ä»Žä¸€ä¸ªç©ºçš„æ ¹view controllerå¼€å§‹ï¼Œç„¶åŽé€šè¿‡è®¾å®šæ–‡æ¡£modelå’Œview state modelï¼Œè¿™ä¸ªæ ¹view controllerå¯ä»¥æž„å»ºå‡ºæ•´ä¸ªviewå±‚çº§å’Œview controllerå±‚çº§ã€‚ä¸€æ—¦viewå±‚çº§è¢«æž„å»ºï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸¤ç§æµ‹è¯•ã€‚ç¬¬ä¸€ç§æµ‹è¯•è´Ÿè´£æ£€æŸ¥viewå±‚çº§æ˜¯ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬çš„æœŸæœ›è¢«å»ºç«‹èµ·æ¥ï¼Œç¬¬äºŒç§æµ‹è¯•æ£€æŸ¥view actionæœ‰æ²¡æœ‰æ­£ç¡®åœ°æ”¹å˜view stateã€‚]]></content>
      <categories>
        <category>APPæž¶æž„</category>
      </categories>
      <tags>
        <tag>MVC</tag>
        <tag>MVVM</tag>
        <tag>MVC-VS</tag>
        <tag>MVCS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ã€APPæž¶æž„æ¦‚è®º]]></title>
    <url>%2F2018%2F12%2F08%2FAPP%E6%9E%B6%E6%9E%84%2F%E4%B8%80%E3%80%81APP%E6%9E%B6%E6%9E%84%E6%A6%82%E8%AE%BA%2F</url>
    <content type="text"><![CDATA[Reference:App Architecture 1. è½¯ä»¶æž¶æž„å’ŒAPPè®¾è®¡æ¨¡å¼è½¯ä»¶æž¶æž„æ˜¯è½¯ä»¶è®¾è®¡ä¸­çš„åˆ†æ”¯ï¼Œå®ƒå…³æ³¨ä¸¤ä¸ªæ–¹é¢ï¼š å¦‚ä½•å°†è½¯ä»¶åˆ†è§£æˆä¸åŒçš„æŽ¥å£å’Œæ¦‚å¿µå±‚æ¬¡éƒ¨ä»¶ï¼› è¿™äº›éƒ¨ä»¶è‡ªèº«å’Œéƒ¨ä»¶ä¹‹é—´çš„ä¸åŒæ“ä½œä¸­æ‰€ä½¿ç”¨çš„æŽ§åˆ¶æµå’Œæ•°æ®æµè·¯å¾„ã€‚ ä¸€ä¸ªå¥½çš„APPæž¶æž„ä¾èµ–äºŽä¸€å¥—æœ‰åŠ›çš„è®¾è®¡è§„åˆ™æ¥å®šä¹‰éƒ¨ä»¶çš„åˆ’åˆ†ä»¥åŠéƒ¨ä»¶ä¹‹é—´çš„ç›¸äº’åä½œæ–¹å¼ï¼Œåœ¨æž¶æž„ä¸­ä¸€å¥—è¢«é‡å¤ä½¿ç”¨çš„è®¾è®¡è§„åˆ™ç§°ä¸ºè®¾è®¡æ¨¡å¼ã€‚ appçš„è®¾è®¡æ¨¡å¼åŸºæœ¬å°±æ˜¯ä¸€å¥—åˆ†å±‚è§„åˆ™ï¼Œappä¸­ä¸åŒçš„éƒ¨ä»¶ä¼šè¢«å½’çº³åˆ°æŸä¸ªç±»åž‹ä¸­åŽ»ï¼Œå°†è¿™äº›ä¸åŒçš„ç§ç±»å«åšå±‚æ¬¡ï¼šä¸€ä¸ªå±‚æ¬¡æŒ‡çš„æ˜¯ï¼Œéµå¾ªä¸€äº›åŸºæœ¬è§„åˆ™å¹¶è´Ÿè´£ç‰¹å®šåŠŸèƒ½çš„æŽ¥å£å’Œå…¶ä»–ä»£ç çš„é›†åˆã€‚ 2. Modelå’ŒViewModelå’ŒViewæ˜¯APPæž¶æž„ä¸­æœ€å¸¸è§ä¹Ÿæ˜¯æœ€åŸºç¡€çš„ä¸¤ä¸ªåˆ†å±‚ã€‚ Modelï¼šModelå±‚æ˜¯APPçš„å†…å®¹ï¼Œå®ƒä¸ä¾èµ–äºŽä»»ä½•APPæ¡†æž¶ï¼Œç¨‹åºå‘˜å¯¹Modelå±‚æœ‰å®Œå…¨çš„æŽ§åˆ¶ã€‚å®ƒé€šå¸¸åŒ…æ‹¬modelå¯¹è±¡å’Œåè°ƒå¯¹è±¡ã€‚ Viewï¼šViewå±‚å‡ ä¹Žæ˜¯å®Œå…¨ä¾èµ–äºŽAPPæ¡†æž¶çš„éƒ¨åˆ†ï¼Œå®ƒä½¿Modelå±‚å¯è§ï¼Œå¹¶å…è®¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œä»Žè€Œå°†Modelå±‚è½¬å˜ä¸ºä¸€ä¸ªAPPã€‚ åœ¨APPä¸­ï¼ŒViewå¯¹è±¡é€šå¸¸ä¼šæž„æˆä¸€ä¸ªå•ä¸€çš„viewå±‚çº§ï¼Œview controllerä¹Ÿé€šå¸¸ä¼šå½¢æˆ view controllerå±‚çº§ã€‚modelå¯¹è±¡å´ä¸éœ€è¦æœ‰æ˜Žç¡®çš„å±‚çº§å…³ç³»ï¼Œåœ¨ç¨‹åºä¸­å®ƒä»¬å¯ä»¥æ˜¯äº’ä¸å…³è”çš„ç‹¬ç«‹ modelã€‚ modelå±‚çš„æœ€é‡è¦çš„æ„ä¹‰åœ¨äºŽï¼šå®ƒä¸ºæˆ‘ä»¬çš„ç¨‹åºæä¾›ä¸€ä¸ªè¡¨è¿°äº‹å®žçš„å•ä¸€æ¥æºï¼Œè®©ç¨‹åºçš„è¡Œä¸ºæœ‰æ¸…æ™°çš„è§„åˆ™å¯ä»¥ä¾æ®ï¼Œè¿™ä¼šè®©ç¼–ç¨‹é€»è¾‘æ¸…æ™°ã€è¡Œä¸ºæ­£ç¡®ã€‚å¦‚æžœ model å±‚èƒ½åšåˆ°å’Œåº”ç”¨æ¡†æž¶åˆ†ç¦»ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œå…¨åœ¨ app çš„èŒƒå›´ä¹‹å¤–ä½¿ç”¨å®ƒã€‚ 3. åé¦ˆå›žè·¯ç”¨æˆ·ç•Œé¢æ˜¯ä¸€ä¸ªåŒæ—¶è´Ÿè´£å±•ç¤ºå’Œè¾“å…¥åŠŸèƒ½çš„åé¦ˆè®¾å¤‡ï¼ŒAPPçš„é€»è¾‘å°±æ˜¯ä¸€ä¸ªåé¦ˆå›žè·¯ã€‚ç”¨æˆ·å‘èµ·çš„äº‹ä»¶ä¼šå¯¼è‡´viewçš„å“åº”ï¼Œæˆ‘ä»¬æŠŠç”±æ­¤å¼•èµ·çš„ä»£ç è·¯å¾„ç§°ä¸ºview actionï¼Œå½“ä¸€view actionè¢«é€åˆ°modelå±‚æ—¶ï¼Œå®ƒä¼šè¢«è½¬å˜ä¸ºmodel actionï¼Œå°†view actionè½¬å˜ä¸ºmodel actionçš„æ“ä½œ,ä»¥åŠè·¯å¾„ä¸Šçš„å…¶ä»–é€»è¾‘è¢«å«åšäº¤äº’é€»è¾‘ã€‚ä¸€ä¸ªæˆ–è€…å¤šä¸ªmodelå¯¹è±¡ä¸ŠçŠ¶æ€çš„æ”¹å˜å«åšmodelå˜æ›´ã€‚Modelçš„å˜æ›´é€šå¸¸ä¼šè§¦å‘ä¸€ä¸ªmodelé€šçŸ¥ï¼Œå½“viewä¾èµ–äºŽmodelæ•°æ®æ—¶ï¼Œé€šçŸ¥ä¼šè§¦å‘ä¸€ä¸ªviewå˜æ›´ï¼Œå°†modelé€šçŸ¥å’Œæ•°æ®è½¬å˜ä¸ºview æ›´æ”¹çš„æ“ä½œï¼Œä»¥åŠè·¯å¾„ä¸Šçš„å…¶ä»–é€»è¾‘è¢«å«åšè¡¨çŽ°é€»è¾‘ã€‚ 4. å•å‘æ•°æ®æµæœ‰äº›çŠ¶æ€å¯èƒ½æ˜¯åœ¨æ–‡æ¡£modelä¹‹å¤–è¿›è¡Œç»´æŠ¤çš„ï¼Œä¾‹å¦‚å¯¼èˆªçŠ¶æ€ã€‚åœ¨appä¸­éžæ–‡æ¡£modelçš„çŠ¶æ€è¢«å«åšview stateã€‚åœ¨Cocoaé‡Œï¼Œå¤§éƒ¨åˆ†viewå¯¹è±¡éƒ½ç®¡ç†ç€å®ƒä»¬è‡ªå·±çš„view stateï¼Œcontrollerå¯¹è±¡åˆ™ç®¡ç†å‰©ä½™çš„view stateã€‚å½“æ‰€æœ‰çš„çŠ¶æ€éƒ½åœ¨modelå±‚ä¸­è¢«ç»´æŠ¤ï¼Œè€Œä¸”æ‰€æœ‰çš„å˜æ›´éƒ½é€šè¿‡å®Œæ•´çš„åé¦ˆå›žè·¯è·¯å¾„è¿›è¡Œä¼ é€’æ—¶ï¼Œæˆ‘ä»¬å°±å°†å®ƒç§°ä¸ºå•å‘æ•°æ®æµã€‚å³ï¼šä»»æ„çš„viewå¯¹è±¡æˆ–è€…ä¸­é—´å±‚å¯¹è±¡åªèƒ½å¤Ÿé€šè¿‡ modelå‘å‡ºçš„é€šçŸ¥æ¥è¿›è¡Œåˆ›å»ºå’Œæ›´æ–°(æ¢å¥è¯è¯´viewæˆ–è€…ä¸­é—´å±‚ä¸èƒ½é€šè¿‡æ·å¾„æ¥æ›´æ–°è‡ªèº«æˆ–è€…å…¶ä»–çš„view)æ—¶ï¼Œè¿™ä¸ªæ¨¡å¼é€šå¸¸å°±æ˜¯å•å‘çš„ã€‚åœ¨éµå¾ªå•å‘æ•°æ®æµçš„æ¨¡å¼ä¸­ï¼Œå°±å®žçŽ°äº†modelä¸Žåº”ç”¨æ¡†æž¶çš„è§£è€¦ã€‚ 5. APPçš„ä»»åŠ¡ä¸€ä¸ªç¨‹åºçš„æ­£å¸¸å·¥ä½œæ–¹å¼ä¸ºï¼šviewå¿…é¡»ä¾èµ–äºŽmodelæ•°æ®æ¥ç”Ÿæˆå’Œå­˜åœ¨ï¼Œæˆ‘ä»¬é…ç½®viewï¼Œè®©å®ƒå¯ä»¥å¯¹modelè¿›è¡Œæ›´æ”¹ï¼Œå¹¶ä¸”èƒ½åœ¨modelå¾—åˆ°æ›´æ–°æ—¶ä¹Ÿå¾—åˆ°æ›´æ–°ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†³å®šAPPä¸­å¦‚ä½•æ‰§è¡Œä¸‹åˆ—ä»»åŠ¡ï¼š æž„å»ºï¼šè°æž„å»ºmodelå’Œviewï¼Œä»¥åŠå°†ä¸¤è€…è¿žæŽ¥èµ·æ¥ï¼Ÿ å˜æ›´viewï¼šå¦‚ä½•å°†modelæ•°æ®çš„å˜åŒ–åº”ç”¨åˆ°viewä¸ŠåŽ»ï¼Ÿ æ›´æ–°modelï¼šå¦‚ä½•å¤„ç†view actionï¼Ÿ å¤„ç†view stateï¼šå¦‚ä½•å¤„ç†å¯¼èˆªåŠå…¶ä»–model stateä»¥å¤–çš„çŠ¶æ€ï¼Ÿ æµ‹è¯•ï¼šä¸ºè¾¾åˆ°ä¸€å®šç¨‹åº¦çš„æµ‹è¯•è¦†ç›–ï¼Œé‡‡å–æ€Žæ ·çš„æµ‹è¯•ç­–ç•¥ï¼Ÿ æˆ‘ä»¬ç ”ç©¶APPè®¾è®¡æ¨¡å¼ï¼Œå°±æ˜¯ç ”ç©¶ä¸€ä¸ªè®¾è®¡æ¨¡å¼å¦‚ä½•å¤„ç†ä»¥ä¸Šäº”ä¸ªAPPä»»åŠ¡ã€‚]]></content>
      <categories>
        <category>APPæž¶æž„</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[iOSå¼€å‘ä¸­å¥½ç”¨çš„ä¸‰æ–¹è½®å­]]></title>
    <url>%2F2018%2F09%2F06%2F%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C%2FiOS%E4%B8%89%E6%96%B9%E8%BD%AE%E5%AD%90%E5%88%86%E7%B1%BB-OC%2F</url>
    <content type="text"><![CDATA[æ”¶å½•çš„åº“ä»¥Objective Cä¸ºä¸»ï¼ŒSwiftä¸‰æ–¹åº“å‚è§[]ï¼› ä»¥âš ï¸æ ‡è®°è¡¨ç¤ºä½œè€…å·²å¤šå¹´(3å¹´åŠä»¥ä¸Š)æœªæ›´æ–°ï¼›* ä»¥ðŸš«æ ‡è®°è¡¨ç¤ºä½œè€…å·²å£°æ˜Žä¸å†ç»´æŠ¤å‡çº§ã€‚ 1.ç”¨æˆ·ç•Œé¢å±‚(User Interface)è§†å›¾æŽ§ä»¶å¯¹äºŽæ›´æ–°ä¸å¤Ÿé¢‘ç¹æˆ–è‡ªå®šä¹‰æŽ¥å£ä¸å¤Ÿä¸°å¯Œçš„è§†å›¾æŽ§ä»¶ï¼Œæœ€å¥½ç›´æŽ¥ä½¿ç”¨å…¶æºç ï¼Œè€Œä¸æ˜¯é€šè¿‡Cocoapodså¯¼å…¥ MJRefreshï¼šä¸‹æ‹‰åˆ·æ–°ï¼Œä¸Šæ‹‰åŠ è½½ MBProgressHUDï¼šå¥½ç”¨æ˜“æ‰©å±•çš„æ´»åŠ¨æŒ‡ç¤ºå™¨ SVProgressHUDï¼šè½»é‡çº§çš„æ´»åŠ¨æŒ‡ç¤ºå™¨ TWMessageBarManagerï¼šè½»é‡çš„é€šçŸ¥å’Œè­¦å‘Šæç¤ºåº“âš ï¸ TSMessagesï¼šè½»é‡çš„é€šçŸ¥å’Œè­¦å‘Šæç¤ºåº“ JDStatusBarNotificationï¼šé¡¶éƒ¨çŠ¶æ€æ æé†’ UIActivityIndicator-for-SDWebImageï¼šä¸ºç½‘ç»œå›¾ç‰‡åŠ è½½æ·»åŠ æ´»åŠ¨æŒ‡ç¤º PYSearchï¼šä¸€ç§ä½¿ç”¨æ ·å¼è¾ƒå¹¿çš„æœç´¢é¡µé¢ YYTextï¼šå¯Œæ–‡æœ¬ DTCoreTextï¼šå¯Œæ–‡æœ¬ï¼Œå¯è§£æžHtmlå’ŒCSS TTTAttributedLabelï¼šå¯Œæ–‡æœ¬label M80AttributedLabelï¼šå¯Œæ–‡æœ¬label SDCycleScrollViewï¼šè½®æ’­å›¾ FSCalendarï¼šæ—¥åŽ†æ’ä»¶ PGDatePickerï¼šæ—¶é—´/æ—¥æœŸé€‰æ‹©å™¨ DZNEmptyDataSetï¼šæ— æ•°æ®æ—¶çš„å±•ç¤ºè§†å›¾ SGPagingViewï¼šæ ‡ç­¾æŒ‡ç¤ºå™¨ iCarouselï¼šå¡ç‰‡çš„æ—‹è½¬åˆ‡æ¢ ZJPickerViewï¼šå„åˆ—ä¼šè”åŠ¨çš„é€‰æ‹©å™¨ LMReportï¼šå¸¸è§æŠ¥è¡¨è¡¨æ ¼æ ·å¼ PPBadgeViewï¼šä¸ºå„ç§è§†å›¾æ·»åŠ badge WZLBadge:ä¸ºè§†å›¾æ·»åŠ badge WMPageControllerï¼šåˆ†é¡µè§†å›¾æŽ§åˆ¶å™¨ FlatUIKitï¼šæ‰å¹³åŒ–é£Žæ ¼çš„UIKitâš ï¸ JSQMessagesViewControllerï¼šèŠå¤©æ¶ˆæ¯ç±»æ¡†æž¶ðŸš« JVFloatLabeledTextFieldï¼šå¸¦æµ®åŠ¨æ ‡ç­¾çš„æ–‡æœ¬è¾“å…¥æ¡† SWTableViewCellï¼šæ”¯æŒå·¦æ»‘å’Œå³æ»‘çš„tableViewCellâš ï¸ MGSwipeTableCellï¼šæ”¯æŒå·¦æ»‘å’Œå³æ»‘çš„tableViewCell tapkulibraryï¼šè‡ªå®šä¹‰æŽ§ä»¶åº“ï¼ŒåŒ…æ‹¬HUDã€è¿›åº¦æ¡ã€æ—¥åŽ†ã€CoverFlowç­‰ MWPhotoBrowserï¼šç®€å•çš„ç…§ç‰‡æµè§ˆæŽ§ä»¶âš ï¸ ZZCircleProgressï¼šå¯å®šåˆ¶çš„çŽ¯å½¢è¿›åº¦æ¡ BFNavigationBarDrawerï¼šNavigationBarä¸‹çš„toolèœå• SXFiveScoreShowï¼šäº”é¡¹ç´ è´¨è¯„åˆ†æ‰€ç»„æˆçš„äº”è§’æ˜Ÿ UUChatTableViewï¼šIMèŠå¤©ç•Œé¢çš„å°è£… HyPopMenuViewï¼šç±»ä¼¼å¾®åšæ•ˆæžœçš„å¼¹å‡ºèœå• DXPopoverï¼šå¸¦å°ç®­å¤´çš„å¼¹å‡ºè§†å›¾ DOPDropDownMenuï¼šä¸‹æ‹‰èœå• ActionSheetPicker-3.0ï¼šåº•éƒ¨å¼¹çª—é€‰æ‹©å™¨ MultilevelMenuï¼šå¤šçº§é€‰æ‹©å™¨ï¼ŒSwiftå®žçŽ° å±‚çº§ç®¡ç† CWLateralSlideï¼šä¾§è¾¹æŠ½å±‰æ•ˆæžœçš„è§†å›¾å®¹å™¨ ViewDeckï¼šä¾§è¾¹æŠ½å±‰æ•ˆæžœçš„è§†å›¾å®¹å™¨ ECSlidingViewControllerï¼šåŒå±‚å­è§†å›¾å®¹å™¨å®žçŽ°ä¾§æ»‘æ•ˆæžœ MMDrawerControllerï¼šè½»é‡çš„ä¾§è¾¹æŠ½å±‰æ•ˆæžœçš„è§†å›¾å®¹å™¨âš ï¸ RDVTabBarControllerï¼šä¸‰æ–¹å°è£…çš„tabBarController é¡µé¢å¸ƒå±€ Masonryï¼šAutolayoutä»£ç å¸ƒå±€åº“ PureLayoutï¼šAutolayoutä»£ç å¸ƒå±€åº“ UITableView+FDTemplateLayoutCellï¼štableVeiwCellé«˜åº¦çš„è‡ªåŠ¨å¸ƒå±€ åŠ¨ç”»ç‰¹æ•ˆ GPUImageï¼šå›¾ç‰‡æ·»åŠ æ»¤é•œâš ï¸ Shimmerï¼šä¸ºè§†å›¾æ·»åŠ æµå…‰æ•ˆæžœ FXBlurViewï¼šæ·»åŠ æ¯›çŽ»ç’ƒæ•ˆæžœðŸš« NYXImagesKitï¼šå¸¸è§„çš„å›¾ç‰‡å¤„ç† AwesomeMenuï¼šå¼¹å°„åŠ¨ç”»å±•å¼€çš„èœå• Canvasï¼šæ— éœ€ç¼–ç å°±èƒ½æ·»åŠ åŠ¨ç”»æ•ˆæžœçš„åº“âš ï¸ JazzHandsï¼šåœ¨scrollviewä¸­ç»˜åˆ¶å…³é”®å¸§åŠ¨ç”»âš ï¸ popï¼špopåŠ¨ç”»å¼•æ“Ž poppingï¼šåŸºäºŽpopå¼•æ“Žçš„åŠ¨ç”»åº“ pop-handappï¼šåŸºäºŽpopå¼•æ“Žçš„åŠ¨ç”»å®žä¾‹ VCTransitionsLibraryï¼šè½¬åœºåŠ¨ç”»åº“âš ï¸ UIå±‚ä¼˜åŒ– FDFullscreenPopGestureï¼šç®€åŒ–è¿”å›žæ‰‹åŠ¿çš„ç®¡ç† KMNavigationBarTransitionï¼šä¼˜åŒ–è½¬åœºæ—¶çš„å¯¼èˆªæ æ ·å¼ ZYCornerRadiusï¼šé¿å…ç¦»å±æ¸²æŸ“çš„åœ†è§’è®¾ç½® FastImageCacheï¼šæœ¬åœ°å›¾ç‰‡çš„å¿«é€ŸåŠ è½½ä¸Žæ¸²æŸ“ Textureï¼šé€šè¿‡å¼‚æ­¥ç»˜åˆ¶æ¥æå‡æ€§èƒ½çš„UIæ¡†æž¶ nuiï¼šç”¨ç±»CSSçš„è¯­æ³•æ¥ç®€åŒ–UIæ ·å¼çš„è®¾ç½®âš ï¸ LEEThemeï¼šç®€åŒ–APPä¸»é¢˜çš„ç®¡ç† 2.ä¸šåŠ¡é€»è¾‘å±‚(Bussiness Logic)APPä»»åŠ¡ IQKeyboardManagerï¼šé”®ç›˜äº‹åŠ¡ç®¡ç† AYCheckVersionï¼šæ›´æ–°æ£€æŸ¥ iVersionï¼šæ›´æ–°æ£€æŸ¥ðŸš« Appiraterï¼šåŽ»AppStoreè¯„åˆ† CocoaLumberjackï¼šAppçš„æ—¥å¿—ç®¡ç†åº“ NSLoggerï¼šå¸¦macå®¢æˆ·ç«¯çš„æ—¥å¿—åˆ†æžå·¥å…· åŠŸèƒ½ç»„ä»¶ TZImagePickerControllerï¼šå›¾ç‰‡é€‰æ‹©å™¨ ZFPlayerï¼šè§†é¢‘æ’­æ”¾å™¨åŠæŽ§åˆ¶å™¨ PNChartï¼šå›¾è¡¨ç»˜åˆ¶åº“(OC) Chartsï¼šå›¾æ ‡ç»˜åˆ¶åº“(Swift) WebViewJavascriptBridgeï¼šOCå’ŒJSçš„äº¤äº’åº“ AGEmojiKeyboardï¼šemojiè¡¨æƒ…è¾“å…¥é¢æ¿ ZFSettingï¼šå¿«æ·æž„å»ºè®¾ç½®ç•Œé¢ TOCropViewControllerï¼šå›¾ç‰‡è£å‰ª EZAudioï¼šéŸ³é¢‘æ³¢å½¢å›¾ç»˜åˆ¶âš ï¸ ä¾¿æ·å·¥å…· ReactiveObjCï¼šå‡½æ•°å“åº”å¼ç¼–ç¨‹æ¡†æž¶ KVOControllerï¼šæ–¹ä¾¿å®‰å…¨çš„KVOå·¥å…· PromiseKitï¼šPromiseè®¾è®¡æ¨¡å¼å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„åº“ JKCategoriesï¼šç³»ç»Ÿåº“çš„ç±»æ‰©å±• Coloursï¼šé¢œè‰²åº“æ‰©å±• FormatterKitï¼šä¸ºå¾ˆå¤šæ•°æ®ç±»åž‹æä¾›äº†æ ¼å¼åŒ–çš„è½¬æ¢ nimbusï¼šå¼€æºçš„iOSå¼€å‘æ¡†æž¶ BlocksKitï¼šä¸ºä¸€äº›å¸¸ç”¨çš„ç³»ç»ŸæŽ¥å£æä¾›blockç‰ˆæœ¬ Bolts-ObjCï¼šGCDã€NSOperationä¹‹å¤–çš„å¤šä»»åŠ¡ç®¡ç†åº“ RegexKitLiteï¼šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å¤„ç†å­—ç¬¦ä¸²âš ï¸ Objective-C-RegEx-Categoriesï¼šæä¾›ä¾¿æ·çš„æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨æŽ¥å£âš ï¸ 3.æ•°æ®è®¿é—®å±‚(Data Access)ç½‘ç»œä¼ è¾“ AFNetworkingï¼šç½‘ç»œè¯·æ±‚åº“ XMNetworkingï¼šåŸºäºŽAFçš„å°è£…ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œé€‚åˆä¸­å°åž‹é¡¹ç›® YTKNetworkï¼šåŸºäºŽAFçš„å°è£…ï¼ŒåŠŸèƒ½å®Œå¤‡ï¼Œé€‚åˆå¤æ‚ç½‘ç»œè¯·æ±‚é¡¹ç›® MKNetworkKitï¼šè½»é‡çš„ç½‘ç»œè¯·æ±‚åº“ Reachabilityï¼šåˆ¤æ–­ç½‘ç»œå¯è¾¾æ€§ RestKitï¼šä¸“æ³¨äºŽRESTful APIçš„ç½‘ç»œè¯·æ±‚ã€JSONè§£æžã€CoreDataå­˜å‚¨çš„æ¡†æž¶ SDWebImageï¼šæ ¹æ®ç½‘ç»œè¿žæŽ¥èŽ·å–å›¾ç‰‡ SocketRocketï¼šfacebookå®¶çš„è½»é‡çº§socketè¿žæŽ¥åº“âš ï¸ CocoaAsyncSocketï¼šå¼‚æ­¥socketé€šè®¯ SocketRocketï¼šwebSocketå®¢æˆ·ç«¯ XMPPFrameworkï¼šXMPPé€šä¿¡æ¡†æž¶ è½¬æ¢å¤„ç† GZIPï¼šæ•°æ®åŽ‹ç¼©ä¸Žè§£åŽ‹ MJExtensionï¼šJSONå­—å…¸å’Œæ¨¡åž‹ç›¸äº’è½¬æ¢ Mantleï¼šJSONå­—å…¸å’Œæ¨¡åž‹çš„è½¬æ¢ json frameworkï¼šJSONæ•°æ®è§£æž JSONModelï¼šJSONå­—å…¸å’Œæ¨¡åž‹çš„è½¬æ¢ hppleï¼šXML/HTMLè§£æž æœ¬åœ°æŒä¹…åŒ– YYCacheï¼šNSCodingå½’æ¡£ç¼“å­˜ Realmï¼šç§»åŠ¨ç«¯æœ¬åœ°æ•°æ®åº“ MagicalRecordï¼šå¯¹CoreDataçš„å°è£… FMDBï¼šå¯¹SQLiteæ•°æ®åº“çš„å°è£… KeychainItemWrapperï¼škeychainé’¥åŒ™ä¸²ç®¡ç†âš ï¸ SAMKeychainï¼škeychainé’¥åŒ™ä¸²ç®¡ç† GVUserDefaultsï¼šå¯¹NSUserDefaultsçš„æ–¹ä¾¿å­˜å– 4.æµ‹è¯•è°ƒè¯•(Test &amp; Debug)è°ƒè¯•ç±»ä¸‰æ–¹åº“åœ¨Cocoapodså¯¼å…¥æ—¶éœ€è®¾ç½®å…¶ç¼–è¯‘çŽ¯å¢ƒä»…åŒ…å«Debugï¼Œå³éœ€è¦åœ¨ä¸‰æ–¹åº“çš„å¼•å…¥åŽé¢åŠ ä¸Š:configurations =&gt; [&#39;Debug&#39;]ï¼›æµ‹è¯•ç±»ä¸‰æ–¹åº“è¦æ³¨æ„ä»…åŠ åˆ°æµ‹è¯•targetä¸‹ã€‚ FLEXï¼šå¼ºå¤§çš„è°ƒè¯•å·¥å…·é›† YKWoodpeckerï¼šä¼˜é…·ï¼ˆé˜¿é‡Œï¼‰å¼€æºçš„è°ƒè¯•å·¥å…·é›† MLeaksFinderï¼šVCå’ŒVCä¸Šçš„Viewçš„å†…å­˜æ³„æ¼æ£€æŸ¥å·¥å…· FBRetainCycleDetectorï¼šå¯¹è±¡çš„å¾ªçŽ¯å¼•ç”¨æ£€æŸ¥å·¥å…· JxbDebugToolï¼šç½‘ç»œè¯·æ±‚è°ƒè¯•å·¥å…·âš ï¸ NetworkEyeï¼šHttpç½‘ç»œè¯·æ±‚è°ƒè¯•å·¥å…· PonyDebuggerï¼šé€šè¿‡Chromeè°ƒè¯•ç½‘ç»œæµé‡å’Œæ•°æ®å­˜å‚¨ KIFï¼šåŸºäºŽXCTestçš„UIæµ‹è¯•æ¡†æž¶ Kiwiï¼šBDDè¡Œä¸ºé©±åŠ¨å¼€å‘æµ‹è¯•æ¡†æž¶]]></content>
      <categories>
        <category>å®žæˆ˜ç»éªŒ</category>
      </categories>
      <tags>
        <tag>ä¸‰æ–¹åº“åˆé›†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Appledoc]]></title>
    <url>%2F2018%2F09%2F06%2F%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B%2FAppledoc%2F</url>
    <content type="text"><![CDATA[å·¥å…·ç®€ä»‹Appledocæ˜¯ä¸€æ¬¾å¼€æºå·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥æ ¹æ®æŒ‡å®šè·¯å¾„ä¸‹ä»£ç æ–‡ä»¶ä¸­çš„æ³¨é‡Šï¼Œä¸ºé¡¹ç›®ç”ŸæˆAppleé£Žæ ¼çš„APIæ–‡æ¡£ã€‚ å·¥å…·æ•™ç¨‹1.å®‰è£…appledocå¯ä»¥é€šè¿‡Homebrewå®‰è£…ï¼Œç»ˆç«¯æ‰§è¡Œå‘½ä»¤brew install appledocå³å¯ï¼Œä¸è¿‡è¿™ç§æ–¹å¼ä¸ä¼šä¸€å¹¶å®‰è£…æ–‡æ¡£æ¨¡æ¿ï¼ˆtemplateï¼‰ï¼Œæ‰€ä»¥æ›´æŽ¨èé€šè¿‡appledocé¡¹ç›®çš„æºæ–‡ä»¶æ¥å®‰è£…ï¼š 12345678# 1. clone appledocæ–‡ä»¶git clone git://github.com/tomaz/appledoc.git# 2. è¿›å…¥appledocç›®å½•cd ./appledoc# 3. è¿è¡Œappledocå®‰è£…è„šæœ¬sudo sh install-appledoc.sh 2.ä½¿ç”¨ä»£ç æ³¨é‡Šappledocæ”¯æŒå¯¼å‡ºMarkdownè¯­æ³•ä¹¦å†™çš„æ³¨é‡Šï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¯¼å‡ºXcodeé€šè¿‡Command + Option + /ä¸ºæ–¹æ³•æ·»åŠ çš„æ ‡å‡†æ³¨é‡Šï¼Œé™„Xcodeæ ‡å‡†æ³¨é‡Šçš„å…³é”®å­—ï¼š 12345678910/** @brief æ–¹æ³•ç®€è¦æè¿° @param æ–¹æ³•å‚æ•°è¯´æ˜Ž @exception æ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ @see å‚çœ‹ç›¸å…³çš„ Method/Function/æžšä¸¾ @discussion æ–¹æ³•è¯¦ç»†è¯´æ˜Ž @warning è­¦å‘Š @bug BUG @return è¿”å›žå€¼ */ å¯¼å‡ºæ–‡æ¡£appledocçš„å‘½ä»¤æ ¼å¼ä¸ºappledoc [OPTIONS] &lt;paths to source dirs or files&gt;ï¼Œå¸¸ç”¨çš„appledocå‘½ä»¤å¦‚ä¸‹ï¼š 1appledoc -i *.m --keep-undocumented-objects --keep-undocumented-members -h --no-publish-docset --no-create-docset --no-install-docset -c "å…¬å¸åç§°" -p "é¡¹ç›®åç§°" -o "è¾“å‡ºåœ°å€" "æºæ–‡ä»¶ç›®å½•" å‘½ä»¤çš„æœ€åŽæ˜¯éœ€è¦å¯¼å‡ºæ–‡æ¡£çš„æºæ–‡ä»¶ç›®å½•ï¼Œä¸­é—´æ˜¯å‘½ä»¤å‚æ•°ï¼Œappledocæ‰€æ”¯æŒçš„æ›´å¤šå‘½ä»¤å‚æ•°å¯é€šè¿‡appledoc --helpè¿›è¡ŒæŸ¥çœ‹ã€‚ å‘½ä»¤æˆåŠŸæ‰§è¡ŒåŽé€šå¸¸æ˜¯åœ¨æŒ‡å®šçš„è¾“å‡ºåœ°å€ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸ºdocset-installed.txtçš„æ–‡ä»¶ï¼ˆç¤ºä¾‹å‘½ä»¤æ˜¯ç›´æŽ¥åœ¨è¾“å‡ºåœ°å€ä¸­ç”Ÿæˆhtmlæ–‡æ¡£ï¼‰ï¼Œé‡Œé¢è®°å½•äº†å¯¼å‡ºçš„æ–‡æ¡£çš„åœ°å€ï¼Œå¯¼å‡ºçš„æ–‡æ¡£ä¸€èˆ¬åœ¨~/Library/Developer/Shared/Documentation/DocSets/ç›®å½•ä¸‹ï¼Œæ–‡æ¡£ä¸º.dosetæ ¼å¼ï¼Œå¯é€šè¿‡å³é”®-æ˜¾ç¤ºåŒ…å†…å®¹æŸ¥çœ‹å…¶å†…å®¹ã€‚ Aggregateå¯ä»¥é€šè¿‡ä¸ºé¡¹ç›®æ·»åŠ Aggregate Targetï¼Œå†ä¸ºAggregateæ·»åŠ Run Scriptï¼Œæœ€åŽå†ç¼–è¯‘Aggregateçš„æ–¹å¼æ¥æ–¹ä¾¿å¿«é€Ÿçš„ä¸ºé¡¹ç›®ç”ŸæˆAPIæ–‡æ¡£ã€‚ æ·»åŠ Aggregateï¼šXcodeä¸­ä¾æ¬¡File -&gt; New -&gt; Target... -&gt; Aggretgateè¿›è¡Œæ·»åŠ ï¼› æ·»åŠ Run Scriptï¼šåœ¨æ·»åŠ çš„Aggregateçš„Build Phasesä¸­æ·»åŠ Run Scriptï¼› Run Scriptç¤ºä¾‹: 12345678910111213141516171819company=&quot;ç»„ç»‡åç§°&quot;; companyID=&quot;ç»„ç»‡ID&quot;;outputPath=&quot;$&#123;PROJECT_DIR&#125;&quot;;filePath=&quot;$&#123;PROJECT_DIR&#125;&quot;appledoc \-i *.m \--keep-undocumented-objects \--keep-undocumented-members \-h \--no-publish-docset \--no-create-docset \--no-install-docset \--company-id &quot;$&#123;companyID&#125;&quot; \-c &quot;$&#123;company&#125;&quot; \-p &quot;$&#123;PROJECT_NAME&#125;&quot; \-o &quot;$&#123;outputPath&#125;&quot; \--exit-threshold 2 \&quot;$&#123;filePath&#125;&quot; 3.æ³¨æ„ä½¿ç”¨appledocçš„æ³¨æ„äº‹é¡¹ï¼š appledocä¸ä¼šå¯¼å‡º//æ³¨é‡Šçš„å†…å®¹ï¼Œéœ€è¦å¯¼å‡ºçš„å•è¡Œæ³¨é‡Šå¯ä»¥ä½¿ç”¨///ï¼› Xcode9.3ä¹‹åŽä¸å†æ”¯æŒé›†æˆè‡ªå®šä¹‰æ–‡æ¡£ï¼Œä½¿ç”¨appledocé›†æˆæ–‡æ¡£æ—¶ä¼šæŠ¥Errorï¼Œä½†ä¸å½±å“æ–‡æ¡£çš„å¯¼å‡ºï¼Œè¯¦è§Issueï¼›]]></content>
      <categories>
        <category>å·¥å…·æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>appledoc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å››ã€å†…å­˜ç®¡ç†]]></title>
    <url>%2F2018%2F07%2F14%2FiOS%E7%BC%96%E7%A8%8B%E8%BF%9B%E9%98%B6%2F%E5%9B%9B%E3%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[[TOC] Reference:Effective Objective-C 2.0ç†è§£ iOS çš„å†…å­˜ç®¡ç†å†…å­˜ç®¡ç†åŸºç¡€Objective-C ä¸­çš„å†…å­˜åˆ†é…iOSä¸­çš„blockæ˜¯å¦‚ä½•æŒæœ‰å¯¹è±¡çš„ ç¨‹åºéƒ½æ˜¯åŠ è½½åˆ°å†…å­˜ä¸­è¿è¡Œï¼Œäº†è§£APPå·¥ä½œæœºåˆ¶ï¼Œç¬¬ä¸€æ­¥å…ˆäº†è§£APPæ˜¯å¦‚ä½•ä½¿ç”¨å†…å­˜çš„ã€‚ ç®€è¿°ç¨‹åºåŠ è½½åˆ°å†…å­˜ä¸­è¿è¡Œæ—¶ï¼Œåœ¨å†…å­˜ä¸­åˆ†é™æ€æ•°æ®(åªè¯»)å’ŒåŠ¨æ€æ•°æ®(è¯»å†™)ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­åŠ¨æ€éƒ¨åˆ†ä¸­å †çš„åˆ†é…ä¸Žé‡Šæ”¾ç”±ç¨‹åºåšå†…å­˜ç®¡ç†ï¼ŒiOSä¸­ä½¿ç”¨å¼•ç”¨è®¡æ•°æœºåˆ¶é…åˆè‡ªåŠ¨é‡Šæ”¾æ± æ¥åšå†…å­˜ç®¡ç†ï¼Œåˆä½¿ç”¨ARCæ¥ç®€åŒ–å¼•ç”¨è®¡æ•°å’Œè‡ªåŠ¨é‡Šæ”¾çš„ç¼–ç¨‹ï¼š å¼•ç”¨è®¡æ•°ï¼šå¯¹äºŽå †ä¸­çš„å¯¹è±¡ï¼Œæƒ³è¦ä¿ç•™æ—¶ä½¿å…¶å¼•ç”¨è®¡æ•°+1ï¼Œæƒ³è¦é‡Šæ”¾æ—¶ä½¿å…¶å¼•ç”¨è®¡æ•°-1ï¼Œå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œç³»ç»Ÿä¼šé”€æ¯å¯¹è±¡å›žæ”¶å†…å­˜ï¼› ARCæŠ€æœ¯ï¼šä¾èµ–ç¼–è¯‘å™¨çš„é™æ€åˆ†æžï¼Œåœ¨ç¼–è¯‘æ—¶ä¸ºå¯¹è±¡æ’å…¥ä¿ç•™ã€é‡Šæ”¾ã€è‡ªåŠ¨é‡Šæ”¾ç­‰å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å¯¹å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç åšä¼˜åŒ–; è‡ªåŠ¨é‡Šæ”¾ï¼šè‡ªåŠ¨é‡Šæ”¾æ ‡è®°ä½¿å¯¹è±¡å¼•ç”¨è®¡æ•°å»¶è¿Ÿ-1ï¼Œå³è‡ªåŠ¨é‡Šæ”¾æ± é”€æ¯æ—¶ï¼Œå¯¹è±¡åœ¨æ­¤è‡ªåŠ¨é‡Šæ”¾æ± ç®¡ç†èŒƒå›´å†…è¢«æ ‡è®°äº†å‡ æ¬¡ï¼Œå°±ä¼šåšå‡ æ¬¡å¼•ç”¨è®¡æ•°-1ï¼› æ¦‚è§ˆ è¦ç‚¹ å†…å­˜ä¸­é™æ€æ•°æ®ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ ˆåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œç¼–ç¨‹ä¸­å†…å­˜ç®¡ç†æ˜¯å¯¹å †çš„åˆ†é…å’Œå›žæ”¶ï¼› iOSä¸­ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å†…å­˜ï¼Œåˆä½¿ç”¨ARCæ¥ç®€åŒ–å¼•ç”¨è®¡æ•°çš„ç¼–ç¨‹ï¼› è‡ªåŠ¨é‡Šæ”¾æ± æ»¡è¶³äº†å¯¹è±¡å½’å½“å‰è°ƒç”¨è€…æ‰€æœ‰ï¼Œä½†åˆéœ€è¦å»¶è¿Ÿé‡Šæ”¾çš„å¼•ç”¨è®¡æ•°ç®¡ç†éœ€æ±‚ï¼› ARCä¸­æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆéƒ½éœ€è¡¨æ˜Žè‡ªå·±å¯¹å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œæ™®é€šæŒ‡é’ˆé€šè¿‡æ‰€æœ‰æƒä¿®é¥°ç¬¦æŒ‡æ˜Žï¼Œå±žæ€§çš„æˆå‘˜å˜é‡åˆ™é€šè¿‡å±žæ€§ä¿®é¥°ç¬¦æŒ‡æ˜Žï¼› æŽ¨èç”¨__autoreleasingæ¥ä¿®é¥°ç»“æžœå‚çš„å½¢å‚ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ARCçš„å¼€é”€ï¼› çŽ°åœ¨çš„ARCä¸­è™½ç„¶ä¸å†éœ€è¦ä½¿ç”¨@autoreleasepool { }æ¥æ¶ˆé™¤å¤§é‡çš„å±€éƒ¨å¯¹è±¡æ‰€é€ æˆçš„å†…å­˜å³°å€¼ï¼Œä½†ä¾ç„¶å¯ä»¥ä¿ç•™è¿™ç§å†™æ³•ä»¥å…¼å®¹è¾ƒè€çš„ç‰ˆæœ¬ï¼› CoreFoundationä¸­çš„å¯¹è±¡ä¸ç”±ARCç®¡ç†ï¼Œå½“å’ŒARCç®¡ç†çš„OCå¯¹è±¡äº’ç›¸è½¬æ¢æ—¶ï¼Œéœ€è§†æƒ…å†µæŒ‡æ˜Žå¯¹è±¡æ‰€æœ‰æƒæ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼› ARCä¸­éœ€è¦æ³¨æ„å¯¹è±¡é—´ç›¸äº’å¼•ç”¨ã€performSelectorç›¸å…³æŽ¥å£å’Œå¼‚å¸¸æ•èŽ·æ—¶å¯èƒ½å‡ºçŽ°çš„å†…å­˜æ³„éœ²ï¼› blockåˆ†ä¸ºå…¨å±€blockã€æ ˆblockå’Œå †blockï¼ŒMRCä¸­éœ€è¦æŒæœ‰ä¸€ä¸ªblockæ—¶ï¼Œä½¿ç”¨å®ƒçš„copyæ€»æ˜¯æ²¡é”™ï¼ŒARCä¸­å¯ä»¥å°†blockç›´æŽ¥èµ‹å€¼ç»™å˜é‡ï¼Œå› ä¸ºARCä¼šè§†æƒ…å†µè‡ªåŠ¨copyï¼› ARCä¸­blockä¼šä¿ç•™å…¶æ•èŽ·çš„çŽ¯å¢ƒå±€éƒ¨å˜é‡å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¯èƒ½é€ æˆå¾ªçŽ¯å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æŒ‡é’ˆæ¥é¿å…å¾ªçŽ¯å¼•ç”¨ï¼Œè¿˜å¯ä»¥ç»“åˆä¸´æ—¶å¼ºå¼•ç”¨æŒ‡é’ˆæ¥é¿å…blockæ‰§è¡ŒæœŸé—´å¯¹è±¡è¢«é‡Šæ”¾ï¼› NSStringå’ŒNSMutableStringéƒ½æ˜¯æŠ½è±¡ç±»ï¼ŒiOSä¸­å­—ç¬¦ä¸²çš„å®žé™…ç±»åž‹ä¸ºNSCFStringã€NSCFConstantStringå’ŒNSTaggedPointerStringï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­çš„ç”Ÿå‘½å‘¨æœŸå’Œç®¡ç†æ–¹å¼å„ä¸ç›¸åŒï¼› å½“å‡ºçŽ°å†…å­˜é—®é¢˜æ—¶ï¼ŒXcodeè‡ªå¸¦çš„åƒµå°¸å¯¹è±¡å¯ä»¥è°ƒè¯•é‡ŽæŒ‡é’ˆé—®é¢˜ï¼ŒInstrumentsä¸­çš„Leakså¯ä»¥æ£€æŸ¥å†…å­˜æ³„éœ²é—®é¢˜ï¼Œä¸‰æ–¹æ¡†æž¶FBRetainCycleDetectorå¯ä»¥æ£€æŸ¥å¯¹è±¡çš„å¾ªçŽ¯å¼•ç”¨é—®é¢˜ï¼› è¯¦æƒ…1.å†…å­˜æ¨¡åž‹ç¨‹åºåœ¨å†…å­˜ä¸­è¿è¡Œæ—¶åˆ†é™æ€æ•°æ®å’ŒåŠ¨æ€æ•°æ®ï¼šé™æ€æ•°æ®åªè¯»ï¼Œå­˜å‚¨åœ¨ä»£ç æ®µ(.text)å’Œæ•°æ®æ®µ(.data + .bbs)ï¼Œä¸­è¿™éƒ¨åˆ†æ•°æ®å ç”¨çš„å†…å­˜åœ¨è¿è¡Œæ—¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨ç¨‹åºç»ˆæ­¢åŽè¢«æ¸…ç†ï¼›åŠ¨æ€æ•°æ®å¯è¯»å†™ï¼Œå­˜å‚¨åœ¨æ ˆ(stack)å’Œå †(heap)ä¸­ï¼Œè¿™éƒ¨åˆ†æ•°æ®å ç”¨çš„å†…å­˜ä¼šéšç€ç¨‹åºè¿è¡Œè€ŒåŠ¨æ€å˜åŒ–ï¼Œå…¶ä¸­æ ˆçš„ä½¿ç”¨ç”±ç³»ç»Ÿç®¡ç†ï¼Œè€Œå †çš„çš„ä½¿ç”¨åˆ™éœ€è¦ç¨‹åºè¿›è¡Œç®¡ç†ã€‚ æ ˆç”±é«˜ä½å‘ä½Žä½å¢žé•¿ï¼Œæ˜¯å› ç¨‹åºä¸­å‡½æ•°è¿è¡Œè€Œä¸´æ—¶å ç”¨çš„å†…å­˜ï¼Œç”±ç³»ç»Ÿçš„å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œæ¥è‡ªåŠ¨ç®¡ç†ã€‚å †ç”±ä½Žä½å‘é«˜ä½å¢žé•¿ï¼Œéœ€è¦ç”±ç¨‹åºè‡ªè¡Œç®¡ç†ï¼Œç¼–ç¨‹ä¸­çš„å†…å­˜ç®¡ç†å³æ˜¯æŒ‡å¯¹å †çš„åˆ†é…ä¸Žå›žæ”¶ï¼Œè¿è¡Œä¸­ä¸å†ä½¿ç”¨çš„å†…å­˜å´æœªå›žæ”¶ä¾¿æ˜¯å†…å­˜æ³„éœ²ï¼Œè¿˜åœ¨ä½¿ç”¨çš„å†…å­˜å´è¢«å›žæ”¶äº†ä¾¿æ˜¯é‡ŽæŒ‡é’ˆé—®é¢˜ã€‚ æ ˆçš„å†…å­˜å˜åŒ–ï¼šæ¯ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨å°±ä¼šå‘æ ˆä¸­åŽ‹å…¥ä¸€ä¸ªå‡½æ•°çš„å¸§ï¼Œå‡½æ•°å¸§ä¸­åŒ…æ‹¬å‡½æ•°çš„å½¢å‚ã€å±€éƒ¨å˜é‡å’Œè¿”å›žåœ°å€ç­‰ä¿¡æ¯ï¼Œæœ‰å¤šå°‘å±‚å‡½æ•°è°ƒç”¨å°±ä¼šåŽ‹å¤šå°‘ä¸ªå¸§ï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸæ—¶å…¶å‡½æ•°å¸§å°±ä¼šå‡ºæ ˆï¼Œå¹¶å›žåˆ°å‡½æ•°çš„è¿”å›žåœ°å€ç»§ç»­æ‰§è¡Œï¼Œéšç€å‡½æ•°æ‰§è¡Œæ—¶å‡½æ•°å¸§çš„å…¥æ ˆä¸Žå‡ºæ ˆï¼Œç¨‹åºå¯¹æ ˆçš„å ç”¨ä¹Ÿéšä¹‹å‘ç”Ÿå˜åŒ–ã€‚ 2.å¼•ç”¨è®¡æ•°iOSä¸­ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥åšå†…å­˜ç®¡ç†ï¼Œå¯¹è±¡çš„åˆ›å»ºæ–¹æ³•ä¸ºå…¶åœ¨å †ä¸­åˆ†é…å†…å­˜ï¼Œå¹¶å°†å¼•ç”¨è®¡æ•°åˆå§‹ä¸º1ï¼Œå¯¹è±¡åˆ›å»ºåŽæƒ³è¦ä¿ç•™æ—¶ä½¿å…¶å¼•ç”¨è®¡æ•°+1ï¼Œæƒ³è¦é‡Šæ”¾æ—¶ä½¿å…¶å¼•ç”¨è®¡æ•°-1ï¼Œå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œç³»ç»Ÿä¼šé”€æ¯å¯¹è±¡å›žæ”¶å†…å­˜ã€‚ å¼•ç”¨è®¡æ•°æ‰‹åŠ¨ç®¡ç†æ–¹æ³•ï¼š retain release autorelease å¼•ç”¨è®¡æ•°åˆå§‹ä¸º1çš„åˆ›å»ºæ–¹æ³•ï¼š alloc new copy mutableCopy é€šè¿‡ä»¥ä¸Šæ–¹æ³•åˆ›å»ºçš„å¯¹è±¡å½’è°ƒç”¨è€…æ‰€æœ‰ï¼Œéœ€è¦è°ƒç”¨è€…åœ¨ä½¿ç”¨åŽå°†å…¶å¼•ç”¨è®¡æ•°-1 3.ARCæŠ€æœ¯ARCç¼–ç¨‹æ—¶æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨(æŒ‡é’ˆ)éƒ½éœ€è¦è¡¨æ˜Žå¯¹å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œæ™®é€šæŒ‡é’ˆé€šè¿‡æ‰€æœ‰æƒä¿®é¥°ç¬¦æŒ‡æ˜Ž(å¦‚æžœæ²¡æœ‰æ˜¾ç¤ºå£°æ˜Žæ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œåˆ™ç¼ºçœä¸º__strong)ï¼Œå±žæ€§çš„æˆå‘˜å˜é‡åˆ™é€šè¿‡å±žæ€§ä¿®é¥°ç¬¦æŒ‡æ˜Žï¼Œç¼–è¯‘æ—¶åˆ™ä¾æ®æŒ‡é’ˆå¯¹å¯¹è±¡çš„æ‰€æœ‰æƒæ·»åŠ å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç (å¼•ç”¨è®¡æ•°ç®¡ç†çš„ç›¸å…³Cå‡½æ•°ï¼Œè€ŒéžMRCä¸­çš„OCæ–¹æ³•)ï¼Œè¿è¡Œæ—¶å¯¹äºŽå¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç åˆåšäº†é€‚å½“çš„ä¼˜åŒ–ã€‚ARCæ—¢ç®€åŒ–äº†å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç çš„ç¼–ç¨‹ï¼Œåˆä¼˜åŒ–äº†å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç çš„æ‰§è¡Œï¼ŒObjective-Cå’ŒObjective-C++çš„å¯¹è±¡éƒ½å¯ä»¥ä¾èµ–ARCè¿›è¡Œå†…å­˜ç®¡ç†ï¼ŒCoreFoundationä¸­çš„å¯¹è±¡åˆ™éœ€è¦æ‰‹åŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ã€‚ ARCä¸­çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ARCä¸­æœ‰ä»¥ä¸‹4ç§æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼š __strongï¼šå¼ºå¼•ç”¨ï¼Œé»˜è®¤çš„ä¿®é¥°ç¬¦ï¼Œä½¿å¼•ç”¨è®¡æ•°+1ï¼Œå¯¹åº”å±žæ€§ä¿®é¥°ç¬¦ä¸­çš„strongã€copyå’Œretainï¼› __weakï¼šå¼±å¼•ç”¨ï¼Œä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å˜åŒ–ï¼Œå¯¹è±¡é‡Šæ”¾åŽä¼šè‡ªåŠ¨æŒ‡å‘nilï¼Œå¯¹åº”å±žæ€§ä¿®é¥°ç¬¦ä¸­çš„weakï¼› __unsafe_unretainedï¼šä¸å®‰å…¨çš„å¼±å¼•ç”¨ï¼Œä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å˜åŒ–ï¼Œå¯¹è±¡é‡Šæ”¾åŽä¸ä¼šè‡ªåŠ¨æŒ‡å‘nilï¼Œå®¹æ˜“é€ æˆé‡ŽæŒ‡é’ˆï¼Œä½†æ¯”__weakæ€§èƒ½æ›´å¥½ï¼Œå¯¹åº”å±žæ€§ä¿®é¥°ç¬¦ä¸­çš„assignå’Œunsafe_unretained; __autoreleasingï¼šè‡ªåŠ¨é‡Šæ”¾å¼•ç”¨ï¼Œä¼šä½¿å¼•ç”¨è®¡æ•°+1ï¼Œå¹¶åœ¨è‡ªåŠ¨é‡Šæ”¾æ± é‡Šæ”¾æ—¶å»¶è¿Ÿ-1ï¼Œå¸¸ç”¨äºŽç”³æ˜Žç»“æžœå‚çš„å½¢å‚ã€‚ NSNotificationCenterå¯¹Observerçš„å¼•ç”¨åœ¨iOS9ä¹‹å‰æ˜¯unsafe_unretainedçš„ï¼Œéœ€è¦åœ¨å¯¹è±¡deallocå‰removeObserverï¼Œå¦åˆ™å®¹æ˜“å‡ºçŽ°é‡ŽæŒ‡é’ˆé—®é¢˜ï¼ŒiOS9ä¹‹åŽå¯¹Observerçš„å¼•ç”¨æ”¹ä¸ºäº†weakï¼Œåœ¨å¯¹è±¡deallocæ—¶æ²¡æœ‰removeObserverä¹Ÿä¸å†æœ‰é‡ŽæŒ‡é’ˆçš„é—®é¢˜ã€‚ ARCä¸ŽCoreFoundationCoreFoundationä¸­çš„å¯¹è±¡ä¸ç”±ARCç®¡ç†ï¼Œä¾ç„¶éœ€è¦æ‰‹åŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ï¼ŒARCä¸­CFå¯¹è±¡å’ŒOCå¯¹è±¡è¿›è¡Œç›¸äº’è½¬æ¢æ—¶ï¼Œéœ€è¦é€šè¿‡å…³é”®å­—æŒ‡æ˜Žè½¬æ¢åŽå¯¹è±¡æ‰€æœ‰æƒçš„å˜åŒ–ï¼š __bridgeï¼šç”¨äºŽCFå’ŒOCå¯¹è±¡çš„ç›¸äº’è½¬æ¢ï¼Œä¸å‘ç”Ÿæ‰€æœ‰æƒçš„å˜åŒ–ï¼Œå¼•ç”¨è®¡æ•°ä¸å˜ã€‚CFå¯¹è±¡è½¬OCå¯¹è±¡ï¼Œåˆ™å¯¹è±¡ä¾ç„¶éœ€è¦åœ¨CFä¸­æ‰‹åŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ï¼›OCå¯¹è±¡è½¬CFå¯¹è±¡ï¼Œåˆ™å¯¹è±¡ç”±ARCç®¡ç†ï¼ŒCFä¸­å¯ä»¥ä¸å¯¹å…¶åšæ‰‹åŠ¨çš„å¼•ç”¨è®¡æ•°ç®¡ç†ã€‚ __bridge_retainedï¼šç­‰æ•ˆäºŽCFBridgingRetainï¼Œç”¨äºŽOCå¯¹è±¡è½¬CFå¯¹è±¡ï¼ŒCFä¿ç•™ä¸€æ¬¡å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¼•ç”¨è®¡æ•°+1ã€‚ç›¸å½“äºŽè½¬æ¢å®ŒæˆåŽå†è°ƒç”¨äº†ä¸€æ¬¡CFRetainã€‚ __bridge_transferï¼šç­‰æ•ˆäºŽCFBridgingReleaseï¼Œç”¨äºŽCFå¯¹è±¡è½¬OCå¯¹è±¡ï¼ŒCFé‡Šæ”¾ä¸€æ¬¡å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¼•ç”¨è®¡æ•°-1ã€‚ç›¸å½“äºŽè½¬æ¢å®ŒæˆåŽå†è°ƒç”¨äº†ä¸€æ¬¡CFReleaseã€‚ ARCä¸­çš„å†…å­˜æ³„éœ²ARCä¸ºç¨‹åºè‡ªåŠ¨æ·»åŠ äº†å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç ï¼Œä½†å¦‚æžœç¼–ç¨‹è¿‡ç¨‹ä¸­ä¸æ³¨æ„ï¼Œä¾ç„¶å¯èƒ½å‡ºçŽ°å†…å­˜æ³„éœ²çš„æƒ…å†µï¼š å¾ªçŽ¯å¼•ç”¨é€ æˆçš„å†…å­˜æ³„éœ²ï¼šAç›´æŽ¥æˆ–é—´æŽ¥çš„ä¿ç•™äº†Bï¼ŒBåˆç›´æŽ¥æˆ–é—´æŽ¥çš„ä¿ç•™äº†Aï¼Œå°±ä¼šå‡ºçŽ°å¾ªçŽ¯å¼•ç”¨ï¼Œè¿™åœ¨blockçš„ä½¿ç”¨ä¸­å°¤å…¶å®¹æ˜“å‡ºçŽ°ï¼Œå¾ªçŽ¯å¼•ç”¨çš„å¯¹è±¡åœ¨äº’ç›¸ç­‰å¯¹æ–¹é‡Šæ”¾è‡ªå·±ï¼Œæœ€ç»ˆæ˜¯éƒ½ä¸ä¼šé‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚ARCå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æ¥é¿å…å¾ªçŽ¯å¼•ç”¨çš„å‡ºçŽ°ï¼Œä¹Ÿå¯ä»¥åœ¨å‡ºçŽ°å¾ªçŽ¯å¼•ç”¨åŽæ‰‹åŠ¨è§£é™¤å¼•ç”¨çŽ¯ã€‚ performSelectorç›¸å…³APIé€ æˆçš„å†…å­˜æ³„éœ²ï¼šå½“æ´¾å‘çš„é€‰æ‹©å­ä¸æ˜Žç¡®çš„æ—¶å€™ï¼ŒARCä¸­ç¼–è¯‘å™¨ä¸çŸ¥é“æ˜¯å¦åº”è¯¥ä¸ºè¿”å›žçš„å¯¹è±¡æ·»åŠ é‡Šæ”¾çš„ä»£ç ï¼Œæ‰€ä»¥ARCé€‰æ‹©ä¸æ·»åŠ é‡Šæ”¾ä»£ç çš„ä¿å®ˆåšæ³•ï¼Œè¿™æ ·å½“é€‰æ‹©å­æ˜¯newã€allocã€copyå’ŒmutableCopyè¿™äº›åº”å½“ç”±è°ƒç”¨è€…é‡Šæ”¾è¿”å›žå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚å¯ä»¥æ·»åŠ é¢å¤–çš„åˆ¤æ–­ï¼Œå½“é€‰æ‹©å­æ˜¯éœ€è¦è°ƒç”¨è€…é‡Šæ”¾è¿”å›žå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå°†è¿”å›žå¯¹è±¡è½¬ä¸ºCoreFoundationå¯¹è±¡ï¼Œå†ç”¨__bridge_transferè½¬å›žOCå¯¹è±¡ï¼Œä½¿å…¶å¼•ç”¨è®¡æ•°-1æ¥é¿å…å†…å­˜æ³„éœ²ã€‚ å¼‚å¸¸æ•èŽ·ä»£ç é€ æˆçš„å†…å­˜æ³„éœ²ï¼šå¼‚å¸¸æ•èŽ·ä»£ç @try{ } @catch{ } @finally{ }çš„@try{ }ä¸­å‡ºçŽ°å¼‚å¸¸æ—¶ä¼šè·³è¿‡åŽé¢çš„ä»£ç ï¼Œè¿›å…¥@catch{ }ä¸­ç»§ç»­æ‰§è¡Œï¼Œå¦‚æžœ@try{ }ä¸­åˆ›å»ºå¹¶æŒæœ‰äº†ä¸´æ—¶å¯¹åƒï¼Œé‚£ä¹ˆå³ä½¿ARCä¸ºå…¶æ·»åŠ äº†é‡Šæ”¾ä»£ç ï¼Œä¹Ÿä¸ä¼šè¢«æ‰§è¡Œï¼Œå¦‚æ­¤ä¾¿ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚è§£å†³çš„åŠžæ³•æ˜¯é¿å…åœ¨@try{ }ä¸­ä½¿ç”¨newã€allocã€copyå’ŒmutableCopyç­‰æ–¹æ³•æ¥åˆ›å»ºå¹¶æŒæœ‰å¯¹è±¡ï¼Œæˆ–è€…ä¸ºæ–‡ä»¶æ·»åŠ -fobjc-arc-exceptionsæ ‡è¯†è®©ARCç”Ÿæˆé¢å¤–çš„ä»£ç æ¥åšå¤„ç†(å½±å“è¿è¡ŒæœŸæ€§èƒ½)ï¼Œæ›´æŽ¨èçš„åšæ³•å…¶å®žæ˜¯é¿å…ä½¿ç”¨å¼‚å¸¸æ•èŽ·ä»£ç ã€‚ åœ¨OCçš„ç¼–ç¨‹ä¸­å¹¶æŽ¨èç¼–å†™å¼‚å¸¸å®‰å…¨ä»£ç (å¼‚å¸¸æ•èŽ·)ï¼Œå› ä¸ºOCçš„è¯­è¨€è®¾è®¡ä¸­è®¤ä¸ºåªæœ‰ä¸¥é‡åˆ°éœ€è¦ç¨‹åºç»ˆæ­¢çš„é”™è¯¯æ‰åº”è¯¥æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæ—¢ç„¶æŠ›å‡ºå¼‚å¸¸æ—¶ç¨‹åºåº”è¯¥ç»ˆæ­¢ï¼Œä¹Ÿå°±æ— éœ€æ•èŽ·å¼‚å¸¸ä¹¦å†™å¼‚å¸¸å®‰å…¨ä»£ç ã€‚å¯¹äºŽå¯è¢«æŽ¥å—æˆ–è¿›ä¸€æ­¥å¤„ç†çš„é”™è¯¯ï¼ŒOCä¸­æŽ¨èé€šè¿‡è¿”å›žnil/0æˆ–ä½¿ç”¨NSErroræ¥ä¼ é€’é”™è¯¯ä¿¡æ¯ï¼Œå¹¶åœ¨æŽ¥æ”¶åˆ°é”™è¯¯ä¿¡æ¯åŽåšç›¸åº”å¤„ç†ã€‚ 4.è‡ªåŠ¨é‡Šæ”¾æœ‰æ—¶ä¸æƒ³å†ä¿ç•™å¯¹è±¡ä½†åˆä¸æƒ³å¯¹è±¡è¢«é©¬ä¸Šé‡Šæ”¾æ—¶ï¼Œæ¯”å¦‚å‡½æ•°ä¸­ç”Ÿæˆçš„å¯¹è±¡ä½œä¸ºå‡½æ•°çš„è¿”å›žå€¼ï¼Œå¯ä»¥ä½¿ç”¨autoreleaseæ¥æ ‡è®°å¯¹è±¡ï¼Œè®©å¯¹è±¡åœ¨å…¶æ‰€åœ¨çš„è‡ªåŠ¨é‡Šæ”¾æ± drainæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œè¾¾åˆ°å»¶è¿Ÿé‡Šæ”¾çš„æ•ˆæžœã€‚ autoreleaseä¸Ž__autoreleaseMRCå’ŒARCä¸­åˆ†åˆ«ç”¨autoreleaseå’Œ__autoreleaseä¸ºå¯¹è±¡åšè‡ªåŠ¨é‡Šæ”¾æ ‡è®°ï¼Œåœ¨ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ç®¡ç†èŒƒå›´å†…å¯¹è±¡è¢«æ ‡è®°äº†å‡ æ¬¡è‡ªåŠ¨é‡Šæ”¾ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± drainæ—¶å°±ä¼šä¸ºå…¶åšå‡ æ¬¡å¼•ç”¨è®¡æ•°-1ã€‚ ARCä¸­é€šå¸¸ç”¨æ¥__autoreleaseå£°æ˜Žç»“æžœå‚(äºŒçº§æŒ‡é’ˆå½¢å‚)çš„å®žå‚ï¼Œå…³äºŽè¿™ç§ä½¿ç”¨åœºæ™¯éœ€è¦æ¸…æ¥šçš„æœ‰ï¼š å¼ºå¼•ç”¨çš„å±€åŸŸå¯¹è±¡åœ¨å‡ºäº†ä½œç”¨åŸŸæ—¶å¼•ç”¨è®¡æ•°-1ï¼Œ__autoreleasingæŒ‡å‘çš„å±€åŸŸå¯¹è±¡ï¼Œä¼šå»¶è¿Ÿé‡Šæ”¾ï¼Œå³ç¦»å¼€ä½œç”¨åŸŸå¼•ç”¨è®¡æ•°ä¹Ÿä¸ä¼š-1ï¼Œè€Œæ˜¯åœ¨å½“å‰è‡ªåŠ¨é‡Šæ”¾æ± é‡Šæ”¾æ—¶æ‰å¼•ç”¨è®¡æ•°-1ï¼› å¼ºå¼•ç”¨å½¢å‚ä¼šä½¿å¼•ç”¨è®¡æ•°+1ï¼Œä½†æ˜¯æ˜¯å‡½æ•°ä½œç”¨åŸŸçš„å±€åŸŸå¯¹è±¡ï¼Œå‡ºäº†å‡½æ•°ä½œç”¨åŸŸå¼•ç”¨è®¡æ•°-1ï¼Œ__autoreleasingä¿®é¥°çš„å½¢å‚ä¸ä¼šä½¿å¼•ç”¨è®¡æ•°+1ï¼Œå‡ºäº†å‡½æ•°ä½œç”¨åŸŸä¹Ÿä¸ä¼š-1ï¼› å½“å½¢å‚æ˜¯ç»“æžœå‚æ—¶(äºŒçº§æŒ‡é’ˆ)å¦‚æžœä¼ å…¥çš„å®žå‚æœªåšautoreleasingä¿®é¥°ï¼Œä¸ºç»“æžœå‚èµ‹å€¼æ—¶ï¼ŒARCä¼šæ·»åŠ ä¸€ä¸ªautoreleasingçš„æŒ‡é’ˆæŒ‡å‘æ‰€èµ‹çš„ç»“æžœï¼Œä½¿ç»“æžœå‚è¿”å›žåŽå»¶è¿Ÿé‡Šæ”¾ï¼›å¦‚æžœå®žå‚å·²ç»æœ‰__autoreleasingä¿®é¥°ï¼Œåˆ™åœ¨ä¸ºç»“æžœå‚èµ‹å€¼æ—¶ARCä¸ä¼šæ·»åŠ é¢å¤–çš„ä»£ç ã€‚ autoreleasePoolå…³äºŽè‡ªåŠ¨é‡Šæ”¾æ± éœ€è¦æ¸…æ¥šçš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š æ¯ä¸ªçº¿ç¨‹é€šè¿‡è‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± æ ˆç»´æŠ¤ç€çº¿ç¨‹ä¸­æ·»åŠ çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¯¹è±¡è¢«æ ‡è®°ä¸ºè‡ªåŠ¨é‡Šæ”¾æ—¶ä¼šæ·»åŠ åˆ°æ ˆé¡¶çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼› æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šä¸ºå…¶è‡ªåŠ¨é‡Šæ”¾æ± æ ˆä¸­åˆ›å»ºä¸€ä¸ªé»˜è®¤è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä¸»çº¿ç¨‹ä¼šç›‘å¬main runloopçš„æ´»åŠ¨å¹¶é€šè¿‡å…¥æ ˆå’Œå‡ºæ ˆæ¥å‘¨æœŸæ€§çš„æ–°å»ºå’Œé”€æ¯è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå­çº¿ç¨‹çš„é»˜è®¤è‡ªåŠ¨é‡Šæ”¾æ± åœ¨ä½¿ç”¨æ—¶æ‡’åŠ è½½ï¼Œåœ¨çº¿ç¨‹é€€å‡ºæ—¶æ¸…ç©ºï¼› @autoreleasepool { }æ·»åŠ äº†è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä½†åœ¨ç¦»å¼€å…¶ä½œç”¨åŸŸåŽå°±å·²ç»é‡Šæ”¾äº†ï¼Œå¯ç”¨å…¶æ¥åšç²¾ç»†å†…å­˜ç®¡ç†ï¼› åœ¨MRCå’Œæ—©æœŸçš„ARCä¸­æŽ¨èç”¨@autoreleasepool { }æ¥æ¶ˆé™¤å†…å­˜å³°å€¼ï¼ŒçŽ°åœ¨çš„ARCä¸­ç”Ÿæˆçš„å±€éƒ¨å¯¹è±¡ï¼Œåœ¨ç¦»å¼€å±€éƒ¨ä½œç”¨åŸŸåŽå°±å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå·²ç»ä¸éœ€è¦è‡ªåŠ¨é‡Šæ”¾æ± æ¥æ¶ˆé™¤å†…å­˜å³°å€¼ï¼Œä½†ä¾ç„¶å¯ä»¥ä¿ç•™è¿™ç§å†™æ³•ä»¥å…¼å®¹è€ç‰ˆæœ¬ã€‚ 5.Blockä¸Žå†…å­˜ç®¡ç†Blockè‡ªèº«çš„å†…å­˜ç®¡ç†blockå…¶å®žæ˜¯ä¸€ä¸ªç»“æž„ä½“ï¼Œä½†ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡å‘ç±»çš„isaæŒ‡é’ˆï¼Œæ‰€ä»¥ä¹Ÿå¯è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ã€‚blockçš„isaæŒ‡å‘æŠ½è±¡ç±»NSBlockçš„å­ç±»__NSMallocBlock__ã€__NSStackBlock__æˆ–__NSGlobalBlock__ï¼Œæ ¹æ®å…¶å®žé™…ç±»çš„ä¸åŒå¯å°†blockåˆ†ä¸ºå †blockã€æ ˆblockå’Œå…¨å±€blockï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­æœ‰ä¸åŒçš„ç®¡ç†æ–¹æ³•ï¼š å…¨å±€block(__NSGlobalBlock__)ï¼šå’ŒCå‡½æ•°ä¸€æ ·å‚¨å­˜åœ¨ä»£ç æ®µï¼Œæ— éœ€å†…å­˜ç®¡ç†ï¼› æ ˆblock(__NSStackBlock__)ï¼šç±»ä¼¼äºŽå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼› å †block(__NSMallocBlock__)ï¼šå’Œæ™®é€šå¯¹è±¡ä¸€æ ·ç”±å¼•ç”¨è®¡æ•°è¿›è¡Œç®¡ç†ï¼Œæ”¯æŒARCï¼› å£°æ˜Žä¸€ä¸ªblockæ—¶ï¼Œblockå¯ä»¥ä½¿ç”¨çŽ¯å¢ƒå˜é‡ï¼Œå¯¹çŽ¯å¢ƒä¸­å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„ä½¿ç”¨ä¸ä¼šå½±å“blockçš„ç±»åž‹ï¼Œå¯å¦‚æžœä½¿ç”¨äº†çŽ¯å¢ƒä¸­çš„å±€éƒ¨å˜é‡ï¼Œå£°æ˜Žçš„blockå°†ä¼šæ˜¯ä¸€ä¸ªæ ˆblockï¼Œå¦‚æžœæ²¡æœ‰ä½¿ç”¨çŽ¯å¢ƒä¸­çš„å±€éƒ¨å˜é‡ï¼Œåˆ™å°†ä¼šæ˜¯ä¸€ä¸ªå…¨å±€blockã€‚å¯¹æ ˆblockè¿›è¡Œcopyä¼šå¾—åˆ°ä¸€ä¸ªå…¶åœ¨å †ä¸­çš„æ‹·è´ï¼Œè€Œæ ˆblockçš„ç”Ÿå‘½å‘¨æœŸä»…é™äºŽå…¶å£°æ˜Žæ—¶çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥è‹¥è¦æŒæœ‰ä¸€ä¸ªæ ˆblockï¼ŒMRCä¸­éœ€è¦æ‰‹åŠ¨è°ƒç”¨æ ˆblockçš„copyæ¥ä½¿ç”¨å †blockï¼Œè€ŒARCä¸­åˆ™åœ¨å°†æ ˆblockèµ‹å€¼ç»™å˜é‡æ—¶å°±è‡ªåŠ¨è¿›è¡Œäº†copyï¼Œè€Œåˆå› ä¸ºå…¨å±€blockå’Œå †blockçš„copyè¿”å›žçš„éƒ½æ˜¯å…¶è‡ªèº«ï¼Œæ‰€ä»¥åœ¨éœ€è¦æŒæœ‰ä¸€ä¸ªblockæ—¶ï¼Œä½¿ç”¨å®ƒçš„copyæ€»æ˜¯æ²¡é”™ã€‚ Blockä¸­å¯¹è±¡çš„å†…å­˜ç®¡ç†ARCä¸­blockä¼šä¿ç•™å…¶æ•èŽ·çš„çŽ¯å¢ƒå±€éƒ¨å˜é‡å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æžœblockä¸­å‡ºçŽ°çš„çŽ¯å¢ƒå±€éƒ¨å˜é‡æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡é’ˆï¼Œåˆ™blockä¹Ÿä¼šå¯¹è¯¥æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡å¼ºå¼•ç”¨ï¼Œå¦‚æžœæ•èŽ·çš„çŽ¯å¢ƒå±€éƒ¨å˜é‡æ˜¯å¼±å¼•ç”¨æŒ‡é’ˆï¼Œåˆ™blockå¯¹æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ä¹Ÿæ˜¯å¼±åº”ç”¨ï¼Œè‡³äºŽçŽ¯å¢ƒå±€éƒ¨å˜é‡æ˜¯è‡ªåŠ¨é‡Šæ”¾å¼•ç”¨æŒ‡é’ˆï¼Œåˆ™ä¸èƒ½åœ¨blockä¸­ä½¿ç”¨ã€‚ å› ä¸ºblockçš„ä¸Šè¿°ç‰¹æ€§ï¼Œå¦‚æžœblockä¸­è¦ä½¿ç”¨çš„å±€éƒ¨å˜é‡æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡é’ˆï¼Œä¸”æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ç›´æŽ¥æˆ–é—´æŽ¥çš„åˆå¼ºå¼•ç”¨äº†è¯¥blockï¼Œåˆ™ä¼šå‡ºçŽ°å¾ªçŽ¯å¼•ç”¨ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥å…ˆç”¨ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡é’ˆæŒ‡å‘è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œå†åœ¨blockä¸­ä½¿ç”¨å¼±å¼•ç”¨æŒ‡é’ˆï¼Œåˆ™èƒ½é¿å…å¾ªçŽ¯å¼•ç”¨ï¼›è€Œå¦‚æžœè¿˜éœ€è¦é˜²æ­¢blockä¸­ä»£ç æ‰§è¡ŒæœŸé—´ï¼Œå¼±å¼•ç”¨æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡è¢«é‡Šæ”¾æŽ‰ï¼Œåˆ™åˆå¯ä»¥åœ¨blockä¸­ç”¨å…ˆç”¨ä¸€ä¸ªä¸´æ—¶çš„å¼ºå¼•ç”¨æŒ‡é’ˆæ¥æŒæœ‰å¼±å¼•ç”¨æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ï¼Œè¿™ä¸ªä¸´æ—¶çš„å¼ºå¼•ç”¨æŒ‡é’ˆï¼Œä½œä¸ºblockçš„å±€éƒ¨å˜é‡ï¼Œå¯¹å¯¹è±¡çš„æŒæœ‰åœ¨blockçš„ä½œç”¨åŸŸç»“æŸæ—¶å³ä¼šé‡Šæ”¾ã€‚ 6.NSStringçš„å†…å­˜é—®é¢˜iOSä¸­NSStringå’ŒNSMutableStringéƒ½æ˜¯æŠ½è±¡ç±»ï¼Œå­—ç¬¦ä¸²çš„å®žé™…ç±»åž‹ä¸ºï¼šNSCFStringã€NSCFConstantStringå’ŒNSTaggedPointerStringï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å’Œç®¡ç†æ–¹å¼éƒ½å„ä¸ç›¸åŒï¼š __NSCFStringï¼šå¯¹è±¡å­—ç¬¦ä¸²ï¼Œè¿è¡Œæ—¶åˆ›å»ºï¼Œå­˜å‚¨åœ¨å †ä¸­ï¼Œé€šè¿‡å¼•ç”¨è®¡æ•°ç®¡ç†ï¼› __NSCFConstantStringï¼šå¸¸é‡å­—ç¬¦ä¸²ï¼Œç¼–è¯‘æœŸåˆ›å»ºï¼Œå­˜å‚¨åœ¨å¸¸é‡åŒºï¼Œæ— éœ€å†…å­˜ç®¡ç†ï¼› NSTaggedPointerStringï¼šå˜é‡å­—ç¬¦ä¸²ï¼Œè¿è¡Œæ—¶åˆ›å»ºï¼Œå­˜å‚¨åœ¨æŒ‡é’ˆå˜é‡ä¸­(æ ˆä¸­)ï¼Œç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼› åœ¨åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¾—åˆ°çš„å­—ç¬¦ä¸²çš„å®žé™…ç±»åž‹éµå¾ªä»¥ä¸‹è§„å¾‹ï¼š NSCFConstantStringå’ŒNSTaggedPointerStringæ˜¯NSStringçš„ç›´æŽ¥å­ç±»ï¼ŒNSCFStringæ˜¯NSMutableStringçš„ç›´æŽ¥å­ç±»ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ªå¯å˜å­—ç¬¦ä¸²å’Œå¯¹å­—ç¬¦ä¸²mutableCopyå¾—åˆ°çš„å¿…ç„¶æ˜¯__NSCFStringï¼› å­—é¢é‡è¯­æ³•ç”Ÿæˆçš„NSStringåœ¨ç¼–è¯‘æœŸåˆ›å»ºï¼Œå®žé™…ç±»åž‹ä¸ºNSCFConstantStringï¼Œå†æ¬¡åˆ›å»ºç›¸åŒçš„NSCFConstantStringæ—¶ä¸ä¼šé‡å¤åˆ›å»ºï¼Œè€Œæ˜¯æŒ‡å‘ç›¸åŒçš„å¸¸é‡å­—ç¬¦ä¸²ï¼› withFormart:ç³»åˆ—æ–¹æ³•åˆ›å»ºçš„NSStringåœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œå®žé™…ç±»åž‹ä¸ºNSCFStringæˆ–NSTaggedPointerStringï¼šå½“å­—ç¬¦ä¸²æ”¯æŒTagged Pointerä¼˜åŒ–æ—¶åˆ™åˆ›å»ºçš„NSStringå®žé™…ç±»åž‹ä¸ºNSTaggedPointerStringï¼Œå¦åˆ™ä¸ºNSCFStringï¼› withString:ç³»åˆ—æ–¹æ³•å’Œcopyå¾—åˆ°çš„NSStringå®žé™…ç±»åž‹å’ŒåŽŸå­—ç¬¦ä¸²å®žé™…ç±»åž‹ä¸€è‡´ï¼› Tagged Pointerï¼šç”±äºŽåœ¨64ä½ç³»ç»Ÿä¸­ä¸€ä¸ªæŒ‡é’ˆçš„é•¿åº¦å·²ç»è¾¾åˆ°äº†8ä¸ªå­—èŠ‚ï¼Œå¯¹äºŽä¸€äº›ä¿¡æ¯é‡è¾ƒå°‘çš„å¯¹è±¡(å¦‚NSStingã€NSNumberã€NSDateç­‰)ï¼Œå…¶æœ¬èº«éœ€è¦çš„å†…å­˜ç©ºé—´å¯èƒ½éƒ½ä¸è¶³8ä¸ªå­—èŠ‚ï¼Œå†å°†å…¶åˆ›å»ºåœ¨å †ä¸­ï¼Œå¹¶ç”¨ä¸€ä¸ª8ä¸ªå­—èŠ‚é•¿åº¦çš„æŒ‡é’ˆåŽ»æŒ‡å‘å®ƒï¼Œå°±æœ‰ä¸€äº›æ€§èƒ½å’Œå†…å­˜ä¸Šçš„æµªè´¹ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µè‹¹æžœä¸ºè¿™äº›ç±»å¼•å…¥äº†å„è‡ªçš„Tagged Pointerå¯¹è±¡è¿›è¡Œä¼˜åŒ– â€“ ç”¨æŒ‡é’ˆçš„å‰åŽå„åŠä¸ªå­—èŠ‚å­˜å‚¨å¯¹è±¡çš„æ ‡è®°ä¿¡æ¯ï¼Œä¸­é—´çš„7ä¸ªå­—èŠ‚å­˜å‚¨å¯¹è±¡çš„å€¼ï¼Œå¯¹è±¡ä¸å†ä¿å­˜åœ¨å †ä¸­ï¼Œè€Œæ˜¯ç›´æŽ¥ä¿å­˜åœ¨æŒ‡é’ˆä¸­ã€‚å¯¹äºŽNSStringï¼Œå¦‚æžœå­—ç¬¦ä¸²å¯ä»¥è¢«ASCIIç¼–ç ã€å…­ä½ç¼–ç æˆ–äº”ä½ç¼–ç ï¼Œå¹¶è¢«å­˜å‚¨åœ¨7ä¸ªå­—èŠ‚ä¸­ï¼Œåˆ™è¿è¡Œæ—¶åˆ›å»ºçš„NSStringå®žé™…ç±»åž‹ä¸ºNSTaggedPointerStringï¼Œä½†å³ä½¿æ˜¯äº”ä½ç¼–ç (äº”ä½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦)ï¼Œ7ä¸ªå­—èŠ‚ä¸­æœ€å¤šä¿å­˜(7*8)/5 = 11ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¿è¡Œæ—¶åˆ›å»ºçš„NSStringå¦‚æžœå¤§äºŽ11ä¸ªå­—ç¬¦åˆ™å¿…ç„¶ä¸º__NSCFString 7.å†…å­˜é—®é¢˜è°ƒè¯•å¯ä»¥ä½¿ç”¨Xcodeè‡ªå¸¦çš„åƒµå°¸å¯¹è±¡åŠŸèƒ½æ¥è°ƒè¯•é‡ŽæŒ‡é’ˆé—®é¢˜ï¼Œä½¿ç”¨Instrumentsä¸­çš„Leaksæ¥æ£€æŸ¥å†…å­˜æ˜¯å¦æ³„éœ²ï¼Œå½“å‡ºçŽ°å†…å­˜æ³„éœ²æ—¶å¯ä»¥ä½¿ç”¨ä¸‰æ–¹æ¡†æž¶FBRetainCycleDetectoræ¥æ£€æŸ¥å¯¹è±¡çš„å¾ªçŽ¯å¼•ç”¨ï¼Œè‡³äºŽç›¸å…³å·¥å…·å¦‚ä½•ä½¿ç”¨ï¼Œåœ¨æœ¬ç¯‡ä¸­åˆ™ä¸åšèµ˜è¿°ã€‚]]></content>
      <categories>
        <category>iOSç¼–ç¨‹è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>å†…å­˜ç®¡ç†</tag>
        <tag>å¼•ç”¨è®¡æ•°</tag>
        <tag>ARC</tag>
        <tag>autoreleasePool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äºŒã€ObjCçš„åå°„æœºåˆ¶]]></title>
    <url>%2F2018%2F06%2F30%2FiOS%E7%BC%96%E7%A8%8B%E8%BF%9B%E9%98%B6%2F%E4%BA%8C%E3%80%81ObjC%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[åå°„æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡Œæ—¶å¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹ç¨‹åºæœ¬èº«çš„çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ï¼ŒOCæ˜¯åŸºäºŽRuntimeè¿è¡Œæ—¶ç³»ç»Ÿçš„åŠ¨æ€è¯­è¨€ï¼Œå…·æœ‰å¼ºå¤§çš„åå°„èƒ½åŠ›ã€‚OCçš„åå°„æœºåˆ¶é€šå¸¸æ˜¯æŒ‡NSFoundationä¸­ä¸ºåå°„åŠŸèƒ½æä¾›çš„ä¸€ç³»åˆ—APIï¼Œå®ƒä»¬æ˜¯åŸºäºŽRuntimeçš„å°è£…ï¼Œæ˜¯Runtimeç¼–ç¨‹çš„å­é›†ã€‚ 1. èŽ·å–å¯¹è±¡ç±»åž‹NSFoundationçš„æ ¹ç±»NSObjectä¸­å®žçŽ°äº†-classæ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¿”å›žçš„æ˜¯isaæŒ‡å‘çš„ç±»ï¼Œä½†å®ƒå¯ä»¥è¢«å­ç±»é‡å†™ï¼ˆæ¯”å¦‚KVOä¸­ï¼‰ï¼Œé€ æˆæ­¤æ–¹æ³•è¿”å›žçš„ç±»å’ŒisaæŒ‡å‘çš„ç±»ä¸ä¸€è‡´çš„æƒ…å†µï¼›Runtimeæä¾›äº†Class object_getClass(id obj)å‡½æ•°æ¥èŽ·å–å¯¹è±¡æ‰€å±žçš„ç±»ï¼Œæ­¤å‡½æ•°ç›´æŽ¥è¿”å›žå¯¹è±¡isaæ‰€æŒ‡å‘çš„ç±»ï¼›NSFoundationä¸­è¿˜æä¾›äº†ç±»æ–¹æ³•+classï¼Œè¯¥æ–¹æ³•è¿”å›žçš„å°±æ˜¯å½“å‰ç±»ï¼Œè€Œä¸æ˜¯ç±»çš„ç±»ï¼ˆå…ƒç±»ï¼‰ã€‚ 2. å¯¹è±¡æ£€æµ‹æ–¹æ³•NSFoundationä¸­æ ¹ç±»NSObjectå®žçŽ°äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œæ¥å¯¹å¯¹è±¡çš„ç±»åž‹ã€åè®®ã€æ–¹æ³•ç­‰åšæ£€æµ‹åˆ¤æ–­ï¼š 12345678910// @protocol NSObject- (BOOL)isKindOfClass:(Class)aClass;- (BOOL)isMemberOfClass:(Class)aClass;- (BOOL)conformsToProtocol:(Protocol *)aProtocol;- (BOOL)respondsToSelector:(SEL)aSelector;// @interface NSObject+ (BOOL)instancesRespondToSelector:(SEL)aSelector;+ (BOOL)conformsToProtocol:(Protocol *)protocol;+ (BOOL)isSubclassOfClass:(Class)aClass; 3.æ¶ˆæ¯æ´¾å‘NSFoundationä¸­æ ¹ç±»NSObjectå®žçŽ°ä¸€ç³»åˆ—Perform Selectorï¼Œå®ƒä»¬æœ‰çš„æ˜¯å¯¹objc_msgSendçš„å°è£…ï¼Œæœ‰çš„åˆ™æ˜¯åŸºäºŽçº¿ç¨‹çš„RunLoopæ¥å®žçŽ°çš„ï¼š 123456789101112131415// @protocol NSObject- (id)performSelector:(SEL)aSelector;- (id)performSelector:(SEL)aSelector withObject:(id)object;- (id)performSelector:(SEL)aSelector withObject:(id)object1 withObject:(id)object2;// @interface NSObject (NSDelayedPerforming)- (void)performSelector:(SEL)aSelector withObject:(nullable id)anArgument afterDelay:(NSTimeInterval)delay inModes:(NSArray&lt;NSRunLoopMode&gt; *)modes;- (void)performSelector:(SEL)aSelector withObject:(nullable id)anArgument afterDelay:(NSTimeInterval)delay;// @interface NSObject (NSThreadPerformAdditions)- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array;- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array;- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait;- (void)performSelectorInBackground:(SEL)aSelector withObject:(nullable id)arg; Perform Selectorä¸­æœ‰è¿”å›žå€¼çš„APIè¦æ³¨æ„è¿”å›žçš„å¯¹è±¡å¯èƒ½ä¼šå†…å­˜æ³„éœ²ï¼Œè¿›è¡Œå»¶è¿Ÿæ´¾å‘ã€æ´¾å‘ç»™å…¶ä»–çº¿ç¨‹ã€ä»¥åŠå½“å‰çº¿ç¨‹å¼‚æ­¥æ´¾å‘æ—¶ï¼Œè¦æ³¨æ„åˆ¤æ–­ç›®æ ‡çº¿ç¨‹çš„RunLoopæ˜¯å¦è¿è¡Œã€‚ 4. åå°„æ–¹æ³•NSFoundationä¸­è¿˜æä¾›äº†å­—ç¬¦ä¸²å’ŒSelectorã€ç±»ã€åè®®äº’ç›¸è£…æ¢çš„APIï¼Œä»¥æ–¹ä¾¿æ”¾å°„åŠŸèƒ½çš„ä½¿ç”¨ï¼š 12345678NSString *NSStringFromSelector(SEL aSelector);SEL NSSelectorFromString(NSString *aSelectorName);NSString *NSStringFromClass(Class aClass);Class __nullable NSClassFromString(NSString *aClassName);NSString *NSStringFromProtocol(Protocol *proto);Protocol * __nullable NSProtocolFromString(NSString *namestr);]]></content>
      <categories>
        <category>iOSç¼–ç¨‹è¿›é˜¶</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ã€ObjCçš„åŠ¨æ€ç‰¹æ€§(Runtime)]]></title>
    <url>%2F2018%2F06%2F23%2FiOS%E7%BC%96%E7%A8%8B%E8%BF%9B%E9%98%B6%2F%E4%B8%80%E3%80%81ObjC%E7%9A%84%E5%8A%A8%E6%80%81%E7%89%B9%E6%80%A7(Runtime)%2F</url>
    <content type="text"><![CDATA[[TOC] Reference:Objective-C Runtime Programming GuideiOS Runtimeè¯¦è§£ ç®€è¿°RuntimeæŠ½è±¡çš„è¯´OCçš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œå®žè´¨ç‚¹è®²å®ƒæ˜¯ä¸€ä¸ªç”±Cå’Œæ±‡ç¼–ç¼–å†™çš„åº“ï¼ˆåŽé€æ­¥ç”¨C++é‡å†™ï¼‰ã€‚è¿™ä¸ªåº“å®Œæˆäº†OCå¯¹Cçš„æ‰©å±•ï¼Œåœ¨ç¼–è¯‘æœŸï¼Œé€šè¿‡å®ƒå®žçŽ°äº†OCå‘C/C++çš„è£…æ¢ï¼›åŒæ—¶åœ¨è¿è¡Œæ—¶ï¼Œå®ƒæ˜¯OCé¢å‘å¯¹è±¡å’ŒåŠ¨æ€ç‰¹æ€§çš„åŸºçŸ³ï¼šå®ƒè®©OCå¯ä»¥åŠ¨æ€çš„åˆ›å»ºç±»å’Œå¯¹è±¡ã€å¹¶é€šè¿‡æ–¹æ³•è°ƒç”¨æ¥å®Œæˆå‡½æ•°çš„åŠ¨æ€ç»‘å®šï¼Œè¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’å’Œè½¬å‘ã€‚ æ¦‚è§ˆ è¦ç‚¹ ç±»å’Œå¯¹è±¡éƒ½æœ‰ä¸ªæŒ‡å‘ç±»çš„isaæŒ‡é’ˆï¼Œæ‰€ä»¥ç±»åˆç§°ç±»å¯¹è±¡ï¼Œå¯¹è±¡çš„isaæŒ‡å‘æ‰€å±žç±»ï¼Œç±»çš„isaæŒ‡å‘å…ƒç±»ï¼› æ‰€æœ‰å…ƒç±»çš„isaéƒ½æŒ‡å‘æ ¹ç±»ï¼ˆNSObjectï¼‰çš„å…ƒç±»ï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±ï¼› ç±»åˆ«å¯ä»¥ä¸ºç±»æ·»åŠ å±žæ€§ï¼Œä½†ä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡ï¼Œå¯ä»¥ç”¨å…³è”å¯¹è±¡æ¥ä»£æ›¿æˆå‘˜å˜é‡ï¼Œä¿å­˜å±žæ€§çš„å€¼ï¼› æ¶ˆæ¯å†³ç­–æ—¶å…ˆåœ¨å½“å‰ç±»çš„æ–¹æ³•ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå†åŽ»ç»§æ‰¿é“¾ä¸Šçš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œç»§æ‰¿è¿žä¸Šæ‰¾åˆ°åŽï¼Œä¼šç¼“å­˜åˆ°å½“å‰ç±»çš„æ–¹æ³•ç¼“å­˜ä¸­ï¼› æ¶ˆæ¯è½¬å‘çš„ç³»åˆ—æ–¹æ³•ä¸­è¦æ³¨æ„è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œä»¥ä¾¿å¤„ç†å½“å‰ç±»æœªå¤„ç†çš„æ¶ˆæ¯ï¼› è¯¦è§£Runtimeçš„ä»£ç æ˜¯å¼€æºçš„ï¼Œä»Žobjc4-493ç‰ˆæœ¬å¼€å§‹ï¼ŒRuntimeçš„å®žçŽ°ä»£ç é€æ­¥ç”¨C++è¿›è¡Œé‡å†™ï¼Œæœ¬æ–‡å‚ç…§çš„æºç æ˜¯æœ€åŽä¸€ä¸ªæ²¡æœ‰C++çš„ç‰ˆæœ¬objc4-437.3ã€‚ é¢å‘å¯¹è±¡1.å¯¹è±¡æºç ä¸­å¯¹è±¡çš„å®šä¹‰ï¼š 123typedef struct objc_object &#123; Class isa;&#125; *id; å¯¹è±¡çš„å®šä¹‰æ˜¯ä¸€ä¸ªç»“æž„ä½“ï¼Œå†…éƒ¨åªæœ‰ä¸€ä¸ªæŒ‡å‘æ‰€å±žç±»çš„isaæŒ‡é’ˆã€‚ 2.ç±»æºç ä¸­ç±»çš„å®šä¹‰ï¼š 123456789101112131415161718typedef struct objc_class *Class;struct objc_class &#123; Class isa;#if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; const char *name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; struct objc_method_list **methodLists OBJC2_UNAVAILABLE; struct objc_cache *cache OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE;#endif&#125; OBJC2_UNAVAILABLE; Meta Classç±»çš„ç»“æž„ä½“ä¸­ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡å‘æ‰€å±žç±»çš„isaæŒ‡é’ˆï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘çˆ¶ç±»çš„super_classæŒ‡é’ˆï¼Œç±»çš„isaæŒ‡å‘çš„æ˜¯ç±»çš„ç±»ï¼Œè¢«ç§°ä¹‹ä¸ºå…ƒç±»ï¼›å…ƒç±»çš„super_classæŒ‡é’ˆæŒ‡å‘å…ƒç±»çš„çˆ¶ç±»ï¼Œå…ƒç±»çš„isaæŒ‡é’ˆåˆ™éƒ½æŒ‡å‘æ ¹å…ƒç±»ï¼ˆå³NSObjectçš„å…ƒç±»ï¼‰ï¼›å€¼å¾—æ³¨æ„çš„æ˜¯æ ¹å…ƒç±»çš„super_classæŒ‡å‘çš„æ˜¯æ ¹ç±»ï¼ˆå³NSObjectï¼‰ï¼ŒisaæŒ‡é’ˆä¾ç„¶æŒ‡å‘æ ¹å…ƒç±»ï¼ˆå³å®ƒè‡ªå·±ï¼‰ã€‚ å¯¹è±¡ã€ç±»å’Œå…ƒç±»ä¹‹é—´çš„å…³ç³»å¦‚å›¾ï¼š ç±»å¯¹è±¡ï¼šå¯¹è±¡å’Œç±»éƒ½æœ‰isaæŒ‡é’ˆæŒ‡å‘æ‰€å±žçš„ç±»ï¼Œç”šè‡³åœ¨C++å®žçŽ°çš„Runtimeç‰ˆæœ¬ä¸­ï¼Œç±»çš„ç»“æž„ä½“ç›´æŽ¥ç»§æ‰¿è‡ªå¯¹è±¡çš„ç»“æž„ä½“ï¼Œæ‰€ä»¥è¯´ç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œç§°ä¹‹ä¸ºç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡å’Œå…ƒç±»æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œéƒ½æ˜¯è¿è¡Œæ—¶ç”±ç³»ç»Ÿåˆ›å»ºçš„å•ä¾‹ã€‚ objc_ivar_listç±»ä¸­struct objc_ivar_list *ivarsæ˜¯æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œæºç ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡å…¶ç»“æž„å¦‚ä¸‹ï¼š 12345678struct objc_ivar &#123; char *ivar_name OBJC2_UNAVAILABLE; char *ivar_type OBJC2_UNAVAILABLE; int ivar_offset OBJC2_UNAVAILABLE;#ifdef __LP64__ int space OBJC2_UNAVAILABLE;#endif&#125; å…¶ä¸­ivar_typeå­˜å‚¨çš„æ˜¯æˆå‘˜å˜é‡çš„æ•°æ®ç±»åž‹ã€å†…å­˜ç®¡ç†ã€è®¿é—®æƒé™ç­‰ä¿¡æ¯ç¼–ç åŽçš„ç»“æžœï¼›æä¾›Ivar *class_copyIvarList(Class cls, unsigned int *outCount)å‡½æ•°æ¥èŽ·å–ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡åˆ—è¡¨ã€‚ åœ¨ç±»ä¸­ä½¿ç”¨@propertyä¸ºç±»åŒæ—¶æ·»åŠ äº†å±žæ€§å’Œæˆå‘˜å˜é‡ï¼Œå±žæ€§çš„æœ¬è´¨æ˜¯setå’Œgetæ–¹æ³•ï¼Œæä¾›objc_property_t *class_copyPropertyList(Class cls, unsigned int *outCount)å‡½æ•°èŽ·å–ä¸€ä¸ªç±»çš„å±žæ€§åˆ—è¡¨ã€‚ objc_method_listç±»ä¸­struct objc_method_list **methodListsæ˜¯å¯¹è±¡æ–¹æ³•åˆ—è¡¨ï¼Œç±»æ–¹æ³•å°±æ˜¯ç±»å¯¹è±¡çš„æ–¹æ³•ï¼Œä¿å­˜åœ¨å…ƒç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­ï¼Œæºç ä¸­æ–¹æ³•çš„ç»“æž„å¦‚ä¸‹ï¼š 12345struct objc_method &#123; SEL method_name OBJC2_UNAVAILABLE; char *method_types OBJC2_UNAVAILABLE; IMP method_imp OBJC2_UNAVAILABLE;&#125; æ–¹æ³•ä¸­method_nameå³Selectorï¼Œmethod_typesæ˜¯æ–¹æ³•çš„ç­¾åï¼Œmethod_impåˆ™æ˜¯æ–¹æ³•çš„å®žçŽ°ï¼Œæä¾›Method *class_copyMethodList(Class cls, unsigned int *outCount)æ¥èŽ·å–ä¸€ä¸ªç±»çš„å¯¹è±¡æ–¹æ³•åˆ—è¡¨ã€‚ objc_cacheç±»ä¸­struct objc_cache *cacheæ˜¯Selectorçš„æ–¹æ³•ç¼“å­˜ï¼Œå…¶ä¸­ä¿å­˜çš„æ•°æ®ç»“æž„å¦‚ä¸‹ï¼š 12345typedef struct &#123; SEL name; // same layout as struct old_method void *unused; IMP imp; // same layout as struct old_method&#125; cache_entry; æ–¹æ³•ç¼“å­˜çš„è®¾è®¡æºäºŽä¸€ä¸ªç†å¿µï¼šç±»çš„æŸä¸ªæ–¹æ³•è°ƒç”¨åŽï¼ŒæŽ¥ä¸‹æ¥ä¼šæœ‰å¾ˆå¤§çš„æ¦‚çŽ‡è¢«å†æ¬¡è°ƒç”¨ã€‚å½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯åŽï¼Œéœ€è¦æŸ¥æ‰¾Selecotrå¯¹åº”çš„å®žçŽ°ï¼ˆIMPï¼‰ï¼ŒæŸ¥æ‰¾é¡ºåºæ˜¯å…ˆæŸ¥æ‰¾å½“å‰ç±»çš„æ–¹æ³•ç¼“å­˜ï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä»Žå½“å‰ç±»å¼€å§‹ï¼Œæ²¿ç€ç»§æ‰¿é“¾åœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°åŽä¼šå°†Selectorå’ŒIMPçš„æ˜ å°„ç¼“å­˜åœ¨å½“å‰ç±»çš„æ–¹æ³•ç¼“å­˜ä¸­ã€‚ objc_protocol_listç±»ä¸­struct objc_protocol_list *protocolsæ˜¯åè®®åˆ—è¡¨ï¼Œæºç ä¸­åè®®çš„ç»“æž„å¦‚ä¸‹ï¼š 12345678910111213@interface Object&#123; Class isa; /* A pointer to the instance's class structure */&#125;@interface Protocol : Object&#123;@private char *protocol_name OBJC2_UNAVAILABLE; struct objc_protocol_list *protocol_list OBJC2_UNAVAILABLE; struct objc_method_description_list *instance_methods OBJC2_UNAVAILABLE; struct objc_method_description_list *class_methods OBJC2_UNAVAILABLE;&#125; åè®®æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªObjectçš„ç±»ï¼Œå…¶å†…æœ‰è¯¥åè®®éµå¾ªçš„åè®®åˆ—è¡¨ã€å¯¹è±¡æ–¹æ³•åˆ—è¡¨ã€å’Œç±»æ–¹æ³•åˆ—è¡¨ï¼›æä¾›Protocol **class_copyProtocolList(Class cls, unsigned int *outCount)å‡½æ•°æ¥èŽ·å–ä¸€ä¸ªç±»çš„åè®®åˆ—è¡¨ã€‚ 3.ç±»åˆ«æºç ä¸­ç±»åˆ«çš„ç»“æž„å¦‚ä¸‹ï¼š 1234567struct objc_category &#123; char *category_name OBJC2_UNAVAILABLE; char *class_name OBJC2_UNAVAILABLE; struct objc_method_list *instance_methods OBJC2_UNAVAILABLE; struct objc_method_list *class_methods OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE;&#125; é€šè¿‡ç±»åˆ«å¯ä»¥ä¸ºç±»æ·»åŠ å±žæ€§ï¼Œä½†ä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡ï¼Œç±»åˆ«æ·»åŠ å±žæ€§æ—¶ï¼Œå¯ä»¥é€šè¿‡objc_setAssociatedObjectæ·»åŠ å…³è”å¯¹è±¡ï¼Œä»£æ›¿æˆå‘˜å˜é‡æ¥ä¿å­˜å±žæ€§çš„å€¼ã€‚ ä¸»ç±»å’Œç±»åˆ«ä¸­çš„æ–¹æ³•ã€åè®®ç­‰éƒ½æ˜¯åœ¨Runtimeåˆå§‹åŒ–å‡½æ•°_objc_initä¸­map_imagesæ—¶ï¼Œæ·»åŠ åˆ°ç±»çš„åˆ—è¡¨ä¸­ï¼Œç±»åˆ«è™½ç„¶åŽæ·»åŠ ï¼Œä½†å´æ˜¯æ’åœ¨åˆ—è¡¨å‰é¢ï¼Œæ‰€ä»¥ç±»åˆ«çš„æ–¹æ³•å¯ä»¥è¦†ç›–ä¸»ç±»ä¸­çš„åŒåæ–¹æ³•ã€‚ _objc_initä¸­çš„å›žè°ƒmap_imageså®ŒæˆåŽï¼Œç±»ã€åè®®ã€ç±»åˆ«ç­‰å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œç„¶åŽåœ¨load_imagesè§¦å‘æ—¶ï¼Œå†è°ƒç”¨å„ä¸ªç±»å’Œç±»åˆ«çš„+loadæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨iOSä¸­+loadè°ƒç”¨æ—¶ï¼ŒAppç›¸å…³çš„ç±»éƒ½å·²å®Œæˆåˆå§‹åŒ–ï¼Œå› æ­¤ï¼Œåœ¨iOSä¸­+loadæ–¹æ³•çš„ä¸å®‰å…¨æŒ‡çš„æ˜¯ä¸èƒ½ä¿è¯å…¶ä»–ç±»çš„+loadå·²ç»æ‰§è¡Œï¼Œè€Œä¸æ˜¯æŒ‡å…¶å®ƒç±»æœªå®Œæˆåˆå§‹åŒ–ï¼Œå…³äºŽ+loadçš„æ‰§è¡Œé¡ºåºæ€»ç»“å¦‚ä¸‹ï¼š çˆ¶ç±»çš„+loadæ‰§è¡ŒåŽå­ç±»çš„+loadæ‰æ‰§è¡Œï¼› æ‰€æœ‰ç±»çš„+loadæ‰§è¡ŒåŽç±»åˆ«çš„+loadæ‰æ‰§è¡Œï¼› ç±»åˆ«ä¹‹é—´ã€æ²¡æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œ+loadæ‰§è¡Œçš„é¡ºåºä¸Žç¼–è¯‘é¡ºåºç›¸åŒï¼ˆå³buildPhases -&gt; Compile Sourcesä¸­çš„æ–‡ä»¶é¡ºåºï¼‰ï¼› initializeï¼šé™¤äº†+loadæ–¹æ³•è¿˜å¯ä»¥é€‰æ‹©åœ¨initializeæ–¹æ³•ä¸­åšç±»çš„åˆå§‹åŒ–ç›¸å…³å·¥ä½œï¼Œå…³äºŽinitializeçš„è°ƒç”¨è§„åˆ™éœ€è¦åˆ†æ¸…ä»¥ä¸‹å‡ ç‚¹ï¼š initializeæ˜¯åœ¨ç±»çš„åŠ è½½å®Œæˆä¹‹åŽï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ç±»çš„æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨ï¼› å­ç±»çš„initializeä¸­ä¸éœ€è¦æ˜¾å¼çš„è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œçˆ¶ç±»çš„initializeä¼šè¢«è‡ªåŠ¨çš„è°ƒç”¨ï¼› Categoryä¸­çš„initializeä¼šè¦†ç›–ç±»ä¸­çš„initializeæ–¹æ³•ï¼› æ¶ˆæ¯ä¼ é€’Runtimeé€šè¿‡æ–¹æ³•è°ƒç”¨æ¥å®žçŽ°å‡½æ•°çš„åŠ¨æ€ç»‘å®šï¼Œå³æ‰€è°ƒç”¨çš„å‡½æ•°åœ°å€ä¸æ˜¯ç¼–è¯‘æœŸç¡¬ç¼–ç åœ¨æŒ‡ä»¤ä¸­ï¼Œè€Œæ˜¯éœ€è¦åœ¨è¿è¡ŒæœŸè¯»å–ã€‚æ–¹æ³•è°ƒç”¨åˆå«æ¶ˆæ¯ä¼ é€’ï¼Œæ¶ˆæ¯ç”±selectoråŠå…¶å‚æ•°æ‰€æž„æˆï¼Œæ¶ˆæ¯ä¼ é€’çš„æ ¸å¿ƒæ˜¯objc_msgSendå‡½æ•°ï¼š 1id objc_msgSend(id self, SEL op, ...); åœ¨objc_msgSendå‡½æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯çš„æŽ¥æ”¶ç±»/å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯selectorï¼ŒåŽé¢æ‰æ˜¯æ¶ˆæ¯çš„å‚æ•°ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ–¹æ³•å®žçŽ°çš„å†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªé»˜è®¤çš„å‚æ•°selfå’Œ_cmdï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨æ–¹æ³•è°ƒç”¨è€…è‡ªèº«å’Œæ–¹æ³•çš„selectorã€‚ æ¶ˆæ¯ä¼ é€’ï¼Œå³å¯¹è±¡è¿›è¡Œæ–¹æ³•è°ƒç”¨ï¼Œåˆ°æ‰§è¡Œå¯¹åº”å®žçŽ°ï¼Œæ‰€æ‰§è¡Œçš„æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š æ ¹æ®å¯¹è±¡/ç±»çš„isaæŒ‡é’ˆæ‰¾åˆ°å¯¹è±¡/ç±»æ‰€å±žçš„ç±»/å…ƒç±»ï¼› å…ˆåœ¨å½“å‰ç±»/å…ƒç±»çš„æ–¹æ³•ç¼“å­˜ä¸­æŸ¥æ‰¾selectorå¯¹åº”çš„IMPï¼Œæ‰¾åˆ°IMPåˆ™åŽ»æ‰§è¡Œå¯¹åº”çš„å‡½æ•°å®žçŽ°ï¼› æ–¹æ³•ç¼“å­˜ä¸­æ²¡æ‰¾åˆ°ï¼Œåˆ™æ²¿ç€ç»§æ‰¿é“¾åœ¨ç±»/å…ƒç±»çš„æ–¹æ³•åˆ—è¡¨æ‰¾æŸ¥æ‰¾selectorå¯¹åº”çš„æ–¹æ³•ï¼› æ‰¾åˆ°å¯¹åº”æ–¹æ³•åŽï¼Œå°†æ–¹æ³•ä¸­çš„IMPå’Œselectorçš„æ˜ å°„æ·»åŠ åˆ°å½“å‰ç±»/å…ƒç±»çš„æ–¹æ³•ç¼“å­˜ä¸­ï¼Œå¹¶æ‰§è¡ŒIMPå¯¹åº”çš„å‡½æ•°å®žçŽ°ï¼› å¦‚æžœæœ€ç»ˆæ²¿ç€ç»§æ‰¿é“¾æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œåˆ™å¯åŠ¨æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼› æ¶ˆæ¯è½¬å‘å½“ä¸€ä¸ªæ¶ˆæ¯åœ¨ç±»åŠå…¶ç»§æ‰¿é“¾ä¸Šæœ€ç»ˆæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®žçŽ°ï¼Œå°†å¯åŠ¨æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œæ¶ˆæ¯è½¬å‘çš„æµç¨‹å¦‚å›¾ï¼š å¯åŠ¨æ¶ˆæ¯è½¬å‘åŽï¼Œæ¶ˆæ¯çš„æŽ¥æ”¶è€…è¿˜æœ‰ä¸‰æ¬¡æœºä¼šæ¥å¯¹æ¶ˆæ¯åšå‡ºå¤„ç†ï¼š åŠ¨æ€æ–¹æ³•è§£æžï¼šåœ¨+resolveClassMethod:/+resolveInstanceMethod:ä¸­ï¼Œå¦‚æžœä¸ºæ¶ˆæ¯åŠ¨æ€çš„æ·»åŠ äº†ä¸€ä¸ªç±»/å¯¹è±¡æ–¹æ³•ï¼Œåˆ™é‡æ–°å†å‘é€ä¸€æ¬¡æ¶ˆæ¯ï¼Œå¦‚æžœæ²¡æœ‰ä¸ºæ¶ˆæ¯åŠ¨æ€çš„æ·»åŠ æ–¹æ³•ï¼Œåˆ™ç»§ç»­æ¶ˆæ¯è½¬å‘çš„ä¸‹ä¸€æ­¥ï¼ˆä¸ŽåŠ¨æ€è§£æžæ–¹æ³•è¿”å›žYES/NOæ²¡æœ‰å…³ç³»ï¼‰ï¼› å¤‡æ´æŽ¥å—è€…ï¼šåœ¨-forwardingTargetForSelector:ä¸­å¦‚æžœè¿”å›žäº†ä¸€ä¸ªéžnilçš„å¤‡æ´æŽ¥å—è€…ï¼Œåˆ™å°†æ¶ˆæ¯å‘é€ç»™å¤‡æ´æŽ¥å—è€…ï¼Œå¦‚æžœè¿”å›žnilï¼Œåˆ™ç»§ç»­æ¶ˆæ¯è½¬å‘çš„ä¸‹ä¸€æ­¥ï¼› è½¬å‘æ¶ˆæ¯ï¼šéœ€è¦å…ˆåœ¨-methodSignatureForSelector:è¿”å›žæ¶ˆæ¯å¯¹åº”çš„æ–¹æ³•ç­¾åï¼Œå†åœ¨-forwardInvocation:ä¸­å¤„ç†NSInvocationï¼Œå¦‚æžœæ²¡æœ‰è¿”å›žæ–¹æ³•ç­¾åï¼Œåˆ™ä¼šè°ƒç”¨-doesNotRecognizeSelector:æ–¹æ³•ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼› åœ¨ä¸ºå½“å‰ç±»å®žçŽ°ä»¥ä¸Šæ¶ˆæ¯è½¬å‘æ–¹æ³•æ—¶ï¼Œå¯¹äºŽæ²¡æœ‰å¤„ç†çš„æ¶ˆæ¯ï¼Œéƒ½åº”è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œäº¤ç”±çˆ¶ç±»å¤„ç†ã€‚åœ¨ç¬¬ä¸‰æ­¥è½¬å‘æ¶ˆæ¯æ—¶ï¼Œæ–¹æ³•ç­¾åå¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£Type Encodingsï¼Œå¤„ç†NSInvocationæ—¶ï¼Œå¯ä»¥ç®€å•çš„è½¬å‘ç»™å¦å¤–ä¸€ä¸ªtargetï¼Œä½†è¿™å°±è·Ÿè¿”å›žå¤‡æ´æŽ¥å—è€…æ•ˆæžœä¸€æ ·ï¼Œä¸€èˆ¬å¦‚æžœæ¶ˆæ¯è½¬å‘éœ€è¦èµ°åˆ°è¿™ä¸€æ­¥ï¼Œåˆ™æ˜¯éœ€è¦ç¼–è¾‘NSInvocationæ¥æ›´æ”¹æ¶ˆæ¯å†…å®¹ï¼Œæ¯”å¦‚è¿½åŠ å‚æ•°ã€æ›´æ¢selectorç­‰ã€‚ åº”ç”¨Runtimeæ˜¯OCåŠ¨æ€ç‰¹æ€§çš„åŸºçŸ³ï¼Œä½¿ç”¨å®ƒå¯ä»¥å®žçŽ°OCè¯­è¨€å±‚é¢çš„æ‹“å±•ï¼ŒRuntimeçš„åº”ç”¨éžå¸¸çš„å¹¿æ³›ï¼ŒRuntimeå®žçŽ°çš„åŠŸèƒ½ä¹Ÿéžå¸¸çš„å®žç”¨ï¼ŒRuntimeç¼–ç¨‹å¯ä»¥å‚è§Objective-C Runtime Programming Guideï¼Œè¿™é‡Œåªå¯¹ä¸€äº›å¸¸è§çš„åº”ç”¨åšä¸€ä¸ªç®€å•çš„ä»‹ç» å…³è”å¯¹è±¡Runtimeæä¾›äº†ä¸‰ä¸ªå‡½æ•°æ¥ç®¡ç†å…³è”å¯¹è±¡ï¼š 123456//å…³è”å¯¹è±¡void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)//èŽ·å–å…³è”çš„å¯¹è±¡id objc_getAssociatedObject(id object, const void *key)//ç§»é™¤å…³è”çš„å¯¹è±¡void objc_removeAssociatedObjects(id object) å…³è”å¯¹è±¡ä¸€ä¸ªéžå¸¸å¸¸ç”¨çš„åœ°æ–¹æ˜¯åœ¨ç±»åˆ«ä¸­æ·»åŠ å±žæ€§æ—¶ï¼Œä»£æ›¿æˆå‘˜å˜é‡æ¥ä¿å­˜å±žæ€§çš„å€¼ã€‚æ·»åŠ å…³è”å¯¹è±¡æ—¶ï¼Œéœ€è¦æŒ‡æ˜Žå’Œå±žæ€§ä¿®é¥°ç¬¦ç±»ä¼¼çš„å…³è”å¯¹è±¡å†…å­˜ç­–ç•¥ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š OBJC_ASSOCIATION_ASSIGNï¼ŒåŒ@property (assign)æˆ– @property (unsafe_unretained)ï¼› OBJC_ASSOCIATION_RETAIN_NONATOMICï¼ŒåŒ@property (nonatomic, strong)ï¼› OBJC_ASSOCIATION_COPY_NONATOMICï¼ŒåŒ@property (nonatomic, copy)ï¼› ISA Swizzlingå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘äº†å®ƒæ‰€å±žçš„ç±»ï¼ŒISA Swizzlingæ˜¯æŒ‡ä¿®æ”¹å¯¹è±¡isaæŒ‡å‘çš„ç±»çš„æŠ€æœ¯ã€‚Runtimeæä¾›Class object_setClass(id obj, Class cls)å‡½æ•°æ¥ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡æ‰€æŒ‡å‘çš„ç±»ï¼ŒISA Swizzlingåªä¼šå½±å“åšäº†æ›¿æ¢æ“ä½œçš„å¯¹è±¡ï¼Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªç±»ï¼Œæ›¿æ¢ç¤ºä¾‹ï¼š 12345678BOOL swizzlingObjClass(id obj, Class newCls)&#123; if (class_getInstanceSize(newCls) &lt;= class_getInstanceSize([obj class])) &#123; object_setClass(obj, newCls); return YES; &#125; return NO;&#125; ä¸Šé¢çš„ç¤ºä¾‹ä¸­ä½¿ç”¨äº†size_t class_getInstanceSize(Class cls)æ¥æ¯”è¾ƒISA Swizzlingå‰åŽç±»çš„å®žä¾‹çš„å¤§å°ï¼Œè¿™æ˜¯å› ä¸ºå°†è¦ISA Swizzlingçš„å¯¹è±¡çš„å†…å­˜æ˜¯å·²ç»åˆ†é…å¥½çš„ï¼Œå¦‚æžœæ›¿æ¢åŽç±»çš„å®žä¾‹å¤§äºŽæ›¿æ¢ä¹‹å‰åˆ†é…çš„å†…å­˜ï¼Œä¼šå¯¼è‡´EXC_BAD_ACCESSé”™è¯¯ï¼Œæ‰€ä»¥ISA Swizzlingæ—¶ï¼Œæ›¿æ¢åŽçš„ç±»ä¸€èˆ¬ä¸ºæ›¿æ¢å‰ç±»çš„å­ç±»ï¼Œè€Œä¸”å­ç±»ä¸­æ²¡æœ‰æ–°å¢žä»»ä½•æˆå‘˜å˜é‡æˆ–åˆæˆå±žæ€§ã€‚KVOå°±æ˜¯é€šè¿‡ISA SwizzlingæŠ€æœ¯æ¥å®žçŽ°çš„ã€‚ å½“å¯¹æŸä¸ªç±»Açš„å¯¹è±¡æ·»åŠ KVOä¹‹åŽï¼ŒKVOæœºåˆ¶ä¼šåŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªAçš„å­ç±»ï¼ˆé€šå¸¸å‘½åä¸ºNSKVONotifying_Aï¼‰ï¼Œç„¶åŽè®©è¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡å‘è¿™ä¸ªå­ç±»ï¼Œåœ¨å­ç±»ä¸­é‡å†™äº†-classæ–¹æ³•ï¼Œè®©-classä¾ç„¶è¿”å›žåŽŸæ¥çš„ç±»ï¼Œå¹¶é‡å†™äº†è¢«è§‚å¯ŸkeyPathçš„setteræ–¹æ³•ï¼Œåœ¨setteræ–¹æ³•ä¸­è°ƒç”¨äº†-willChangeValueForKey:å’Œ-didChangeValueForKey:ï¼Œå½“é€šè¿‡setteræ–¹æ³•æ›´æ”¹è¢«è§‚å¯Ÿçš„å€¼æ—¶ï¼Œè§‚å¯Ÿè€…å°±èƒ½æ”¶åˆ°é€šçŸ¥ã€‚ Method SwizzlingRuntimeå…è®¸åŠ¨æ€çš„æ–°å¢žã€æ›¿æ¢æ–¹æ³•çš„å®žçŽ°ï¼Œç”¨æ–°çš„å®žçŽ°æ›¿æ¢åŽŸæœ‰æ–¹æ³•çš„å®žçŽ°ï¼Œå°±å«åšMethod Swizzlingã€‚ä¸€ç§ç‰¹æ®Šçš„Method Swizzling - äº¤æ¢ä¸¤ä¸ªå·²æœ‰æ–¹æ³•çš„å®žçŽ°ï¼Œé…åˆç±»åˆ«å¯ä»¥ä¸ºåŽŸæ–¹æ³•æ·»åŠ hookï¼Œå®Œæˆå¯¹æ²¡æœ‰æºç çš„åŽŸæ–¹æ³•çš„ä¿®æ”¹ã€‚ç®€å•çš„hookä½¿ç”¨method_exchangeImplementationså³å¯å®žçŽ°ï¼Œä½†å®žé™…ä¸Šhookæ—¶æœ‰è®¸å¤šéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œå®‰å…¨è€Œå¥å£®çš„hookå¯ä»¥å‚çœ‹æ–‡ç« Objective-C Method Swizzlingã€‚ Zombie ObjectsZombie Objectsæ˜¯Xcodeä¸­ç”¨æ¥è°ƒè¯•é‡ŽæŒ‡é’ˆï¼ˆEXC_BAD_ACCESSï¼‰è¿™ç±»å†…å­˜é—®é¢˜çš„å·¥å…·ï¼Œå®ƒå……åˆ†çš„åº”ç”¨äº†RuntimeæŠ€æœ¯ï¼šå®ƒé¦–å…ˆé€šè¿‡Method Swizzlingæ›¿æ¢åŽŸæ¥çš„-deallocæ–¹æ³•ï¼Œå½“å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ–°çš„__dealloc_zombieæ–¹æ³•ï¼›æ–°çš„æ–¹æ³•ä¸­åˆä½¿ç”¨ISA SwizzlingæŠ€æœ¯è®©å¯¹è±¡çš„isaæŒ‡å‘åƒµå°¸ç±»ï¼Œç„¶åŽé‡Šæ”¾å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†å¹¶ä¸é‡Šæ”¾å½“å‰å¯¹è±¡ï¼›æœ€åŽå½“ç¨‹åºå†å‘æœ¬è¯¥å·²é‡Šæ”¾çš„å¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œåœ¨åƒµå°¸ç±»çš„æ¶ˆæ¯è½¬å‘ä¸­å°±ä¼šè¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚ Zombie Objectsä¸­__dealloc_zombieæ‰“å¤§è‡´å®žçŽ°ï¼ˆéžæºç ï¼‰ï¼š 123456789101112131415161718192021- (void)__dealloc_zombie&#123; Class cls = object_getClass(self); const char *clsName = class_getName(cls); char *zombieClsPrefix = "_NSZombie_"; char *zombieClsName = malloc(strlen(zombieClsPrefix)+strlen(clsName)+1); strcpy(zombieClsName, zombieClsPrefix); strcat(zombieClsName, clsName); // æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç›¸åŒçš„åƒµå°¸å¯¹è±¡ç±»åï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º Class zombieCls = objc_lookUpClass(zombieClsName); if (!zombieCls) &#123; Class baseZombieCls = objc_lookUpClass("_NSZombie_"); zombieCls = objc_duplicateClass(baseZombieCls, zombieClsName, 0); &#125; // é‡Šæ”¾å¼•ç”¨ã€‚ objc_destructInstance(self); // ISA Swizzling object_setClass(self, zombieCls);&#125; YYModelYYModelè¿ç”¨Runtimeé¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œä¸ºæ ¹ç±»NSObjectæ·»åŠ æ‰©å±•ï¼Œå®žçŽ°JSONæ•°æ®å’ŒOCæ¨¡åž‹ä¹‹é—´è‡ªåŠ¨è½¬æ¢ã€‚YYModeléžå¸¸çš„è½»é‡çº§ï¼Œä»£ç ä¹Ÿéžå¸¸çš„ç›´è§‚ï¼Œå…¶ä»–åˆ©ç”¨Runtimeç‰¹æ€§å®žçŽ°JSONä¸ŽOCæ¨¡åž‹äº’ç›¸è½¬æ¢çš„åº“è¿˜æœ‰å¾ˆå¤šï¼ˆå¦‚ï¼šMJExtensionï¼‰ï¼Œå®ƒä»¬å¯¹Runtimeçš„åˆ©ç”¨æ›´åŠ å¤æ‚ï¼ŒåŠŸèƒ½ä¹Ÿç›¸å¯¹ä¸°å¯Œã€‚ JSPatchJSPatchæ˜¯ä¸€ä¸ªçƒ­ä¿®å¤åº“ï¼Œå®ƒçš„åŸºæœ¬åŽŸç†æ˜¯ï¼šJSä¼ é€’å­—ç¬¦ä¸²ç»™OCï¼ŒOCé€šè¿‡RuntimeåŠ¨æ€è°ƒç”¨æŽ¥å£å’Œæ›¿æ¢OCæ–¹æ³•çš„å®žçŽ°ã€‚JSPatchå¯¹Runtimeçš„åº”ç”¨è¿˜åŒ…æ‹¬åŠ¨æ€çš„æ³¨å†Œç±»ï¼Œä¸ºç±»æ·»åŠ æ–¹æ³•ç­‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123Class cls = objc_allocateClassPair(superCls, "JPObject", 0);class_addMethod(cls, selector, implement, typedesc);objc_registerClassPair(cls);]]></content>
      <categories>
        <category>iOSç¼–ç¨‹è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Runtime</tag>
        <tag>æ¶ˆæ¯è½¬å‘</tag>
        <tag>Swizzling</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å››ã€äº‹ä»¶å¤„ç†æœºåˆ¶ï¼ˆRunLoopï¼‰]]></title>
    <url>%2F2018%2F03%2F02%2FAPP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F%E5%9B%9B%E3%80%81%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%EF%BC%88RunLoop%EF%BC%89%2F</url>
    <content type="text"><![CDATA[[TOC] Reference:æ·±å…¥ç†è§£RunLoopRunLoop è¯¦è§£ ç¨‹åºè¿è¡Œæ—¶ä»£ç éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œæ‰§è¡Œå®Œæ¯•ç¨‹åºå°±ç»“æŸé€€å‡ºäº†ï¼Œäº†è§£APPå·¥ä½œæœºåˆ¶çš„ä¸€ä¸ªåŸºç¡€ï¼Œæ˜¯å¼„æ¸…æ¥šAPPå¦‚ä½•å®žçŽ°åœ¨å†…å­˜ä¸­å¸¸é©»çš„ã€‚ æ¦‚è¿°ä»£ç åœ¨ç¨‹åºçš„çº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œï¼Œå½“ç¨‹åºæ‰€æœ‰çš„çº¿ç¨‹ä¸­ä»£ç éƒ½è¿è¡Œå®Œæ¯•ï¼Œç¨‹åºå°±ç»“æŸå¹¶é€€å‡ºäº†ï¼ŒiOSä¸ŽMacOSä¸­é€šè¿‡RunLoopæœºåˆ¶æ¥è®©çº¿ç¨‹å¯ä»¥ä¸€ç›´ä¿æŒè¿è¡Œï¼Œå¹¶å¾ªçŽ¯çš„å¤„ç†å„ç±»äº‹ä»¶ï¼Œä»Žè€Œè®©APPå¸¸é©»åœ¨å†…å­˜ä¸­æŒç»­å·¥ä½œ ã€‚ç³»ç»Ÿçš„æŸäº›ä»»åŠ¡ä¹Ÿä¾æ‰˜RunLoopæ¥å®Œæˆï¼Œäº†è§£RunLoopçš„è¿è¡Œæœºåˆ¶å°†æœ‰åŠ©äºŽäº†è§£ç³»ç»Ÿä»»åŠ¡çš„æœºåˆ¶ï¼ŒåŒæ—¶ç†è§£äº†RunLoopèƒ½æ¸…æ¥šä¸€ä¸ªçº¿ç¨‹ä¸­ï¼ˆç‰¹åˆ«æ˜¯ä¸»çº¿ç¨‹ä¸­ï¼‰å„ç±»ä»»åŠ¡çš„ä»£ç æ‰§è¡Œé¡ºåºï¼Œè¿˜å°†æœ‰åŠ©äºŽå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ—¶çš„ç¨‹åºè®¾è®¡ã€‚ æ¦‚è§ˆ è¦ç‚¹ RunLoopå°±æ˜¯è®©çº¿ç¨‹ä¿æŒä¸€ç›´è¿è¡Œï¼Œå¹¶å¯ä»¥å¾ªçŽ¯å¤„ç†äº‹ä»¶çš„æœºåˆ¶ï¼› RunLoopçº¿ç¨‹ä¸€ä¸€å¯¹åº”ï¼Œä»£ç ä¸­ä¸èƒ½ç›´æŽ¥åˆ›å»ºï¼Œè€Œæ˜¯æä¾›èŽ·å–ä¸»çº¿ç¨‹å’Œå½“å‰çº¿ç¨‹RunLoopçš„APIï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒå–APIæ—¶ï¼ŒAPIå†…éƒ¨è´Ÿè´£åˆ›å»ºRunLoopï¼Œå­çº¿ç¨‹çš„RunLoopéœ€è¦æ‰‹åŠ¨å¯åŠ¨ï¼› ä¸€ä¸ªRunLoopåŒ…å«è‹¥å¹²ä¸ªModeï¼Œæ¯ä¸ªModeåˆåŒ…å«è‹¥å¹²ä¸ªSource/Timer/Observerï¼› RunLoopå¿…é¡»æŒ‡å®šä¸€ä¸ªModeè¿›è¡Œè¿è¡Œï¼Œè¿è¡ŒåŽå¦‚æžœModeä¸­ä¸€ä¸ªitemséƒ½æ²¡æœ‰ï¼Œå°†ä¼šé€€å‡ºè¿è¡Œï¼› kCFRunLoopCommonModesæ˜¯ä¸€ä¸ªä¼ªModeï¼Œç”¨å®ƒæ·»åŠ çš„itemsï¼Œåœ¨å…¶ä»–â€œCommonModeâ€è¿è¡Œæ—¶ï¼Œä¹Ÿèƒ½å¾—åˆ°è§¦å‘ï¼ŒNSTimeré€šå¸¸éœ€è¦é€šè¿‡æ­¤Modeæ·»åŠ åˆ°RunLoopä¸­ï¼› Sourceåˆ†ä¸ºSource0å’ŒSource1ï¼ŒSource0éœ€è¦æ‰‹åŠ¨æ˜¾ç¤ºå”¤é†’RunLoopæ¥å¤„ç†äº‹ä»¶ï¼Œå¯ç”¨äºŽçº¿ç¨‹é—´å‘é€æ¶ˆæ¯ï¼ŒSource1æ˜¯åŸºäºŽç«¯å£çš„ï¼Œç«¯å£æœ‰æ¶ˆæ¯èƒ½è‡ªåŠ¨å”¤é†’RunLoopæ¥å¤„ç†äº‹ä»¶ï¼Œç”¨äºŽç›‘å¬å†…æ ¸ç«¯å£çš„æ¶ˆæ¯ï¼› Timeræ˜¯åœ¨è®¡ç®—å¥½çš„é¢„è®¾æ—¶é—´ç‚¹ç”±å†…æ ¸å‘é€æ—¶é—´é€šçŸ¥ï¼Œå”¤é†’RunLoopæ¥å¤„ç†Timeräº‹ä»¶ï¼› Observeræ˜¯RunLoopçš„è§‚å¯Ÿè€…ï¼ŒRunLoopåœ¨æŸäº›æ´»åŠ¨èŠ‚ç‚¹ä¼šè§¦å‘å…¶å›žè°ƒï¼Œå¯ä»¥æ®æ­¤åœ¨å¯¹åº”çš„æ—¶æœºå®‰æŽ’è‡ªå·±APPéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼› RunLoopçš„ä¼‘çœ /å”¤é†’æ˜¯é€šè¿‡Maché™·é˜±åˆ‡æ¢ç¨‹åºçš„åº”ç”¨æ€/å†…æ ¸æ€æ¥å®žçŽ°çš„ï¼› Perform Selectorç³»åˆ—æ–¹æ³•ä¸­å»¶è¿Ÿæ´¾å‘ã€æ´¾å‘ç»™å…¶ä»–çº¿ç¨‹ã€ä»¥åŠå½“å‰çº¿ç¨‹å¼‚æ­¥æ´¾å‘æ—¶ï¼Œæ˜¯é€šè¿‡åˆ›å»ºæºå¹¶åŠ å…¥åˆ°å¯¹åº”RunLoopä¸­æ¥å®žçŽ°çš„ï¼Œå¿…é¡»è¦ç›®æ ‡çº¿ç¨‹çš„RunLoopè¿è¡Œï¼Œæ´¾å‘çš„Selectoræ‰ä¼šè¢«æ‰§è¡Œï¼ŒPerform Selectoræ·»åŠ çš„æºä¼šåœ¨æ‰§è¡ŒåŽä»ŽRunLoopä¸­ç§»é™¤ï¼› ç”¨GCDä¸ºä¸»çº¿ç¨‹æ´¾å‘ä»»åŠ¡ï¼Œä¹Ÿæ˜¯åŒ…è£…æˆå¾…å¤„ç†çš„Source1ï¼Œå†æ·»åŠ åˆ°ä¸»çº¿ç¨‹RunLoopä¸­æ¥å®žçŽ°çš„ï¼Œä½†GCDä¸ºå­çº¿ç¨‹ï¼ˆå¹¶å‘é˜Ÿåˆ—ï¼‰æ´¾å‘ä»»åŠ¡ï¼Œä¸æ˜¯é€šè¿‡RunLoopå®žè¡Œçš„ï¼› UIEventæ˜¯UIKitåœ¨ä¸»çº¿ç¨‹ä¸­æ³¨å†Œä¸€ä¸ªSource1ï¼Œé€šè¿‡ç«¯å£æŽ¥æ”¶åˆ°Spring Boardè½¬å‘çš„IOHIDEventï¼Œå†åœ¨å›žè°ƒä¸­å¤„ç†ï¼Œæœ€åŽåŒ…è£…æˆUIEventçš„ï¼› è¯¦è§£1.ä»€ä¹ˆæ˜¯RunLoopRunLoopæ˜¯ä¸€ç§iOSä¸ŽMacOSä¸­è®©çº¿ç¨‹ä¿æŒä¸€ç›´è¿è¡Œï¼Œå¹¶å¯ä»¥å¾ªçŽ¯å¤„ç†äº‹ä»¶çš„æœºåˆ¶ã€‚RunLoopåœ¨CoreFoundationä¸­é€šè¿‡CFRunLoopRefå¯¹è±¡æ¥å®žçŽ°ï¼Œå…¶æä¾›çº¯Cå‡½æ•°çš„ã€çº¿ç¨‹å®‰å…¨çš„APIï¼›åŒæ—¶è¿˜æœ‰åŸºäºŽCFRunLoopRefæ›´ä¸Šå±‚çš„å°è£…ï¼šNSRunLoopï¼Œå…¶æä¾›é¢å‘å¯¹è±¡çš„APIï¼Œä½†ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 2.RunLoopä¸Žçº¿ç¨‹çš„å…³ç³»RunLoopä¸Žçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒCoreFoundationä¸ŽNSFoundationä¸­éƒ½ä¸æä¾›ç›´æŽ¥åˆ›å»ºRunLoopçš„APIï¼Œè€Œæ˜¯æä¾›äº†èŽ·å–ä¸»çº¿ç¨‹RunLoopå’Œå½“å‰çº¿ç¨‹RunLoopçš„APIï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒå–çº¿ç¨‹çš„RunLoopèŽ·å–APIæ—¶ï¼Œå‡½æ•°å†…éƒ¨æ‰ä¸ºçº¿ç¨‹åˆ›å»ºå…¶RunLoopï¼Œå¹¶ä»¥çº¿ç¨‹ä¸ºkeyï¼ŒRunLoopä¸ºvalueï¼Œä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€å­—å…¸ä¸­ã€‚ 3.RunLoopçš„ç›¸å…³æ¦‚å¿µRunLoopä¸­çš„ç»“æž„å¦‚å›¾ï¼š ä¸€ä¸ªRunLoopä¸­åŒ…å«è‹¥å¹²ä¸ªModeï¼Œæ¯ä¸ªModeä¸­åˆåŒ…å«è‹¥å¹²ä¸ªSourceã€Timerå’ŒObserverï¼ŒSourceã€Timerå’ŒObserverç»Ÿç§°ä¸ºitemsï¼Œä¸€ä¸ªitemå¯ä»¥æ·»åŠ åˆ°ä¸åŒçš„Modeï¼Œé‡å¤æ·»åŠ åˆ°åŒä¸€ä¸ªModeæ²¡æœ‰æ•ˆæžœï¼›å¯åŠ¨RunLoopæ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªModeï¼ŒModeä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªitemï¼Œå¦åˆ™RunLoopä¼šç«‹å³é€€å‡ºï¼›RunLoopè¿è¡ŒæœŸé—´æŒ‡å®šModeä¸‹çš„itemsçš„å›žè°ƒä¼šè§¦å‘ï¼Œå¦‚æžœæŒ‡å®šè¿è¡Œçš„Modeå±žäºŽâ€CommondModeâ€ï¼Œåˆ™æ ‡è®°ä¸º kCFRunLoopCommonModesçš„itemsçš„å›žè°ƒä¹Ÿä¼šè§¦å‘ï¼›è¦åˆ‡æ¢Modeï¼Œå¿…éœ€åœæ­¢RunLoopï¼Œå†æŒ‡å®šæ–°çš„Modeé‡æ–°å¯åŠ¨RunLoopã€‚ åœ¨CoreFoundationä¸­Modeå’Œitemså¯¹åº”çš„ç±»ä¸ºï¼šCFRunLoopModeRefã€CFRunLoopSourceRefã€CFRunLoopTimerRefå’ŒCFRunLoopObserverRefï¼Œä¸‹é¢å°†åˆ†åˆ«ä»‹ç»å®ƒä»¬çš„ç‰¹æ€§ã€‚ CFRunLoopModeRefCFRunLoopModeRefç±»æ²¡æœ‰å¯¹å¤–æš´éœ²ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ç³»åˆ—æ ¹æ®mode nameæ¥ç®¡ç†Modeå’ŒModeä¸‹çš„itemsï¼ˆSourceã€Timerå’ŒObserverï¼‰çš„APIï¼š 12345678910// ç®¡ç†Modeçš„æŽ¥å£CFRunLoopRunInMode(CFStringRef modeName, ...);CFRunLoopAddCommonMode(CFRunLoopRef runloop, CFStringRef modeName);// ç®¡ç†Modeä¸‹itemsçš„æŽ¥å£CFRunLoopAddSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);CFRunLoopAddObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);CFRunLoopAddTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);CFRunLoopRemoveSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);CFRunLoopRemoveObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);CFRunLoopRemoveTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode); æä¾›çš„æŽ¥å£åªèƒ½é€šè¿‡mode nameæ¥ç®¡ç†modeï¼Œå½“ä¼ å…¥ä¸€ä¸ªæ–°çš„mode nameï¼Œè€ŒRunLoopå†…åˆæ²¡æœ‰å¯¹åº”çš„Modeæ—¶ï¼ŒRunLoopä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„CFRunLoopModeRefï¼›å¹¶æ²¡æœ‰æä¾›åˆ é™¤Modeçš„APIï¼Œæ‰€ä»¥RunLoopçš„Modeåªèƒ½å¢žåŠ ä¸èƒ½åˆ é™¤ã€‚ ç³»ç»Ÿä¸ºä¸»çº¿ç¨‹çš„RunLoopé»˜è®¤æ³¨å†Œäº†äº”ä¸ªModeï¼š kCFRunLoopDefaultModeï¼šé»˜è®¤Modeï¼Œä¸»çº¿ç¨‹é€šå¸¸ä¹Ÿæ˜¯åœ¨æ­¤Modeä¸‹è¿è¡Œï¼› UITrackingRunLoopModeï¼šç•Œé¢è¿½è¸ªModeï¼Œå½“éœ€è¦è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šè¢«åˆ‡æ¢åˆ°æ­¤Modeï¼Œé¿å…å…¶ä»–itemså¯¹ç•Œé¢æ»‘åŠ¨çš„å½±å“ï¼› UIInitializationRunLoopModeï¼šAPPåˆšå¯åŠ¨æ—¶ä½¿ç”¨çš„Modeï¼Œå¯åŠ¨å®ŒæˆåŽå°±ä¸å†ä½¿ç”¨ï¼› GSEventReceiveRunLoopModeï¼šæŽ¥æ”¶ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨Modeï¼Œå¼€å‘ä¸­é€šå¸¸ç”¨ä¸åˆ°ï¼› kCFRunLoopCommonModesï¼šå ä½Modeï¼Œä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„Modeï¼Œå¯ä»¥ç”¨æ¥æ·»åŠ itemsï¼Œä¸èƒ½ç”¨æ¥å¯åŠ¨RunLoopï¼› ä¸Šè¿°Modeä¸­å¼€å‘ç›¸å…³çš„æœ‰ï¼škCFRunLoopDefaultModeã€UITrackingRunLoopModeå’ŒkCFRunLoopCommonModesï¼Œå…¶ä¸­kCFRunLoopDefaultModeå’ŒUITrackingRunLoopModeæ˜¯çœŸæ­£çš„Modeï¼Œè€ŒkCFRunLoopCommonModesæ˜¯ä¸€ä¸ªå ä½Modeã€‚ç”¨kCFRunLoopCommonModesæ·»åŠ çš„itemsï¼Œåœ¨RunLoopä»¥ä¸€ä¸ªâ€œCommondModeâ€è¿è¡Œæ—¶ï¼Œä¹Ÿèƒ½å¾—åˆ°è§¦å‘ã€‚å¯ä»¥ç”¨CFRunLoopAddCommonModeå°†ä¸€ä¸ªModeæ ‡è®°ä¸ºâ€CommondModeâ€œï¼ˆæ—¢å°†Modeæ·»åŠ åˆ°CFRunLoopRefçš„_commonModesé›†åˆä¸­ï¼‰ï¼ŒkCFRunLoopDefaultModeå’ŒUITrackingRunLoopModeéƒ½æ˜¯â€CommondModeâ€œã€‚ äº‹ä»¶é˜Ÿåˆ—ä¸­åˆ¤æ–­Sourceå’ŒTimerçš„Blockæ˜¯å¦è§¦å‘ä»£ç é€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼š1234567891011121314151617181920static Boolean __CFRunLoopDoBlocks(CFRunLoopRef rl, CFRunLoopModeRef rlm) &#123; ... ... while (item) &#123; struct _block_item *curr = item; item = item-&gt;_next; Boolean doit = false; if (CFStringGetTypeID() == CFGetTypeID(curr-&gt;_mode)) &#123; doit = CFEqual(curr-&gt;_mode, curMode) || (CFEqual(curr-&gt;_mode, kCFRunLoopCommonModes) &amp;&amp; CFSetContainsValue(commonModes, curMode)); &#125; else &#123; doit = CFSetContainsValue((CFSetRef)curr-&gt;_mode, curMode) || (CFSetContainsValue((CFSetRef)curr-&gt;_mode, kCFRunLoopCommonModes) &amp;&amp; CFSetContainsValue(commonModes, curMode)); &#125; if (!doit) prev = curr; if (doit) &#123; ... ... &#125; &#125; ... ... return did;&#125; CFRunLoopSourceRefRunLoopçš„äº‹ä»¶æºæœ‰ä¸¤ä¸ªï¼šè¾“å…¥æºå’Œå®šæ—¶æºï¼Œè¾“å…¥æºå³Sourceï¼Œå¯ä»¥é€šè¿‡ä¸ºModeæ·»åŠ Sourceï¼Œæ¥ä¸ºRunLoopæ·»åŠ éœ€è¦å¤„ç†çš„äº‹ä»¶ï¼Œåœ¨Cocoaå±‚å®˜æ–¹å°†Sourceåˆ†ä¸ºä¸‰ç±»ï¼š Port-Based Sources Custom Input Sources Cocoa Perform Selector Sources CoreFoundationä¸­è¾“å…¥æºåˆ™åˆ†ä¸ºéžåŸºäºŽç«¯å£çš„Source0å’ŒåŸºäºŽç«¯å£çš„Source1ï¼Œåˆ†åˆ«å¯¹åº”Custom Input Sourceså’ŒPort-Based Sourcesï¼ŒCocoa Perform Selector Sourcesæ˜¯Perform Selectorç³»åˆ—æ–¹æ³•åˆ›å»ºçš„æºï¼ŒPerform Selectorå»¶è¿Ÿæ´¾å‘æ—¶åˆ›å»ºçš„æ˜¯å®šæ—¶æºï¼Œæ´¾å‘ç»™å…¶ä»–çº¿ç¨‹æˆ–å½“å‰çº¿ç¨‹å¼‚æ­¥æ´¾å‘æ—¶åˆ›å»ºçš„Source0ï¼ŒPerform Selectoråˆ›å»ºçš„æºï¼Œåœ¨æ‰§è¡Œå®ŒåŽä¼šè‡ªåŠ¨ä»ŽRunLoopä¸­ç§»é™¤ã€‚ Source0ï¼šåªåŒ…å«ä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œéœ€è¦åº”ç”¨æ‰‹åŠ¨è§¦å‘ï¼Œä¸èƒ½ä¸»åŠ¨å”¤é†’RunLoopï¼Œä½¿ç”¨æ—¶éœ€è¦å…ˆè°ƒç”¨CFRunLoopSourceSignal(source)ï¼Œå°†Sourceæ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œå†æ‰‹åŠ¨è°ƒç”¨CFRunLoopWakeUp(runloop)ï¼Œå”¤é†’RunLoopå¤„ç†Sourceçš„äº‹ä»¶ã€‚ Source1ï¼šåŒ…å«ä¸€ä¸ªmach_portå’Œä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œç”±mach_porté©±åŠ¨ï¼Œå¯ä»¥ä¸»åŠ¨å”¤é†’RunLoopï¼Œé€šå¸¸ç”¨äºŽé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹äº’ç›¸å‘é€æ¶ˆæ¯ã€‚ CFRunLoopTimerRefTimerå°±æ˜¯å®šæ—¶æºï¼Œæ˜¯RunLoopçš„å¦ä¸€ä¸ªäº‹ä»¶æºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸ºModeæ·»åŠ Timerï¼Œæ¥ä¸ºRunLoopæ·»åŠ éœ€è¦å¤„ç†çš„äº‹ä»¶ã€‚CFRunLoopTimerRefåŒ…å«ä¸€ä¸ªæ—¶é—´é•¿åº¦å’Œä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå®ƒä¸ŽNSTimeræ˜¯toll-free bridgedçš„ï¼Œå¯ä»¥æ··ç”¨ã€‚å½“TimeråŠ å…¥åˆ°RunLoopä¹‹åŽï¼Œä¼šåŸºäºŽXNUå†…æ ¸çš„mk_timeræˆ–GCDè®¡æ—¶å™¨ï¼ˆæ ¹æ®CoreFoundationçš„ç‰ˆæœ¬ä¸åŒè€Œä¸åŒï¼‰ï¼Œåœ¨è®¡ç®—å¥½çš„é¢„è®¾æ—¶é—´ç‚¹ç”±å†…æ ¸å‘é€é€šçŸ¥ï¼Œå”¤é†’RunLoopå¤„ç†Timerçš„äº‹ä»¶ã€‚ CFRunLoopObserverRefObserveræ˜¯RunLoopçš„è§‚å¯Ÿè€…ï¼ŒåŒ…å«ä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå½“RunLoopè¿è¡Œåˆ°ç‰¹å®šçŠ¶æ€æ—¶ä¼šè§¦å‘å›žè°ƒï¼Œå¹¶å°†çŠ¶æ€ä¼ é€’ç»™å›žè°ƒå‡½æ•°ï¼Œä¼šè§¦Observerå›žè°ƒçš„çŠ¶æ€åŒ…æ‹¬ï¼š 12345678typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // å³å°†è¿›å…¥å¾ªçŽ¯ kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // å³å°†å¤„ç† Timer kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // å³å°†å¤„ç† Source kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), // åˆšä»Žä¼‘çœ ä¸­å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7), // å³å°†é€€å‡ºå¾ªçŽ¯&#125;; 4.RunLoopçš„æ ¸å¿ƒé€»è¾‘CoreFoundationçš„ç‰ˆæœ¬ä¸åŒï¼ŒRunLoopçš„æ ¸å¿ƒæºç å¯èƒ½ä¸ä¸€è‡´ï¼Œä½†é€»è¾‘ä¸ä¼šæœ‰å¤ªå¤§çš„å‡ºå…¥ï¼Œæ•´ä½“å¯ä»¥å‚è€ƒä»¥ä¸‹å¯¹CoreFoundation CF-855.17ç‰ˆæœ¬æºç åˆ å‡åŽçš„é€»è¾‘æ•´ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201/// å…¬å¼€æŽ¥å£ä¸€ï¼šç”¨DefaultModeå¯åŠ¨void CFRunLoopRun(void) &#123; /* DOES CALLOUT */ int32_t result; do &#123; result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false); &#125; while (kCFRunLoopRunStopped != result &amp;&amp; kCFRunLoopRunFinished != result);&#125;/// å…¬å¼€æŽ¥å£äºŒï¼šç”¨æŒ‡å®šçš„Modeå¯åŠ¨ï¼ˆå…è®¸è®¾ç½®RunLoopè¶…æ—¶æ—¶é—´ï¼‰SInt32 CFRunLoopRunInMode(CFStringRef modeName, CFTimeInterval seconds, Boolean returnAfterSourceHandled) &#123; /* DOES CALLOUT */ return CFRunLoopRunSpecific(CFRunLoopGetCurrent(), modeName, seconds, returnAfterSourceHandled);&#125;/// RunLoopçš„å®žçŽ°SInt32 CFRunLoopRunSpecific(CFRunLoopRef rl, CFStringRef modeName, CFTimeInterval seconds, Boolean returnAfterSourceHandled) &#123; /* DOES CALLOUT */ if (__CFRunLoopIsDeallocating(rl)) return kCFRunLoopRunFinished; /// é¦–å…ˆæ ¹æ®modeNameæ‰¾åˆ°å¯¹åº”mode CFRunLoopModeRef currentMode = __CFRunLoopFindMode(rl, modeName, false); /// å¦‚æžœmodeé‡Œæ²¡æœ‰source/timer/observer, ç›´æŽ¥è¿”å›žã€‚ if (NULL == currentMode || __CFRunLoopModeIsEmpty(rl, currentMode, rl-&gt;_currentMode)) &#123; Boolean did = false; return did ? kCFRunLoopRunHandledSource : kCFRunLoopRunFinished; &#125; CFRunLoopModeRef previousMode = rl-&gt;_currentMode; rl-&gt;_currentMode = currentMode; int32_t result = kCFRunLoopRunFinished; /// 1. é€šçŸ¥ Observers: RunLoop å³å°†è¿›å…¥ loopã€‚ if (currentMode-&gt;_observerMask &amp; kCFRunLoopEntry ) __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopEntry); result = __CFRunLoopRun(rl, currentMode, seconds, returnAfterSourceHandled, previousMode); /// 10. é€šçŸ¥ Observers: RunLoop å³å°†é€€å‡ºã€‚ if (currentMode-&gt;_observerMask &amp; kCFRunLoopExit ) __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit); rl-&gt;_currentMode = previousMode; return result;&#125;/// å†…éƒ¨æ ¸å¿ƒå‡½æ•°ï¼Œè¿›å…¥loopstatic int32_t __CFRunLoopRun(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFTimeInterval seconds, Boolean stopAfterHandle, CFRunLoopModeRef previousMode) &#123; /// å¦‚æžœå½“å‰æ˜¯ä¸»çº¿ç¨‹RunLoopï¼Œä¸”å½“å‰modeçš„ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œä¼šåˆ†å‘ä¸€ä¸ªGCDç«¯å£ï¼ˆç”¨äºŽç¬¬5æ­¥ï¼‰ mach_port_name_t dispatchPort = MACH_PORT_NULL; Boolean libdispatchQSafe = pthread_main_np() &amp;&amp; ((HANDLE_DISPATCH_ON_BASE_INVOCATION_ONLY &amp;&amp; NULL == previousMode) || (!HANDLE_DISPATCH_ON_BASE_INVOCATION_ONLY &amp;&amp; 0 == _CFGetTSD(__CFTSDKeyIsInGCDMainQ))); if (libdispatchQSafe &amp;&amp; (CFRunLoopGetMain() == rl) &amp;&amp; CFSetContainsValue(rl-&gt;_commonModes, rlm-&gt;_name)) dispatchPort = _dispatch_get_main_queue_port_4CF(); /// ç»™å½“å‰æ¨¡å¼åˆ†å‘GCDå®šæ—¶ç«¯å£ mach_port_name_t modeQueuePort = MACH_PORT_NULL; if (rlm-&gt;_queue) &#123; modeQueuePort = _dispatch_runloop_root_queue_get_port_4CF(rlm-&gt;_queue); if (!modeQueuePort) &#123; CRASH("Unable to get port for run loop mode queue (%d)", -1); &#125; &#125; /// åˆå§‹åŒ–ä¸€ä¸ªGCDè®¡æ—¶å™¨ï¼Œç”¨äºŽç¬¬7æ­¥å¯¹RunLoopè¿›è¡Œè¶…æ—¶å”¤é†’ dispatch_source_t timeout_timer = NULL; struct __timeout_context *timeout_context = (struct __timeout_context *)malloc(sizeof(*timeout_context)); if (seconds &lt;= 0.0) &#123; // instant timeout seconds = 0.0; timeout_context-&gt;termTSR = 0ULL; &#125; else if (seconds &lt;= TIMER_INTERVAL_LIMIT) &#123; dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, DISPATCH_QUEUE_OVERCOMMIT); timeout_timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue); dispatch_retain(timeout_timer); timeout_context-&gt;ds = timeout_timer; timeout_context-&gt;rl = (CFRunLoopRef)CFRetain(rl); timeout_context-&gt;termTSR = startTSR + __CFTimeIntervalToTSR(seconds); dispatch_set_context(timeout_timer, timeout_context); // source gets ownership of context dispatch_source_set_event_handler_f(timeout_timer, __CFRunLoopTimeout); dispatch_source_set_cancel_handler_f(timeout_timer, __CFRunLoopTimeoutCancel); uint64_t ns_at = (uint64_t)((__CFTSRToTimeInterval(startTSR) + seconds) * 1000000000ULL); dispatch_source_set_timer(timeout_timer, dispatch_time(1, ns_at), DISPATCH_TIME_FOREVER, 1000ULL); dispatch_resume(timeout_timer); &#125; else &#123; // infinite timeout seconds = 9999999999.0; timeout_context-&gt;termTSR = UINT64_MAX; &#125; Boolean didDispatchPortLastTime = true; int32_t retVal = 0; do &#123; uint8_t msg_buffer[3 * 1024]; mach_msg_header_t *msg = NULL; mach_port_t livePort = MACH_PORT_NULL; __CFPortSet waitSet = rlm-&gt;_portSet; /// 2. é€šçŸ¥ Observers: RunLoopå¼€å§‹å¤„ç†Timer __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeTimers); /// 3. é€šçŸ¥ Observers: RunLoopå³å°†å¤„ç†Source0(éžport)å›žè°ƒ __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeSources); /// æ‰§è¡Œå¯èƒ½å³æ—¶æäº¤åˆ°é˜Ÿåˆ—ä¸­çš„block __CFRunLoopDoBlocks(rl, rlm); /// 4. å¤„ç†Source0 Boolean sourceHandledThisLoop = __CFRunLoopDoSources0(rl, rlm, stopAfterHandle); /// å¦‚æžœSource0ä¸­æœ‰å¾…å¤„ç†çš„äº‹ä»¶ï¼Œæ‰§è¡ŒSource0æäº¤åˆ°é˜Ÿåˆ—ä¸­çš„block if (sourceHandledThisLoop) &#123; __CFRunLoopDoBlocks(rl, rlm); &#125; /// æ ‡å¿—æ˜¯å¦ç­‰å¾…ç«¯å£å”¤é†’ Boolean poll = sourceHandledThisLoop || (0ULL == timeout_context-&gt;termTSR); /// 5. å¦‚æžœæ˜¯ä¸»çº¿ç¨‹ï¼ˆdispatchPortæ˜¯ä¸»çº¿ç¨‹æ‰ä¼šè¢«èµ‹å€¼ï¼‰åœ¨è¿›å…¥ä¼‘çœ å‰ä¼šæ£€æŸ¥æ˜¯å¦æœ‰é€šè¿‡GCDæ´¾å‘è¿‡æ¥çš„Source1ï¼Œå¦‚æžœæœ‰ï¼Œè·³è¿‡ä¼‘çœ åˆ°ç¬¬9æ­¥è¿›è¡Œå¤„ç† if (MACH_PORT_NULL != dispatchPort &amp;&amp; !didDispatchPortLastTime) &#123; /// é¦–æ¬¡å¾ªçŽ¯æ˜¯ä¸ä¼šè¿›å…¥æ£€æŸ¥ï¼ˆdidDispatchPortLastTimeä¸ºtrueï¼‰ msg = (mach_msg_header_t *)msg_buffer; if (__CFRunLoopServiceMachPort(dispatchPort, &amp;msg, sizeof(msg_buffer), &amp;livePort, 0)) &#123; goto handle_msg; &#125; &#125; didDispatchPortLastTime = false; /// 6.é€šçŸ¥ Observers: RunLoopå³å°†è¿›å…¥ä¼‘çœ (sleep) __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeWaiting); __CFRunLoopSetSleeping(rl); /// 7. è°ƒç”¨mach_msgç­‰å¾…æŽ¥å—mach_portçš„æ¶ˆæ¯ï¼Œçº¿ç¨‹å°†è¿›å…¥ä¼‘çœ , ç›´åˆ°è¢«ä¸‹é¢æŸä¸€ä¸ªäº‹ä»¶å”¤é†’ï¼š /// â€¢ æŸä¸ªåŸºäºŽportçš„Source1æœ‰æ¶ˆæ¯åˆ°è¾¾ /// â€¢ æŸä¸ªTimerçš„æ—¶é—´åˆ°äº† /// â€¢ RunLoopä¸ºè‡ªèº«è®¾å®šçš„è¶…æ—¶æ—¶é—´åˆ°äº† /// â€¢ è¢«å…¶ä»–è°ƒç”¨è€…æ‰‹åŠ¨æ˜¾å¼å”¤é†’ msg = (mach_msg_header_t *)msg_buffer; __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort, poll ? 0 : TIMEOUT_INFINITY); __CFRunLoopUnsetSleeping(rl); /// 8. é€šçŸ¥ Observers: RunLoopçš„çº¿ç¨‹åˆšåˆšè¢«å”¤é†’äº†ã€‚ __CFRunLoopDoObservers(rl, rlm, kCFRunLoopAfterWaiting); /// äº‹ä»¶å¤„ç†çš„è·³è½¬æ ‡å‡† handle_msg: /// 9. å¤„ç†æœªå¤„ç†çš„äº‹ä»¶ if (MACH_PORT_NULL == livePort) &#123; /// æ— ç«¯å£å”¤é†’ï¼ŒRunLoopæ­£å¸¸è¿è¡Œä¸ä¼šæœ‰æ­¤æƒ…å†µ CFRUNLOOP_WAKEUP_FOR_NOTHING(); &#125; else if (livePort == rl-&gt;_wakeUpPort) &#123; /// è¢«è‡ªèº«çš„CGDè¶…æ—¶è®¡æ—¶å™¨å”¤é†’ï¼Œæ— éœ€åšä»»ä½•å¤„ç† CFRUNLOOP_WAKEUP_FOR_WAKEUP(); &#125; else if (modeQueuePort != MACH_PORT_NULL &amp;&amp; livePort == modeQueuePort) &#123; /// è¢«å®šæ—¶å™¨é€šçŸ¥å”¤é†’ï¼Œå¤„ç†å®šæ—¶å™¨äº‹ä»¶ if (!__CFRunLoopDoTimers(rl, rlm, mach_absolute_time())) &#123; __CFArmNextTimerInMode(rlm, rl); &#125; &#125; else if (livePort == dispatchPort) &#123; /// ä¸»çº¿ç¨‹è¢«GCDæ´¾å‘çš„äº‹ä»¶å”¤é†’ï¼Œæˆ–ç”±ç¬¬5æ­¥ç›´æŽ¥è·³è½¬è¿‡æ¥ï¼Œå¤„ç†æ´¾å‘çš„äº‹ä»¶ CFRUNLOOP_WAKEUP_FOR_DISPATCH(); __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg); &#125; else &#123; /// è¢«source1å”¤é†’,å¤„ç†Source1 CFRUNLOOP_WAKEUP_FOR_SOURCE(); mach_msg_header_t *reply = NULL; sourceHandledThisLoop = __CFRunLoopDoSource1(rl, rlm, rls, msg, msg-&gt;msgh_size, &amp;reply) || sourceHandledThisLoop; &#125; /// æ‰§è¡Œä»¥ä¸Šå„ç±»äº‹ä»¶æ—¶åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­çš„block __CFRunLoopDoBlocks(rl, rlm); /// è·³å‡ºå¾ªçŽ¯ï¼Œåœæ­¢RunLoopçš„å„ç±»æƒ…å†µ if (sourceHandledThisLoop &amp;&amp; stopAfterHandle) &#123; /// å¯åŠ¨RunLoopæ—¶å³æŒ‡æ˜Žå¤„ç†å®Œäº‹ä»¶å°±è¿”å›ž retVal = kCFRunLoopRunHandledSource; &#125; else if (timeout_context-&gt;termTSR &lt; mach_absolute_time()) &#123; /// RunLoopè¿è¡Œè¶…è¿‡å¯åŠ¨æ—¶æŒ‡æ˜Žçš„è¶…æ—¶æ—¶é—´ retVal = kCFRunLoopRunTimedOut; &#125; else if (__CFRunLoopIsStopped(rl)) &#123; /// è¢«å¤–éƒ¨è°ƒç”¨è€…æ‰‹åŠ¨ç»ˆæ­¢äº†RunLoop __CFRunLoopUnsetStopped(rl); retVal = kCFRunLoopRunStopped; &#125; else if (rlm-&gt;_stopped) &#123; /// RunLoopè¢«æ ‡è®°ä¸ºå·²åœæ­¢äº† rlm-&gt;_stopped = false; retVal = kCFRunLoopRunStopped; &#125; else if (__CFRunLoopModeIsEmpty(rl, rlm, previousMode)) &#123; /// å½“å‰Modeä¸­Source/Timer/Observeréƒ½è¢«ç§»é™¤äº† retVal = kCFRunLoopRunFinished; &#125; &#125; while (0 == retVal); /// é‡Šæ”¾RunLoopè‡ªèº«çš„è¶…æ—¶GCDè®¡æ—¶å™¨ if (timeout_timer) &#123; dispatch_source_cancel(timeout_timer); dispatch_release(timeout_timer); &#125; else &#123; free(timeout_context); &#125; return retVal;&#125; å€¼å¾—ä¸€æçš„æ˜¯CF-855.17ç‰ˆæœ¬æ˜¯CoreFoundationä½¿ç”¨mk_timerå’ŒGCDè®¡æ—¶å™¨çš„ä¸€ä¸ªè¿‡æ¸¡ç‰ˆæœ¬ï¼Œæºç ä¸­æœ‰åˆ†ä½¿ç”¨mk_timerå’ŒGCDè®¡æ—¶å™¨çš„æ¡ä»¶ç¼–è¯‘ï¼Œä»¥ä¸Šä»£ç é€»è¾‘çš„æ•´ç†ä¸­ï¼Œåªå‚ç…§äº†ä½¿ç”¨GCDè®¡æ—¶å™¨çš„æºç ã€‚ å¯¹RunLoopæ ¸å¿ƒä»£ç é€»è¾‘çš„å…³é”®æµç¨‹æ¦‚è¿°å¦‚ä¸‹ï¼š é€šçŸ¥Observerï¼šRunLoopè¿›å…¥Loopï¼› é€šçŸ¥Observerï¼šRunLoopå¼€å§‹å¤„ç†Timerï¼› é€šçŸ¥Observerï¼šRunLoopå³å°†å¤„ç†Source0ï¼› æ‰§è¡ŒSource0åŠ å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­çš„Blockï¼› å¦‚æžœæ˜¯ä¸»çº¿ç¨‹RunLoopï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é€šè¿‡GCDæ´¾å‘ç»™ä¸»çº¿ç¨‹çš„å¾…å¤„ç†çš„Source1ï¼š æ²¡æœ‰ï¼šç»§ç»­ä¸‹ä¸€æ­¥ï¼› æœ‰ï¼šè·³åˆ°ç¬¬9æ­¥åŽ»å¤„ç†Source1ï¼› é€šçŸ¥Observerï¼šRunLoopå³å°†è¿›å…¥ä¼‘çœ ï¼› ä¼‘çœ ï¼Œç­‰å¾…è¢«å”¤é†’ï¼š æŸä¸ªåŸºäºŽportçš„Source1æœ‰æ¶ˆæ¯åˆ°è¾¾ï¼› æŸä¸ªTimerçš„æ—¶é—´åˆ°äº†ï¼› RunLoopä¸ºè‡ªèº«è®¾å®šçš„è¶…æ—¶æ—¶é—´åˆ°äº†ï¼› è¢«å…¶ä»–è°ƒç”¨è€…æ‰‹åŠ¨æ˜¾å¼å”¤é†’ï¼› é€šçŸ¥Observerï¼šRunLoopåˆšè¢«å”¤é†’ï¼› å¼€å§‹å¤„ç†æœªå¤„ç†çš„äº‹ä»¶ï¼š è¶…æ—¶å”¤é†’ï¼Œä¸ç”¨åšä»»ä½•å¤„ç†ï¼› Timeråˆ°æ—¶äº†ï¼Œå¤„ç†Timerçš„äº‹ä»¶ï¼› å¦‚æžœæ˜¯ä¸»çº¿ç¨‹ï¼Œå¤„ç†GCDæ´¾å‘è¿‡æ¥çš„äº‹ä»¶ï¼› å¤„ç†åŸºäºŽportçš„Source1ï¼› é€šçŸ¥Observerï¼šå·²ç»é€€å‡ºLoopï¼› RunLoopçš„ä»£ç å†…éƒ¨æ˜¯ä¸€ä¸ªdo-whileå¾ªçŽ¯ï¼Œå¾ªçŽ¯çš„æ‰§è¡Œä¸Šè¿°æµç¨‹çš„ç¬¬2-9æ­¥ï¼Œä»¥ä¸‹æƒ…å†µä¼šå¯¼è‡´æ­¤æ¬¡æµç¨‹åŽè·³å‡ºå¾ªçŽ¯ï¼Œé€€å‡ºRunLoopï¼š å¯åŠ¨RunLoopæ—¶çš„å‚æ•°æŒ‡æ˜Žï¼šæ‰§è¡Œä¸€éäº‹ä»¶å¤„ç†æµç¨‹å°±é€€å‡ºå¾ªçŽ¯ï¼› è¶…è¿‡äº†å¯åŠ¨RunLoopæ—¶æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ï¼› è¢«å¤–éƒ¨è°ƒç”¨è€…æ‰‹åŠ¨æ˜¾å¼çš„ç»ˆæ­¢äº†RunLoopï¼› RunLoopè¢«æ ‡è®°ä¸ºå·²åœæ­¢ï¼ˆ_stoppedï¼‰äº†ï¼› å½“å‰Modeä¸­Source/Timer/Observeréƒ½è¢«ç§»é™¤äº†; RunLoopåœ¨éœ€è¦æ—¶è¢«å”¤é†’ï¼Œåœ¨ä¸éœ€è¦æ—¶è¿›è¡Œä¼‘çœ ï¼Œå…¶åŽŸç†æ˜¯é€šè¿‡mach_msg( )è°ƒç”¨äº†ä¸€ä¸ªMaché™·é˜±ï¼šmach_msg_trap( )ï¼Œå°†çº¿ç¨‹ç”±ç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼Œåœ¨å†…æ ¸æ€ä¸‹ç­‰å¾…æ¶ˆæ¯ï¼Œå½“æœ‰æ¶ˆæ¯åˆ°è¾¾æ—¶åˆè¿”å›žç”¨æˆ·æ€è¿›è¡Œå¤„ç†ï¼Œå…¶é€»è¾‘ç¤ºæ„å¦‚å›¾ï¼š 5.ç³»ç»Ÿä¸­å¯¹RunLoopçš„åº”ç”¨Perform SelectorPerform Selectorç³»åˆ—æ–¹æ³•å»¶è¿Ÿæ´¾å‘åˆ›å»ºçš„æ˜¯å®šæ—¶æºï¼Œæ´¾å‘ç»™å…¶ä»–çº¿ç¨‹æˆ–å½“å‰çº¿ç¨‹å¼‚æ­¥æ´¾å‘æ—¶åˆ›å»ºçš„Source0ï¼Œå†æ·»åŠ åˆ°æŒ‡å®šçº¿ç¨‹çš„RunLoopä¸­ã€‚æ‰€ä»¥å¦‚æžœä½¿ç”¨Perform Selectorå»¶è¿Ÿæ´¾å‘ã€æ´¾å‘ç»™å…¶ä»–çº¿ç¨‹ã€ä»¥åŠå½“å‰çº¿ç¨‹å¼‚æ­¥æ´¾å‘æ—¶ï¼Œè¦æ³¨æ„åˆ¤æ–­ç›®æ ‡çº¿ç¨‹çš„RunLoopæ˜¯å¦åœ¨è¿è¡Œï¼Œå¦‚æžœæœªè¿è¡Œåˆ™æ´¾å‘çš„ä»»åŠ¡å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚ GCDä½¿ç”¨GCDä¸ºä¸»çº¿ç¨‹æ´¾å‘ä»»åŠ¡ï¼Œä¼šå”¤é†’ä¸»çº¿ç¨‹RunLoopï¼Œå¹¶å¯¹æ´¾å‘çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œåœ¨æ¯æ¬¡ä¸»çº¿ç¨‹RunLoopä¼‘çœ å‰ï¼Œè¿˜ä¼šæ£€æŸ¥æ˜¯å¦æœ‰GCDæ´¾å‘è¿‡æ¥çš„äº‹ä»¶ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™ä¼šè·³è¿‡ä¼‘çœ ï¼Œå¼€å§‹å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚ä½†ä»¥ä¸ŠRunLoopä¸­çš„é€»è¾‘ï¼Œä»…é™äºŽä¸»çº¿ç¨‹ä¸­çš„RunLoopï¼Œé€šè¿‡GCDä¸ºå…¶ä»–çº¿ç¨‹æ´¾å‘çš„ä»»åŠ¡ï¼Œåˆ™æ˜¯ç”±libDispatchå¤„ç†ï¼Œæ‰€ä»¥GCDå°†ä»»åŠ¡æ´¾å‘ç»™å­çº¿ç¨‹æ—¶ï¼Œä¹Ÿä¸éœ€è¦å­çº¿ç¨‹çš„RunLoopå¤„äºŽè¿è¡ŒçŠ¶æ€ã€‚ UIEventç³»ç»Ÿä¸ºAPPæ³¨å†Œäº†ä¸€ä¸ªSource1ç”¨æ¥æŽ¥æ”¶æ“ä½œç³»ç»Ÿçš„äº‹ä»¶ã€‚å½“ä¸€ä¸ªç¡¬ä»¶äº‹ä»¶ï¼ˆè§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰ï¼‰å‘ç”ŸåŽï¼Œå…ˆç”±IOKit.frameworkç”Ÿæˆä¸€ä¸ªIOHIDEventï¼Œå¹¶ç”±SpringBoardæŽ¥æ”¶ï¼ŒSpringBoardå†é€šè¿‡mach_portè½¬å‘ç»™éœ€è¦çš„APPï¼›APPä¸­ç³»ç»Ÿæ³¨å†Œçš„é‚£ä¸ªSource1æŽ¥æ”¶åˆ°mach_portä¸­ä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯åŽï¼Œå”¤é†’ä¸»çº¿ç¨‹RunLoopï¼Œåœ¨å…¶å›žè°ƒä¸­è°ƒç”¨_UIApplicationHandleEventQueue( )è¿›è¡ŒAPPå†…éƒ¨çš„åˆ†å‘ï¼›_UIApplicationHandleEventQueue( )ä¸­ä¼šæŠŠIOHIDEventåŒ…è£…æˆUIEventï¼Œå†é€šè¿‡APPçš„å“åº”é“¾ä¼ é€’ç»™å¯¹åº”çš„å“åº”è€…ã€‚ NSTimerNSTimerå…¶å®žå°±æ˜¯CFRunLoopTimerRefï¼Œä»–ä»¬ä¹‹é—´æ˜¯toll-free bridgedçš„ï¼ˆToll-Free Bridged Typesï¼‰ã€‚æ ¹æ®ç‰ˆæœ¬ä¸åŒRunLoopçš„Timerå¯èƒ½åŸºäºŽå†…æ ¸çš„mk_timeræˆ–è€…GCDçš„timeræ¥å®žçŽ°çš„ï¼ŒTimerå¹¶ä¸æ˜¯ç»å¯¹å‡†æ—¶çš„ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªå®½å®¹åº¦ï¼ˆToleranceï¼‰ï¼Œå®žé™…æ‰§è¡Œçš„æ—¶é—´å¯èƒ½åœ¨è¿™ä¸ªå®½å®¹åº¦å…è®¸çš„è¯¯å·®ä¹‹å†…ï¼Œå¦‚æžœå› ä¸ºæ‰§è¡Œé˜Ÿåˆ—ä¸­å…¶ä»–äº‹ä»¶é€ æˆæ—¶é—´è¶…è¿‡äº†å®½å®¹åº¦æ‰€å…è®¸çš„è¯¯å·®ï¼Œé‚£ä¹ˆè¿™æ¬¡Timerçš„blockä¸ä¼šå»¶åŽæ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¢«è·³è¿‡ã€‚ NSTimeré»˜è®¤æ˜¯æ·»åŠ åˆ°RunLoopçš„kCFRunLoopDefaultModeä¸­çš„ï¼Œå¦‚æžœéœ€è¦NSTimeråœ¨RunLoopåˆ‡æ¢ä¸ºå…¶ä»–Modeè¿è¡Œæ—¶ä¹Ÿä¼šæ­£ç¡®è§¦å‘ï¼Œéœ€è¦é€šè¿‡kCFRunLoopCommonModesæ¥æ·»åŠ NSTimerã€‚ AutoreleasePoolAPPå¯åŠ¨åŽï¼Œç³»ç»Ÿä¸ºä¸»çº¿ç¨‹RunLoopæ³¨å†Œäº†ä¸¤ä¸ªObserveræ¥ç®¡ç†ä¸»çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼š ç¬¬ä¸€ä¸ªObserveråªè§‚å¯ŸkCFRunLoopEntryï¼šåœ¨å…¶å›žè°ƒä¸­è°ƒç”¨_objc_autoreleasePoolPush( )åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼› ç¬¬äºŒä¸ªObserverè§‚å¯Ÿä¸¤ä¸ªäº‹ä»¶ï¼šåœ¨å…¶å›žè°ƒä¸­è§‚å¯Ÿåˆ°kCFRunLoopBeforWaitingï¼Œä¼šè°ƒç”¨_objc_autoreleasePoolPop( )ï¼Œå†è°ƒç”¨_objc_autoreleasePoolPush( )ï¼Œä»¥é‡Šæ”¾æ—§æ± å¹¶åˆ›å»ºæ–°æ± ï¼›å›žè°ƒä¸­è§‚å¯Ÿåˆ°kCFRunLoopExitï¼Œä¼šè°ƒç”¨_objc_autoreleasePoolPop( )æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ï¼› å­çº¿ç¨‹ä¸­çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¼šåœ¨ä½¿ç”¨æ—¶æ‡’åŠ è½½ï¼Œåœ¨çº¿ç¨‹é€€å‡ºæ—¶é‡Šæ”¾ï¼Œæ‰€ä»¥ä¸€èˆ¬å­çº¿ç¨‹ä¸­ä¹Ÿæ— éœ€è€ƒè™‘å†…å­˜è‡ªåŠ¨é‡Šæ”¾çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æžœé€šè¿‡è¿è¡Œå­çº¿ç¨‹çš„RunLoopæ¥è®©å­çº¿ç¨‹å¸¸é©»ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘ä¸ºæŸäº›è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± æ¥é¿å…å†…å­˜æ³„æ¼ã€‚ UIKitå½“æ›´æ”¹äº†UIä¹‹åŽï¼Œæ¯”å¦‚æ”¹å˜äº†Frameã€æ›´æ–°äº†UIView/CALayerçš„å±‚æ¬¡ã€æˆ–æ‰‹åŠ¨è°ƒç”¨äº†UIView/CALayerçš„setNeedsLayout/setNeedsDisplayç­‰ï¼Œè¿™ä¸ªUIView/CALayerä¼šè¢«æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç„¶åŽæäº¤åˆ°ä¸€ä¸ªå…¨å±€å®¹å™¨ä¸­åŽ»ã€‚ç³»ç»Ÿä¸ºä¸»çº¿ç¨‹æ³¨å†Œäº†ä¸€ä¸ªObserveræ¥åˆ·æ–°UIï¼Œåœ¨å…¶å›žè°ƒä¸­ï¼Œå½“è§‚å¯Ÿåˆ°kCFRunLoopBeforWaitingå’ŒkCFRunLoopExitæ—¶ï¼Œä¼šè°ƒç”¨ä¸€ä¸ªå‡½æ•°åŽ»éåŽ†æ‰€æœ‰å¾…å¤„ç†çš„UIView/CALayerï¼Œä¸ºå®ƒä»¬æ‰§è¡Œå®žé™…çš„ç»˜åˆ¶å’Œè°ƒæ•´ï¼Œæ¥å®Œæˆç•Œé¢çš„åˆ·æ–°ã€‚ NSURLConnectionä¸ŽNSURLSessionNSURLConnectionå·²ç»è¢«NSURLSessionå–ä»£ï¼Œä½†åº•å±‚çš„éƒ¨åˆ†é€»è¾‘å´åœ¨æ²¿ç”¨ï¼ŒåŒæ—¶NSURLConnectionå¯¹RunLoopçš„è¿ç”¨ä¹Ÿå¯ä½œä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹è®¾è®¡çš„å‚è€ƒï¼šå¼€å§‹ç½‘ç»œä»»åŠ¡æ—¶ï¼Œä¼šä¸ºNSURLConnectionè®¾ç½®ä¸€ä¸ªdelegateï¼Œé™¤äº†è¿™ä¸ªå¼€å§‹ä»»åŠ¡æ—¶çš„delegateçº¿ç¨‹ï¼ŒNSURLConnectionåˆæ³¨å†Œäº†ä¸¤ä¸ªæ–°çº¿ç¨‹com.apple.NSURLConnectionLoaderå’Œcom.apple.CFSocket.privateï¼Œä¸‰ä¸ªçº¿ç¨‹é—´çš„æ¶ˆæ¯äº¤æµå¦‚å›¾æ‰€ç¤ºï¼š CFSocketçº¿ç¨‹è´Ÿè´£å¤„ç†åº•å±‚socketè¿žæŽ¥ï¼ŒNSURLConnectionLoaderåˆ™è´Ÿè´£å±…ä¸­è°ƒåº¦ã€‚å¼€å§‹ä¸€ä¸ªç½‘ç»œä»»åŠ¡æ—¶ï¼ŒNSURLConnectionåˆ›å»ºäº†4ä¸ªSource0ï¼Œå¹¶æ·»åŠ åˆ°äº†delegateçº¿ç¨‹RunLoopçš„DefaultModeä¸­ï¼ŒNSURLConnectionLoaderçº¿ç¨‹æœ¬èº«é€šè¿‡ä¸€ä¸ªSource1æ¥æŽ¥æ”¶åº•å±‚CFSocketçº¿ç¨‹æ ¹æ®ç½‘ç»œè¿žæŽ¥äº§ç”Ÿçš„é€šçŸ¥ï¼Œåœ¨NSURLConnectionLoaderçº¿ç¨‹çš„Source1å›žè°ƒä¸­ï¼Œåˆé€šè¿‡delegateçº¿ç¨‹çš„4ä¸ªSource0æŠŠç›¸å…³çš„é€šçŸ¥ä¼ é€’ç»™delegateçº¿ç¨‹ï¼Œåœ¨è¿™äº›Source0çš„å›žè°ƒä¸­å†æ‰§è¡ŒçœŸæ­£çš„delegateå›žè°ƒæ–¹æ³•ã€‚ 6.ä¸‰æ–¹åº“å¯¹RunLoopçš„åº”ç”¨AFNetworkingåœ¨AFNetworking2.xä¸­é€šè¿‡å¼€å¯å­çº¿ç¨‹çš„RunLoopæ¥åˆ›å»ºäº†ä¸€æ¡å¸¸é©»çº¿ç¨‹ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829+ (void)networkRequestThreadEntryPoint:(id)__unused object &#123; @autoreleasepool &#123; [[NSThread currentThread] setName:@"AFNetworking"]; NSRunLoop *runLoop = [NSRunLoop currentRunLoop]; [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode]; [runLoop run]; &#125;&#125; + (NSThread *)networkRequestThread &#123; static NSThread *_networkRequestThread = nil; static dispatch_once_t oncePredicate; dispatch_once(&amp;oncePredicate, ^&#123; _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil]; [_networkRequestThread start]; &#125;); return _networkRequestThread;&#125;- (void)start &#123; [self.lock lock]; if ([self isCancelled]) &#123; [self performSelector:@selector(cancelConnection) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]]; &#125; else if ([self isReady]) &#123; self.state = AFOperationExecutingState; [self performSelector:@selector(operationDidStart) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]]; &#125; [self.lock unlock];&#125; AFNetworking2.xæ˜¯åŸºäºŽNSURLConnectionçš„ï¼ŒAFNetworkingåœ¨å¸¸é©»å­çº¿ç¨‹ä¸­å¼‚æ­¥çš„startæ‰€æœ‰NSURLConnectionï¼Œä¹Ÿåœ¨æ­¤çº¿ç¨‹ä¸­æŽ¥æ”¶æ‰€æœ‰NSURLConnectionçš„delegateå›žè°ƒï¼Œæ‰€ä»¥éœ€è¦å­çº¿ç¨‹å¸¸é©»ã€‚ ç”±äºŽNSURLConnectionéœ€è¦delegateçº¿ç¨‹ä¿æŒæ´»è·ƒæ¥æŽ¥æ”¶å›žè°ƒï¼Œå¦‚æžœç»´æŒä¸€ä¸ªå¸¸é©»å­çº¿ç¨‹æ¥ç®¡ç†NSURLConnectionçš„ç½‘ç»œè¯·æ±‚åˆ™å¼€é”€å¤ªå¤§äº†ï¼Œåœ¨NSURLSessionä¸­å·²ç»æ”¹ä¸ºæŒ‡æ˜ŽdelegateQueueï¼ˆNSOperationQueueï¼‰æ¥å¤„ç†ç½‘ç»œå›žè°ƒï¼ŒAFNetworking3.xä¹‹åŽç½‘ç»œè¯·æ±‚æ”¹ä¸ºä½¿ç”¨NSURLSessionï¼Œæ‰€ä»¥ä¹Ÿä¸å†éœ€è¦å¸¸é©»å­çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œå›žè°ƒäº†ã€‚ å€¼å¾—ä¸€æçš„æ˜¯NSURLSessionçš„delegateQueueçš„maxConcurrentOperationCounté€šå¸¸éœ€è¦è®¾ä¸º1ï¼Œæ¥å°†ä»£ç†é˜Ÿåˆ—è®¾ç½®ä¸ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œè¿™æ˜¯å› ä¸ºå³ä½¿è®¾ç½®ä¸ºå¹¶å‘é˜Ÿåˆ—ï¼Œåœ¨å›žè°ƒä¸­é€šå¸¸ä¹Ÿéœ€è¦åŠ é”æ¥å¤„ç†ï¼Œå®žé™…ä¹Ÿæ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œç›´æŽ¥è®¾ç½®ä¸ºä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆ™æ— éœ€å†æ·»åŠ åŠ é”ç­‰æ“ä½œã€‚ ReactiveCocoaåœ¨RACçš„ä¸€ä¸ªTestingæ–¹æ³•ä¸­ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹æ³•æ¥ä½¿ç”¨RunLoopï¼š 123do &#123; [NSRunLoop.mainRunLoop runMode:NSDefaultRunLoopMode beforeDate:[NSDate dateWithTimeIntervalSinceNow:0.1]];&#125; while (!done); ä¸Šé¢ä»£ç æ˜¯ç”¨æ¥æ»¡è¶³RACå•å…ƒæµ‹è¯•æ—¶çš„éœ€æ±‚ï¼šçŸ­æš‚çš„è¿è¡Œèµ·ä¸»çº¿ç¨‹ï¼Œä»¥æŽ¥æ”¶é€šè¿‡ä¸»çº¿ç¨‹æ´¾å‘çš„RACSignalã€‚è¿™ç§åœ¨do-whileå¾ªçŽ¯ä¸­è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´æ¥è¿è¡ŒRunLoopçš„æ–¹å¼å€¼å¾—å‚è€ƒï¼Œåœ¨çŽ°åœ¨çš„ARCä¸‹ï¼Œå®ƒå…¶å®žèµ·åˆ°äº†å®šæ—¶é‡Šæ”¾æ—§æ± ï¼ˆè‡ªåŠ¨é‡Šæ”¾æ± ï¼‰å¹¶åˆ›å»ºæ–°æ± çš„ä½œç”¨ï¼ˆæ¯ä¸€æ¬¡å¾ªçŽ¯ï¼ŒARCä¼šè‡ªåŠ¨ä¸ºå…¶æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± çš„åˆ›å»ºä¸Žé‡Šæ”¾ï¼‰ã€‚ TextureTextureåŽŸåAsyncDisplayKitï¼Œæ˜¯ä¸€ä¸ªç•Œé¢æ€§èƒ½ä¼˜åŒ–æ¡†æž¶ï¼Œç›¸è¾ƒäºŽUIKitæŠŠç•Œé¢å…ƒç´ çš„åˆ›å»ºã€ç»˜åˆ¶ã€æ¸²æŸ“ã€é”€æ¯ç­‰ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸­é¡ºåºå®Œæˆï¼Œå®ƒæŠŠç•Œé¢æ˜¾ç¤ºçš„ç›¸å…³ä»»åŠ¡è¿›è¡Œäº†æ‹†åˆ†ï¼Œå†æŠŠå¯ä»¥æ”¾åˆ°å­çº¿ç¨‹çš„ä»»åŠ¡å¹¶å‘çš„æ‰§è¡Œï¼ŒæŠŠå¯ä»¥æŽ¨è¿Ÿçš„ä»»åŠ¡å»¶åŽæ‰§è¡Œï¼ŒæŠŠå¯ä»¥åˆå¹¶çš„ä»»åŠ¡åˆå¹¶æ˜¾ç¤ºï¼Œä»¥æ­¤æ¥ä¿è¯ç•Œé¢çš„æµç•…æ€§ã€‚ Textureä¸­ä¹Ÿæœ‰å¯¹RunLoopçš„ç›¸å…³åº”ç”¨ï¼Œç›¸å…³é€»è¾‘å¦‚å›¾æ‰€ç¤ºï¼š TextureæŠŠç•Œé¢å…ƒç´ ä¸­å¿…é¡»åœ¨ä¸»çº¿ç¨‹å®Œæˆçš„éƒ¨åˆ†ä»»åŠ¡ï¼Œå…ˆå°è£…åˆ°ä¸€ä¸ªå…¨å±€å®¹å™¨ä¸­ï¼Œç„¶åŽåœ¨ä¸»çº¿ç¨‹RunLoopä¸­æ³¨å†Œäº†ä¸€ä¸ªObserverï¼Œè§‚å¯Ÿçš„äº‹ä»¶å’ŒCoreAnimationçš„Observerè§‚å¯Ÿçš„äº‹ä»¶ç›¸åŒï¼škCFRunLoopBeforeWaitingå’ŒkCFRunLoopBeforeExitï¼Œä½†å›žè°ƒä¼˜å…ˆçº§ä½ŽäºŽCoreAnimationçš„å›žè°ƒï¼Œè¿™æ ·åœ¨RunLoopæ¯æ¬¡ä¼‘çœ å‰æˆ–é€€å‡ºæ—¶ï¼Œåœ¨CoreAnimationçš„å›žè°ƒå¤„ç†å®ŒæˆåŽï¼ŒTextureå†æ‰§è¡Œè‡ªå·±å…¨å±€å®¹å™¨ä¸­æäº¤çš„ä»»åŠ¡ï¼Œæ­¤æ—¶è¿™äº›å¿…é¡»åœ¨ä¸»çº¿ç¨‹å®Œæˆçš„ä»»åŠ¡éœ€è¦ä¾èµ–çš„ä»»åŠ¡ï¼Œä¾¿å¯èƒ½å·²ç»å¼‚æ­¥ã€å¹¶å‘çš„å®Œæˆï¼Œæ­¤å¤„Textureä¹Ÿå®Œæˆäº†å°†è¿™äº›å¼‚æ­¥ã€å¹¶å‘çš„æ“ä½œåŒæ­¥åˆ°ä¸»çº¿ç¨‹ä¸­åŽ»ã€‚]]></content>
      <categories>
        <category>APPå·¥ä½œåŽŸç†</category>
      </categories>
      <tags>
        <tag>RunLoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸‰ã€APPçš„ç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2F2018%2F02%2F17%2FAPP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F%E4%B8%89%E3%80%81APP%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%2F</url>
    <content type="text"><![CDATA[[TOC] Reference:appçš„ç”Ÿå‘½å‘¨æœŸios background modes åœ¨çŸ¥é“APPæ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­ä¿æŒä¸€ç›´è¿è¡ŒåŽä¹‹åŽï¼ŒæŽ¥ä¸‹æ¥éœ€è¦çŸ¥é“çš„æ˜¯APPè¿è¡Œæ—¶æœ‰å“ªäº›ä¸»è¦çš„çŠ¶æ€ï¼Œä»¥åŠè¿™äº›çŠ¶æ€æ˜¯å¦‚ä½•åˆ‡æ¢çš„ã€‚ ç®€è¿°åº”ç”¨ç¨‹åºæœ‰ Not Running(æœªè¿è¡Œ)ï¼ŒInactive(æœªæ¿€æ´»)ï¼ŒActive(æ¿€æ´»), Background(åŽå°)ï¼ŒSuspended(æŒ‚èµ·)äº”ä¸ªçŠ¶æ€ï¼Œå½“çŠ¶æ€å³å°†æ”¹å˜æˆ–å·²ç»æ”¹å˜æ—¶ï¼Œä¼šå‘é€ç›¸åº”é€šçŸ¥å¹¶åœ¨AppDelegateä¸­ä¼šæ‰§è¡Œç›¸åº”çš„å›žè°ƒï¼Œå¼€å‘ä¸­éœ€è¦è§†éœ€æ±‚ï¼Œåœ¨çŠ¶æ€å˜æ¢çš„å›žè°ƒæ–¹æ³•ä¸­ï¼Œæ·»åŠ ç›¸åº”çš„å¤„ç†ã€‚ æ¦‚è§ˆ è¦ç‚¹ Not Runningå’ŒSuspendedæ˜¯APPæœªè¿è¡Œæ—¶çš„ä¸¤ç§çŠ¶æ€ï¼Œåœ¨APPçš„æŠ½è±¡å¯¹è±¡UIApplicationçš„çš„applicationStateä¸­æ²¡æœ‰è¿™ä¸¤ç§çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰ç›¸åº”çš„é€šçŸ¥å’ŒAppDelegateå›žè°ƒï¼› éœ€è¦æ³¨æ„åŒºåˆ†APPåœ¨åˆšå¯åŠ¨å’Œè¿”å›žå‰å°æ—¶åˆ†åˆ«è§¦å‘çš„applicationDidBecomeActive:ï¼› APPè¿›å…¥åŽå°å‰ä¼šå…ˆè¿›å…¥æœªæ¿€æ´»çŠ¶æ€applicationWillResignActive:ï¼› ä¸€èˆ¬çš„APP(æ²¡æœ‰ç‰¹æ®ŠBackground Modesçš„APP)è¿›å…¥åŽå°æœ‰5sæ—¶é—´æ‰§è¡Œä»£ç ï¼Œä¹‹åŽä¼šè¢«æŒ‚èµ·ï¼› è¿›å…¥åŽå°åŽé€šè¿‡beginBackgroundTaskWithExpirationHandler:å¯ç”³è¯·180sçš„æ—¶é—´ ç”³è¯·åŽå°ä»»åŠ¡éœ€å’Œç»“æŸåŽå°ä»»åŠ¡endBackgroundTask:éœ€æˆå¯¹å‡ºçŽ°ï¼› æŒ‚èµ·çš„APPä¾ç„¶åœ¨å†…å­˜ä¸­ï¼Œä½†å¯èƒ½è¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œå†…å­˜ä¸è¶³æ—¶ç³»ç»Ÿä¼˜å…ˆæ¸…ç†å†…å­˜å¤§çš„æŒ‚èµ·APPï¼› APPå°†è¦è¢«ç»ˆæ­¢(éžå´©æºƒ)æ—¶ä¼šè°ƒç”¨applicationWillTerminate:ï¼Œæœ‰5sçš„ä»»åŠ¡æ‰§è¡Œæ—¶é—´ã€‚ è¯¦ç»†APPå¼€å§‹è¿è¡Œä¹‹åŽä¼šæ ¹æ®é…ç½®æ–‡ä»¶info.pliståˆ›å»ºAPPçš„æŠ½è±¡å¯¹è±¡â€“UIApplicationï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œå…¨å•ä¾‹ï¼Œåœ¨è¿è¡ŒæœŸé—´æœ‰ä¸”åªä¼šæœ‰ä¸€ä¸ªï¼ŒNot Runningå’ŒSuspendedæ˜¯APPè¿è¡ŒæœŸä¹‹å¤–çš„çŠ¶æ€ï¼ŒUIApplicationå¯¹è±¡çš„applicationStateå±žæ€§ä¸­è¿è¡Œæ—¶çš„ä¸‰ç§çŠ¶æ€ï¼šactiveã€inactiveå’Œbackgroundï¼Œå½“APPè¿è¡Œæ—¶çš„çŠ¶æ€å°†è¦æˆ–å·²ç»å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå‘é€é€šçŸ¥å¹¶é€šè¿‡ä»£ç†æ¨¡å¼å›žè°ƒAppDelegateä¸­çš„æ–¹æ³•ï¼Œç”±é€šçŸ¥æŽ¥å—è€…æˆ–AppDelegateåšç›¸åº”çš„å¤„ç†ã€‚ ApplicationStateAPPæœªè¿è¡Œæ—¶çš„ä¸¤ç§çŠ¶æ€Not Runningå’ŒSuspendedå¯¹äºŽç¼–ç¨‹æ²¡å¤šå°‘æ„ä¹‰ï¼Œéœ€è¦å…³å¿ƒçš„æ­£æ˜¯UIApplicationå¯¹è±¡ä¸­applicationStateçš„çŠ¶æ€åˆ‡æ¢ï¼Œéœ€è¦æ¸…æ¥šçš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š APPå®ŒæˆåŠ è½½å‰æ˜¯inactiveï¼Œå®ŒæˆåŠ è½½åŽå³è¿›å…¥activeçŠ¶æ€ å›žè°ƒ1ï¼šapplication:willFinishLaunchingWithOptions: å›žè°ƒ2ï¼šapplication:didFinishLaunchingWithOptions: å›žè°ƒ3ï¼šapplicationDidBecomeActive: APPè¢«ä¸­æ–­æ—¶ä¼šè¿›å…¥inactiveçŠ¶æ€ï¼Œç»“æŸä¸­æ–­æ—¶è¿”å›žactiveçŠ¶æ€ å›žè°ƒ1ï¼šapplicationWillResignActive: å›žè°ƒ2ï¼šapplicationDidBecomeActive: é”å±å’ŒhomeæŒ‰é”®ä¹Ÿéƒ½æ˜¯ä¸­æ–­ï¼Œæ‰€ä»¥APPåœ¨è¿›å…¥åŽå°å‰ä¼šå…ˆè¿›å…¥inactive å›žè°ƒ1ï¼šapplicationWillResignActive: å›žè°ƒ2ï¼šapplicationDidEnterBackground: ä»ŽåŽå°è¿”å›žå‰å°ï¼ŒAPPä¼šé‡æ–°è¿›å…¥activeçŠ¶æ€ å›žè°ƒ1ï¼šapplicationWillEnterForeground: å›žè°ƒ2ï¼šapplicationDidBecomeActive: æ™®é€šAPPè¿›å…¥åŽå°ä¸€æ®µæ—¶é—´åŽä¼šè¢«æŒ‚èµ·ï¼Œè¢«æŒ‚èµ·çš„APPå¯èƒ½ä¼šè¢«ç³»ç»Ÿç»ˆæ­¢ å›žè°ƒï¼šapplicationWillTerminate: ä¸Šè¿°å›žè°ƒæ–¹æ³•å¯¹åº”çš„çš„APPé€šçŸ¥æœ‰ï¼š UIApplicationDidFinishLaunchingNotification; UIApplicationDidEnterBackgroundNotification UIApplicationWillEnterForegroundNotification UIApplicationDidBecomeActiveNotification; UIApplicationWillResignActiveNotification; UIApplicationWillTerminateNotification; Background ModesAPPè¿›å…¥åŽå°åŽå¯ä»¥æŒ‰åˆ›å»ºæ—¶æŒ‡å®šçš„ç‰¹æ®ŠåŽå°è¿è¡Œæ¨¡å¼è¿è¡Œï¼ŒAPPå¯ä»¥æ‹¥æœ‰å¤šç§åŽå°è¿è¡Œæ¨¡å¼ï¼Œä½†å®¡æ ¸æ—¶å¦‚æžœè¢«è®¤ä¸ºAPPæ— éœ€æ‰€å£°æ˜Žçš„åŽå°è¿è¡Œæ¨¡å¼ï¼Œåˆ™å®¡æ ¸ä¼šè¢«æ‹’ã€‚åŽå°æ¨¡å¼å¯ä»¥é€šè¿‡info.plistä¸­çš„Required background modesè¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Capabilities-&gt;Background Modesè¿›è¡Œé…ç½®(æŽ¨èæ–¹å¼)ï¼ŒAPPçš„åŽå°æ¨¡å¼å¦‚ä¸‹ï¼š Audio, AirPlay and Picture in Picture info.plist key: App plays audio or streams audio/video using AirPlay éŸ³é¢‘æ’­æ”¾ã€å½•åˆ¶ã€ä½¿ç”¨AirPlayæŠ•æ”¾ï¼Œç”»ä¸­ç”»(iPad)ï¼Œæ­¤ç±»APPå¯ä»¥åŽå°å¸¸é©» Location updates info.plist key: App registers for location updates åŽå°èŽ·å–å®šä½æ›´æ–°ï¼Œæ­¤ç±»APPä¹Ÿå¯ä»¥åŽå°å¸¸é©» Voice over IP info.plist key: App provides Voice over IP services IPç”µè¯ï¼Œæ­¤ç±»APPåŒæ ·ä¼šè¢«æŒ‚èµ·ï¼Œä½†ç³»ç»Ÿä¼šæŽ¥ç®¡å…¶é€šä¿¡socketï¼Œå½“socketä¸­æœ‰æ•°æ®ä¼ æ¥æ—¶ï¼Œä¼šå”¤é†’APPå¹¶äº¤å›žsocket Newsstand downloads info.plist key: App processes Newsstand Kit downloads æ‚å¿—ç±»åº”ç”¨ï¼Œæ­¤ç±»APPä¼šè¢«æŒ‚èµ·å’Œç»ˆæ­¢ï¼Œä½†å¯ä½¿ç”¨NKAssetDownloadåŽå°ä¸‹è½½æ‚å¿—ï¼Œå¹¶åœ¨ä¸‹è½½æˆåŠŸåŽé‡æ–°å”¤é†’æˆ–å¯åŠ¨APP External Accessory communication info.plist key: App communicates with an accessory ä¸ŽMFiå¤–è®¾é€šä¿¡ç±»APPï¼Œåœ¨å¤–è®¾æ¶ˆæ¯åˆ°è¾¾æ—¶APPä¼šè¢«å”¤é†’ï¼Œæœ‰10sçš„æ‰§è¡Œæ—¶é—´ Uses Bluetooth LE accessories info.plist key: App communicates using CoreBluetooth ä¸ŽBluetooth LEè®¾å¤‡é€šä¿¡ç±»APPï¼Œåœ¨è®¾å¤‡çš„æ¶ˆæ¯åˆ°è¾¾æ—¶ä¼šè¢«å”¤é†’ï¼Œæœ‰10sçš„æ‰§è¡Œæ—¶é—´ Acts as a Bluetooth LE accessory info.plist key: App shares data using CoreBluetooth è‡ªèº«ä½œä¸ºè“ç‰™å¤–è®¾çš„åº”ç”¨ï¼Œæ­¤ç±»APPå¯ä»¥åŽå°å¸¸é©»ï¼Œä½†éœ€è¦ç”¨æˆ·æŽˆæƒ Background fetch info.plist key: App downloads content from the network åŽå°å®šæ—¶æ›´æ–°ï¼Œè®¾ç½®æ—¶é—´é—´éš”ï¼Œåœ¨é—´éš”æ—¶é—´å†…å¯åŠ¨åº”ç”¨æ›´æ–°æ•°æ®ï¼Œæœ‰30sæ‰§è¡Œæ—¶é—´ Remote notifications info.plist key: App downloads content in response to push notifications é™é»˜æŽ¨é€ï¼Œåœ¨é™é»˜æŽ¨é€åˆ°åº•æ—¶ï¼Œå›žè°ƒå¯¹åº”æ–¹æ³•ä¸‹è½½å†…å®¹ï¼Œæœ‰30sæ‰§è¡Œæ—¶é—´ Background processing info.plist key: App processes data in the background åŸºäºŽNSURLSessionçš„åŽå°ä¼ è¾“ï¼Œä»»åŠ¡æˆåŠŸæˆ–å¤±è´¥æ—¶ï¼ŒAPPä¼šè¢«å”¤é†’å¹¶æ‰§è¡Œapplication:handleEventsForBackgroundURLSession:completionHandler:å›žè°ƒ]]></content>
      <categories>
        <category>APPå·¥ä½œåŽŸç†</category>
      </categories>
      <tags>
        <tag>APPç”Ÿå‘½å‘¨æœŸ</tag>
        <tag>Background Modes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äºŒã€APPçš„åŠ è½½è¿‡ç¨‹]]></title>
    <url>%2F2018%2F01%2F07%2FAPP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F%E4%BA%8C%E3%80%81APP%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[[TOC] Reference:iOS åº•å±‚ - ä»Žå¤´æ¢³ç† dyld åŠ è½½æµç¨‹iOSè¿›é˜¶ â€“ ç¨‹åºå¯åŠ¨é‚£äº›äº‹Dyldç³»åˆ—ä¹‹ä¸€ï¼š_dyld_startä¹‹å‰DYLDåŠ¨æ€é“¾æŽ¥å™¨dyldä¸ŽObjCä»Ž dyld åˆ° runtime ExecutableAPPçš„åŠ è½½è¿‡ç¨‹å°±æ˜¯APPä¸­å¯æ‰§è¡Œæ–‡ä»¶çš„åŠ è½½è¿‡ç¨‹ï¼Œäº†è§£è¿™ä¸ªåŠ è½½è¿‡ç¨‹ä¹‹å‰éœ€è¦å…ˆäº†è§£iOSä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚MacOSä¸­å¯ä»¥ä½¿ç”¨chmod+xå‘½ä»¤æ¥èµ‹äºˆä¸€ä¸ªæ–‡ä»¶å¯æ‰§è¡Œæƒé™ï¼Œä½†å®žé™…ä¸Šå¯ä»¥æ‰§è¡Œçš„æ–‡ä»¶åªæœ‰ä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯è„šæœ¬æ–‡ä»¶ï¼Œç¬¬äºŒç±»æ˜¯å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆåˆ†ä¸ºMach-Oå’ŒFat Binaryï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ï¼š è„šæœ¬æ–‡ä»¶ï¼šè„šæœ¬æ–‡ä»¶æ˜¯ä»¥#!å¼€å¤´çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ‰§è¡Œæ—¶ä¼šç”±shellæ ¹æ®#!åŽé¢æŒ‡æ˜Žçš„åœ°å€ï¼Œæ‰¾åˆ°è„šæœ¬è§£é‡Šå™¨ï¼Œç„¶åŽç”±è„šæœ¬è§£é‡Šå™¨ï¼Œå¯¹æ–‡ä»¶ä¸­çš„è„šæ­¥ä»£ç ï¼Œè¿›è¡Œè§£é‡Šæ‰§è¡Œï¼› Mach-Oï¼šMach-Oæ˜¯ä»¥é­”æ•°0xfeedface(32ä½) æˆ–0xfeedfacf(64ä½)ä½œä¸ºæ–‡ä»¶å¤´çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒMach-Oæœ‰å¤šç§typeï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„typeæ˜¯Executableï¼ˆMH_EXECUTEï¼‰ï¼Œè¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œçš„Mach-Oæ—¶ï¼Œç³»ç»Ÿä¼šforkä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œç„¶åŽæ‰§è¡Œexecveè°ƒç”¨ï¼Œè§£æžMach-Oï¼Œæ‰§è¡Œå…¶ä¸­çš„çš„Load Commandsï¼Œå¯åŠ¨åŠ¨æ€é“¾æŽ¥å™¨dyldï¼Œé“¾æŽ¥ä¸»ç¨‹åºä¸Žä¾èµ–åº“ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ–°çš„è¿›ç¨‹é•œåƒï¼Œåœ¨å†…å­˜ä¸­è¿è¡Œï¼› Fat Binaryï¼šFat Binaryå°±æ˜¯é’ˆå¯¹ä¸åŒèŠ¯ç‰‡æž¶æž„çš„Mach-Oï¼ˆExecutableï¼‰çš„é›†åˆï¼Œæ˜¯ä»¥é­”æ•°0xcafebabeï¼ˆå°ç«¯ï¼‰æˆ–0xbebafecaï¼ˆå¤§ç«¯ï¼‰ä¸ºæ–‡ä»¶å¤´çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰§è¡Œæ—¶æ ¹æ®Fat Headeræ‰¾åˆ°å½“å‰æž¶æž„çš„Mach-Oï¼Œå†è§£æžå¹¶åŠ è½½å¯¹åº”çš„Mach-Oï¼› iOSä¸­çš„Appåœ¨ä¸ä½¿ç”¨BitCodeçš„æƒ…å†µä¸‹ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä¸€ä¸ªFat Binaryï¼Œä½¿ç”¨BitCodeæ—¶ï¼ŒAppä¸­æ˜¯ä¸Žè®¾å¤‡çš„èŠ¯ç‰‡æž¶æž„æ‰€å¯¹åº”çš„Mach-Oï¼Œå®ƒä»¬åœ¨Appå¯åŠ¨æ—¶ï¼Œæœ€ç»ˆéƒ½æ˜¯è§£æžå¹¶åŠ è½½ä¸€ä¸ªMach-Oã€‚ Fat Binaryçš„å¤§ç«¯æ¨¡å¼å’Œå°ç«¯æ¨¡å¼ï¼šå¤§ç«¯æ¨¡å¼ï¼Œæ˜¯æŒ‡æ•°æ®çš„é«˜å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½Žåœ°å€ä¸­ï¼Œè€Œæ•°æ®çš„ä½Žå­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ï¼›å°ç«¯æ¨¡å¼ï¼Œåˆ™æ˜¯æŒ‡æ•°æ®çš„é«˜å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ï¼Œè€Œæ•°æ®çš„ä½Žå­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½Žåœ°å€ä¸­ã€‚ Mach-OMach-Oçš„æ–‡ä»¶ç»“æž„å¦‚å›¾ï¼š Mach-Oä¸»è¦ç”±Headerã€Load Commandså’ŒDataæ‰€æž„æˆï¼š Headerï¼šåŒ…å«é­”æ•°ã€èŠ¯ç‰‡ç±»åž‹ä¸Žå­ç±»åž‹ã€æ–‡ä»¶ç±»åž‹ã€åŠ è½½å‘½ä»¤æ•°é‡ä¸Žå¤§å°ã€åŠ¨æ€é“¾æŽ¥å™¨æ ‡è¯†ã€å­—èŠ‚é¡ºåºç­‰ä¿¡æ¯ï¼› Load Commandsï¼šç¨‹åºçš„åŠ è½½å‘½ä»¤ï¼ŒåŒ…æ‹¬æ®µä¸Žè¿›ç¨‹åœ°å€çš„æ˜ å°„ã€æŒ‡å®šåŠ¨æ€é“¾æŽ¥å™¨ã€æŒ‡æ˜Žéœ€è¦åŠ¨æ€é“¾æŽ¥çš„åº“ç­‰ç­‰ï¼› Dataï¼šç¨‹åºçš„åŽŸå§‹æ•°æ®æ®µï¼ŒåŒ…æ‹¬_TEXTã€_DATAç­‰ï¼ŒåŠ è½½æ—¶è¢«æ˜ å°„åˆ°è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ã€‚ Load CommandsMach-Oä¸­Load Commandséƒ¨åˆ†æ˜¯ç¨‹åºçš„åŠ è½½å‘½ä»¤ï¼Œè¿™äº›åŠ è½½å‘½ä»¤åœ¨å†…æ ¸åœ¨æ‰§è¡Œexecveè°ƒç”¨æ—¶ï¼Œå®Œæˆå¯¹Mach-Oçš„æ–‡ä»¶è§£æžä¹‹åŽï¼Œæœ‰çš„ç”±å†…æ ¸ç›´æŽ¥æ‰§è¡Œï¼Œæœ‰çš„åˆ™ç”±åŠ¨æ€é“¾æŽ¥å™¨å¤„ç†ï¼Œè¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒæ–‡ç« â€”Mach-Oæ–‡ä»¶ä»‹ç»ä¹‹loadcommandï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›å¸¸è§çš„åŠ è½½å‘½ä»¤åŠå…¶å«ä¹‰ï¼š å‘½ä»¤ å«ä¹‰ LC_SEGMENT å°†æ•°æ®æ®µæ˜ å°„åˆ°åœ°å€ç©ºé—´ä¸­ LC_DYLD_INFO_ONLY åŠ¨æ€é“¾æŽ¥ç›¸å…³ä¿¡æ¯ LC_SYMTAB ç¬¦å·è¡¨åœ°å€ LC_DYSYMTAB åŠ¨æ€ç¬¦å·è¡¨åœ°å€ LC_LOAD_DYLINKER åŠ¨æ€é“¾æŽ¥å™¨ LC_UUID æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯† LC_VERSION_MIN_IPHONEOS æ”¯æŒçš„æœ€ä½ŽiOSç‰ˆæœ¬ LC_SOURCE_VERSION æºç ç‰ˆæœ¬ LC_MAIN è®¾ç½®è¿›ç¨‹çš„ä¸»çº¿ç¨‹å…¥å£åœ°å€å’Œæ ˆå¤§å° LC_ENCRPYTION_INFO åŠ å¯†ä¿¡æ¯ LC_LOAD_DYLIB åŠ è½½åŠ¨æ€åº“ LC_LOAD_WEAK_DYLIB å¼±åŠ è½½åŠ¨æ€åº“ï¼ˆä¸å› åº“ä¸å­˜åœ¨è€Œä¸­æ­¢ï¼‰ LC_FUNCTION_STARTS å‡½æ•°èµ·å§‹åœ°å€è¡¨ LC_CODE_SIGNATURE ä»£ç ç­¾åä¿¡æ¯ DyldExecutableç±»åž‹çš„Mach-Oçš„Load Commandsä¸­é€šè¿‡LC_LOAD_DYLINKERæŒ‡æ˜Žäº†ç¨‹åºçš„åŠ¨æ€é“¾æŽ¥å™¨ï¼ŒMacOS/iOSä¸­é»˜è®¤çš„åŠ¨æ€é“¾æŽ¥å™¨æ˜¯dyldï¼ˆ/usr/lib/dyldï¼‰ï¼Œdyldä¸»è¦è´Ÿè´£å°†ä¸»ç¨‹åºåŠå…¶ä¾èµ–åº“åŠ è½½ä¸ºé•œåƒæ–‡ä»¶ï¼ˆimagesï¼‰ï¼Œå¹¶é“¾æŽ¥è¿™äº›é•œåƒæ–‡ä»¶ï¼Œdyldçš„ä»£ç æ˜¯å¼€æºçš„ï¼Œæœ¬æ–‡ä¸­å¼•ç”¨çš„æºç æ˜¯732.8ç‰ˆæœ¬ã€‚ _dyld_startdyldæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªMach-Oï¼Œç±»åž‹ä¸ºMH_DYLINKERï¼Œåœ¨execveçš„è°ƒç”¨ä¸­ï¼Œå®Œæˆä¸»ç¨‹åºMach-Oçš„è§£æžåŽï¼Œæ ¹æ®å…¶ä¸­çš„LC_LOAD_DYLINKERï¼Œç”±å†…æ ¸è§£æžå¹¶åŠ è½½dyldï¼Œæ ¹æ®dyldçš„LC_UNIXTHREADå¾—åˆ°dyldçš„entry_pointï¼Œå³_dyld_startå‡½æ•°ï¼Œç„¶åŽé€šè¿‡_dyld_startæ‰§è¡Œdyldç¨‹åºï¼Œå¼€å§‹dyldçš„å·¥ä½œã€‚ ä»Žexecveåˆ°_dyld_startçš„å‡½æ•°è°ƒç”¨æ ˆå¤§è‡´å¦‚ä¸‹ï¼š 12345678910â–¼ execve // å¯åŠ¨appæ—¶, ç”¨æˆ·æ€å‘é€ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨execveåˆ°å†…æ ¸ â–¼ __mac_execve // åˆ›å»ºçº¿ç¨‹ â–¼ exec_activate_image â–¼ exec_mach_imgact â–¼ load_machfile â–¶ï¸Ž parse_machfile // è§£æžä¸»ç¨‹åºçš„Mach-O â–¼ load_dylinker // è§£æžå®ŒMach-OåŽï¼Œæ ¹æ®LC_LOAD_DYLINKERæ‰€æŒ‡å®šçš„åœ°å€ï¼ˆ/usr/bin/dyldï¼‰å¯åŠ¨åŠ¨æ€é“¾æŽ¥å™¨ â–¼ parse_machfile // è§£æždyldçš„Mach-Oï¼Œæ ¹æ®å®ƒçš„LC_UNIXTHREADå¾—åˆ°dyldçš„entry_pointï¼Œå³_dyld_start â–¼ activate_exec_state â–¶ï¸Ž thread_setentrypoint // è®¾ç½®entry_pointï¼Œå¼€å§‹æ‰§è¡Œ_dyld_start start_dyld_startä¸­è°ƒç”¨äº†startå‡½æ•°ï¼Œstartä¸­ä¸»è¦æ˜¯å®Œæˆä¸€äº›dyldçš„å¼•å¯¼å·¥ä½œï¼ŒåŒ…æ‹¬rebaseDyldã€æ ˆæº¢å‡ºä¿æŠ¤ã€èŽ·å–ä¸»ç¨‹åºçš„ASLRéšæœºæ•°ç­‰ï¼Œåœ¨startçš„æœ«å°¾è°ƒç”¨å¹¶è¿”å›žäº†_mainå‡½æ•°ï¼š 1234567891011121314151617181920212223uintptr_t start(const dyld3::MachOLoaded* appsMachHeader, int argc, const char* argv[], const dyld3::MachOLoaded* dyldsMachHeader, uintptr_t* startGlue)&#123; dyld3::kdebug_trace_dyld_marker(DBG_DYLD_TIMING_BOOTSTRAP_START, 0, 0, 0, 0); rebaseDyld(dyldsMachHeader); const char** envp = &amp;argv[argc+1]; const char** apple = envp; while(*apple != NULL) &#123; ++apple; &#125; ++apple; __guard_setup(apple);#if DYLD_INITIALIZER_SUPPORT // run all C++ initializers inside dyld runDyldInitializers(argc, argv, envp, apple);#endif uintptr_t appsSlide = appsMachHeader-&gt;getSlide(); return dyld::_main((macho_header*)appsMachHeader, appsSlide, argc, argv, envp, apple, startGlue);&#125; _mainå†…æ ¸é€šè¿‡_dyld_startå¼€å§‹æ‰§è¡Œdyldç¨‹åºï¼Œå†è°ƒç”¨startå‡½æ•°å®Œæˆå¼•å¯¼å·¥ä½œï¼Œæœ€åŽè°ƒç”¨_mainå‡½æ•°å¼€å§‹æ‰§è¡Œdyldç¨‹åºï¼Œ_mianå‡½æ•°æ˜¯dyldå®žé™…çš„é€»è¾‘å…¥å£ï¼Œæºç ä¸­å¯¹äºŽ_mainå‡½æ•°çš„æ³¨é‡Šå¦‚ä¸‹ï¼š 123456//// Entry point for dyld. The kernel loads dyld and jumps to __dyld_start which// sets up some registers and call this function.//// Returns address of main() in target program which __dyld_start jumps to// _mainä¸­æ‰€åšçš„å·¥ä½œè¾ƒå¤šï¼Œå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š 1. åŠ è½½å…±äº«ç¼“å­˜åº“åœ¨åŠ è½½å…±äº«ç¼“å­˜åº“ä¹‹å‰ï¼Œ_mainå‡½æ•°ä¸­ä¼šå…ˆè®¾ç½®è¿è¡ŒçŽ¯å¢ƒï¼Œè®¾ç½®è¿è¡ŒçŽ¯å¢ƒçš„å·¥ä½œåŒ…æ‹¬åŒ…æ‹¬ï¼š é…ç½®çŽ¯å¢ƒå˜é‡ï¼Œå°†ä¼ å…¥çš„å‚æ•°èµ‹å€¼ç»™ä¸€äº›çŽ¯å¢ƒå˜é‡ï¼› è®¾ç½®ä¸Šä¸‹æ–‡ä¿¡æ¯setContextï¼ŒåŒ…æ‹¬ä¸€äº›å›žè°ƒå‡½æ•°ã€å‚æ•°ã€æ ‡å¿—ä¿¡æ¯ç­‰ï¼› æ£€æµ‹è¿›ç¨‹æ˜¯å¦å—é™configureProcessRestrictionsï¼› æ ¹æ®çŽ¯å¢ƒå˜é‡é…ç½®æ‰“å°ä¿¡æ¯DYLD_PRINT_OPTSã€DYLD_PRINT_ENVï¼› èŽ·å–ç¨‹åºçš„æž¶æž„ä¿¡æ¯getHostInfoï¼› åœ¨è®¾ç½®äº†è¿è¡ŒçŽ¯å¢ƒä¹‹åŽï¼Œ_mianå‡½æ•°ä¸­é€šè¿‡mapSharedCacheå†è°ƒç”¨äº†loadDyldCacheå‡½æ•°ï¼Œå·²ç¡®ä¿å…±äº«ç¼“å­˜åº“å·²è¢«åŠ è½½ï¼š 123456789101112131415161718192021222324252627bool loadDyldCache(const SharedCacheOptions&amp; options, SharedCacheLoadInfo* results)&#123; results-&gt;loadAddress = 0; results-&gt;slide = 0; results-&gt;errorMessage = nullptr;#if TARGET_OS_SIMULATOR // simulator only supports mmap()ing cache privately into process return mapCachePrivate(options, results);#else if ( options.forcePrivate ) &#123; // mmap cache into this process only return mapCachePrivate(options, results); &#125; else &#123; // fast path: when cache is already mapped into shared region bool hasError = false; if ( reuseExistingCache(options, results) ) &#123; hasError = (results-&gt;errorMessage != nullptr); &#125; else &#123; // slow path: this is first process to load cache hasError = mapCacheSystemWide(options, results); &#125; return hasError; &#125;#endif&#125; å…±äº«ç¼“å­˜åº“ï¼šå®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªiOSç³»ç»ŸåŠ¨æ€åº“çš„é›†åˆï¼ŒiOSä¸­çš„ç³»ç»ŸåŠ¨æ€åº“å¯ä»¥è¢«ä¸åŒçš„Appæ‰€å…±äº«ï¼Œæ‰€ä»¥ç³»ç»ŸåŠ¨æ€åº“åªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªAppä½¿ç”¨å®ƒæ—¶è¢«åŠ è½½ï¼ŒåŽç»­çš„Appä½¿ç”¨æ—¶ï¼Œä½¿ç”¨å®ƒç¬¬ä¸€æ¬¡åŠ è½½åŽåœ¨å†…å­˜ä¸­çš„ç¼“å­˜å³å¯ï¼Œä½†æ¯ä¸ªAppä½¿ç”¨åˆ°çš„ç³»ç»ŸåŠ¨æ€åº“è¾ƒå¤šï¼Œå¦‚æžœä½¿ç”¨åˆ°çš„ç³»ç»ŸåŠ¨æ€åº“éœ€è¦é€ä¸ªçš„åŽ»åˆ¤æ–­å¹¶åŠ è½½çš„è¯ï¼Œå¯¹Appçš„å¯åŠ¨é€Ÿåº¦ä¾ç„¶æœ‰è¾ƒå¤§çš„å½±å“ï¼ŒäºŽæ˜¯iOSä¸­ä¾¿å°†å¸¸ç”¨çš„ç³»ç»ŸåŠ¨æ€åº“éƒ½åˆå¹¶åˆ°äº†ä¸€ä¸ªè¾ƒå¤§çš„ç¼“å­˜æ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ‰€æœ‰Appå¯¹ç³»ç»ŸåŠ¨æ€åº“çš„ä½¿ç”¨ï¼Œéƒ½åªéœ€è¦ç¡®ä¿è¿™ä¸ªç¼“å­˜æ–‡ä»¶å·²ç»è¢«åŠ è½½åˆ°äº†å†…å­˜ä¸­å³å¯ï¼Œè¿™ä¸ªç¼“å­˜æ–‡ä»¶å°±æ˜¯å…±äº«ç¼“å­˜åº“ï¼Œå…³äºŽå…±äº«ç¼“å­˜åº“å¯ä»¥å‚è€ƒé“¾æŽ¥ã€‚ å…±äº«ç¼“å­˜åŒºä¸Žå…±äº«ç¼“å­˜åº“ï¼šåŠ¨æ€åº“åˆè¢«ç§°ä¸ºå…±äº«åº“ï¼Œå®ƒä»¬ä¼šè¢«åŠ è½½åˆ°å†…å­˜çš„å…±äº«ç¼“å­˜åŒºï¼Œä¾›ä¸åŒçš„è¿›ç¨‹å…±äº«ï¼Œå…±äº«ç¼“å­˜åº“æ˜¯å¸¸ç”¨ç³»ç»ŸåŠ¨æ€åº“çš„é›†åˆï¼Œå®ƒä¹Ÿä¼šè¢«åŠ è½½åˆ°å…±äº«ç¼“å­˜åŒºï¼Œä¾›æ‰€æœ‰çš„è¿›ç¨‹æ‰€å…±äº«ï¼Œä½†å…±äº«ç¼“å­˜åŒºä¸æ­¢å…±äº«ç¼“å­˜åº“ï¼Œå®ƒè¿˜å¯èƒ½å­˜åœ¨Appçš„Embedded Frameworkï¼ŒEmbedded Frameworkä¸èƒ½ä¸Žå¤–éƒ¨çš„Appå…±äº«ï¼Œä½†å¯ä»¥ä¸Žè‡ªå·±çš„Extensionç­‰å…±äº«ã€‚ 2. å®žä¾‹åŒ–ä¸»ç¨‹åº Appä½¿ç”¨åˆ°çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶éƒ½éœ€è¦è¢«åŠ è½½ã€è§£æžå¹¶å®žä¾‹åŒ–ä¸ºå†…å­˜é•œåƒï¼Œæ¯ä¸€ä¸ªMach-Oéƒ½å¯¹åº”ä¸€ä¸ªé•œåƒå®žä¾‹ã€‚å®žä¾‹åŒ–ä¸»ç¨‹åºå°±æ˜¯ç”Ÿæˆä¸»ç¨‹åºçš„é•œåƒï¼Œä¸»ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å–å’Œè§£æžæ˜¯åœ¨execveä¸­å®Œæˆçš„ï¼Œç„¶åŽä½œä¸ºå‚æ•°ä¼ é€’ç»™dyldçš„ï¼Œåœ¨dyldçš„_mainä¸­é€šè¿‡instantiateFromLoadedImageå°†ä¸»ç¨‹åºå®žä¾‹åŒ–ä¸ºé•œåƒï¼Œå†æ·»åŠ åˆ°å…¨å±€çš„é•œåƒåˆ—è¡¨ä¸­ã€‚ 1234567891011static ImageLoaderMachO* instantiateFromLoadedImage(const macho_header* mh, uintptr_t slide, const char* path)&#123; // try mach-o loader if ( isCompatibleMachO((const uint8_t*)mh, path) ) &#123; ImageLoader* image = ImageLoaderMachO::instantiateMainExecutable(mh, slide, path, gLinkContext); addImage(image); return (ImageLoaderMachO*)image; &#125; throw "main executable not a known format";&#125; 3. åŠ è½½æ’å…¥åº“è¿™ä¸€æ­¥æ˜¯å°†çŽ¯å¢ƒå˜é‡DYLD_INSERT_LIBRARIESä¸­é…ç½®çš„åŠ¨æ€åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå…ˆåˆ¤æ–­çŽ¯å¢ƒå˜é‡DYLD_INSERT_LIBRARIESä¸­æ˜¯å¦æœ‰éœ€è¦æ’å…¥çš„åŠ¨æ€åº“ï¼Œå¦‚æžœæœ‰å­˜åœ¨åˆ™è°ƒç”¨loadInsertedDylibæ¥ä¾æ¬¡åŠ è½½ï¼Œåˆ©ç”¨DYLD_INSERT_LIBRARIESçŽ¯å¢ƒå˜é‡æ˜¯MacOSå’ŒiOSä¸Šéžå¸¸çŸ¥åçš„ä¸€ç§æ³¨å…¥æŠ€æœ¯ï¼Œé€šå¸¸è¶Šç‹±æ’ä»¶å°±æ˜¯åŸºäºŽæ­¤æ¥æ³¨å…¥åˆ°åº”ç”¨ä¸­ã€‚ 12345// load any inserted libraries if ( sEnv.DYLD_INSERT_LIBRARIES != NULL ) &#123; for (const char* const* lib = sEnv.DYLD_INSERT_LIBRARIES; *lib != NULL; ++lib) loadInsertedDylib(*lib); &#125; Inserted Librariesä¸ŽEmbedded Frameworkï¼šiOSçš„Appåœ¨å¯åŠ¨æ—¶æ¶‰åŠä¸‰ç±»åŠ¨æ€åº“ï¼Œé¦–å…ˆæ˜¯System Librariesï¼ˆç³»ç»ŸåŠ¨æ€åº“ï¼‰ï¼Œå®ƒä»¬è¢«åˆå¹¶åˆ°å…±äº«ç¼“å­˜åº“ä¸­ï¼Œåœ¨åŠ è½½åˆ°æ‰‹æœºå†…å­˜ä¹‹åŽï¼Œç”±æ‰€æœ‰Appæ‰€å…±äº«ï¼›ç„¶åŽä¾¿æ˜¯Inserted Librariesï¼Œå®ƒä»¬åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¸»ç¨‹åºå®žä¾‹åŒ–ä¹‹åŽï¼Œæ ¹æ®DYLD_INSERT_LIBRARIESçŽ¯å¢ƒå˜é‡ä¾æ¬¡è¿›è¡ŒåŠ è½½ï¼Œè¶Šç‹±è®¾å¤‡ä¸­å®‰è£…çš„åº”ç”¨æ’ä»¶é€šå¸¸å°±æ˜¯è¿™ç±»åŠ¨æ€åº“ï¼›æœ€åŽä¾¿æ˜¯Embedded Frameworkï¼Œå®ƒä»¬æ˜¯ç”±å¼€å‘è€…åˆ›å»ºçš„ï¼Œå±žäºŽAppè‡ªå·±çš„åŠ¨æ€åº“ï¼ŒiOS8ä¹‹å‰çš„iOS Appæ˜¯ä¸èƒ½æœ‰è‡ªå·±çš„åŠ¨æ€åº“çš„ï¼Œåœ¨iOS8ä¹‹åŽä¸ºäº†æ»¡è¶³Appå’ŒExtensionä¹‹é—´ä»£ç å…±äº«çš„éœ€æ±‚ï¼ŒäºŽæ˜¯ä¾¿æœ‰äº†Embedded Frameworkçš„æ¦‚å¿µï¼Œå®ƒä»¬ä¸èƒ½ä¸Žå¤–éƒ¨Appå…±äº«ï¼Œåœ¨Appå¯åŠ¨è¿‡ç¨‹ä¸­é“¾æŽ¥ä¸»ç¨‹åºæ—¶ï¼Œæ ¹æ®LC_LOAD_DYLIBå‘½ä»¤å’Œä¾èµ–å…³ç³»é€’å½’çš„åŠ è½½åˆ°å†…å­˜ä¸­ã€‚é™¤äº†è¿™äº›å¯åŠ¨æ—¶åŠ è½½çš„åŠ¨æ€åº“ï¼ŒMacOSçš„Appè¿˜å¯ä»¥é€šè¿‡dlopen()åœ¨è¿è¡Œæ—¶åŠ è½½åŠ¨æ€åº“æ’ä»¶ï¼Œä½†è¿™åœ¨iOSçš„Appæäº¤å®¡æ ¸æ—¶æ˜¯è¢«ç¦æ­¢çš„ã€‚ 4. é“¾æŽ¥é•œåƒ_mainå‡½æ•°ä¸­è°ƒç”¨linkæ¥é“¾æŽ¥ç¨‹åºçš„é•œåƒï¼Œå¯åŠ¨æ—¶å…ˆé“¾æŽ¥ä¸»ç¨‹åºå†é“¾æŽ¥æ’å…¥åº“ï¼Œé€šå¸¸linkå‡½æ•°é“¾æŽ¥ä¸€ä¸ªé•œåƒæ—¶æœ‰ä¸‰é¡¹ä¸»è¦çš„å·¥ä½œï¼šé€’å½’çš„åŠ è½½ä¾èµ–åº“ï¼ˆAppçš„Embedded Frameworkçš„å®žä¾‹åŒ–ï¼‰ã€é€’å½’çš„Rebaseå’Œé€’å½’çš„Bindingï¼Œè¿™é‡Œ732.8ç‰ˆæœ¬çš„æºç ä¸Žæ›´æ—©ç‰ˆæœ¬æºç çš„åšæ³•æœ‰äº›è®¸å·®å¼‚ï¼Œå®ƒå°†ä¸»ç¨‹åºå’Œæ’å…¥åº“é“¾æŽ¥æ—¶çš„Bindingå…ˆæš‚æ—¶è·³è¿‡äº†ï¼Œæ”¾åœ¨äº†ä¸»ç¨‹åºå’Œæ’å…¥åº“éƒ½é“¾æŽ¥å®Œæˆä¹‹åŽå†è¿›è¡Œï¼š 1234567891011121314151617181920212223242526272829303132333435void ImageLoader::link(const LinkContext&amp; context, bool forceLazysBound, bool preflightOnly, bool neverUnload, const RPathChain&amp; loaderRPaths, const char* imagePath)&#123; ... uint64_t t0 = mach_absolute_time(); uint64_t t0 = mach_absolute_time(); // 1. é€’å½’çš„åŠ è½½é•œåƒçš„ä¾èµ–åº“ this-&gt;recursiveLoadLibraries(context, preflightOnly, loaderRPaths, imagePath); context.notifyBatch(dyld_image_state_dependents_mapped, preflightOnly); ... uint64_t t1 = mach_absolute_time(); context.clearAllDepths(); // é€’å½’åˆ·æ–°ä¾èµ–åº“çš„å±‚çº§ this-&gt;recursiveUpdateDepth(context.imageCount()); __block uint64_t t2, t3, t4, t5; &#123; dyld3::ScopedTimer(DBG_DYLD_TIMING_APPLY_FIXUPS, 0, 0, 0); // é€’å½’çš„è¿›è¡ŒRebase t2 = mach_absolute_time(); this-&gt;recursiveRebaseWithAccounting(context); context.notifyBatch(dyld_image_state_rebased, false); // é€’å½’çš„è¿›è¡ŒBindingï¼ˆä¸»ç¨‹åºå’Œæ’å…¥åº“linkæ—¶ä¼šè·³è¿‡ï¼‰ t3 = mach_absolute_time(); if ( !context.linkingMainExecutable ) this-&gt;recursiveBindWithAccounting(context, forceLazysBound, neverUnload); // é€’å½’çš„è¿›è¡Œå¼±ç»‘å®šï¼ˆä¸»ç¨‹åºå’Œæ’å…¥åº“linkæ—¶ä¼šè·³è¿‡ï¼‰ t4 = mach_absolute_time(); if ( !context.linkingMainExecutable ) this-&gt;weakBind(context); t5 = mach_absolute_time(); &#125; ...&#125; Rebaseï¼šä¸ºäº†å¢žåŠ æ”»å‡»è€…å¯¹ç¨‹åºå†…éƒ¨åœ°å€é¢„æµ‹çš„éš¾åº¦ï¼Œç¨‹åºåœ¨åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ä¼šæœ‰ä¸€ä¸ªéšæœºçš„åœ°å€åç§»å€¼ï¼Œè¿™é¡¹å®‰å…¨æŠ€æœ¯è¢«ç§°ä¸ºASLRï¼ˆiOSä¸­çš„ASLRå¯å‚è€ƒé“¾æŽ¥ï¼‰ï¼Œå› ä¸ºè¿™ä¸ªéšæœºåç§»çš„å­˜åœ¨ï¼Œåœ¨ç¨‹åºæ¯æ¬¡åŠ è½½åˆ°å†…å­˜åŽéƒ½éœ€è¦å¯¹å†…éƒ¨ä»£ç ä¸­çš„åœ°å€åšä¿®æ­£ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­è¿™æ­¥æ“ä½œè¢«ç§°ä¸ºRebaseï¼Œå®ƒæ˜¯ä¿®å¤æŒ‡å‘å½“å‰é•œåƒå†…éƒ¨çš„åœ°å€ã€‚ 5. ç¬¦å·ç»‘å®šç¬¦å·ç»‘å®šåŒ…æ‹¬bindingå’Œweak bindingï¼Œå…ˆè¿›è¡Œbindingï¼Œå†æ˜¯weak bindingï¼Œä»Žæºç ä¸­å¯ä»¥çœ‹å‡ºBindingçš„è€—æ—¶ç»Ÿè®¡å¹¶ä¸åŒ…æ‹¬weak bindingï¼š 1234567891011121314151617// Bind and notify for the main executable now that interposing has been registereduint64_t bindMainExecutableStartTime = mach_absolute_time();sMainExecutable-&gt;recursiveBindWithAccounting(gLinkContext, sEnv.DYLD_BIND_AT_LAUNCH, true);uint64_t bindMainExecutableEndTime = mach_absolute_time();ImageLoaderMachO::fgTotalBindTime += bindMainExecutableEndTime - bindMainExecutableStartTime;gLinkContext.notifyBatch(dyld_image_state_bound, false);// Bind and notify for the inserted images now interposing has been registeredif ( sInsertedDylibCount &gt; 0 ) &#123; for(unsigned int i=0; i &lt; sInsertedDylibCount; ++i) &#123; ImageLoader* image = sAllImages[i+1]; image-&gt;recursiveBind(gLinkContext, sEnv.DYLD_BIND_AT_LAUNCH, true); &#125;&#125; // do weak binding only after all inserted images linkedsMainExecutable-&gt;weakBind(gLinkContext); Bindingï¼š é€šå¸¸ä¸€ä¸ªç¨‹åºä¸­éƒ½ä¼šåŒ…å«å¯¹å¤–éƒ¨åœ°å€çš„å¼•ç”¨ï¼Œæ¯”å¦‚å¯¹åŠ¨æ€åº“çš„ä½¿ç”¨ï¼ŒåŠ¨æ€åº“ä¸ä¼šåœ¨ç¼–è¯‘æ—¶è¢«åˆå¹¶åˆ°ç¨‹åºä¸­ï¼Œè¿è¡Œæ—¶æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥æ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šå¯¹å…¶ç›¸å…³å¼•ç”¨çš„å…·ä½“åœ°å€ï¼ŒäºŽæ˜¯å°±æœ‰äº†PICï¼ˆPosition Independent Codeï¼‰æŠ€æœ¯ï¼šç¨‹åºä¸­æŒ‡å‘å¤–éƒ¨çš„åœ°å€ï¼Œåœ¨ç¼–è¯‘æ—¶å…ˆè¢«è®¾ç½®ä¸ºç¬¦å·åœ°å€ï¼Œåœ¨åŠ è½½æ—¶å†æ ¹æ®å¤–éƒ¨é•œåƒçš„ç¬¦å·è¡¨ç­‰ä¿¡æ¯ï¼Œé‡æ–°æŠŠç¬¦å·åœ°å€ç»‘å®šä¸ºå®žé™…çš„åœ°å€ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­ç¬¦å·åœ°å€é‡æ–°ç»‘å®šè¿™æ­¥æ“ä½œè¢«ç§°ä¸ºBindingï¼Œå®ƒæ˜¯ç»‘å®šæŒ‡å‘å½“å‰é•œåƒå¤–éƒ¨çš„åœ°å€ã€‚ 6. åˆå§‹åŒ–ä¸»ç¨‹åº_mainå‡½æ•°è°ƒç”¨initializeMainExecutableå‡½æ•°æ¥åˆå§‹åŒ–ç¨‹åºï¼Œåˆå§‹åŒ–æ—¶å…ˆåˆå§‹åŒ–æ’å…¥åº“ä¸­çš„æ ¹é•œåƒï¼Œå†åˆå§‹åŒ–ä¸»ç¨‹åºã€‚é•œåƒé€šè¿‡è°ƒç”¨recursiveInitializationæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼ŒrecursiveInitializationä¸­ä¼šæ ¹æ®ä¾èµ–å…³ç³»é€’å½’çš„å…ˆæ‰§è¡Œä¾èµ–åº“çš„åˆå§‹åŒ–å·¥ä½œã€‚ Xcodeä¸­å¯ä»¥é€šè¿‡é…ç½®çŽ¯å¢ƒå˜é‡DYLD_PRINT_INITIALIZERS=1æ¥æ‰“å°å„ä¸ªä¾èµ–åº“çš„åˆå§‹åŒ–æ–¹æ³•åŠå…¶è°ƒç”¨é¡ºåºï¼Œå¯ä»¥å‘çŽ°libSystemçš„åˆå§‹åŒ–æ–¹æ³•å§‹ç»ˆæ˜¯æœ€å…ˆè°ƒç”¨çš„ã€‚ Objc_initç¨‹åºä¸­é•œåƒåœ¨åˆå§‹åŒ–æ—¶ä¼šé€’å½’çš„å…ˆè¿›è¡Œä¾èµ–åº“çš„åˆå§‹åŒ–å·¥ä½œï¼Œä»Ždyldçš„æºç ä¸­å¯ä»¥å¾—çŸ¥ï¼Œåœ¨æ²¡æœ‰æ’å…¥åº“çš„æƒ…å†µä¸‹ï¼Œlibsystemé€šå¸¸ä¼šæ˜¯ç¬¬ä¸€ä¸ªè¿›è¡Œåˆå§‹åŒ–çš„åº“ï¼Œè€Œlibsystemçš„åˆå§‹åŒ–æ–¹æ³•ä¸­åˆ™è°ƒç”¨äº†runtimeçš„åˆå§‹åŒ–æ–¹æ³•_objc_initï¼š 123456789101112131415void _objc_init(void)&#123; static bool initialized = false; if (initialized) return; initialized = true; // fixme defer initialization until an objc-using image is found? environ_init(); tls_init(); static_init(); lock_init(); exception_init(); _dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);&#125; _objc_initä¸­è°ƒç”¨dyldçš„_dyld_objc_notify_registeræ³¨å†Œäº†ä¸‰ä¸ªå›žè°ƒæ–¹æ³•ï¼Œæ¥æŽ¥æ”¶dyldåŠ è½½é•œåƒç›¸å…³äº‹ä»¶çš„å›žè°ƒï¼Œä»¥å®Œæˆå¯¹æ¯ä¸ªé•œåƒä¸­çš„Objcç›¸å…³éƒ¨åˆ†çš„å¤„ç†ï¼š 12345678910111213141516171819202122232425262728293031void _dyld_objc_notify_register(_dyld_objc_notify_mapped mapped, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmapped)&#123; dyld::registerObjCNotifiers(mapped, init, unmapped);&#125;void registerObjCNotifiers(_dyld_objc_notify_mapped mapped, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmapped)&#123; // record functions to call sNotifyObjCMapped = mapped; sNotifyObjCInit = init; sNotifyObjCUnmapped = unmapped; // call 'mapped' function with all images mapped so far try &#123; notifyBatchPartial(dyld_image_state_bound, true, NULL, false, true); &#125; catch (const char* msg) &#123; // ignore request to abort during registration &#125; // call 'init' function on all images already init'ed (below libSystem) for (std::vector&lt;ImageLoader*&gt;::iterator it=sAllImages.begin(); it != sAllImages.end(); it++) &#123; ImageLoader* image = *it; if ( (image-&gt;getState() == dyld_image_state_initialized) &amp;&amp; image-&gt;notifyObjC() ) &#123; dyld3::ScopedTimer timer(DBG_DYLD_TIMING_OBJC_INIT, (uint64_t)image-&gt;machHeader(), 0, 0); (*sNotifyObjCInit)(image-&gt;getRealPath(), image-&gt;machHeader()); &#125; &#125;&#125; å…³äºŽå¤„ç†é•œåƒä¸­Objcç›¸å…³ä¿¡æ¯çš„ä¸‰ä¸ªå›žè°ƒæ–¹æ³•ï¼š map_imagesï¼šåœ¨é•œåƒå®ŒæˆåŠ è½½ï¼ˆå³åŠ è½½è¿›å†…å­˜ä¸­ï¼‰åŽè¢«è°ƒç”¨ï¼Œé€šè¿‡_read_imageså‡½æ•°å®Œæˆå¯¹é•œåƒä¸­Objcçš„ç±»ã€åè®®ã€ç±»åˆ«ç­‰çš„åˆå§‹åŒ–å·¥ä½œï¼› load_imagesï¼šåœ¨é•œåƒçš„åˆå§‹åŒ–å®ŒæˆåŽè¢«è°ƒç”¨ï¼Œä¸»è¦æ˜¯è°ƒç”¨é•œåƒä¸­å„ç§Objcç±»çš„+loadæ–¹æ³•ï¼Œå®ŒæˆObjcç±»çš„åŠ è½½ï¼› unmap_imageï¼šåœ¨ç§»é™¤é•œåƒæ—¶è¢«è°ƒç”¨ï¼Œä¸»è¦æ˜¯åšé•œåƒçš„Objcç›¸å…³ä¿¡æ¯çš„æ¸…ç†å·¥ä½œã€‚ libsystemçš„åˆå§‹åŒ–æ—¶è°ƒç”¨_objc_initæ‰æ³¨å†ŒObjcçš„å¤„ç†å›žè°ƒæ–¹æ³•ï¼Œè¿™æ—¶ä¸»ç¨‹åºå’Œæ’å…¥åº“ï¼Œä»¥åŠå®ƒä»¬ä¾èµ–åº“çš„é•œåƒéƒ½å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥åœ¨**æ³¨å†Œå›žè°ƒçš„æ–¹æ³•æ—¶ï¼Œå°±è§¦å‘äº†ä¸€æ¬¡map_imagesæ¥æ‰¹é‡çš„åˆå§‹åŒ–å·²åŠ è½½é•œåƒä¸­çš„Objcä¿¡æ¯ï¼Œç„¶åŽä¹Ÿå¾ªçŽ¯çš„è§¦å‘äº†load_imagesï¼Œæ¥åŠ è½½é‚£äº›åœ¨libsystemåˆå§‹åŒ–ä¹‹å‰å°±å·²ç»éšé•œåƒè½½å…¥å†…å­˜ä¸­çš„Objcç±»ã€‚ 7. è¿”å›žä¸»ç¨‹åºå…¥å£æœ€åŽdyldçš„_mainå‡½æ•°ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„ä¸»ç¨‹åºå…¥å£ï¼ˆé€šå¸¸æ˜¯ä¸»ç¨‹åºä¸­çš„mainå‡½æ•°åœ°å€ï¼‰ä½œä¸ºè¿”å›žå€¼è¿”å›žï¼Œè¿™ä¸ªå€¼æœ€ç»ˆä¼šè¿”å›žç»™ä¸€å¼€å§‹forkåˆ›å»ºçš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ®æ­¤è·³è½¬åˆ°ä¸»ç¨‹åºå…¥å£ç»§ç»­è¿è¡Œï¼Œä¸»ç¨‹åºä¸­çš„ä»£ç ä¾¿å¼€å§‹æ‰§è¡Œã€‚]]></content>
      <categories>
        <category>APPå·¥ä½œåŽŸç†</category>
      </categories>
      <tags>
        <tag>Mach-O</tag>
        <tag>åŠ è½½</tag>
        <tag>å¯åŠ¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ã€APPçš„ç¼–è¯‘è¿‡ç¨‹]]></title>
    <url>%2F2017%2F12%2F23%2FAPP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F%E4%B8%80%E3%80%81APP%E7%9A%84%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[[TOC] Reference:iOS App çš„ç¼–è¯‘è¿‡ç¨‹æ·±å…¥å‰–æž iOS ç¼–è¯‘ Clang / LLVMå…³äºŽbitcode, çŸ¥é“è¿™äº›å°±å¤Ÿäº†Mach-O ä¸Žé™æ€é“¾æŽ¥ Xcode BuildXcode Buildæ—¶ä»¥ä¸€ä¸ªTargetä½œä¸ºBuildç›®æ ‡ï¼Œå½“Targetæ˜¯ä¸€ä¸ªiOSé¡¹ç›®æ—¶ï¼Œå…¶å®žå°±æ˜¯Appçš„æ‰“åŒ…è¿‡ç¨‹ï¼Œé™¤äº†å¯¹æºä»£ç æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼ŒXcodeè¿˜åšäº†å¾ˆå¤šå…¶ä»–çš„å·¥ä½œï¼Œä¸»è¦åŒ…æ‹¬ï¼š å‡†å¤‡BuildçŽ¯å¢ƒï¼šåˆ›å»ºBuildç›®å½•ï¼Œå†™å…¥è¾…åŠ©æ–‡ä»¶ï¼Œåˆ›å»ºç›®æ ‡åŒ…ï¼ˆ.app)ï¼› å¤„ç†ä¾èµ–é¡¹ï¼šå¦‚æžœä¾èµ–å…¶ä»–Targetï¼Œä¼šå…ˆBuildæ‰€ä¾èµ–çš„Targetï¼› è¿è¡Œç¼–è¯‘å‰è„šæœ¬ï¼šå¦‚Cocoapodsçš„Check Pods Manifest.lockï¼› ä½¿ç”¨LVVMç¼–è¯‘Targetä¸­çš„æºä»£ç æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œé™æ€é“¾æŽ¥ï¼Œç”ŸæˆMach-Oï¼› ç¼–è¯‘xibå¹¶å°†ç»“æžœå’Œå›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡åŒ…ï¼› ç¼–è¯‘storyboardã€ImageAssetsï¼Œå¹¶å°†ç»“æžœæ‹·è´åˆ°ç›®æ ‡åŒ…ï¼› å¤„ç†Info.plistæ–‡ä»¶ã€ç”Ÿæˆç¬¦å·è¡¨æ–‡ä»¶dSYMï¼› è¿è¡Œç¼–è¯‘åŽè„šæœ¬ï¼šå¦‚Cocoapodsçš„ç¼–è¯‘åŽè„šæœ¬ï¼Œä¼šå°†Podsä¸­ç¼–è¯‘å¥½çš„ä¾èµ–åº“å’Œèµ„æºæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡åŒ…ï¼› ç”ŸæˆAppåŒ…ï¼Œå¹¶å¯¹åŒ…è¿›è¡Œç­¾åï¼› ä¸€ä¸ªTargetå¯ä»¥ä¾èµ–å…¶ä»–Targetï¼ˆæ¯”å¦‚Tests Targetä¾èµ–ä¸»Targetï¼‰ï¼ŒBuildæ—¶ä¼šå…ˆBuildä¾èµ–çš„Targetï¼Œè¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚ Clang/LLVMXcodeçš„Buildè¿‡ç¨‹ä¸­ï¼Œå¯¹æºä»£ç æ–‡ä»¶çš„ç¼–è¯‘æ˜¯ç”±Clang/LLVMï¼ˆæˆ–Swift/LLVMï¼‰æ¥å®Œæˆçš„ï¼ŒLLVMæ˜¯ç¼–è¯‘å™¨åŸºç¡€è®¾æ–½ï¼ŒLLVMå°†ç¼–è¯‘å™¨åˆ†ä¸ºå‰ç«¯ï¼ˆFrontendï¼‰ã€ä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰å’ŒåŽç«¯ï¼ˆBackendï¼‰ï¼Œå‰ç«¯è´Ÿè´£å°†å„ç§è¯­è¨€è½¬æ¢ä¸ºLLVM IRï¼ˆä¸­é—´ä»£ç ï¼‰ï¼Œä¼˜åŒ–å™¨è´Ÿè´£å¯¹LLVM IRè¿›è¡Œä¼˜åŒ–ï¼ŒåŽç«¯åˆ™è´Ÿè´£å°†LLVM IRè½¬æ¢ä¸ºæœºå™¨ä»£ç ï¼Œç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ åœ¨LLVMçš„æž¶æž„ä¸­ï¼Œé’ˆå¯¹ä¸åŒçš„è¯­è¨€ï¼Œå¯ä»¥æœ‰ä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ï¼Œä¼˜åŒ–å™¨ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå®šä¹‰ä¼˜åŒ–èŠ‚ç‚¹ï¼ˆpassï¼‰ï¼Œé’ˆå¯¹ä¸åŒçš„èŠ¯ç‰‡æž¶æž„åˆ™ä¼šæœ‰ä¸åŒçš„ç¼–è¯‘å™¨åŽç«¯ã€‚Clangæ˜¯åŸºäºŽLLVMçš„ã€é’ˆå¯¹C/C++/Objective-Cçš„ç¼–è¯‘å™¨å‰ç«¯ï¼ŒXcodeä¸­ä½¿ç”¨Clang/LLVMå¯¹Targetçš„æºä»£ç æ–‡ä»¶è¿›è¡Œç¼–è¯‘æ—¶ï¼Œå…¶å·¥ä½œæ­¥éª¤åŒ…æ‹¬ï¼š é¢„å¤„ç†ï¼šç”±Clangè¿›è¡Œå®æ›¿æ¢ã€å¤´æ–‡ä»¶å¯¼å…¥ç­‰ï¼› è¯æ³•åˆ†æžå’Œè¯­æ³•åˆ†æžï¼šç”±Clangç”Ÿæˆç¬¦å·è¡¨ã€ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ASTï¼› ç”ŸæˆIRï¼šç”±Clangæ ¹æ®ASTç”ŸæˆLLVM IRï¼› ä¼˜åŒ–IRï¼šXcodeä¸­å¯ä»¥è®¾ç½®ä¼˜åŒ–çº§åˆ«ï¼Œå¼€å¯bitcodeï¼Œè‹¹æžœè¿˜ä¼šåšé¢å¤–çš„ä¼˜åŒ–å·¥ä½œï¼› æ ¹æ®LLVM IRç”Ÿæˆæ±‡ç¼–ï¼Œä¼˜åŒ–åŽå†è½¬ä¸ºæœºå™¨ä»£ç ï¼Œå¾—åˆ°ç›®æ ‡æ–‡ä»¶ï¼ˆObject Fileï¼‰ï¼› å¯¹ç›®æ ‡æ–‡ä»¶è¿›è¡Œé™æ€é“¾æŽ¥ï¼Œç”ŸæˆMach-Oæˆ–Fat Binaryï¼ˆMach-Oçš„é›†åˆï¼‰ï¼› ä¸€ä¸ªMach-Oæ˜¯é’ˆå¯¹æŸä¸€ç‰¹å®šèŠ¯ç‰‡æž¶æž„çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒFat Binaryå°±æ˜¯Appleå°†é’ˆå¯¹ä¸åŒèŠ¯ç‰‡æž¶æž„çš„å¤šä¸ªMach-Oåˆå¹¶åŽå¾—åˆ°çš„é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ BitCodeç”±äºŽFat Binaryä¼šä½¿ç”¨æˆ·ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«å¤§é‡å’Œå½“å‰è®¾å¤‡èŠ¯ç‰‡æž¶æž„æ— å…³çš„å†…å®¹ï¼ŒäºŽæ˜¯åœ¨Xcode 9ä¹‹åŽAppleæŽ¨å‡ºäº†åŸºäºŽBitCodeçš„äºŒè¿›åˆ¶æ–‡ä»¶ç˜¦èº«æ–¹æ¡ˆï¼Œä½œä¸ºæ•´ä¸ªiOSå®‰è£…åŒ…ç˜¦èº«æŠ€æœ¯ä¸­çš„ä¸€çŽ¯ï¼šBitCodeæ˜¯å¯¹LLVM IRè¿›ä¸€æ­¥ä¼˜åŒ–åŽå†ç¼–ç æ‰€å¾—åˆ°çš„ä¸­é—´äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¼€å¯BitCodeä¹‹åŽï¼ŒXcodeåœ¨æ‰“åŒ…ä¸Šä¼ åˆ°App Storeçš„æž„å»ºæ–‡ä»¶ä¸­ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸å†æ˜¯Fat Binaryï¼Œè€Œæ˜¯åŒ…å«BitCodeçš„Mach-Oï¼Œæäº¤åˆ°App StoreåŽï¼Œå†ç”±App Storeè´Ÿè´£æå–å‡ºBitCodeï¼Œç„¶åŽé’ˆå¯¹ä¸åŒçš„èŠ¯ç‰‡æž¶æž„ç¼–è¯‘ã€é“¾æŽ¥ã€ç”Ÿæˆå¯¹åº”çš„Mach-Oï¼Œè¿™æ ·å½“ç”¨æˆ·ä¸‹è½½æ—¶ï¼ŒAppä¸­å°±åªåŒ…å«å½“å‰èŠ¯ç‰‡æž¶æž„æ‰€å¯¹åº”çš„Mach-Oã€‚ BitCodeåœ¨æ•´ä¸ªç¼–ç è¿‡ç¨‹æ‰€å¤„çš„ä½ç½®å¦‚å›¾ï¼š å¼€å¯BitCodeæ¥è¿›è¡ŒAppæ‰“åŒ…ä¸Šä¼ æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š BitCodeä¸€è‡´æ€§ï¼šè¦æ±‚Appæ‰€ä¾èµ–çš„åº“ä¹Ÿå¿…é¡»æ”¯æŒBitCodeï¼Œå¦åˆ™å°±ä¼šæ‰“åŒ…å¤±è´¥ï¼Œæ¯”å¦‚Appä¸­å¦‚æžœä½¿ç”¨äº†ä¸æ”¯æŒBitCodeçš„ä¸‰æ–¹é™æ€åº“ï¼ˆä¾‹å¦‚æŸäº›ä»¥.aå½¢å¼æä¾›çš„ä¸‰æ–¹é—­æºåº“ï¼‰ï¼Œå°±ä¸èƒ½ä½¿ç”¨BitCodeæ‰“åŒ…ä¸Šä¼ ï¼› ä¸‹è½½dSYMæ–‡ä»¶ï¼šç¬¦å·è¡¨æ–‡ä»¶dSYMæ˜¯åœ¨ç”Ÿæˆæœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶åŽå†ç”Ÿæˆçš„ï¼Œä½¿ç”¨BitCodeæ—¶ï¼Œè¿™ä¸€æ­¥ç”±App Storeå®Œæˆï¼Œæ‰€ä»¥Appçš„dSYMæ–‡ä»¶éœ€è¦åˆ°Xcode -&gt; Organizerä¸­ä¸‹è½½ï¼› Build ConfigureXcodeä¸­å¯ä»¥é€šè¿‡Build Pahsesã€Build Ruleså’ŒBuild Settingsæ¥æŽ§åˆ¶Buildçš„è¿‡ç¨‹ã€‚ 1. Build PhasesBuild PhasesæŽ§åˆ¶Buildå„é˜¶æ®µçš„å·¥ä½œå†…å®¹ï¼Œä¸»è¦çš„Phasesæœ‰ï¼š Dependenciesï¼šæŒ‡å®šå½“å‰Targetçš„ä¾èµ–é¡¹ç›®ï¼Œå¯ä»¥æ˜¯å…¶ä»–Targetï¼ŒBuildæ—¶ä¼šå…ˆBuildæ‰€ä¾èµ–çš„é¡¹ç›®ï¼› Headersï¼šå½“Buildç»“æžœçš„Mach-O Typeæ˜¯Dynamic Libraryæˆ–é™æ€åº“Static Libraryæ—¶ï¼Œå¯ä»¥åœ¨Build Phasesä¸­æ·»åŠ Headers Phaseæ¥æŒ‡æ˜Žå…¬å¼€çš„å¤´æ–‡ä»¶ï¼› Compile Sourcesï¼šæ‰€æœ‰éœ€è¦ç¼–è¯‘çš„æºä»£ç æ–‡ä»¶ï¼ŒBuildæ—¶ä¼šæ ¹æ®Build Ruleså’ŒBuild Settingsä¸­è®¾ç½®çš„è§„åˆ™è¿›è¡Œç¼–è¯‘ï¼Œè¿™å„¿ä¹Ÿå¯ä»¥ä¸ºå•ä¸ªæ–‡ä»¶æ·»åŠ ç¼–è¯‘å‚æ•°ï¼Œå¦‚-fno-objc-arcï¼› Link Binary With Librariesï¼šTargetéœ€è¦é“¾æŽ¥çš„é™æ€åº“å’ŒåŠ¨æ€åº“ï¼Œå®ƒä»¬ä¼šå’Œç¼–è¯‘ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶è¿›è¡Œé“¾æŽ¥ï¼› Copy Bundle Resourceï¼šéœ€è¦ç¼–è¯‘åŽæ‹·è´åˆ°åŒ…ä¸­çš„èµ„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬xibã€storyboardã€ImageAssetsç­‰ç­‰ï¼› ä»¥ä¸Šçš„ä¸»è¦Phasesåœ¨Buildè¿‡ç¨‹ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†ä¸»è¦çš„Phasesï¼Œè¿˜å¯ä»¥æŒ‰éœ€è¦ä¸ºTargetçš„Buildè¿‡ç¨‹æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå¯é€‰çš„Pashes: Copy Files Phaseï¼šå°†æŒ‡å®šæ–‡ä»¶æ‹·è´åˆ°Buildæ‰€ç”Ÿæˆçš„ç›®æ ‡åŒ…ï¼ˆ.appï¼‰ä¸­ï¼› Run Script Phaseï¼šæ‰§è¡Œè„šæœ¬ç¨‹åºï¼Œä¾‹å¦‚Cocoapodsçš„Check Pods Manifest.lockå’ŒCopy Pods Resourceséƒ½æ˜¯é€šè¿‡æ­¤æ–¹å¼æ’å…¥åˆ°Buildè¿‡ç¨‹ä¸­çš„ï¼› 2. Build Rulesåœ¨Build Rulesä¸­ï¼Œå¯ä»¥é€šè¿‡æ›´æ”¹ç›¸åº”è„šæœ¬æ¥å¯¹ä¸åŒæ–‡ä»¶è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰çš„ç¼–è¯‘ã€æ‹·è´ã€åŽ‹ç¼©ç­‰ç­‰ã€‚Build Rulesä¸­è¿˜ç½—åˆ—äº†Xcodeå¯¹ä¸åŒæ–‡ä»¶çš„é»˜è®¤å¤„ç†æ–¹å¼ï¼Œå¯ä»¥Copy to TargetåŽè¿›è¡Œè‡ªå®šä¹‰ç¼–è¾‘ã€‚ 3. Build SettingsBuild Settingsæ˜¯å¯¹Buildè¿‡ç¨‹ä¸­å„ä¸ªé˜¶æ®µçš„å‘½ä»¤å‚æ•°çš„è®¾ç½®ï¼Œå†…å®¹éžå¸¸çš„ç¹æ‚ï¼Œæœ‰ä¸€åƒé¡¹å·¦å³ï¼Œåœ¨ç½‘ç«™Xcode Build Settingsä¸Šæœ‰å„é¡¹çš„ç®€è¦ä»‹ç»ã€‚ Mach-O TypeMach-Oæ˜¯iOS/MacOSä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ˜¯ç”±æºç ç»ç¼–è¯‘å†é“¾æŽ¥æ‰€ç”Ÿæˆçš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯Xcodeæ‰€ç”Ÿæˆçš„åº”ç”¨åŒ…ä¸­æœ€é‡è¦çš„äº§ç‰©ã€‚Mach-Oåˆåˆ†ä¸ºä¸åŒçš„ç±»åž‹ï¼Œåœ¨mach-o/loader.hæ–‡ä»¶ä¸­å®šä¹‰äº†Mach-Oçš„ç»†åˆ†ç±»åž‹ï¼Œä»Žåº”ç”¨å¼€å‘çš„è§’åº¦ï¼Œåªéœ€è¦å…³å¿ƒXcodeå°†å…¶ç”Ÿæˆçš„Mach-Oæ‰€åˆ†ä¸ºçš„äº”ç§ç±»åž‹å³å¯ï¼š Executableï¼šå¯å•ç‹¬æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¿…é¡»æœ‰mainæ–¹æ³•ä½œä¸ºæ‰§è¡Œå…¥å£ï¼ŒAppæ‰“åŒ…æ‰€ç”Ÿäº§çš„äºŒè¿›åˆ¶æ–‡ä»¶å³ä¸ºæ­¤ç±»åž‹ï¼› Dylib Libraryï¼šåŠ¨æ€åº“é“¾æŽ¥æ–‡ä»¶ï¼Œæ‰“åŒ…åŠ¨æ€åº“æ—¶éœ€è¦æ³¨æ„åœ¨Build Phasesä¸­æŒ‡æ˜ŽHeadersï¼› Static Libraryï¼šé™æ€åº“é“¾æŽ¥æ–‡ä»¶ï¼Œæ‰“åŒ…é™æ€åº“æ—¶åŒæ ·éœ€è¦æŒ‡æ˜ŽHeadersï¼› Bundleï¼šç‹¬ç«‹çš„åŠ¨æ€åº“ï¼ŒåŒæ—¶è¿˜åŒ…å«èµ„æºæ–‡ä»¶ï¼Œä¸ä¼šè¢«é“¾æŽ¥ï¼Œéœ€è¦æ˜¾ç¤ºåŠ è½½ï¼Œå¯åœ¨è¿è¡Œæ—¶é€šè¿‡dlopen()æˆ–NSBundleçš„-loadæ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚MacOSä¸­å¯ä½œä¸ºåº”ç”¨ç¨‹åºçš„æ’ä»¶ï¼ŒiOSä¸­å¯é€šè¿‡Bundleæ‰“åŒ…èµ„æºæ–‡ä»¶ï¼Œç„¶åŽåœ¨Copy Bundle Resourceä¸­æ‹·è´åˆ°Appä¸­ï¼Œä¸è¿‡ä½œä¸ºèµ„æºåŒ…æ—¶ï¼ŒBundleä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦è¢«åˆ é™¤ï¼› Relocatable Object Fileï¼šå¯é‡å®šå‘çš„ç›®æ ‡æ–‡ä»¶ï¼Œå³æœªè¿›è¡Œé™æ€é“¾æŽ¥çš„ç›®æ ‡æ–‡ä»¶çš„é›†åˆï¼Œæ‰“åŒ…é™æ€åº“æ—¶å¯é€‰æ­¤ç±»åž‹ï¼Œè¿™æ ·å¯ä»¥é¿å…ç¨‹åºä¸­å¤šä¸ªé™æ€åº“éƒ½ä¾èµ–ç›¸åŒçš„é™æ€åº“æ—¶ï¼Œè¢«ä¾èµ–çš„é™æ€åº“è¢«é‡å¤çš„æ‹·è´åˆ°ç¨‹åºä¸­ï¼› Xcodeä¸­ï¼Œåœ¨Build Settings -&gt; Mach-O Typeä¸­å¯ä»¥æŒ‡å®šç¼–è¯‘æ‰€ç”Ÿæˆçš„Mach-Oçš„ç±»åž‹ï¼› é™æ€åº“ä¸ŽåŠ¨æ€åº“æºä»£ç æ–‡ä»¶ç»ç¼–è¯‘æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé™¤å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å¤–ï¼Œæ ¹æ®å…¶æ˜¯åœ¨ç¼–è¯‘æ—¶è¢«é“¾æŽ¥åˆ°ç¨‹åºä¸­ï¼Œè¿˜æ˜¯è¿è¡Œæ—¶è¢«åŠ è½½åˆ°ç¨‹åºä¸­ï¼Œåˆå¯ä»¥åˆ†ä¸ºé™æ€åº“å’ŒåŠ¨æ€åº“ï¼Œå…³äºŽiOS/MacOSä¸­çš„é™æ€åº“å’ŒåŠ¨æ€åº“ï¼Œéœ€è¦äº†è§£çš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š Frameworkï¼šframeworkæ˜¯Xcodeçš„ä¸€ç§ä»£ç æ‰“åŒ…æ–¹å¼ï¼Œframeworkä¸­åŒ…æ‹¬Mach-Oæ–‡ä»¶ã€å¤´æ–‡ä»¶ã€ä»¥åŠç›¸å…³çš„èµ„æºæ–‡ä»¶ï¼Œæ ¹æ®ç”Ÿæˆçš„Mach-Oç±»åž‹çš„ä¸åŒï¼Œframeworkå¯ä»¥æ˜¯åŠ¨æ€åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯é™æ€åº“ã€‚ é™æ€åº“ï¼šé™æ€åº“ä¸»è¦ç”±å¤´æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶æ‰€ç»„æˆï¼Œåœ¨iOS/MacOSä¸­é™æ€åº“çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥æ˜¯.aæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯Static Libraryå’ŒRelocatable Object Fileå¯¹åº”çš„Mach-Oæ–‡ä»¶ã€‚ç¨‹åºå¼•ç”¨çš„é™æ€åº“ï¼Œä¼šåœ¨ç¼–è¯‘æœŸçš„é™æ€é“¾æŽ¥æ—¶è¢«é“¾æŽ¥åˆ°ç›®æ ‡ç¨‹åºä¸­ï¼Œä½¿ç”¨é™æ€åº“ä¼šä½¿ç›®æ ‡ç¨‹åºä½“ç§¯å¢žå¤§ï¼Œä½†ä¸ä¼šè®©ç¨‹åºå¯¹å¤–éƒ¨äº§ç”Ÿä¾èµ–ã€‚ åŠ¨æ€åº“ï¼šåŠ¨æ€åº“ä¹Ÿä¸»è¦ç”±å¤´æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶æ‰€ç»„æˆï¼ŒiOS/MacOSä¸­åŠ¨æ€åº“çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸º.dylibã€.tbdã€æˆ–è€…Dylib Libraryå’ŒBundleå¯¹åº”çš„Mach-Oã€‚ç¨‹åºå¼•ç”¨çš„åŠ¨æ€åº“ä¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ˆå¯åŠ¨æ—¶æˆ–å¯åŠ¨åŽï¼‰è¢«åŠ è½½ï¼Œå¹¶ä¸Žç¨‹åºåŠ¨æ€é“¾æŽ¥ï¼Œä½¿ç”¨åŠ¨æ€åº“ä¸ä¼šä½¿ç¨‹åºä½“ç§¯å¢žå¤§ï¼ŒåŒæ—¶åŠ¨æ€åº“ä¹Ÿå¯ä»¥ç‹¬ç«‹çš„å‡çº§æ›¿æ¢ï¼Œä½†ä½¿ç”¨åŠ¨æ€åº“ä¹Ÿè®©ç¨‹åºå¯¹å¤–éƒ¨äº§ç”Ÿäº†ä¾èµ–ï¼ŒåŒæ—¶åŠ¨æ€åº“çš„åŠ è½½ä¹Ÿä¼šé€ æˆä¸€å®šçš„æ€§èƒ½æŸå¤±ã€‚ Embedded Frameworkï¼šå‡ºäºŽå®‰å…¨è€ƒè™‘ï¼ŒiOSçš„Appä¹‹é—´ä¸å…è®¸ä½¿ç”¨éžå®˜æ–¹çš„åŠ¨æ€åº“ï¼Œä½†åœ¨iOS 8ä¹‹åŽAppå¯ä»¥æœ‰extensionï¼ŒAppå’Œextensionæ˜¯ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»£ç å…±äº«çš„éœ€æ±‚ï¼ŒäºŽæ˜¯ä¾¿æœ‰äº†Embedded Frameworkï¼Œå®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§â€œæ²™ç›’åŠ¨æ€åº“â€ï¼Œåªåœ¨ä¸€ä¸ªAppåŠå…¶extensionä¹‹é—´è¢«å…±äº«ã€‚ Swift Static Librariesï¼šXcode9ä¹‹åŽæ˜¯æ”¯æŒå°†Swiftä»£ç æ‰“åŒ…æˆé™æ€åº“çš„frameworkæ¥ä½¿ç”¨çš„ï¼Œåœ¨Xcode9ä¹‹å‰å› ä¸ºSwiftçš„è¿è¡Œåº“ä¸æˆç†Ÿï¼Œå…¶å¹¶æœªè¢«ä½œä¸ºç³»ç»ŸåŠ¨æ€åº“æ‰€ä½¿ç”¨ï¼ŒXcodeæ‰“åŒ…Swifté™æ€åº“æ—¶ï¼Œä¼šå°†Swiftçš„è¿è¡Œåº“é™æ€é“¾æŽ¥åˆ°æ‰€ç”Ÿæˆçš„é™æ€åº“ä¸­ï¼Œå¦‚æžœAppä½¿ç”¨äº†å¤šä¸ªSwifté™æ€åº“ï¼Œå°±ä¼šé€ æˆAppä¸­Swiftè¿è¡Œåº“çš„é‡å¤ï¼ŒXcode9ä¹‹åŽSwiftçš„è¿è¡Œåº“å·²ç»è¢«åŠ å…¥åˆ°ç³»ç»ŸåŠ¨æ€åº“ä¸­ï¼Œå·²ä¸åœ¨æœ‰æ­¤é™åˆ¶ã€‚]]></content>
      <categories>
        <category>APPå·¥ä½œåŽŸç†</category>
      </categories>
      <tags>
        <tag>ç¼–è¯‘</tag>
        <tag>Mach-O</tag>
        <tag>BitCode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdownè¯­æ³•åŸºç¡€]]></title>
    <url>%2F2017%2F11%2F17%2F%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B%2FMarkdown%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[Reference:Mardownè¯­æ³•è¯´æ˜Ž Markdownçš„å®—æ—¨ï¼šMarkdownçš„ç›®æ ‡æ˜¯å®žçŽ°æ˜“è¯»æ˜“å†™ã€‚å¯è¯»æ€§æ— è®ºå¦‚ä½•éƒ½æ˜¯æœ€é‡è¦çš„ã€‚ ä¸ŽHTMLçš„å…¼å®¹Markdownå¯¹HTMLå…¼å®¹ï¼ŒMarkdownä¹‹å¤–çš„æ ‡ç­¾å¯ä»¥ä½¿ç”¨HTMLæ’°å†™ã€‚éœ€è¦æ³¨æ„çš„æ˜¯HTMLåŒºå—æ ‡ç­¾éœ€è¦åœ¨å‰åŽåŠ ä¸Šç©ºè¡Œå’Œå…¶ä»–å†…å®¹éš”å¼€ï¼Œä¸”è¦æ±‚å¼€å§‹å’Œç»“å°¾æ ‡ç­¾ä¸èƒ½ç”¨åˆ¶è¡¨ç¬¦(tab)æˆ–ç©ºæ ¼æ¥ç¼©è¿›ã€‚åœ¨HTMLåŒºå—æ ‡ç­¾é—´çš„Markdownæ ¼å¼è¯­æ³•ä¸ä¼šè¢«å¤„ç†ï¼Œä½†Markdownè¯­æ³•åœ¨HTMLåŒºæ®µæ ‡ç­¾é—´æ˜¯æœ‰æ•ˆçš„ï¼ŒåŒæ—¶HTMLåŒºæ®µæ ‡ç­¾ä¹Ÿå¯ä»¥åœ¨Markdownæ®µè½ä¸­ç›´æŽ¥ä½¿ç”¨ï¼Œã€‚ &amp;ä¸Ž&lt;åœ¨Markdownçš„HTMLåŒºæ®µä¸­çš„å¦‚æžœå‡ºçŽ°è¿™ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦ï¼ŒMarkdownåœ¨è½¬æ¢æ—¶ä¼šå°†å…¶è‡ªåŠ¨è½¬æ¢ä¸ºHTMLçš„å®žä½“ã€‚ åŒºå—å…ƒç´ é“¾æŽ¥Markdownçš„é“¾æŽ¥æœ‰è¡Œå†…å¼å’Œå‚è€ƒå¼ä¸¤ç§ï¼Œè¡Œå†…å¼æ˜“å†™ï¼Œå‚è€ƒå¼æ˜“è¯»ã€‚ è¡Œå†…å¼é“¾æŽ¥è¯­æ³•ä¸ºä¸­æ‹¬å·+å°æ‹¬å·ï¼Œä¸­æ‹¬å·ä¸­æ˜¯é“¾æŽ¥æ–‡å­—ï¼Œå°æ‹¬å·å†…ä¸ºé“¾æŽ¥å’Œtitleï¼ˆtitleåœ¨é¼ æ ‡æ‚¬åœåœ¨é“¾æŽ¥ä¸Šæ˜¾ç¤ºçš„æç¤ºä¿¡æ¯ï¼‰ï¼Œé“¾æŽ¥å¯ä»¥ä¸ºåŒä¸€ä¸»æœºçš„ç›¸å¯¹åœ°å€ï¼Œtitleç”¨åŒå¼•å·åŒ…èµ·æ¥ï¼Œtitleå¯æœ‰å¯æ— ã€‚ é“¾æŽ¥ä½¿ç”¨+åœ°å€å®šä¹‰ï¼š This is [an example](http://example.com/ &quot;Title&quot;) inline link. å‚è€ƒå¼é“¾æŽ¥è¯­æ³•ä¸ºä¸­æ‹¬å·+ä¸­æ‹¬å·ï¼Œç¬¬äºŒä¸ªä¸­æ‹¬å·ä¸­ä¸ºé“¾æŽ¥çš„æ ‡è¯†ï¼Œç„¶åŽåœ¨ä»»ä½•ä½ç½®ï¼ˆä¸€èˆ¬ä¸ºæ–‡æœ«æˆ–è€…æ®µåŽï¼‰ç”¨æ ‡è®°:é“¾æŽ¥åœ°å€+&quot;title&quot;çš„æ–¹å¼å°†é“¾æŽ¥å†…å®¹å®šä¹‰å‡ºæ¥å³å¯ï¼Œé“¾æŽ¥æ ‡è¯†ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥ä¸ºç©ºï¼Œä¸ºç©ºæ—¶ä¸ºéšå¼æ ‡è¯†ï¼Œå³æ ‡è¯†ä¸ºå‰é¢ä¸­æ‹¬å·ä¸­çš„å†…å®¹ã€‚ é“¾æŽ¥ä½¿ç”¨ï¼š This is [an example][id] reference-style link. åœ°å€å®šä¹‰ï¼š [id]: http://example.com/ &quot;Optional Title Here&quot; å¼ºè°ƒMarkdownå¯ä¸ºæ®µè½ä¸­çš„æ–‡å­—åŠ æ–œä½“ã€ç²—ä½“å’Œåˆ é™¤çº¿ä¸‰ç§æ–¹å¼æ¥è¿›è¡Œå†…å®¹å¼ºè°ƒã€‚æ–¹æ³•æ˜¯ä¸ºè¦å¼ºè°ƒçš„æ–‡å­—å‰åŽåˆ†åˆ«åŠ *ã€**å’Œ~~ï¼Œå…¶ä¸­æ–œä½“å’Œç²—ä½“åˆ†åˆ«ä¼šä¸ºæ–‡å­—åŠ ä¸Š&lt;em&gt;å’Œ&lt;strong&gt;æ ‡ç­¾ã€‚ ä»£ç å¦‚æžœè¦æ ‡è®°ä¸€å°æ®µçš„è¡Œå†…ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨åå¼•å·`å°†å…¶åŒ…èµ·æ¥ï¼Œå¦‚æžœè¦åœ¨ä»£ç æ®µä¸­ä½¿ç”¨åå¼•å·ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªä»¥ä¸Šçš„åå¼•å·çš„å¼€å§‹å’Œç»“æŸä»£ç æ®µ:ä»£ç æ®µä¸­æœ‰`ã€‚è¡Œå†…ä»£ç ä¸­çš„&amp;å’Œ&lt;&gt;åŒæ ·ä¼šè¢«è½¬æ¢ä¸ºå¯¹åº”çš„HTMLå®žä½“ã€‚ å›¾ç‰‡æ’å…¥å›¾ç‰‡å’Œæ’å…¥è¿žæŽ¥çš„è¯­æ³•åŸºæœ¬ç›¸åŒï¼Œä¹Ÿåˆ†ä¸ºè¡Œå†…å¼å’Œå‚è€ƒå¼ï¼ŒåŒºåˆ«æ˜¯æ’å…¥å›¾ç‰‡éœ€è¦åœ¨å‰é¢åŠ ä¸Š!ï¼Œç¬¬ä¸€ä¸ª[]ä¸­æ˜¯å›¾ç‰‡çš„æ›¿ä»£æ–‡å­—ï¼Œå¹¶ä¸ä¼šæ˜¾ç¤ºã€‚Markdownä¸æ”¯æŒæŒ‡å®šå›¾ç‰‡å®½é«˜ï¼Œå¦‚æžœæœ‰éœ€æ±‚å¯ä»¥ä½¿ç”¨HTMLçš„&lt;img&gt;æ ‡ç­¾ã€‚ åŒºæ®µå…ƒç´ æ®µè½å’Œæ¢è¡ŒMarkdownçš„æ®µè½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿žç»­çš„æ–‡æœ¬è¡Œç»„æˆï¼Œä¸€ä¸ªæ®µè½çš„å‰åŽè¦æ±‚å„æœ‰è‡³å°‘ä¸€ä¸ªçš„ç©ºç™½è¡Œã€‚Markdownå…è®¸æ®µè½ä¸­æ¢è¡Œï¼ˆæ’å…¥æ¢è¡Œç¬¦ï¼‰ï¼Œå¹¶ä¸ä¼šæŠŠæ¢è¡Œç¬¦éƒ½è½¬æ¢ä¸º&lt;br /&gt;,è¿žæŒ‰ä¸¤ä¸ªç©ºæ ¼å†æ¢è¡Œï¼ŒMarkdownæ‰ä¼šå°†æ­¤æ¢è¡Œç¬¦è½¬ä¸º&lt;br /&gt;ã€‚ æ ‡é¢˜Markdownçš„æ ‡é¢˜æ”¯æŒSetextï¼ˆåº•çº¿ï¼‰å’Œatxä¸¤ç§å½¢å¼çš„æ ‡é¢˜ï¼Œä½†ä¸€èˆ¬ä½¿ç”¨atxå½¢å¼ï¼Œå³åœ¨è¡Œé¦–æ’å…¥1~6ä¸ª#ï¼Œå¯¹åº”1~6é˜¶æ ‡é¢˜ã€‚ åŒºå—å¼•ç”¨Markdownä½¿ç”¨&gt;æ ‡è®°åŒºå—å¼•ç”¨ï¼ŒMarkdownå…è®¸åªåœ¨æ®µè½çš„é¦–è¡Œæ·»åŠ &gt;æ ‡è®°ï¼ŒåŒæ—¶åŒºå—å¼•ç”¨å¯ä»¥åµŒå¥—ï¼Œæ·»åŠ ä¸åŒæ•°é‡&gt;å³å¯ï¼Œè€Œä¸”åœ¨åŒºå—å†…ä¹Ÿå¯ä»¥ä½¿ç”¨Markdownè¯­æ³•ã€‚ åŒºå—ï¼ˆç¤ºä¾‹ï¼‰ ä¸‰çº§åŒºå— åˆ—è¡¨ Markdownçš„åˆ—è¡¨å¯åˆ†ä¸ºæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ã€‚æœ‰åºåˆ—è¡¨ä½¿ç”¨æ•°å­—æŽ¥ä¸€ä¸ªè‹±æ–‡å¥ç‚¹ä½œä¸ºæ ‡è®°ï¼Œæ•°å­—å¯ä»¥æ˜¯ä¹±åºçš„ï¼ˆä¼šè‡ªåŠ¨æŽ’ï¼‰ï¼Œä½†æœ€å¥½ä¿æŒæœ‰åºã€‚æ— åºåˆ—è¡¨ä½¿ç”¨*,+å’Œ-ä½œä¸ºæ ‡è®°ï¼Œä»–ä»¬çš„åŠŸèƒ½ä¸€æ ·ï¼Œå»ºè®®åœ¨åšåˆ—è¡¨åµŒå¥—æ—¶ä½¿ç”¨ä¸åŒçš„æ ‡è®°æ¥åšåŒºåˆ†ã€‚ç¬¬ä¸€çº§çš„åˆ—è¡¨æ ‡è®°ä¸€èˆ¬æ”¾åœ¨æœ€å·¦è¾¹ï¼Œä½†ä¹Ÿå¯ä»¥ç¼©è¿›ï¼ˆæœ€å¤š3ä¸ªç©ºæ ¼ï¼Œ4ä¸ªç©ºæ ¼=ä¸€ä¸ªtabï¼Œä¼šè¢«è§†ä¸ºåµŒå¥—ï¼‰ã€‚ æ³¨æ„ï¼šå¦‚æžœåˆ—è¡¨é¡¹ç›®é—´ç”¨ç©ºè¡Œåˆ†å¼€ï¼Œåœ¨è¾“å‡ºHTMLæ—¶é¡¹ç›®å†…å®¹å°†ä¼šç”¨&lt;p&gt;æ ‡ç­¾åŒ…èµ·æ¥ã€‚ åˆ—è¡¨çš„é¡¹ç›®ä¸‹å…è®¸æœ‰å¤šä¸ªæ®µè½ï¼Œæ¯ä¸ªé¡¹ç›®ä¸‹çš„æ®µè½éƒ½å¿…é¡»ç¼©è¿›ä¸€ä¸ªtabã€‚ åˆ—è¡¨é¡¹ç›®ä¸­å¯ä»¥åµŒå¥—åŒºå—å¼•ç”¨ï¼Œéœ€è¦åœ¨åŒºå—å‰åŠ ç©ºè¡Œï¼Œå¹¶å¯¹åŒºå—è¿›è¡Œä¸€ä¸ªtabçš„ç¼©è¿›ï¼Œå¦‚ä¸‹ï¼š åµŒå¥—çš„åŒºå— åˆ—è¡¨é¡¹ç›®ä¸­è¿˜å¯ä»¥åµŒå¥—ä»£ç å—ï¼Œä»£ç å—éœ€è¦å‰é¢åŠ ç©ºè¡Œï¼Œå¹¶è¿›è¡Œä¸¤ä¸ªtabçš„ç¼©è¿›ï¼Œå¦‚ä¸‹ï¼š // è¿™å°±æ˜¯ä»£ç  printf(&quot;hello, world&quot;); åˆ—è¡¨ä¸‹ä¹Ÿå¯ä»¥åµŒå¥—è¡¨æ ¼ |å·¦å¯¹é½æ ‡é¢˜ |å³å¯¹é½æ ‡é¢˜ |å±…ä¸­å¯¹é½æ ‡é¢˜ | |:â€“ |â€“: |:â€“: | |çŸ­æ–‡æœ¬ |ä¸­ç­‰æ–‡æœ¬ |ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ | |ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬|çŸ­æ–‡æœ¬ |ä¸­ç­‰æ–‡æœ¬ | å¦‚æžœä¸€å®šä¼šåœ¨å¥é¦–å‡ºçŽ°æ•°å­—+å¥ç‚¹+ç©ºç™½ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å¥ç‚¹å‰åŠ ä¸Šåæ–œæ \ã€‚ è¡¨æ ¼å’Œå…¶ä»–åŒºå—ä¸€æ ·ï¼Œè¡¨æ ¼å‰ä¹Ÿéœ€è¦æœ‰ç©ºç™½è¡Œï¼Œä½¿ç”¨|æ¥åŒºåˆ†åˆ—ï¼Œç¬¬ä¸€è¡Œä¸ºæ ‡é¢˜ï¼Œç¬¬äºŒè¡ŒæŒ‡æ˜ŽåŒä¸€åˆ—çš„æ–‡å­—å¯¹é½æ–¹å¼:--è¡¨ç¤ºå·¦å¯¹é½ï¼Œ--:è¡¨ç¤ºå³å¯¹é½ï¼Œ:-:è¡¨ç¤ºå±…ä¸­å¯¹é½ï¼Œ---è¡¨ç¤ºé»˜è®¤å¯¹é½æ–¹å¼ï¼Œå³æ ‡é¢˜å±…ä¸­å†…å®¹é å·¦ã€‚è¡¨ç¤ºå¯¹é½çš„ç¬¦å·å¯ä»¥æœ‰å¤šä¸ª-ï¼Œä½†-å’Œ:åŠ èµ·æ¥è¦ä¸å°‘äºŽä¸‰ä¸ªã€‚ç¤ºä¾‹ï¼š å·¦å¯¹é½æ ‡é¢˜ å³å¯¹é½æ ‡é¢˜ å±…ä¸­å¯¹é½æ ‡é¢˜ çŸ­æ–‡æœ¬ ä¸­ç­‰æ–‡æœ¬ ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ çŸ­æ–‡æœ¬ ä¸­ç­‰æ–‡æœ¬ ä»£ç åŒºå—Markdownä¸­ä½¿ç”¨ä¸€ä¸ªtabçš„ç¼©è¿›å’Œä¸€ä¸ªæ®µè½ï¼ˆå‰åŽåŠ ç©ºè¡Œï¼‰å³å¯æ’å…¥ä»£ç å—ï¼Œä»£ç å—ä¼šæŒç»­åˆ°æ²¡æœ‰æ²¡æœ‰ç¼©è¿›çš„é‚£ä¸€è¡Œ,ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ç¼©è¿›ï¼Œè€Œæ˜¯åœ¨ä»£ç å—çš„å‰åŽåŠ ä¸Šå„åŠ ä¸€è¡Œä¸‰ä¸ªï¼ˆæˆ–ä»¥ä¸Šï¼‰åå¼•å·`ã€‚åœ¨è½¬æ¢çš„æ—¶å€™ï¼ŒMarkdownä¼šå°†ä»£ç ç”¨&lt;pre&gt;å’Œ&lt;code&gt;æ ‡ç­¾åŒ…èµ·æ¥ï¼Œåœ¨ä»£ç å—ä¸­ï¼ŒMarkdownè¯­æ³•ä¸ä¼šè¢«è½¬æ¢ï¼Œè€Œç¼©è¿›çš„åˆ¶è¡¨ç¬¦ä¹Ÿä¼šè¢«ç§»é™¤ï¼ŒåŒæ—¶&amp;ã€&lt;å’Œ&gt;è¿™ç§HTMLç‰¹æ®Šç¬¦å·ä¹Ÿä¼šè‡ªåŠ¨è½¬ä¸ºHTMLå®žä½“ï¼Œä¾‹å¦‚ï¼š &lt;div class=&quot;footer&quot;&gt; &amp;copy; 2004 Foo Corporation &lt;/div&gt; åˆ†éš”çº¿å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªåŠä»¥ä¸Šçš„*ã€-å’Œå‡å·æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼Œåˆ†éš”çº¿è¡Œå†…ä¸èƒ½æœ‰å…¶å®ƒä¸œè¥¿ï¼ˆ*å’Œ-ä¹‹é—´å¯ä»¥æ’å…¥ç©ºæ ¼ï¼‰ï¼Œä¾‹å¦‚ï¼š åˆ†éš”çº¿è¿˜æœ‰åˆ†éš”å‡ºå•ç‹¬ä¸€æ®µçš„æ•ˆæžœï¼Œä¸ºäº†é¿å…ç›´æŽ¥åœ¨æ–‡å­—åŽåŠ -ï¼Œè€Œå’ŒSetextï¼ˆåº•çº¿ï¼‰æ ‡é¢˜è¯­æ³•æ··æ·†ï¼Œåˆ†éš”çº¿å‰åº”ç•™ä¸€ä¸ªç©ºç™½è¡Œï¼Œæˆ–å»ºè®®ä½¿ç”¨****ã€‚ å…¶ä»–è‡ªåŠ¨é“¾æŽ¥Markdownæ”¯æŒç”¨æ¯”è¾ƒç®€çŸ­è‡ªåŠ¨é“¾æŽ¥å½¢å¼æ¥å¤„ç†ç½‘å€å’Œç”µå­é‚®ç®±ï¼Œåªéœ€è¦ç”¨å°–æ‹¬å·åŒ…èµ·æ¥å³å¯ã€‚å¦‚é‚®ç®±&#x79;&#x6f;&#117;&#x78;&#105;&#x61;&#110;&#x67;&#64;&#x71;&#x71;&#46;&#x63;&#x6f;&#x6d;ï¼Œç½‘å€http://www.baidu.comã€‚å€¼å¾—ä¸€æçš„æ˜¯é‚®ç®±åœ°å€çš„å­—ç¬¦ä¼šè¢«Markdownè½¬æ¢ä¸ºå¯¹åº”çš„16è¿›åˆ¶ç çš„HTMLå®žä½“ï¼Œä»¥é˜²å¾¡ä¸€äº›é‚®ç®±æ”¶é›†æœºå™¨äººã€‚ åæ–œæ Markdownä¸­çš„è¯­æ³•ç¬¦å·è¦ç›´æŽ¥æ˜¾ç¤ºè€Œä¸è¡¨ç¤ºè¯­ä¹‰çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ç¬¦å·å‰é¢åŠ \æ¥è½¬ä¹‰ã€‚å¯¹åº”çš„ç¬¦å·æœ‰ï¼š \ åæ–œæ  ` åå¼•å· * æ˜Ÿå· _ åº•çº¿ {} å¤§æ‹¬å· [] ä¸­æ‹¬å· () å°æ‹¬å· # äº•å· + åŠ å· - å‡å· . è‹±æ–‡å¥ç‚¹ ! æƒŠå¹å·]]></content>
      <categories>
        <category>å·¥å…·æ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
</search>
